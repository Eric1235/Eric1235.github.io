
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>2016-9笔记 | Eric&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Eric Li">
    

    
    <meta name="description" content="多事之秋 不关我事的开学季

感觉情况好了很多，我在一帮老司机的带领下，算是在正确的轨道上面成长">
<meta property="og:type" content="article">
<meta property="og:title" content="2016-9笔记">
<meta property="og:url" content="http://yoursite.com/2016/09/14/Coding/2016-9笔记/2016-9笔记/index.html">
<meta property="og:site_name" content="Eric's Blog">
<meta property="og:description" content="多事之秋 不关我事的开学季

感觉情况好了很多，我在一帮老司机的带领下，算是在正确的轨道上面成长">
<meta property="og:updated_time" content="2016-09-30T06:50:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2016-9笔记">
<meta name="twitter:description" content="多事之秋 不关我事的开学季

感觉情况好了很多，我在一帮老司机的带领下，算是在正确的轨道上面成长">
<meta name="twitter:creator" content="@ericli1235">
<link rel="publisher" href="Eric1235">

    
    <link rel="alternative" href="/atom.xml" title="Eric&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Eric&#39;s Blog" title="Eric&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Eric&#39;s Blog">Eric&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/14/Coding/2016-9笔记/2016-9笔记/" title="2016-9笔记" itemprop="url">2016-9笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2016-09-14T01:56:46.000Z" itemprop="datePublished"> 发表于 2016-09-14</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-天气-阴"><span class="toc-number">1.</span> <span class="toc-text">9-1 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-天气-阴"><span class="toc-number">2.</span> <span class="toc-text">9-2 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-天气-晴"><span class="toc-number">3.</span> <span class="toc-text">9-5 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-天气-晴"><span class="toc-number">4.</span> <span class="toc-text">9-6 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-7-天气-晴"><span class="toc-number">5.</span> <span class="toc-text">9-7 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-8-天气-阴"><span class="toc-number">6.</span> <span class="toc-text">9-8 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-9-天气-晴"><span class="toc-number">7.</span> <span class="toc-text">9-9 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-10-天气-雨"><span class="toc-number">8.</span> <span class="toc-text">9-10 天气:雨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-12-天气-晴"><span class="toc-number">9.</span> <span class="toc-text">9-12 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-13-天气-晴"><span class="toc-number">10.</span> <span class="toc-text">9-13 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-14-天气-晴"><span class="toc-number">11.</span> <span class="toc-text">9-14 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-17-天气-晴"><span class="toc-number">12.</span> <span class="toc-text">9-17 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-18-天气-晴"><span class="toc-number">13.</span> <span class="toc-text">9-18 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-19-天气-晴"><span class="toc-number">14.</span> <span class="toc-text">9-19 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-20-天气-阴雨"><span class="toc-number">15.</span> <span class="toc-text">9-20 天气:阴雨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-23-天气-晴"><span class="toc-number">16.</span> <span class="toc-text">9-23 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-24-天气-晴"><span class="toc-number">17.</span> <span class="toc-text">9-24 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-26-天气-晴"><span class="toc-number">18.</span> <span class="toc-text">9-26 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-27-天气-晴"><span class="toc-number">19.</span> <span class="toc-text">9-27 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-28-天气-晴"><span class="toc-number">20.</span> <span class="toc-text">9-28 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-29-天气-阴"><span class="toc-number">21.</span> <span class="toc-text">9-29 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-30-天气-小雨"><span class="toc-number">22.</span> <span class="toc-text">9-30 天气:小雨</span></a></li></ol>
		
		</div>
		
		<p><code>多事之秋</code> <code>不关我事的开学季</code></p>
<blockquote>
<p>感觉情况好了很多，我在一帮老司机的带领下，算是在正确的轨道上面成长</p>
</blockquote>
<a id="more"></a>
<h3 id="9-1-天气-阴"><a href="#9-1-天气-阴" class="headerlink" title="9-1 天气:阴"></a>9-1 天气:阴</h3><p>今天服务器还是登陆不上，我都不能愉快地去玩我的下载了。那就，凭着感觉，去继续调整好ui吧。</p>
<ul>
<li>解决了全选的时候，ui不响应的问题。判断的时候，要去剔除假数据。<br>adapter里面的选择</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectAll</span><span class="params">(<span class="keyword">boolean</span> select)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(select)&#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; mList.size() ; i ++)&#123;</div><div class="line">                <span class="keyword">if</span>(mList.get(i).getType() == <span class="number">0</span> || mList.get(i).getType() == <span class="number">1</span>)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                isSelected.put(i,<span class="keyword">true</span>);</div><div class="line">            &#125;</div><div class="line">            ischeckall = <span class="keyword">true</span>;</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; mList.size() ; i ++)&#123;</div><div class="line">                <span class="keyword">if</span>(mList.get(i).getType() == <span class="number">0</span> || mList.get(i).getType() == <span class="number">1</span>)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                isSelected.put(i,<span class="keyword">false</span>);</div><div class="line">            &#125;</div><div class="line">            ischeckall = <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        isclickall = <span class="keyword">false</span>;</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>按钮的监听</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">viewHolder.cbSelect.setOnCheckedChangeListener(<span class="keyword">new</span> CompoundButton.OnCheckedChangeListener()&#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCheckedChanged</span><span class="params">(CompoundButton buttonView, <span class="keyword">boolean</span> isChecked)</span> </span>&#123;</div><div class="line">                isSelected.put(position,isChecked);</div><div class="line">                <span class="keyword">if</span>(isChecked)&#123;</div><div class="line">                    mSelectCount ++;</div><div class="line">                    mSelectListener.onChange(mSelectCount);</div><div class="line">                &#125;<span class="keyword">else</span> &#123;</div><div class="line">                    mSelectCount --;</div><div class="line">                    mSelectListener.onChange(mSelectCount);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p>ui里面的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">mAdapter.setSelectListener(<span class="keyword">new</span> FileListAdapter.SelectListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChange</span><span class="params">(<span class="keyword">int</span> mcount)</span> </span>&#123;</div><div class="line">                HashMap&lt;Integer,Boolean&gt; isselected =  mAdapter.getIsSelected();</div><div class="line">                <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">                <span class="keyword">if</span>(isselected != <span class="keyword">null</span> &amp;&amp; mFileInfoList != <span class="keyword">null</span>  &amp;&amp; mFileInfoList.size() &gt; <span class="number">0</span>)</div><div class="line">                &#123;</div><div class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;mFileInfoList.size(); i++)</div><div class="line">                    &#123;</div><div class="line">                        <span class="keyword">if</span>(mFileInfoList.get(i).getType() == <span class="number">0</span> || mFileInfoList.get(i).getType() == <span class="number">1</span>)</div><div class="line">                            <span class="keyword">continue</span>;</div><div class="line">                        <span class="keyword">if</span>(isselected.get(i))</div><div class="line">                            count ++;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(mcount &gt; <span class="number">0</span>)&#123;</div><div class="line">                    btnDelete.setEnabled(<span class="keyword">true</span>);</div><div class="line">                    btnDelete.setBackgroundColor(getResources().getColor(R.color.red));</div><div class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(mcount == <span class="number">0</span>)&#123;</div><div class="line">                    btnDelete.setEnabled(<span class="keyword">false</span>);</div><div class="line">                    btnDelete.setBackgroundColor(getResources().getColor(R.color.line_gray));</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(count == (mAdapter.getCount() - fakeDataSize))&#123;</div><div class="line">                    cbChooseAll.setButtonDrawable(R.drawable.checkbox_checked_icon);</div><div class="line">                &#125;<span class="keyword">else</span> &#123;</div><div class="line">                    cbChooseAll.setButtonDrawable(R.drawable.checkbox_uncheck_icon);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<ul>
<li>去除ui中最后一项的线，这个的思路就是。看看下一项是不是title，如果是，就去隐藏掉那条线。要是这样写，就肯定会报数组越界。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//隐藏最后一项的线</span></div><div class="line">DownloadFileInfoBean temp = getItem(position +<span class="number">1</span>);</div><div class="line"><span class="comment">//已完成的标题</span></div><div class="line"><span class="keyword">if</span>(temp.getType() == <span class="number">1</span>)&#123;</div><div class="line">    viewHolder.viewLine.setVisibility(View.GONE);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>正确的改法，加多一句判断。最后一条，无论如何也是要显示的，啥也别说了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//隐藏最后一项的线</span></div><div class="line">        <span class="keyword">if</span>(position &lt; getCount()-<span class="number">1</span>)&#123;</div><div class="line">            DownloadFileInfoBean temp = getItem(position +<span class="number">1</span>);</div><div class="line">            <span class="comment">//已完成的标题</span></div><div class="line">            <span class="keyword">if</span>(temp.getType() == <span class="number">1</span>)&#123;</div><div class="line">                viewHolder.viewLine.setVisibility(View.GONE);</div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line">                viewHolder.viewLine.setVisibility(View.VISIBLE);</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(position == getCount() -<span class="number">1</span>)&#123;</div><div class="line">            viewHolder.viewLine.setVisibility(View.VISIBLE);</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<ul>
<li>瞎扯一下ui的布局编写吧。布局整体移动的话，这里没有要求做动画效果，涉及的就是没有那么多了。我所要做的就是然后布局在隐藏布局的右边，等待隐藏控件再度出现，自己去刷新。额，就这么简单。什么时候，给我来一点动画？</li>
<li>下面这个就是需求的问题了。要求去屏蔽掉老师端，不能让其找到离线课程的入口，因为没有这个功能。我去找了手机版好久，怎么没有前人的痕迹？瞎搞了一下，才记起来，手机版没有教师功能的。于是，我就停手了，去搞其他平板端了。</li>
<li>为了更好的用户体验，我是不是要去处理一下编辑中的listview的点击事件呢。进入编辑状态，就要禁止点击了啦，防止误触。事实证明，在编辑状态的时候，把点击事件设置为null，退出编辑状态的时候才设置回去的方法是可行的。</li>
<li>学习一点新知识，检查当前线程是不是主线程。原来，getMainLooper就是拿到主线程的looper，然后判断当前线程是否等于这个线程就好。避免耗时操作在主线程中进行的话，就用这个去做判断。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (Thread.currentThread() == Looper.getMainLooper().getThread())</div></pre></td></tr></table></figure>
<h3 id="9-2-天气-阴"><a href="#9-2-天气-阴" class="headerlink" title="9-2 天气:阴"></a>9-2 天气:阴</h3><p>数一数，今天到底是干了什么呢？干了什么呢？</p>
<ul>
<li>把精准红点控制那里，我做了查询数据库的逻辑。同屏的，就要去接收本地广播，实时根据数据库去控制红点显示或者隐藏（主要用于平板）。不同屏的，最好就是在onresume那里去更新，等到页面重现，刷新就好。</li>
<li>今天使用了开源的viewpager指示器。最纳闷的就是为了实现那种效果，而要撸一个出来。问题一开始是找不到当前的fragment。</li>
<li>新学到的知识，viewpager的页面切换listener，可以是add，也可以是set。前者的话，都能够响应多个。</li>
<li>修改好了顶部栏的ui，现在可以自由去慢慢调整ui了。</li>
<li>问题又来了，现在不是全部保存这些界面，就是意味着，重新回来的时候，和service的连接问题就复杂了。</li>
<li>这个破网络，终于让我可以有机会可以测试重连的功能了，哈哈。我把下载的方法抽离出来，只要捕获到相应的异常，就再次调用这个方法去继续尝试。尝试失败的话，计数器加1，如果尝试成功，则计数器置0.好了，我现在要思考一下我的timeout事件设置为3秒到底对不对了。我写的下载类。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">OkHttpDownLoad</span> <span class="keyword">extends</span> <span class="title">ThreadPoolTask</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> DownloadThreadInfoBean threadInfo = <span class="keyword">null</span>;</div><div class="line">        OkHttpClient client = <span class="keyword">null</span>;</div><div class="line">        RandomAccessFile randomAccessFile = <span class="keyword">null</span>;</div><div class="line">        InputStream inputStream = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">long</span> startPosition;<span class="comment">//下载的开始位置</span></div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> connectTimes = <span class="number">0</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">boolean</span> isFinished = <span class="keyword">false</span>;<span class="comment">//标识本线程是否下载完成</span></div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">OkHttpDownLoad</span><span class="params">(DownloadThreadInfoBean info)</span></span>&#123;</div><div class="line">            <span class="keyword">super</span>(<span class="string">"download thread"</span>);</div><div class="line">            threadInfo = info;</div><div class="line">            client = service.getClient();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        BaseDownloadApiClient service = BaseDownloadApiClient.getInstance();</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTask</span><span class="params">(Object parameter)</span> </span>&#123;</div><div class="line">            download();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">download</span><span class="params">()</span></span>&#123;</div><div class="line">            startPosition = threadInfo.getStart_position() + threadInfo.getFinished_size();</div><div class="line">            Request request = <span class="keyword">new</span> Request.Builder().url(threadInfo.getUrl())</div><div class="line">                    .addHeader(<span class="string">"Range"</span>, <span class="string">"bytes="</span> +startPosition+<span class="string">"-"</span>+threadInfo.getEnd_position()).build();</div><div class="line">            client.newCall(request).enqueue(<span class="keyword">new</span> Callback() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Request request, IOException e)</span> </span>&#123;</div><div class="line">                    <span class="keyword">if</span>(connectTimes &lt; <span class="number">10</span>)&#123;</div><div class="line">                        connectTimes ++;</div><div class="line">                        download();</div><div class="line">                        DebugUtils.d(<span class="string">"Eric"</span>,<span class="string">"task connectTimes="</span> + connectTimes);</div><div class="line">                    &#125;<span class="keyword">else</span> &#123;</div><div class="line">                        updateDownloadFinishedSize(mTotalFinishSize);</div><div class="line">                        updateDownloadFileStatus(Status.NETWORK_ERROR);</div><div class="line">                        setTaskStatus(Status.NETWORK_ERROR);</div><div class="line">                        setNetwork_Error(<span class="keyword">true</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Response response)</span></span>&#123;</div><div class="line">                    <span class="keyword">try</span>&#123;</div><div class="line">                        inputStream = response.body().byteStream();</div><div class="line">                        File file = <span class="keyword">new</span> File(DownloadService.DOWNLOAD_PATH,mFileInfo.getFile_name()+<span class="string">".mp4"</span>);</div><div class="line">                        randomAccessFile = <span class="keyword">new</span> RandomAccessFile(file, <span class="string">"rwd"</span>);</div><div class="line">                        randomAccessFile.seek(startPosition);</div><div class="line">                        <span class="keyword">int</span> length ;</div><div class="line">                        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">4</span>];</div><div class="line">                        <span class="keyword">while</span>((length = inputStream.read(buffer))!= -<span class="number">1</span>)&#123;</div><div class="line">                            <span class="comment">//连接成功就置0</span></div><div class="line">                            connectTimes = <span class="number">0</span>;</div><div class="line">                            randomAccessFile.write(buffer,<span class="number">0</span>,length);</div><div class="line">                            threadInfo.setFinished_size(threadInfo.getFinished_size() + length);</div><div class="line">                            mFinishedMap.put(threadInfo.getThread_id(),threadInfo.getFinished_size());</div><div class="line">                            <span class="keyword">synchronized</span> (DownloadTask.<span class="keyword">this</span>)&#123;</div><div class="line">                                mTotalFinishSize += length;</div><div class="line">                                mDownloadSpeed += length;</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">if</span>(isPaused())&#123;</div><div class="line">                                updateDownloadFinishedSize(mTotalFinishSize);</div><div class="line">                                setTaskStatus(Status.PAUSE);</div><div class="line">                                updateDownloadFileStatus(Status.PAUSE);</div><div class="line">                                <span class="keyword">return</span>;</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">if</span>(isNetwork_Error())&#123;</div><div class="line">                                updateDownloadFinishedSize(mTotalFinishSize);</div><div class="line">                                setTaskStatus(Status.NETWORK_ERROR);</div><div class="line">                                updateDownloadFileStatus(Status.NETWORK_ERROR);</div><div class="line">                                <span class="keyword">return</span>;</div><div class="line">                            &#125;</div><div class="line">                            <span class="comment">//这个停止，不会被移出队列，用于暂停正在下载的任务到等待中</span></div><div class="line">                            <span class="keyword">if</span>(isPauseAndNotRemove())&#123;</div><div class="line">                                <span class="keyword">return</span>;</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                        isFinished = <span class="keyword">true</span>;</div><div class="line">                        checkAllThreadFinished();</div><div class="line">                    &#125;<span class="keyword">catch</span> (Throwable e)&#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                        <span class="keyword">if</span>(connectTimes &lt; <span class="number">10</span>)&#123;</div><div class="line">                            connectTimes++;</div><div class="line">                            download();</div><div class="line">                            DebugUtils.d(<span class="string">"Eric"</span>,<span class="string">"exception task connectTimes="</span> + connectTimes);</div><div class="line">                        &#125;<span class="keyword">else</span> &#123;</div><div class="line">                            <span class="comment">/**</span></div><div class="line">                             * 线程异常退出，终止任务</div><div class="line">                             * 只要保存好现场，并且把状态设置成为pause（要不要多设置一种状态为网络错误），就service就会删除任务</div><div class="line">                             */</div><div class="line">                            updateDownloadFinishedSize(mTotalFinishSize);</div><div class="line">                            updateDownloadFileStatus(Status.NETWORK_ERROR);</div><div class="line">                            setTaskStatus(Status.NETWORK_ERROR);</div><div class="line">                            setNetwork_Error(<span class="keyword">true</span>);</div><div class="line">                            e.printStackTrace();</div><div class="line">                        &#125;</div><div class="line">                    &#125;<span class="keyword">finally</span> &#123;</div><div class="line">                        <span class="keyword">try</span> &#123;</div><div class="line">                            <span class="keyword">if</span>(inputStream != <span class="keyword">null</span>)&#123;</div><div class="line">                                inputStream.close();</div><div class="line">                            &#125;</div><div class="line">                        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                            e.printStackTrace();</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">try</span>&#123;</div><div class="line">                            <span class="keyword">if</span>(randomAccessFile != <span class="keyword">null</span>)&#123;</div><div class="line">                                randomAccessFile.close();</div><div class="line">                            &#125;</div><div class="line">                        &#125;<span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                            e.printStackTrace();</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="9-5-天气-晴"><a href="#9-5-天气-晴" class="headerlink" title="9-5 天气:晴"></a>9-5 天气:晴</h3><p>今天回到公司，应该就是要把下载的收尾一下，然后进行提测。我下一点眼神去看看需求页。握草，怎么会有东西改了的，我之前做的东西呢，这个怎么破？辛辛苦苦做好了精准红点控制，现在就说不要了，我们改成模糊的控制就好。但是我还是有一点不懂了啦，怎么做？</p>
<ul>
<li>问了一下老大，说，你在外层点击的时候，把所有的状态设置一下就好了，内层的操作就不要操作了。根据我之前写代码的性格，我会把内层操作的代码真的全部删除干净。但是我今天下午认识到了产品的善变，我决定还是把代码注释掉就好了，鬼知道下一版会不会又说要精准控制。</li>
<li><p>顶部栏的tab是要动态生成的。封装的数据库操作函数是没有这种方法，自己动手写原生的解决。就是要记得不能在主线程操作数据库就好了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">queryAllSubjects</span><span class="params">()</span></span>&#123;</div><div class="line">       checkMainThread();</div><div class="line">       List&lt;String&gt; subjectList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">       Cursor cursor;</div><div class="line">       String sql = <span class="string">"SELECT DISTINCT subject_name FROM DownloadFileInfoBean ORDER BY subject_name"</span>;</div><div class="line">       cursor = dbHelper.getReadableDatabase().rawQuery(sql,<span class="keyword">null</span>);</div><div class="line">       <span class="keyword">while</span> (cursor.moveToNext())&#123;</div><div class="line">           String subject = cursor.getString(cursor.getColumnIndex(<span class="string">"subject_name"</span>));</div><div class="line">           subjectList.add(subject);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">if</span>(cursor != <span class="keyword">null</span>)&#123;</div><div class="line">           cursor.close();</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> subjectList;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>关于删除的时候，如何通知通知其他界面也去刷新呢？我目前采用的策略就是本地广播。不过要过滤掉自己。</p>
</li>
<li>平板端还是有很多不同的说。界面啊界面，你干嘛不主动去刷新的啦。我现在新建任务的话，你这里刷新不了了，囧。</li>
<li>onResume不能把super的东西删除了。</li>
<li>虽然红点已经不用精准了，但是联动还是要改一下的。有三级红点这么多，我也是够晕了。好好改一下逻辑，好好利用本地广播就能够解决这个问题了。</li>
</ul>
<h3 id="9-6-天气-晴"><a href="#9-6-天气-晴" class="headerlink" title="9-6 天气:晴"></a>9-6 天气:晴</h3><p>我看了看，哎呀，红点有问题。目前，通过广播是不能够解决的了。那就，咱们先不解决，在onResume那里让它自己去刷新就好了，其他先不用管。<br>想了想，我还是要继续去学习英语。戈军说过，笛福的《鲁滨逊漂流记》很容易可以看懂的。之前家里也有也有这几本中英对照的书，我好像只是看了中文版。对鲁滨逊很欣赏，就去重拾旧事啦。给自己3个月的时间把纯英文版的去看完。靠，竟然有时间蛇王，代码写完了吗？</p>
<ul>
<li>清理无用的脏数据要紧。本地视频被恶意删除以后，记录也要去进行删除。在哪里做这个玩意好呢？额，就在再次进入app的时候啦。这个，就是比如说安卓内部的相册管理吧，你把文件删除了，当然就不显示这记录。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkDownloadFileExists</span><span class="params">()</span></span>&#123;</div><div class="line">        ThreadPoolTask checkDownloadFileExistsTask = <span class="keyword">new</span> ThreadPoolTask(<span class="string">"checkDownloadFileExistsTask"</span>) &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTask</span><span class="params">(Object parameter)</span> </span>&#123;</div><div class="line">                BundleDbHelper dbHelper = <span class="keyword">new</span> BundleDbHelper();</div><div class="line">                List&lt;DownloadFileInfoBean&gt; list = dbHelper.queryForAllNoRole(DownloadFileInfoBean.class);</div><div class="line">                <span class="keyword">if</span>(list != <span class="keyword">null</span> &amp;&amp; list.size() &gt; <span class="number">0</span>)&#123;</div><div class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; list.size() ; i ++)&#123;</div><div class="line">                        DownloadFileInfoBean temp = list.get(i);</div><div class="line">                        <span class="keyword">if</span>(!FileUtil.checkFileExists(temp.getLocal_url()))&#123;</div><div class="line">                            DownloadFileDbHelper dbHelper1 = <span class="keyword">new</span> DownloadFileDbHelper();</div><div class="line">                            dbHelper1.deleteFileInfo(temp.getFile_url());</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        checkDownloadFileExistsTask.postLongTask();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>下载的时候，让格式一开始不是.mp4，让我随便去加？这个，怎么总感觉是有点怪怪的。目的，看看下载的视频是否完整哦。重装app直接卸载</li>
<li>app卸载数据残留问题，只要这样去设置就可以了，会跟着app的卸载而消失。这个对应的就是app中的清除数据选项。还有另外一个cache文件夹，对应的就是清除缓存选择项。在那可以清除？就在设置那里咯。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">File dir = getExternalCacheDir();</div></pre></td></tr></table></figure>
<ul>
<li>关于下拉刷新的问题，一般的界面都是要加上下拉刷新的。我那个离线下载管理界面，由于重建比较频繁，所以基本不用，只要放在onResume那里去刷新数据就好了。其实关于要不要下拉刷新，还是取决于数据来自于哪里吧。和服务器打交道多的页面，最好加入下拉刷新功能。</li>
</ul>
<h3 id="9-7-天气-晴"><a href="#9-7-天气-晴" class="headerlink" title="9-7 天气:晴"></a>9-7 天气:晴</h3><ul>
<li>今天早上的任务就是换一下adapter，改好搜索的界面显示等等。问题就来了，谁改了我的代码，搞到我有点失忆症的尴尬一样。把两个fragment砍掉一个，不能直接用activity去直接显示，在里面包一个fragment，谁知道以后要不要在里面加点东西进去。</li>
<li>业务逻辑更加有感觉了。比如说我现在会去考虑要怎么提升用户体验。关于搜索的参数传递，它到另外一个界面以后，还是要把它显示出来，让用户有点家的感觉咯。</li>
</ul>
<hr>
<p>以下是今天技术知识积累</p>
<ul>
<li>关于looper一直在主线程无限循环，为什么没有造成anr。额，你说反了吧。anr是事件得不到处理，才会造成主线程anr。主线程正是靠着looper在一直无限循环，才不会立马就退出。looper会构成生产者–消费者模式。</li>
<li>anr的三种基本类型：触摸事件得不到响应，一般5秒；广播得不到执行，10秒；service无法在指定的时间响应，一般20秒。一般的耗时事件为：在主线程操作数据库；在主线程进行网络操作；</li>
<li>养成良好的编程习惯，坚决避免写这些逻辑错误的代码。</li>
<li>support lib更新了一点新东西，使用bottom sheet 可以实现底部滑动滑出界面。还可以利用bottomsheetdialog代替底部弹出的popupwindow。</li>
<li>郭霖博客上面推荐的LRecyclerView。可以增加很多功能进去里面哦。包括左右滑动菜单，长按拖拽，滑动删除。gridview也同样可以。滑动删除和滑动菜单是互相冲突的，这有点常识的都应该知道的了。可以指定某项不能滑动，也不能被删除，就是有vip的存在。侧滑也是可以的，整体布局移动，显示隐藏的布局。</li>
<li>圆形温度显示，学习自定义控件还是不错的<br><a href="https://github.com/ljuns/TemperatureView" target="_blank" rel="external">github源码链接</a></li>
</ul>
<h3 id="9-8-天气-阴"><a href="#9-8-天气-阴" class="headerlink" title="9-8 天气:阴"></a>9-8 天气:阴</h3><p>讨论了一下，我们app的核心就是授课模块，我很想跟着强哥去干的。这个新的播放器的确颠覆了我对以往播放器的认识。数据源不是一帧一帧的来，而是ppt，音频，聊天，涂鸦这几个信息分开来传送，client接收到以后，再以特定的方式去实现播放。</p>
<ul>
<li>单个界面的话，正确的做法就是用一个activity去托管fragment。</li>
<li>一个自定义的textview，主要就是其底部的view的selector显示。集合到一个view中就好了，不必要使用两个view。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;TextView</div><div class="line">  android:id=<span class="string">"@+id/order_condition_all"</span></div><div class="line">  android:layout_width=<span class="string">"0dp"</span></div><div class="line">  android:layout_height=<span class="string">"match_parent"</span></div><div class="line">  android:layout_weight=<span class="string">"1"</span></div><div class="line">  android:drawableBottom=<span class="string">"@drawable/public_courseslist_series_tag_selector"</span></div><div class="line">  android:gravity=<span class="string">"center"</span></div><div class="line">  android:text=<span class="string">"全部"</span></div><div class="line">  android:textColor=<span class="string">"@color/public_courseslist_series_tag_text_color"</span></div><div class="line">  android:textSize=<span class="string">"@dimen/size_14"</span> /&gt;</div></pre></td></tr></table></figure>
<ul>
<li>我昨天看到用另外一种方法去设置fragment的显示隐藏的标志位。onResume去设置为true，表示在显示状态；onPause设置为false，表示隐藏状态。对于数据刷新，就可以根据这个标志位去做？？？</li>
<li>java的比较器，0表示相等；1 大于；-1 小于。</li>
<li>数据库操作那里有问题了，我不应该把文件写数据库的操作放到download的时候才执行，应该是一来到的时候就要将数据写进去数据库，然后对其执行更新。这个操作好像不行，我只能想其他的方法去解决。具体为什么不行呢，我没有深究。改用其他的方法去做。把它的状态进行保留了啦，如果数据库有这个记录的话，保留isWatched这个字段。</li>
<li>对popupwindow的使用有了一点新的认识，调用其View.showAsDropDown(anchor,0,0);就可以让popupwindow在anchor的左下方，其余两个参数就是偏移量。mPop.showAtLocation(findViewById(R.id.parent), Gravity.LEFT, 0, -90);（以某个View为参考）,表示弹出窗口以parent组件为参考，位于左侧，偏移-90。</li>
<li>安卓知识点学习：setContentView()这个方法。本来我的activity只是弄了一个layout，但是用工具一看，前面有好多的view，就是setContentView()这个方法弄的，它会去包装activity。</li>
</ul>
<h3 id="9-9-天气-晴"><a href="#9-9-天气-晴" class="headerlink" title="9-9 天气:晴"></a>9-9 天气:晴</h3><p>今天，就请求组织分配新的任务，我可以跟着去做。辛巍吐槽我做的东西不精确，不行，我必须得甩锅，虽然是不好，但是也是需求不清晰我才做成那样的。我这种态度和想法也不好，以后一有问题先去问清楚产品再继续做，然后就不会和ios差别那么大了。</p>
<ul>
<li>今天第一个任务就是修改tab的显示为靠左，之前这个默认的是平均分的。这个是一个开源控件，咱们先进源码看看，如果太难，可以考虑换一个库。一步一步去跟踪代码，然后好像发现了点什么，FixedIndicatorView里面自带了这种显示方式的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">measureTabs</span><span class="params">()</span> </span>&#123;</div><div class="line">     <span class="keyword">int</span> count = getTabCountInLayout();</div><div class="line">     <span class="keyword">switch</span> (splitMethod) &#123;</div><div class="line">         <span class="keyword">case</span> SPLITMETHOD_EQUALS:</div><div class="line">             <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</div><div class="line">                 View view = getItemOutView(i);</div><div class="line">                 LayoutParams layoutParams = (LayoutParams) view.getLayoutParams();</div><div class="line">                 layoutParams.width = <span class="number">0</span>;</div><div class="line">                 layoutParams.weight = <span class="number">1</span>;</div><div class="line">                 view.setLayoutParams(layoutParams);</div><div class="line">             &#125;</div><div class="line">             <span class="keyword">break</span>;</div><div class="line">         <span class="keyword">case</span> SPLITMETHOD_WRAP:</div><div class="line">             <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</div><div class="line">                 View view = getItemOutView(i);</div><div class="line">                 LayoutParams layoutParams = (LayoutParams) view.getLayoutParams();</div><div class="line">                 layoutParams.width = LayoutParams.WRAP_CONTENT;</div><div class="line">                 layoutParams.weight = <span class="number">0</span>;</div><div class="line">                 view.setLayoutParams(layoutParams);</div><div class="line">             &#125;</div><div class="line">             <span class="keyword">break</span>;</div><div class="line">         <span class="keyword">case</span> SPLITMETHOD_WEIGHT:</div><div class="line">             <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</div><div class="line">                 View view = getItemOutView(i);</div><div class="line">                 LayoutParams layoutParams = (LayoutParams) view.getLayoutParams();</div><div class="line">                 layoutParams.width = LayoutParams.WRAP_CONTENT;</div><div class="line">                 layoutParams.weight = <span class="number">1</span>;</div><div class="line">                 view.setLayoutParams(layoutParams);</div><div class="line">             &#125;</div><div class="line">             <span class="keyword">break</span>;</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>下一步，我就得去找设置这个分割方式的地方了。首先想到的，是去看看官方的demo介绍，有没有设置这个的。其实动脑子想一下，是肯定有的。那么，我就要用放大镜去找这个接口了。命名得不尽人意，一眼看不出。下载个demo来玩玩吧，里面也没有看到使用方法，或许我放大镜的倍数不够大。不能气馁，继续去跟踪代码。然后我就找到了外层的view的调用方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSplitAuto</span><span class="params">(<span class="keyword">boolean</span> isAutoSplit)</span> </span>&#123;</div><div class="line">          <span class="keyword">if</span> (<span class="keyword">this</span>.isAutoSplit != isAutoSplit) &#123;</div><div class="line">              <span class="keyword">this</span>.isAutoSplit = isAutoSplit;</div><div class="line">              <span class="keyword">if</span> (!isAutoSplit) &#123;</div><div class="line">                  setSplitMethod(SPLITMETHOD_WRAP);</div><div class="line">              &#125;</div><div class="line">              requestLayout();</div><div class="line">              invalidate();</div><div class="line">          &#125;</div><div class="line">      &#125;</div></pre></td></tr></table></figure>
<p>继续往上,ScrollIndicatorView里面发现了这个，看来是找到了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSplitAuto</span><span class="params">(<span class="keyword">boolean</span> splitAuto)</span> </span>&#123;</div><div class="line">       setFillViewport(splitAuto);</div><div class="line">       fixedIndicatorView.setSplitAuto(splitAuto);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>继续回到去外层，设置为false，解决问题。附上这个控件的地址<a href="https://github.com/LuckyJayce/ViewPagerIndicator" target="_blank" rel="external">ViewPagerIndicator链接</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mScrollIndicatorView.setSplitAuto(<span class="keyword">false</span>);<span class="comment">//tab不会进行平均分割</span></div></pre></td></tr></table></figure>
<ul>
<li>精彩回放的课程要屏蔽掉下载按钮，需求搞清楚一点咯，我可以改。</li>
<li>离线下载接口返回数据有问题，系列课不能返回课程封面。待我去和服务端联调，今天能搞定吗？我说的是他们。</li>
<li>明天老大说了要加班的就自觉回来加班吧。这句话，好像是很有深意的样子。不管我来到会有什么作用，正确的选择就是奉陪到底哦。</li>
<li>接口调试的基本要领，贴log，先贴这个，其余先不要乱谈。</li>
<li>系列课没有课程封面，怎么解决？我app这里就无能为力了，后台说了，小课是没有封面的。那么，我们就用大课的封面啦。</li>
</ul>
<h3 id="9-10-天气-雨"><a href="#9-10-天气-雨" class="headerlink" title="9-10 天气:雨"></a>9-10 天气:雨</h3><p>今天是教师节，就祝我的老师们教师节快乐。</p>
<ul>
<li>今天的知识点积累主要就是Drawable的各种使用，我在这里总结一下就好。第一个我感到最新奇的就是TransitionDrawable，这个玩意可以让drawable有一个渐变的过程，用途比如说开灯和关灯的亮度渐变；BitmapDrawable就是普通的啦；LayerDrawable就是分层的，这个在星星或者进度条那里用过，有层次的。InsertDrawable就是作为一个drawable嵌入到另外一个背景图中，设置边距；ClipDrawable进行裁剪和剪切操作，安卓中的进度条就是使用这个来做的，根据level的属性值去决定裁剪区域的大小；BitmapShader；</li>
</ul>
<h3 id="9-12-天气-晴"><a href="#9-12-天气-晴" class="headerlink" title="9-12 天气:晴"></a>9-12 天气:晴</h3><p>知识点整理：</p>
<ul>
<li>第一个就是我一直想要关注的顶部栏颜色渐变的技术点。现在看了别人实现的代码，我可以看到的就是使用一个带滚动状态监听回调的scrollView，在它的监听回调中，判断滑动的方向和距离。如果y方向滑动距离大过了要遮盖的view，那么就要让titlebar进行渐变，直到完全变色。贴代码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollChanged</span><span class="params">(ObservableScrollView scrollView, <span class="keyword">int</span> x, <span class="keyword">int</span> y,</span></span></div><div class="line">                            <span class="keyword">int</span> oldx, <span class="keyword">int</span> oldy) &#123;</div><div class="line">    <span class="keyword">if</span> (y &lt;= <span class="number">0</span>) &#123;</div><div class="line">        rl_title_bar.setBackgroundColor(Color.argb(<span class="number">0</span>, <span class="number">247</span>, <span class="number">247</span>, <span class="number">247</span>));<span class="comment">//AGB由相关工具获得，或者美工提供</span></div><div class="line">        textView.setVisibility(View.GONE);</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (y &gt; <span class="number">0</span> &amp;&amp; y &lt;= imageHeight) &#123;</div><div class="line">        <span class="keyword">float</span> scale = (<span class="keyword">float</span>) y / imageHeight;</div><div class="line">        <span class="keyword">float</span> alpha = (<span class="number">255</span> * scale);</div><div class="line">        <span class="comment">// 只是layout背景透明(仿知乎滑动效果)</span></div><div class="line">        rl_title_bar.setBackgroundColor(Color.argb((<span class="keyword">int</span>) alpha, <span class="number">247</span>, <span class="number">247</span>, <span class="number">247</span>));</div><div class="line">        textView.setVisibility(View.GONE);</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        rl_title_bar.setBackgroundColor(Color.argb( <span class="number">255</span>, <span class="number">247</span>, <span class="number">247</span>, <span class="number">247</span>));</div><div class="line">        textView.setVisibility(View.VISIBLE);</div><div class="line">        textView.setText(<span class="string">"付雷"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>上报点的加入。我们需要加入视频播放和下载的上报。具体为什么要这样做呢？就是为了收集数据。需求就是要进行上报点击下载按钮的事件，打开在线视频和打开离线视频的上报。这些都是和视频有关的，那么，我就要抽出到一个公共的类里面，有需要的地方就使用吧。现在的问题是，使用的地方，包括所有能够进去播放器的点击，播放器内部下载按钮的点击那里，都调用相应的上报啦。</li>
<li>今天编程出现了一点地事故，就是要注入Context的变量，是不能在类里面直接初始化的，这样会让Context对象为空的啦。正确的做法，是不是应该在OnCreate里面，再初始化这个变量呢？反正就是要在很后面的啦，不能当做类变量直接初始化。</li>
<li>volatile关键词：用来对共享变量的访问进行同步，上一次写入操作的结果对下一次读取操作是肯定可见的。（在写入volatile变量值之后，CPU缓存中的内容会被写回内存；在读取volatile变量时，CPU缓存中的对应内容会被置为失效，重新从主存中进行读取），volatile不使用锁，性能优于synchronized关键词。</li>
<li>线程同步的方法，synchronized关键字，可以用于静态方法、实例方法和代码块；Object类的wait，notify和notifyAll方法；线程状态的转换，比如sleep(),interrupt(),join(),yield()等方法。</li>
<li>线程之间同步机制的核心是监视对象上的锁，竞争锁来获得执行代码的机会。当一个对象获取对象的锁，然后其他尝试获取锁的对象会处于等待状态，这种锁机制的实现方式很大程度限制了多线程程序的吞吐量和性能（线程阻塞），且会带来死锁（线程A有a对象锁，等着获取b对象锁，线程B有b对象锁，等待获取a对象锁）和优先级倒置（优先级低的线程获得锁，优先级高的只能等待对方释放锁）等问题。所以，我们可以尝试使用非阻塞的方式。atomic包中提供了很多支持原子性操作的类，AtomicInteger……。数组：AtomicIntegerArray</li>
<li>高层同步api。java的current包中为多线程提供了Lock接口，表示一个锁方法，代替了synchronized方法。ReadWriteLock，适用于读者和写者场景；ReentrantLock类和ReentrantReadWriteLock，分别为上面两个接口的实现类；Condition接口，代替了wait和notify。</li>
<li>多线程数据结构：1.队列 BlockingQueue，BlockingDeque； 2.集合类 ConcurrentMap，CopyOnWriteArrayList。</li>
</ul>
<h3 id="9-13-天气-晴"><a href="#9-13-天气-晴" class="headerlink" title="9-13 天气:晴"></a>9-13 天气:晴</h3><ul>
<li>今天做的事情就是搜索界面的ui调整。说起来这个ui也是挺烦的，最主要就是背景颜色的改变。有数据的时候，要从灰色变成纯白色。如果使用gridview的话，我那里的控件并不能占据全部屏幕，就会留下边边不能进行填充。辛巍之前采取的策略就是直接换成listview去做，然后改adapter，这是什么鬼策略，我不同意。所以，我选择去操作背景颜色的改变。有数据的时候，设置背景为纯白色。这个策略按道理是行得通的。先就这样去做。我能想到的办法就是这个。</li>
<li>搞了那么久，我终于发现了不能和首页是一样的边距的啦。因为首页有一个侧栏占据了位置，是不同的，所以我要自己去进行计算，再进行等分。</li>
<li>测试一下离线下载的健壮性，就是查看会不会造成内存泄露。现在的问题，就是平板端的service不能在适当的时候及时被关闭。主要就是因为fragment会被页面保存，无法撤销。我现在的策略就是，在界面存在的时候，就要对service建立连接。界面不被销毁，我要找另外一种策略去停止service了，不，是去断开界面的连接。</li>
<li>handler static leak的问题的解决。尝试使用静态的handler和去弱引用对象解决。不过我目前这个东西好像不太适用。</li>
<li>我初步印象中的mvp模式。通过一个类把v和p抽象接口出来。activity和fragment就实现view的那部分接口，被回调以后就更新代码。重点就是p这部分了，也是一个接口，逻辑操作全部搬到这里来。实现数据了以后，就通过接口回调view的方法，部署到view上面。p里面是不应该出现view得操作的，只是调用v的接口进行更新就好。</li>
<li>和UI设计师讨论了一天，好像慢慢就把我写的布局调整过来了，还是缺了一些图片哦，我等着把新图补上。</li>
</ul>
<h3 id="9-14-天气-晴"><a href="#9-14-天气-晴" class="headerlink" title="9-14 天气:晴"></a>9-14 天气:晴</h3><p>今天的主题就是放假，但是也不能怠慢工作。还有什么让我做的，赶紧提出来，别等到差不多下班的时候才扔过来，老子不接这锅。</p>
<p>研究一下布局的优化结果了啦。</p>
<ul>
<li>RelativeLayout会让子View调用2次onMeasure，LinearLayout 在有weight时，也会调用子View2次onMeasure。</li>
<li>使用相对布局的时候，会测量两次子view。如果子view太过复杂的话，使用margi会导致一点性能问题，建议，可以使用padding的话，就不用margin。</li>
<li>在不影响层级深度的情况下,使用LinearLayout和FrameLayout而不是RelativeLayout。</li>
<li>能用两层LinearLayout，尽量用一个RelativeLayout，在时间上此时RelativeLayout耗时更小。另外LinearLayout慎用layout_weight,也将会增加一倍耗时操作。由于使用LinearLayout的layout_weight,大多数时间是不一样的，这会降低测量的速度。这只是一个如何合理使用Layout的案例，必要的时候，你要小心考虑是否用layout weight。总之减少层级结构，才是王道，让onMeasure做延迟加载，用viewStub，include等一些技巧。</li>
<li>为什么Google给开发者默认新建了个RelativeLayout，而自己却在DecorView中用了个LinearLayout。因为DecorView的层级深度是已知而且固定的，上面一个标题栏，下面一个内容栏。采用RelativeLayout并不会降低层级深度，所以此时在根节点上用LinearLayout是效率最高的。而之所以给开发者默认新建了个RelativeLayout是希望开发者能采用尽量少的View层级来表达布局以实现性能最优，因为复杂的View嵌套对性能的影响会更大一些.</li>
<li>自己可控的情况下，不能让布局的层次超过5层。</li>
<li>一种fragment的管理方式，使用栈stack来管理app中的fragment。我们app的设计就是左右分屏，所以要想出一种策略去管理界面的保留或者删除。</li>
<li>解决播放视频完成以后，让按钮的状态改成已经完成。</li>
</ul>
<h3 id="9-17-天气-晴"><a href="#9-17-天气-晴" class="headerlink" title="9-17 天气:晴"></a>9-17 天气:晴</h3><p>今天的主题就是加班，我回来了。</p>
<ul>
<li>第一个问题就是搜索课程的问题，不，今天全部的bug都是搜索课程的问题，有毒，为什么上次测试没有测出来。第一个问题就是执行新的请求的时候，页数pageNum被记住了，所以请求回来了空的数据，我晕。查看了一下，原来是执行新的请求，在外面传参数的时候，我传少了一个字段，不能把那个字段重置为1，修改一下，应该就能够解决了.</li>
<li>搜索出新的结果，不能回到最初了。我目前的思路就是执行新的请求的时候，直接设置listview的位置为0.另外一种方法就是直接清空listview就好了，它会直接塞新的东西进去。</li>
<li>键盘弹不出来嘛，我搞了一通，最后发现是配置文件的问题，改回来就好了。在xml下面让edittext获取焦点还是有点不靠谱，要写到代码里面。同时也解决了我的一个疑惑，放在fragment的add之前，也是可以的。</li>
<li>这也就奇怪了，平板的使用原生焦点可以，而手机的使用keyboarduitl的方法可以。都不能做到完全统一，不能增强用户统一体验。</li>
<li>出现的一个事故，就是离线下载点击tab的时候，会进行切换，然后不能退出编辑状态。</li>
</ul>
<h3 id="9-18-天气-晴"><a href="#9-18-天气-晴" class="headerlink" title="9-18 天气:晴"></a>9-18 天气:晴</h3><p>回到公司，发现自己的电脑是挂掉了，键盘和触摸板都不行的感觉。我尝试了去重新开机，但是还是没用。外接的还行，那就将就着先用。</p>
<ul>
<li>今天看到平板首页的一个ui很漂亮，很有挑战的欲望。我一开始以为是自定义的ui来的，但是我就看不到有进行自定义ui。打开来一看，哦，原来是用了点9图作为底部，画出来的。</li>
<li>看看强哥的代码，主要就是去吸收他说的编程思想。第一点就是我发现上报那里是同时上报到了三个服务器，为什么要这样做呢？这样是为了进行平行试验。我有3份，就能够避免网络，服务器等的bug，造成的数据丢失。上传也分紧急和不紧急的上传，不紧急的就先缓存到本地，等到有wifi的时候就进行上传。</li>
<li>看到我自己设置的网络连接的timeout为3秒，当时我为什么就是想到这个数字呢？要进行检讨，第一代的2g网络的话，这个timeout时间是必死无疑，都不够建立通信的一个来回。现在写得好一点地做法呢，就是如果有wifi网络，可以将时间缩短到5秒到10秒；手机网络就设置为30秒。动态获取到client时不同的。不过，我们的app就那样，我先统一都定义为30秒了。</li>
<li>科普一下网络连接的初级阶段：本地连接。linux要进行网络连接的时候，是要向系统获取到分配好端口等东西的连接对象句柄。一般系统的资源是有限的，我们申请资源可能会进行等待，所以要设置一下请求时间timeout。达到了timeout，我们就认为申请资源超时了。程序获得资源的过程，就叫做本地连接。然而，java代码这里 并没有体现这玩意，我该怎么去设置？？？</li>
<li>今天终于动手去优化我写的代码了，坚持去做这件事啦，以后写出来的代码就让人很容易读懂了。重构，一辈子的事。。。</li>
<li>上课中显示教师图片为空，服务端的错，但是我们需要跟进。</li>
</ul>
<h3 id="9-19-天气-晴"><a href="#9-19-天气-晴" class="headerlink" title="9-19 天气:晴"></a>9-19 天气:晴</h3><p>今天回来，继续纠结我电脑的不行，同时也是主动去帮同事分担一点任务吧。额，一早上就领到了5个bug。我去抓log了。</p>
<ul>
<li>第一个bug，服务端返回的数据没有进行排序，推荐课程应该都在前面。</li>
<li>第二个，返回的课程状态不对。有一节课是已经下课很久了，但是返回的值依旧是正在上课中，请修改。（后来跟进，得知那一条是脏数据来的，删除了就没事）</li>
<li>第三个bug，课程结束得太快，点击就提示课程结束。跟进：这个得到了解决</li>
<li>人数报名总数不对，得算好一点。有待跟进</li>
<li>正在上课中，教师头像为空的话，我这里还是没有得到解决。跟进：下午3点左右，问题得到了解决。</li>
</ul>
<p>编程经验吸收：如果发现项目中有一条数据是特别的与众不同，并且在那个模块当中复现的比例不是很高。可以合理怀疑那是脏数据来的。可以删了。</p>
<p>TextView的setTextSize（int），里面填数字就好，那里默认就是sp，不用考虑适配了，它自己会转。</p>
<p><em>重新敲一遍代码，胜过复制粘贴</em>。的确，起码可以把别人的代码改成自己的风格，这样变量命名什么的就不用去尊重前人的风格了。<a href="http://netsmell.com/post/dont-copy-paste-retype.html" target="_blank" rel="external">重新敲一遍代码，胜过复制粘贴</a></p>
<p>JobService:这是一种低功耗的service，用于处理后台不紧急的任务。<br>约束条件：</p>
<p>1.最小延时</p>
<p>2.最晚执行时间</p>
<p>3.需要充电</p>
<p>4.需要设备为idle（空闲）状态（一般很难达到这个条件吧）</p>
<p>5.联网状态（NETWORK_TYPE_NONE–不需要网络，NETWORK_TYPE_ANY–任何可用网络，NETWORK_TYPE_UNMETERED–不按用量计费的网络）</p>
<p>约束条件决定了JobService在什么时候执行，如果都没指定，系统就不知道在什么来执行我们的JobService了。如果我们的后台任务满足以上的一个或多个条件，就可以考虑是不是应该用JobService来执行。</p>
<h3 id="9-20-天气-阴雨"><a href="#9-20-天气-阴雨" class="headerlink" title="9-20 天气:阴雨"></a>9-20 天气:阴雨</h3><p>今天早上先来的是来一下技术学习总结。</p>
<ul>
<li>昨天晚上看了一轮java核心技术，就先说说对象的克隆啦。克隆分为深克隆和浅克隆。简单地去调用对象的克隆，如果对象中都是基本数据类型（一等公民），那就可以进行深克隆。但是，如果对象中引用了其他对象，那么就是存在可变实例域，这样就不能实现深克隆。实现深克隆的方法就是要对对象里面的所有可变实例域对应进行克隆。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> <span class="keyword">implements</span> <span class="title">Cloneable</span></span>&#123;</div><div class="line">  <span class="keyword">private</span> String name;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">float</span> price;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(String name,<span class="keyword">float</span> price)</span></span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">    <span class="keyword">this</span>.price = price;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span></span>&#123;</div><div class="line">    Product p = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">try</span>&#123;</div><div class="line">      p = (Product)<span class="keyword">super</span>.clone();</div><div class="line">    &#125;<span class="keyword">catch</span>(CloneNotSupportException e)&#123;</div><div class="line">      e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> p;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Phone</span> <span class="keyword">implements</span> <span class="title">Cloneable</span></span>&#123;</div><div class="line">  <span class="keyword">private</span> String color;</div><div class="line">  <span class="keyword">private</span> Product p;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Phone</span><span class="params">(String color,Product p)</span></span>&#123;</div><div class="line">    <span class="keyword">this</span>.color = color;</div><div class="line">    <span class="keyword">this</span>.p = p;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span></span>&#123;</div><div class="line">    Phone iphone = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">try</span>&#123;</div><div class="line">      iphone = (Phone) <span class="keyword">super</span>.clone();</div><div class="line">    &#125;<span class="keyword">catch</span>(CloneNotSupportException e)&#123;</div><div class="line">      e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//关键在这里，要对可变实例域进行深拷贝</span></div><div class="line">    iphone.p = p.clone();</div><div class="line">    <span class="keyword">return</span> iphone;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>今天解决了课程状态显示错误的问题，额，我催后台去改的。</li>
<li>修改status状态值拆分为两个值后带来的ui显示的变化。去掉数据库缓存了，这么简单和不常用的页面，不需要缓存数据到本地。</li>
<li>不过，报名人数那里，好像统计还是不太对得上。</li>
<li>果然要增加多一个字段才能解决问题，还是我去发现的。。。以后你们接口定义的时候，可以严谨一点吗？差点出大事了。</li>
<li>升级到as2.2，看起来好像舒爽多了，字体硬朗了好多。可是，出问题了，编译直接不过。搞不会，我还是用回2.13.</li>
<li>自定义view，去学习ValueAnimator。</li>
</ul>
<p>9-21 天气:晴<br>一早上回来，看到代码也是不行，状态值怎么弄都不对。服务器要给力一点了啦。</p>
<ul>
<li>看见课程请求那里好像有点不对劲，对，ui会闪。这次要以第二步请求回来的数据才算准确。可是第一步请求回来的数据，也应该是要有点状态的。服务器说，第一步返回的脏数据（会被第二步覆盖的数据）是不管的，比如说status值，它那里可能随便返回个1，2，3，4。我要做的，就是去屏蔽这些字段，不让它进行显示。可是，好多地方要改。这，就要涉及到重构了，把屏蔽的东西都抽离出一个方法里面。</li>
<li>修改提示文案，又要改一万个地方，老子得把这个方法抽出来，造福后人。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;SketchBean&gt; <span class="title">discardFirstRequest</span><span class="params">(List&lt;SketchBean&gt; beans)</span></span>&#123;</div><div class="line">       <span class="keyword">for</span>(SketchBean bean:beans)&#123;</div><div class="line">           bean.setTeachers(<span class="keyword">null</span>);</div><div class="line">           bean.setStatus(-<span class="number">1</span>);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> beans;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>以后就这样调用，好吗，大家都改成这样。以后要怎么玩，我们就只改一次就好了。来啊，继续新增字段啊。。。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(items != <span class="keyword">null</span> &amp;&amp; items.size() &gt; <span class="number">0</span>)&#123;</div><div class="line">    <span class="comment">//以后要屏蔽什么字段，就在这里面加</span></div><div class="line">    items = CourseUtil.discardFirstRequest(items);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>有人建议说抽取那个接口出来给大家伙用。然而大家使用这个接口的参数都不对，后续处理过程也不同，还是别搞了，只统一调用那个方法去屏蔽字段就ok。</li>
<li>我在别人的代码里面发现了一点很不好的东西，在主线程操作数据库就更不用说是错的了。还把数据库操作都杂糅到一起。一个数据库操作，集合了查询和更新，这没有问题吗？在一个操作中执行两条命令语句select和update。我反对这种写法。</li>
<li>今天学习了估值器TypeEvaluator，这个嘛，是可以进行颜色值的变换的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorEvaluator</span> <span class="keyword">implements</span> <span class="title">TypeEvaluator</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCurrentRed = -<span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCurrentGreen = -<span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCurrentBlue = -<span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">evaluate</span><span class="params">(<span class="keyword">float</span> fraction, Object startValue, Object endValue)</span> </span>&#123;</div><div class="line">        String startColor = (String) startValue;</div><div class="line">        String endColor = (String) endValue;</div><div class="line">        <span class="keyword">int</span> startRed = Integer.parseInt(startColor.substring(<span class="number">1</span>, <span class="number">3</span>), <span class="number">16</span>);</div><div class="line">        <span class="keyword">int</span> startGreen = Integer.parseInt(startColor.substring(<span class="number">3</span>, <span class="number">5</span>), <span class="number">16</span>);</div><div class="line">        <span class="keyword">int</span> startBlue = Integer.parseInt(startColor.substring(<span class="number">5</span>, <span class="number">7</span>), <span class="number">16</span>);</div><div class="line">        <span class="keyword">int</span> endRed = Integer.parseInt(endColor.substring(<span class="number">1</span>, <span class="number">3</span>), <span class="number">16</span>);</div><div class="line">        <span class="keyword">int</span> endGreen = Integer.parseInt(endColor.substring(<span class="number">3</span>, <span class="number">5</span>), <span class="number">16</span>);</div><div class="line">        <span class="keyword">int</span> endBlue = Integer.parseInt(endColor.substring(<span class="number">5</span>, <span class="number">7</span>), <span class="number">16</span>);</div><div class="line">        <span class="comment">// 初始化颜色的值</span></div><div class="line">        <span class="keyword">if</span> (mCurrentRed == -<span class="number">1</span>) &#123;</div><div class="line">            mCurrentRed = startRed;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (mCurrentGreen == -<span class="number">1</span>) &#123;</div><div class="line">            mCurrentGreen = startGreen;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (mCurrentBlue == -<span class="number">1</span>) &#123;</div><div class="line">            mCurrentBlue = startBlue;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 计算初始颜色和结束颜色之间的差值</span></div><div class="line">        <span class="keyword">int</span> redDiff = Math.abs(startRed - endRed);</div><div class="line">        <span class="keyword">int</span> greenDiff = Math.abs(startGreen - endGreen);</div><div class="line">        <span class="keyword">int</span> blueDiff = Math.abs(startBlue - endBlue);</div><div class="line">        <span class="keyword">int</span> colorDiff = redDiff + greenDiff + blueDiff;</div><div class="line">        <span class="keyword">if</span> (mCurrentRed != endRed) &#123;</div><div class="line">            mCurrentRed = getCurrentColor(startRed, endRed, colorDiff, <span class="number">0</span>,</div><div class="line">                    fraction);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mCurrentGreen != endGreen) &#123;</div><div class="line">            mCurrentGreen = getCurrentColor(startGreen, endGreen, colorDiff,</div><div class="line">                    redDiff, fraction);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mCurrentBlue != endBlue) &#123;</div><div class="line">            mCurrentBlue = getCurrentColor(startBlue, endBlue, colorDiff,</div><div class="line">                    redDiff + greenDiff, fraction);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 将计算出的当前颜色的值组装返回</span></div><div class="line">        String currentColor = <span class="string">"#"</span> + getHexString(mCurrentRed)</div><div class="line">                + getHexString(mCurrentGreen) + getHexString(mCurrentBlue);</div><div class="line">        <span class="keyword">return</span> currentColor;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 根据fraction值来计算当前的颜色。</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getCurrentColor</span><span class="params">(<span class="keyword">int</span> startColor, <span class="keyword">int</span> endColor, <span class="keyword">int</span> colorDiff,</span></span></div><div class="line">            <span class="keyword">int</span> offset, <span class="keyword">float</span> fraction) &#123;</div><div class="line">        <span class="keyword">int</span> currentColor;</div><div class="line">        <span class="keyword">if</span> (startColor &gt; endColor) &#123;</div><div class="line">            currentColor = (<span class="keyword">int</span>) (startColor - (fraction * colorDiff - offset));</div><div class="line">            <span class="keyword">if</span> (currentColor &lt; endColor) &#123;</div><div class="line">                currentColor = endColor;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            currentColor = (<span class="keyword">int</span>) (startColor + (fraction * colorDiff - offset));</div><div class="line">            <span class="keyword">if</span> (currentColor &gt; endColor) &#123;</div><div class="line">                currentColor = endColor;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> currentColor;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 将10进制颜色值转换成16进制。</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getHexString</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</div><div class="line">        String hexString = Integer.toHexString(value);</div><div class="line">        <span class="keyword">if</span> (hexString.length() == <span class="number">1</span>) &#123;</div><div class="line">            hexString = <span class="string">"0"</span> + hexString;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> hexString;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>另外一个就是加速器啦，主打动画执行的速度的快慢。需要一定的数学计算能力，最好我以后是有机会接触到这方面的开发。</li>
</ul>
<h3 id="9-23-天气-晴"><a href="#9-23-天气-晴" class="headerlink" title="9-23 天气:晴"></a>9-23 天气:晴</h3><p>今天是秋分了，我说天气开始转凉了。</p>
<ul>
<li>微调ui，让界面显示得更自然一点。</li>
<li>接到新任务了，我去看看上传。问题是，怎么入手啊。找到入口，去断点，一步一步进行跟踪，找到整个流程。透露一下技术的流程。教师上课，有什么操作动作触发了屏幕的改变，咱们就要去截屏，然后写到MP4里面去。有什么中途离开以后，就要再写另外一个MP4，直到最后，去修复合并课堂中产生的MP4，合并成为一个文件。修复是使用第三方自带的，合并的话，咱们就使用ffmpeg去进行拼接，耗时啊，大概5分钟。修复合并成功以后，就去执行上传。</li>
<li>继续熟悉adb pull命令，把设备里面的东西拉到桌面</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lixinkun$ adb pull sdcard/QtonePad/cache/<span class="number">15625016803</span>/media/complete/ ~/Desktop</div></pre></td></tr></table></figure>
<ul>
<li>没办法了，我先去搞一下上传的视频，然后比对本地的视频文件和下载回来的视频是否有问题。</li>
</ul>
<h3 id="9-24-天气-晴"><a href="#9-24-天气-晴" class="headerlink" title="9-24 天气:晴"></a>9-24 天气:晴</h3><p>先来一波看帖收获，新浪微博的内容显示那里，有表情，话题和@好友三种东西，其实都是在一个textview里面。显示的时候，就要变色课点击什么的。谈谈做法吧，都是用spandableString配合正则表达式，话题就是##话题，[]就是表情吧，@好友就是@好友昵称。在一个string中，如果正则表达式匹配到相应的字符，则将内容变色，因为有些地方是可以点击的，就要通过接口的方式把点击事件交给调用者。表情解析方法就是得到图片的资源id，弄到bitmap，塞进spandableString。。。等等等等。</p>
<ul>
<li>继续看别人的代码，看到我都好乱。分块就是分了8k一块，每次传8k。</li>
<li>修改了上传速度的显示，从减法到加法。</li>
<li>数据库操作那里，在主线程操作数据库，可能会导致anr。</li>
<li>进度的保存，不是实时保存，我觉得要1秒保存一次。</li>
<li>上传的第二步会不会有问题。</li>
<li>一切都是重构，我感觉自己写一遍会更好。</li>
<li>写了好久，我终于把数据库的操作暂时改好了，不是很明白里面的所有逻辑，不能确保修改都完全正确</li>
<li>升级了as2.2，得去屏蔽掉一点gradle的方法，操，那么以后打包的时候，怎么办？</li>
<li>gradle第一次启动慢，我所要知道的是它为什么慢，而不是只知道那个一种解决办法。为什么会慢，为什么？现在给一下通用的调查的方法，监控一切启动时会初始化的东西。可以在自己继承的Application里面去打log，再次在cp和Mainactivity里面都打log，log的内容嘛，就是时间戳了。同时要去看系统的任务栈里面，写有多少activity和它们的信息，都有写到。找到了瓶颈所在，我们再去根据出现的问题去搜相应的blog。</li>
<li>其实，我改完数据库操作以后，还是应该把数据库操作再抽出到一个类里面，以便复用的。。。下周我想起来我就去改.</li>
</ul>
<h3 id="9-26-天气-晴"><a href="#9-26-天气-晴" class="headerlink" title="9-26 天气:晴"></a>9-26 天气:晴</h3><p>今天去开会，辛巍说是可以让我去接触更多的模块了。</p>
<ul>
<li>继续测试自己改的代码，尽量不要改错了。新建课程的时候，要尽量去测试多一点，看看有没有什么传输的问题。</li>
<li>下午说了产品路线的修改，开始走高端产品路线。我很赞同他的那个说法，还有就是时间点，定在明年年底，这很好。</li>
<li>线程池管理，这里是集成了抛到主线程或者是子线程的方法。核心的思想就是获取到主线程的handle，然后用handler把Runnable抛过去，就行了呀。</li>
</ul>
<h3 id="9-27-天气-晴"><a href="#9-27-天气-晴" class="headerlink" title="9-27 天气:晴"></a>9-27 天气:晴</h3><ul>
<li>有什么办法证明是我上传的环节出了问题呢？我搞了好久也不能够去弄到两者不一致的视频。</li>
<li>httpUrlConnection啊，我发现了一个好神奇的东西啦。你往一个url那里去写了一堆东西。再去得到这个链接的input输入流，得到的东西就是什么？写的东西的位置吗？</li>
<li>动画补间器Interpolator，用于控制动画的变化速率快慢。系统内置好多，比如说有先加速后减速的，模拟物理反弹的，需要的时候咱们就去找合适的使用，不过这没什么难度，不是我今天要学习的。我今天要学习的目标，咱们去写一个补间器出来，研究它的实现过程。加速再减速的补间器，先看看数学公式：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Math.cos((input + <span class="number">1</span>) / <span class="number">2.0f</span>) + <span class="number">0.5f</span> <span class="comment">//input的值为0到1</span></div></pre></td></tr></table></figure>
<p>最后得出的值域还是0到1，只是曲线不再是匀速，而是先加速（0 ~ 0.8），然后再减速（0.8 ~ 1.0）。</p>
<p>现在来个先减速后加速的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> input)</span> </span>&#123;</div><div class="line">        <span class="keyword">float</span> result;</div><div class="line">        <span class="keyword">if</span>(input &lt; <span class="number">0.5</span>)&#123;</div><div class="line">            result = (<span class="keyword">float</span>) (Math.sin(Math.PI * input)) / <span class="number">2</span> ;</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            result = (<span class="keyword">float</span>) (<span class="number">2</span> - Math.sin(Math.PI * input)) / <span class="number">2</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>ViewPropertyAnimator机制，让动画的使用更加简便，是在安卓3.1的时候引进的新方法。用法主要就是使用连缀的语法，需要什么就加什么。并且，我们看不见动画的start方法，是因为ViewPropertyAnimator使用了隐式的启动方法。主打一行代码就能够完成高度复杂的动画功能。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//已经隐式启动了，没有start()方法</span></div><div class="line">textView.animate().x(<span class="number">500</span>).y(<span class="number">500</span>).setDuration(<span class="number">5000</span>).setInterpolator(<span class="keyword">new</span> BounceInterpolator());</div></pre></td></tr></table></figure>
<ul>
<li>以后自己去看技术点的时候，要多看一步。别去学习招式，咱要知道个所以然啊啊啊。</li>
</ul>
<h3 id="9-28-天气-晴"><a href="#9-28-天气-晴" class="headerlink" title="9-28 天气:晴"></a>9-28 天气:晴</h3><ul>
<li>看了看代码，我好像又发现一点东西。断点续传完全都是由服务器去做支持的。本地保存的进度，只是用来做进度条指示，完全没有用来恢复现场。</li>
<li>为什么不抛弃习悦的服务器，转存那边老出问题了啦。不就一个上传而已，干嘛还不交出权限，我们直接和金山云打交道。</li>
<li>看回了一下位移运算，左移就是乘以2.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> n = <span class="number">1</span> &lt;&lt; <span class="number">1</span>; <span class="comment">//结果就是2</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">  <span class="keyword">if</span>(x &lt;= <span class="number">10000</span>)&#123;</div><div class="line">    cout&lt;&lt;x&lt;&lt;endl;</div><div class="line">    print(x*<span class="number">2</span>);</div><div class="line">  &#125;</div><div class="line">  cout&lt;&lt;x&lt;&lt;endl;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>我今晚要去研究一下，怎么去写一个线程池。线程池的原理和分析。</li>
</ul>
<h3 id="9-29-天气-阴"><a href="#9-29-天气-阴" class="headerlink" title="9-29 天气:阴"></a>9-29 天气:阴</h3><ul>
<li>先继续来技术经验积累。安卓在应用退出以后，5.0之前的清理内存（主要就是杀死进程）是这样执行的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Process.killProcessQuit(pid);</div></pre></td></tr></table></figure>
<p>只是杀死了主进程，但是到了5.0以后，就变成了这样子。把同一进程组里面的进程都杀死了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Process.killProcessQuiet(app.pid);</div><div class="line">Process.killProcessGroup(app.uid,app.pid);</div></pre></td></tr></table></figure>
<p>现在想要采取的措施就是要去把子进程脱离出来，不要受到主进程影响。</p>
<ul>
<li>线程池的学习。完成一项任务的时间为:T1 创建线程时间， T2 执行任务的时间， T3 线程销毁的时间。 如果 T1 + T3 &gt;&gt; T2 的话，线程池就开始大展身手了，极大地去提升性能。线程池一般包括以下四个基本组成部分：线程池管理器，工作线程，任务接口和任务队列。  线程池的关键技术正是关注于如何缩短或调整 T1 和 T3 的时间，从而去提高服务程序性能的。</li>
<li>什么时候会需要强制类型转换？我之前是一直都在纳闷这个问题，现在看来，就是集合中间，能放的东西不是指定的时候，可以放多种类型的数据的话，你取出来以后，就是需要去对不同的数据转回去不同的类型。</li>
</ul>
<h3 id="9-30-天气-小雨"><a href="#9-30-天气-小雨" class="headerlink" title="9-30 天气:小雨"></a>9-30 天气:小雨</h3><p>先来一下自主学习的东西，今天是看到了WebView的JavaScript于本地代码交互的三种方式。</p>
<ul>
<li>先来说说4.2系统之前的JavaScript漏洞,js会去遍历window中的对象，然后去查找，执行具体命令。4.2之后的修复漏洞，就是去加入注解约束@JavaScriptInterface，只有加上这个注解的方法才会被js调用。Object类中的getClass()方法是没有这个注解，所以不会被执行。这样，就解决了这个漏洞。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">cmdArgs</span>)</span>&#123;</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> obj <span class="keyword">in</span> <span class="built_in">window</span>)&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="string">"getClass"</span> <span class="keyword">in</span> <span class="built_in">window</span>[obj])&#123;</div><div class="line">      alert(obj);</div><div class="line">      <span class="keyword">return</span> <span class="built_in">window</span>[obj].getClass().forName(<span class="string">"java.lang.Runtion"</span>)</div><div class="line">      .getMethod(<span class="string">"getRuntime"</span>,<span class="literal">null</span>).invoke(<span class="literal">null</span>,<span class="literal">null</span>).exec(cmdArgs);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>第一种方法，是就是来调用java代码。这一点，好像是和native的方法注册一样。先给java层的方法打个标签，然后把对象注入到js中。</li>
</ul>
<p>java代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">  <span class="meta">@JavaScriptInterface</span></div><div class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getPwd</span><span class="params">(String txt)</span></span>&#123;</div><div class="line">    Log.i(<span class="string">"Eric"</span>,<span class="string">"getPwd ..."</span>);</div><div class="line">    <span class="keyword">return</span> <span class="string">"123456"</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>js代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">clickGetPwd</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> result = myObj.getPwd(<span class="string">"111"</span>);</div><div class="line">  alert(<span class="string">"java result :"</span> + result);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>绑定本地类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mWebView.addJavaScriptInterface(<span class="keyword">new</span> Test(),<span class="string">"myObj"</span>);</div></pre></td></tr></table></figure>
<ul>
<li>第二种方法，利用webviewclient的接口回调方法去拦截url。约定好协议，对url进行协议的解析。在获得协议以后，执行本地方法。但是有一个缺点就是，页面得不到结果，需要再次调用js方法，把结果回传回去。方法实在是太过繁琐，安卓中是不建议使用的。你要看，就看看我项目中的webviewActivity。不要去拦截啊，不提倡。</li>
<li>第三种方法其实是和第二种原理差不多，不过是拦截的接口方法不一样。这个方法可以拦截js的alert，confirm，prompt等，最好的就是js能够得到处理的结果，不用回传哦。<br>*<br>alert 是弹出警告框，在文本里面加入\n就可以换行。<br>confirm 弹出确认框，会返回布尔值，通过这个值可以判断点击时确认还是取消。true表示点击了确认，false表示点击了取消。<br>prompt 弹出输入框，点击确认返回输入框中的值，点击取消返回null。</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/work/">work</a><a href="/tags/coding/">coding</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	<div class="share-jiathis">
	  
<div class="jiathis_style_24x24">
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_googleplus"></a>
	<a class="jiathis_button_douban"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
    var jiathis_config={
    data_track_clickback:true,
    sm:"copy,renren,cqq",
    pic:"",
    summary:"",
     ralateuid:{"tsina":"1634073622"},hideMore:false}
    
  </script> 
<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=
2103362" charset="utf-8"></script>      

	 </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/10/12/Coding/2016-10工作笔记/2016-10-工作笔记/" title="2016-10-工作笔记">
  <strong>上一篇：</strong><br/>
  <span>
  2016-10-工作笔记</span>
</a>
</div>


<div class="next">
<a href="/2016/09/09/Coding/Sql语句复习/"  title="巩固印象中的sql">
 <strong>下一篇：</strong><br/> 
 <span>巩固印象中的sql
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/09/14/Coding/2016-9笔记/2016-9笔记/" data-title="2016-9笔记" data-url="http://yoursite.com/2016/09/14/Coding/2016-9笔记/2016-9笔记/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-天气-阴"><span class="toc-number">1.</span> <span class="toc-text">9-1 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-天气-阴"><span class="toc-number">2.</span> <span class="toc-text">9-2 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-天气-晴"><span class="toc-number">3.</span> <span class="toc-text">9-5 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-天气-晴"><span class="toc-number">4.</span> <span class="toc-text">9-6 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-7-天气-晴"><span class="toc-number">5.</span> <span class="toc-text">9-7 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-8-天气-阴"><span class="toc-number">6.</span> <span class="toc-text">9-8 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-9-天气-晴"><span class="toc-number">7.</span> <span class="toc-text">9-9 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-10-天气-雨"><span class="toc-number">8.</span> <span class="toc-text">9-10 天气:雨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-12-天气-晴"><span class="toc-number">9.</span> <span class="toc-text">9-12 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-13-天气-晴"><span class="toc-number">10.</span> <span class="toc-text">9-13 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-14-天气-晴"><span class="toc-number">11.</span> <span class="toc-text">9-14 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-17-天气-晴"><span class="toc-number">12.</span> <span class="toc-text">9-17 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-18-天气-晴"><span class="toc-number">13.</span> <span class="toc-text">9-18 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-19-天气-晴"><span class="toc-number">14.</span> <span class="toc-text">9-19 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-20-天气-阴雨"><span class="toc-number">15.</span> <span class="toc-text">9-20 天气:阴雨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-23-天气-晴"><span class="toc-number">16.</span> <span class="toc-text">9-23 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-24-天气-晴"><span class="toc-number">17.</span> <span class="toc-text">9-24 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-26-天气-晴"><span class="toc-number">18.</span> <span class="toc-text">9-26 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-27-天气-晴"><span class="toc-number">19.</span> <span class="toc-text">9-27 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-28-天气-晴"><span class="toc-number">20.</span> <span class="toc-text">9-28 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-29-天气-阴"><span class="toc-number">21.</span> <span class="toc-text">9-29 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-30-天气-小雨"><span class="toc-number">22.</span> <span class="toc-text">9-30 天气:小雨</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="Eric1235" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/life/" title="life">life<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/work/" title="work">work<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/coding/" title="coding">coding<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/college/" title="college">college<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/feuture/" title="feuture">feuture<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/me/" title="me">me<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/improve/" title="improve">improve<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/future/" title="future">future<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/android/" title="android">android<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/study/" title="study">study<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/fight/" title="fight">fight<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/work-life/" title="-work -life">-work -life<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/sunshine/" title="sunshine">sunshine<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://weicong.win" target="_blank" title="Weicong Blog">Weicong Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1634073622&verifier=43ce7f75&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Be Fearless <br/>
			Be an Engineer</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1634073622" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/Eric1235" target="_blank" class="icon-github" title="github"></a>
		
		
		
		<a href="https://twitter.com/ericli1235" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/lixinkun" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		
		<a href="https://plus.google.com/Eric1235?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:Eric1235@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="Eric Li">Eric Li</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"ericli"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
