
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>11月工作笔记 | Eric&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Eric Li">
    

    
    <meta name="description" content="天气很好

11月2日 天气:阴
java知识补充，ConCurrentSkipListmap的学习。其优点有两个：key是有序的；支持更高的并发量。存取时间为log(N)，与线程数无关。线程数越多，越体现它的优势。
如果安装的时候报了这个错误： INSTALL_PARSE_FAILED_MANIFEST_MALFORMED 。 可以去检查一下配置清单文件有没有什么错误。比如包名路径那些，拒绝大">
<meta property="og:type" content="article">
<meta property="og:title" content="11月工作笔记">
<meta property="og:url" content="http://yoursite.com/2016/11/11/Coding/11月工作笔记/index.html">
<meta property="og:site_name" content="Eric's Blog">
<meta property="og:description" content="天气很好

11月2日 天气:阴
java知识补充，ConCurrentSkipListmap的学习。其优点有两个：key是有序的；支持更高的并发量。存取时间为log(N)，与线程数无关。线程数越多，越体现它的优势。
如果安装的时候报了这个错误： INSTALL_PARSE_FAILED_MANIFEST_MALFORMED 。 可以去检查一下配置清单文件有没有什么错误。比如包名路径那些，拒绝大">
<meta property="og:updated_time" content="2016-12-01T02:42:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="11月工作笔记">
<meta name="twitter:description" content="天气很好

11月2日 天气:阴
java知识补充，ConCurrentSkipListmap的学习。其优点有两个：key是有序的；支持更高的并发量。存取时间为log(N)，与线程数无关。线程数越多，越体现它的优势。
如果安装的时候报了这个错误： INSTALL_PARSE_FAILED_MANIFEST_MALFORMED 。 可以去检查一下配置清单文件有没有什么错误。比如包名路径那些，拒绝大">
<meta name="twitter:creator" content="@ericli1235">
<link rel="publisher" href="Eric1235">

    
    <link rel="alternative" href="/atom.xml" title="Eric&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Eric&#39;s Blog" title="Eric&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Eric&#39;s Blog">Eric&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/11/11/Coding/11月工作笔记/" title="11月工作笔记" itemprop="url">11月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2016-11-11T08:28:12.000Z" itemprop="datePublished"> 发表于 2016-11-11</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#11月2日-天气-阴"><span class="toc-number">1.</span> <span class="toc-text">11月2日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月3日-天气-阴"><span class="toc-number">2.</span> <span class="toc-text">11月3日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月4日-天气-晴"><span class="toc-number">3.</span> <span class="toc-text">11月4日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月7日-天气-晴"><span class="toc-number">4.</span> <span class="toc-text">11月7日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月8日-天气-阴"><span class="toc-number">5.</span> <span class="toc-text">11月8日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月9日-天气-阴"><span class="toc-number">6.</span> <span class="toc-text">11月9日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月10日-天气-阴雨"><span class="toc-number">7.</span> <span class="toc-text">11月10日 天气:阴雨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月11日-天气-冷"><span class="toc-number">8.</span> <span class="toc-text">11月11日 天气:冷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月14日-天气-晴"><span class="toc-number">9.</span> <span class="toc-text">11月14日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月15日-天气-晴"><span class="toc-number">10.</span> <span class="toc-text">11月15日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月16日-天气-晴"><span class="toc-number">11.</span> <span class="toc-text">11月16日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月17日-天气-晴"><span class="toc-number">12.</span> <span class="toc-text">11月17日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月18日-天气-阴"><span class="toc-number">13.</span> <span class="toc-text">11月18日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月21日-天气-阴"><span class="toc-number">14.</span> <span class="toc-text">11月21日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月22日-天气-雨"><span class="toc-number">15.</span> <span class="toc-text">11月22日 天气:雨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11月23日-天气-阴雨"><span class="toc-number"></span> <span class="toc-text">11月23日 天气:阴雨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11月24日-天气-阴"><span class="toc-number"></span> <span class="toc-text">11月24日 天气:阴</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11月25日-天气-阴"><span class="toc-number"></span> <span class="toc-text">11月25日 天气:阴</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11月28日-天气-晴"><span class="toc-number"></span> <span class="toc-text">11月28日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11月29日"><span class="toc-number"></span> <span class="toc-text">11月29日</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11月30日-天气-晴"><span class="toc-number"></span> <span class="toc-text">11月30日 天气:晴</span></a>
		
		</div>
		
		<blockquote>
<p>天气很好</p>
</blockquote>
<h3 id="11月2日-天气-阴"><a href="#11月2日-天气-阴" class="headerlink" title="11月2日 天气:阴"></a>11月2日 天气:阴</h3><ul>
<li>java知识补充，ConCurrentSkipListmap的学习。其优点有两个：key是有序的；支持更高的并发量。存取时间为log(N)，与线程数无关。线程数越多，越体现它的优势。</li>
<li>如果安装的时候报了这个错误： INSTALL_PARSE_FAILED_MANIFEST_MALFORMED 。 可以去检查一下配置清单文件有没有什么错误。比如包名路径那些，拒绝大写。Service中去掉android:process。</li>
<li>Android中的GUID的意义：通过唯一标识，可以对软件的使用情况进行上报。快速进行bug的定位，哪种机型不行，哪些机子经常出bug等。组成的有IMEI，androidid，mac，iccid，手机型号，品牌，操作系统等信息。</li>
</ul>
<a id="more"></a>
<h3 id="11月3日-天气-阴"><a href="#11月3日-天气-阴" class="headerlink" title="11月3日 天气:阴"></a>11月3日 天气:阴</h3><ul>
<li>知道了一个token过期的处理方式。页面一定要采取一种统一的报token过期的处理方式。我们目前能处理的就是js弹框。拦截js弹框，去处理token过期。当token过期的时候，弹得js符合我们的协议的话，我们就拦截，然后调用原始的方法，返回登录界面。目前的问题就是，有人的处理方式是不一样的，他们直接返回的静态的html页面告诉用户token过去，握草，我没法解决。</li>
<li><p>单一职责原则和开放封闭原则的实际小demo使用。一个类里面可能承载的功能是有点太多。比如要去写一个图片下载，ImageDownloader里面，第一版的时候是承载了下载，缓存的功能，违反了类的单一职责原则。正确的改法就是去抽离出一个缓存类。抽离出缓存的时候，问题又来了，缓存策略又被写死了，只能使用内存缓存。这样也不行，又得抽缓存策略出来。这时就得去依赖抽象了。暴露出接口，不同的策略去实现不同的东西。然后给个接口，去注入不同的缓存实现就好了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ImageCache</span> </span>&#123;</div><div class="line">    <span class="function">Bitmap <span class="title">get</span><span class="params">(String url)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(String url, Bitmap bitmap)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>里氏替换原则的应用，就是setIMageCache（）方法的使用，子类可以完全替换成为父类，所以可以随便切换缓存策略。使用反射的话，是不是就能够把配置写到xml文件里面？</p>
</li>
</ul>
<h3 id="11月4日-天气-晴"><a href="#11月4日-天气-晴" class="headerlink" title="11月4日 天气:晴"></a>11月4日 天气:晴</h3><ul>
<li>主要是没有见得多吧，终于要上6.0了。搞了一早上的拍照功能，一直爆的bug就是说图片得不到，写不进去。那就，乱改代码了啦。一顿乱改，还是没有解决问题。那么就开始怀疑其他的问题了，网上一搜，好多都说是权限，一看。果然app的访问内存卡功能被禁止掉了。既然找到问题，改起来就方便了。我们去动态申请权限就好了。既然坑都来了，连7.0的file传递也搞了吧。</li>
<li>java内存模型的主要目标是定义程序中各个变量的访问规则，即在虚拟机中将变量存储到内存和从内存中取出变量这样的底层细节。此处的变量（variable）与java编程中所说的变量略有区别，它包括了实例字段、静态字段和构成数组对象的元素，但是不包括局部变量与方法参数，因为后者是线程私有的，不会被共享，自然就不存在竞争问题。java内存模型规定了所有的变量都存储在主内存中。每条线程还有自己的工作内存，线程的工作内存中保存了被该线程使用到的变量的主内存副本拷贝，线程对变量的所有操作（读取、赋值等）都必须在工作内存中进行，而不能直接读写主内存中的变量。不同的线程之间也无法直接访问对方工作内存的变量，线程间变量的传递均需要通过主内存来完成。</li>
<li>FileProvider的作用，就是把以“file://”开头的文件，转换成为contentprovider 的uri。至于怎么注册，怎么使用的话，看自己的笔记。</li>
</ul>
<h3 id="11月7日-天气-晴"><a href="#11月7日-天气-晴" class="headerlink" title="11月7日 天气:晴"></a>11月7日 天气:晴</h3><ul>
<li>今天学习了建造者模式。它的精髓就是给出各个部件的组长接口，让用户直接调用接口去设置部件，再给出create（）就<br>能够组装出各具特色的产品。记得，要去检查参数了哦。看看用户输入的参数是不是全部可以使用，没有输入的参数，就只能给出默认实现。在初始化对象时，一次性set好，以后通过build的属性，就不允许再度更改。建造者模式的缺点就是会生成冗余的builder对象，消耗内存。</li>
<li>已安装了存在签名冲突的同名数据包这个冲突，有下面四种解释：打包签名的key不一样；新版的版本号比旧版的低；AndroidManifest文件不一样或者有冲突；导入的包名有冲突。</li>
<li>原型模式的核心就是对象的拷贝。使用原型模式，可以解决构建复杂对象的资源消耗问题，能够在某些场景提高对象创建的效率。还有一个重要的用途就是保护性拷贝，也许某个对象对外是只读的，为了防止该对象被修改，通常可以返回一个对象拷贝形式实现只读限制。用处：比如说登陆以后的用户信息，这个信息是由网上接口得来的，在app中只能是只读，不能被修改。</li>
</ul>
<h3 id="11月8日-天气-阴"><a href="#11月8日-天气-阴" class="headerlink" title="11月8日 天气:阴"></a>11月8日 天气:阴</h3><ul>
<li>昨天晚上就说好的，我今天要去写一个太极和八卦出来的。这次真的是自己动手写了，看看自己的自定义控件的能力还是不是真的熟练？八卦的外壳还是很容易写的，只要设定好了，让画布canvas先去旋转22.5°，然后就可以用一个for循环去画出骨架。然后就是用path一直去连线，然后画出外形。画好了边以后，要做的就是去话里面的太极图了。一开始我没有想好是怎么去画，就不断地去画圆和画弧，一层一层往上去堆叠，还真的是可以画出来的。后来想到了一种更加有用的方法，用path去不断地填充路径，到最后形成形状以后，去进行填充。步骤也是也是挺多的，但是就可以建设那么一点点过度绘制。</li>
<li>重新认识到了工厂模式，这里介绍的是使用反射去生成对象。用反射搭配工厂模式去生产复杂的对象，使代码就简洁了很多。只要传进去</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> &lt;T extends AudiCar&gt; <span class="function">T <span class="title">createAudiCar</span><span class="params">(Class&lt;T&gt; clazz)</span> </span>&#123;</div><div class="line">        AudiCar car = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span>&#123;</div><div class="line">            Class clz = Class.forName(clazz.getName());</div><div class="line">            car = (AudiCar) clz.newInstance();</div><div class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> (T)car;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>抽象工厂模式。刚刚的工厂模式只是一个工厂，可以生产出若干产品啦。现在再扩大一点，就是把工厂那一层也是抽象出来，变成好多个工厂，生产出更多的产品。看似是灵活了一点，但是会导致类文件会爆炸性增长。同时，起添加新的产品类的时候，就可能要修改抽象工厂，具体工厂也是要被修改的了。</li>
</ul>
<h3 id="11月9日-天气-阴"><a href="#11月9日-天气-阴" class="headerlink" title="11月9日 天气:阴"></a>11月9日 天气:阴</h3><ul>
<li>今天学习了安卓开发的mvp模式，里面最重要的精髓应该就是分层。复用代码的话，我还真是没有看出哪里进行了复用啊。高度抽象出一个view出来，数据的采集就是可以通过view传递到p。抽象出一个p，持有view，得到数据以后，就对数据进行处理。然后p把处理完的数据，再通过view抽象出来的接口回传回去activity，activity得到数据以后更新界面。所有的逻辑业务，理论上是可以交给p去做的，所以p抽象出来就是处理一堆的逻辑业务，然后得到处理后的数据。p持有view，p被activity或者fragment持有。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserLoginView</span> </span>&#123;</div><div class="line">    <span class="function">String <span class="title">getUserName</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">String <span class="title">getPassword</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clearUserName</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clearPassword</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">showLoading</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hideLoading</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">gotoMainActivity</span><span class="params">(User user)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">showError</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>编程经验的收集，如何去组织Toast被多次点击呢？要点就是将Toast的调用封装成为一个工具类，在调用的时候，判断Toast对象是否为空咯。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToastUtil</span></span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Toast toast;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showToast</span><span class="params">(Context context,String content)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(toast == <span class="keyword">null</span>)&#123;</div><div class="line">      toast = Toast.makeText(context,content,Toast.LENGTH_SHORT);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      toast.setText(content);</div><div class="line">    &#125;</div><div class="line">    toast.show();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Dialog：当提示信息是至关重要的，并且必须要由用户做出决定才能继续的时候，使用Dialog。<br>Toast：当提示信息只是告知用户某个事情发生了，用户不需要对这个事情做出响应的时候，使用Toast。<br>Snackbar：以上两者之外的任何其他场景，Snackbar可能会是你最好的选择。</p>
<ul>
<li>在Application的构造方法当中，是不能去调用Context的方法的，因为此时的Context还没有生成，直接报错。Application中在onCreate()方法里去初始化各种全局的变量数据是一种比较推荐的做法，但是如果你想把初始化的时间点提前到极致，也可以去重写attachBaseContext()方法。</li>
</ul>
<h3 id="11月10日-天气-阴雨"><a href="#11月10日-天气-阴雨" class="headerlink" title="11月10日 天气:阴雨"></a>11月10日 天气:阴雨</h3><ul>
<li>今天，就是学习着去做动画了。什么都别说，死磕PathMeasure就好了。这个工具类是有点好玩，可以获取path的片段，可以获取path上的某个点的坐标。利用这两个特性，再加上动画控制器，就能做出很多有意思的动画出来。比如说沿着path跑一圈，比如说慢慢画个圆圈出来。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startPathAnim</span><span class="params">(<span class="keyword">long</span> duration)</span> </span>&#123;</div><div class="line">        ValueAnimator valueAnimator = ValueAnimator.ofFloat(<span class="number">0</span>, mPathMeasure.getLength());</div><div class="line">        Log.i(TAG, <span class="string">"measure length = "</span> + mPathMeasure.getLength());</div><div class="line">        valueAnimator.setDuration(duration);</div><div class="line">        valueAnimator.setInterpolator(<span class="keyword">new</span> DecelerateInterpolator());</div><div class="line">        valueAnimator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</div><div class="line">                <span class="keyword">float</span> value = (Float) animation.getAnimatedValue();</div><div class="line">                Log.d(<span class="string">"Eric"</span>,<span class="string">"value="</span> + value);</div><div class="line">                <span class="comment">// 获取当前点坐标封装到mCurrentPosition</span></div><div class="line">                mPathMeasure.getPosTan(value, mCurrentPosition, <span class="keyword">null</span>);</div><div class="line">                postInvalidate();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        valueAnimator.start();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>这是另外一个去根据不同的状态绘制不同的路径。至于状态的切换嘛，那就是去使用handler进行切换了啦。在AnimatorListener的监听周期，动画结束的时候，使用handler发个消息，继续下一个动画。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawSearch</span><span class="params">(Canvas canvas)</span></span>&#123;</div><div class="line">        canvas.translate(mWidth/<span class="number">2</span>,mHeight/<span class="number">2</span>);</div><div class="line">        canvas.drawColor(Color.parseColor(<span class="string">"#0082D7"</span>));</div><div class="line">        <span class="keyword">switch</span> (mState)&#123;</div><div class="line">            <span class="keyword">case</span> NONE:</div><div class="line">                canvas.drawPath(mPathSearch,mPaint);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//放大镜逐渐消失</span></div><div class="line">            <span class="keyword">case</span> STARTING:</div><div class="line">                mPathMeasure.setPath(mPathSearch,<span class="keyword">false</span>);</div><div class="line">                Path dst = <span class="keyword">new</span> Path();</div><div class="line">                mPathMeasure.getSegment(mPathMeasure.getLength() * mAnimatorValue, mPathMeasure.getLength(),dst,<span class="keyword">true</span>);</div><div class="line">                canvas.drawPath(dst,mPaint);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//圆圈在转</span></div><div class="line">            <span class="keyword">case</span> SEARCHING:</div><div class="line">                mPathMeasure.setPath(mPathCircle,<span class="keyword">false</span>);</div><div class="line">                Path dst2 = <span class="keyword">new</span> Path();</div><div class="line">                <span class="keyword">float</span> stop = mPathMeasure.getLength() * mAnimatorValue;</div><div class="line">                <span class="keyword">float</span> start = (<span class="keyword">float</span>)(stop - ((<span class="number">0.5</span> - Math.abs(mAnimatorValue - <span class="number">0.5</span>))* (mPathMeasure.getLength() / <span class="number">3</span>)));</div><div class="line">                mPathMeasure.getSegment(start,stop,dst2,<span class="keyword">true</span>);<span class="comment">//开启硬件加速的时候可能会导致一些错误</span></div><div class="line">                canvas.drawPath(dst2,mPaint);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//放大镜回来</span></div><div class="line">            <span class="keyword">case</span> ENDING:</div><div class="line">                mPathMeasure.setPath(mPathSearch,<span class="keyword">false</span>);</div><div class="line">                Path dst3 = <span class="keyword">new</span> Path();</div><div class="line">                mPathMeasure.getSegment(mPathMeasure.getLength() * mAnimatorValue , mPathMeasure.getLength(), dst3, <span class="keyword">true</span>);</div><div class="line">                canvas.drawPath(dst3,mPaint);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>继续经验积累，要是弄不了view转的话，可以转一下思维，转画布咯。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">       mMeasure.getPosTan(mMeasure.getLength() * currentValue, pos, tan);</div><div class="line">       <span class="keyword">float</span> degrees = (<span class="keyword">float</span>) (Math.atan2(tan[<span class="number">1</span>], tan[<span class="number">0</span>]) * <span class="number">180.0</span> / Math.PI);</div><div class="line">       canvas.save();</div><div class="line">       canvas.translate(<span class="number">400</span>, <span class="number">400</span>);</div><div class="line">       canvas.drawPath(mPath, mPaint);</div><div class="line">       canvas.drawCircle(pos[<span class="number">0</span>], pos[<span class="number">1</span>], <span class="number">10</span>, mPaint);</div><div class="line">       canvas.rotate(degrees);</div><div class="line">       canvas.drawLine(<span class="number">0</span>, -<span class="number">200</span>, <span class="number">300</span>, -<span class="number">200</span>, mPaint);</div><div class="line">       canvas.restore();</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>控制器:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">ValueAnimator animator = ValueAnimator.ofFloat(<span class="number">0</span>, <span class="number">1</span>);</div><div class="line">       animator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator valueAnimator)</span> </span>&#123;</div><div class="line">               currentValue = (<span class="keyword">float</span>) valueAnimator.getAnimatedValue();</div><div class="line">               invalidate();</div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line">       animator.setDuration(<span class="number">3000</span>);</div><div class="line">       animator.setRepeatCount(ValueAnimator.INFINITE);</div><div class="line">       animator.start();</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h3 id="11月11日-天气-冷"><a href="#11月11日-天气-冷" class="headerlink" title="11月11日 天气:冷"></a>11月11日 天气:冷</h3><p>今天测试人员就丢了一个bug过来，说是那个头像照片上传不成功。我试了几次，就发现了有意思的问题。上传是可以上传成功的，但是返回的状态码就是timeout。问题就可能是出在自身的网络连接这方面了。我查看了一下代码，握草，之前的人也是太不负责任了，直接用默认的okhttp的timeout，网络差一点的地方哪里够用了？自己自定义一个，给多少好呢？30秒吧，和之前的下载一样，都是30秒。</p>
<ul>
<li>自定义Toast步骤。首先要有一个布局，构造方法的时候，把布局add到当前的activity中，怎么拿到当前activity的布局呢？一个ViewGroup，记得R是android.R。接着addView进去就好了，记住，view此时状态是隐藏的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">container = (ViewGroup)((Activity)context)<span class="comment">//Android activity的布局</span></div><div class="line">                .findViewById(android.R.id.content);</div></pre></td></tr></table></figure>
<p>然后，接着去写makeText方法，主要做的事情就是初始化加载进来的布局，设置好动画的时间。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EToast <span class="title">makeToast</span><span class="params">(Context context, String message, <span class="keyword">int</span> hideProxy)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(result == <span class="keyword">null</span>)&#123;</div><div class="line">            result = <span class="keyword">new</span> EToast(context);</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span>(!mContext.getClass().getName().equals(context.getClass().getName()))&#123;</div><div class="line">                result = <span class="keyword">new</span> EToast(context);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(hideProxy == LENGTH_LONG)&#123;</div><div class="line">            result.HIDE_DELAY = <span class="number">3000</span>;</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            result.HIDE_DELAY = <span class="number">1500</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        mTextView.setText(message);</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>也可以去重载那个传入int res的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EToast <span class="title">makeToast</span><span class="params">(Context context, <span class="keyword">int</span> res, <span class="keyword">int</span> hideProxy)</span></span>&#123;</div><div class="line">       String msg = <span class="string">""</span>;</div><div class="line">       msg = context.getResources().getString(res);</div><div class="line">       <span class="keyword">return</span> makeToast(context,msg,hideProxy);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>最后，就是到最重要的show方法了。定义两个动画，把布局展示出来，然后在相应的时间后，隐藏布局。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</div><div class="line">       <span class="keyword">if</span>(isShow)&#123;</div><div class="line">           <span class="keyword">return</span>;</div><div class="line">       &#125;</div><div class="line">       isShow = <span class="keyword">true</span>;</div><div class="line">       mFadeInAnimation = <span class="keyword">new</span> AlphaAnimation(<span class="number">0</span>,<span class="number">1</span>);</div><div class="line">       mFadeOutAnimation = <span class="keyword">new</span> AlphaAnimation(<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">       mFadeOutAnimation.setDuration(ANIMATION_DURATION);</div><div class="line">       mFadeOutAnimation.setAnimationListener(<span class="keyword">new</span> Animation.AnimationListener() &#123;</div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line">               isShow = <span class="keyword">true</span>;</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line">               mContainer.setVisibility(View.GONE);</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line"></div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line">       mContainer.setVisibility(View.VISIBLE);</div><div class="line">       mFadeInAnimation.setDuration(ANIMATION_DURATION);</div><div class="line">       mContainer.startAnimation(mFadeInAnimation);</div><div class="line">       mHandler.postDelayed(mHideRunnable,HIDE_DELAY);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>使用handler的原因，就是因为这里不是主线程嘛，不能操作界面。</p>
<h3 id="11月14日-天气-晴"><a href="#11月14日-天气-晴" class="headerlink" title="11月14日 天气:晴"></a>11月14日 天气:晴</h3><p>今天早上就先去研究了一下recyclerview的局部刷新，优雅的实现方式。recyclerview是自带根据position刷新一个item的功能，要实现单选的话，就是可以使用一个标志位去记住。但是更优雅一点的方式，使用DiffUtil去进行判断也行。优雅一点就是节能。</p>
<ul>
<li>测试的说了，登陆的时候，为什么登陆失败以后，那个圈还在那里转啊转啊？不就是在这个路径之下没有关闭么。看一下代码，在所有路径下面都没有关闭。测试可能会说了，登陆成功以后为什么就不见了呢？那是，当前界面已经被销毁了。行，我花1分钟去改。</li>
<li>又有人找我拿最新的apk包了。不行，你们自己拿。可是，怎么拿呢？持续集成咯。我一开始的方案是想跟着全辅导走的，找一个Jenkins去进行自动化构建。执行的时候，问题就来了，公司用了bamboo，而不是和全辅导一样去使用Jenkins。Bamboo可行吗？按道理是可行的。把git关联起来，配置好android的编译环境和相应的gradle版本，下午再看看有什么坑出现。</li>
<li>1、local.properties中sdk.dir需设置成ANDROID_HOME路径</li>
</ul>
<p>2、build.gradle的compileSdkVersion、buildToolsVersion需与ANDROID_HOME中的SDK一致</p>
<p>3、/opt/adt-bundle-linux-x86_64-20140702/sdk/extras/android路径下可能缺少m2repository包，需要补全，否则可能无法识别出external-library里的support-v4/v7包并依赖，原因不详。</p>
<p>4、我是在google develper android官网下载的64位，linux版本为64位，结果报aapt: error while loading shared libraries: libz.so.1: cannot open shared object file: No such file or directory，原因是64为OS需运行32为应用程序缺少链接库所致，$ yum install glibc.i686下载库即可。不知道为啥官网上下下来的都会这样。</p>
<p>5、build.gradle脚本中可能需要加上lintOptions选项。</p>
<p>android{</p>
<p>lintOptions {<br>abortOnError false<br>}</p>
<p>}</p>
<ul>
<li>责任链模式：写一个批假的责任链出来。写好了，抽象的层次有点多。</li>
</ul>
<h3 id="11月15日-天气-晴"><a href="#11月15日-天气-晴" class="headerlink" title="11月15日 天气:晴"></a>11月15日 天气:晴</h3><p>今天回到公司，测试人员说头像上传的速度很慢，找我去优化一下。我努力去排查，和其他的项目先做对比，不断打log，发现上传的图片大小都是一样的，但是一个会很快，另外一个是很慢。这就不是我擅长的领域了，我应该怎么去和我们后台的同事去协调？有想过去抓包，但是没用的啦，数据肯定是一样的。有另外一个办法就是去打时间点，发送和返回的时间点，当然服务器那边也是要去打点。先去分析那四个时间点，看看有什么问题先。</p>
<ul>
<li>app老是弹出叫我去更新新的版本，然而程序是我写的，是不是最新版我肯定知道。那么问题来了，是服务器不知道。我去打了一个log，果然程序的发布平台没有更改成为最新的。那就不关我们的事情了，是服务端要去更新url。</li>
<li>（安装好后，点击打开，然后中途home键，再次打开app，会重新生成app）其实原因很简单，利用程序安装器打开程序，启动的Intent是没有带Category，而我们自己打开程序是带了Category,所以只需要在配置Intent.ACTION_MAIN的Activity判断下有无Category。然后放到通知栏的时候要更具有无Category 来生成启动的Intent。</li>
<li>遇到项目打不开的时候，先去把它的gradle版本改成自己里面有的，不然，那是要下载很久的gradle的。</li>
</ul>
<h3 id="11月16日-天气-晴"><a href="#11月16日-天气-晴" class="headerlink" title="11月16日 天气:晴"></a>11月16日 天气:晴</h3><p>粗略看了一下安卓的Packageparser，包解析器。它的主要作用就是去解析安卓的配置文件，xml，把application，四大组件等，都逐个去解析出来，然后放到pms那里去。源码好长，但是基本思路就是去遍历整个xml，遇到匹配的文法，就可以解析出相应的组件。</p>
<h3 id="11月17日-天气-晴"><a href="#11月17日-天气-晴" class="headerlink" title="11月17日 天气:晴"></a>11月17日 天气:晴</h3><p>今天模仿了一个命令模式。现在对命令模式有更深一点的认识就是命令模式对调用者和接收者之间进行了解耦。还了解到了更重要的一个作用是去记录命令的执行线路，用于撤销或者重做。书写的例子就是一个涂鸦器的使用，用户的每次操作都是一个命令，有命令控制器去转化用户的命令，画到画布上面。控制器可以记录用户的命令，使用list这个数据结构存储可重做的命令和全部命令（里面可以撤销）。但是目前没有做到的是持久化保存用户操作，退出之后，命令就不在了。</p>
<ul>
<li>新学习到的知识点，就是在 进行基类抽象的时候，抽象出抽象方法。同时，去暴露出一个公有的接口，传入和抽象方法相同的参数，里面调用抽象方法。抽象方法是由基类去实现的，向上转型为基类，这样一来，就是一种多态了。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span></span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">doHandle</span><span class="params">(<span class="keyword">int</span> i)</span></span>;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">handle</span><span class="params">(<span class="keyword">int</span> i)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> doHandle(i);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="11月18日-天气-阴"><a href="#11月18日-天气-阴" class="headerlink" title="11月18日 天气:阴"></a>11月18日 天气:阴</h3><p>初步写了一下内部类，知道它的好处之一就是很容易去隐藏内部的实现细节。使用内部类去实现接口也是一种不错的选择？内部类自动获取到外围类的所有域，在内部去操作。我都在说些啥啊。。。</p>
<ul>
<li>给画图的地方去加入了备忘录模式，是初步加入，我也没有去做优化，比如说持久化存储记录，存储多个状态等等。但是，就是能用啊。</li>
<li>码了一下迭代器模式的使用。这种设计模式的精髓就是要去把数据结构的迭代抽象出来，给出一个统一的抽象接口。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">T <span class="title">next</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为不同数据结构去实现不同的迭代器。这样，客户端就能够得到统一的调用了。</p>
<h3 id="11月21日-天气-阴"><a href="#11月21日-天气-阴" class="headerlink" title="11月21日 天气:阴"></a>11月21日 天气:阴</h3><p>测试人员给了一个bug，说是没有角色的切换选择项，我登陆上去看了一下，果然是没有。可是，代码是和泰中的一样的，怎么可能没有呢。瞅一瞅代码，发现了下面的片段。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(Bl.getRoleListSize() &lt;= <span class="number">1</span>)&#123;</div><div class="line">      changeRoleLayout.setVisibility(View.GONE);</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>角色少于两个的时候，当然要对这个选项进行隐藏。</p>
<ul>
<li><p>webp图片资源的使用。谷歌推出的图片新处理方式，占用资源要比jpg少3成，看起来还是很诱人的。4.0以上的系统可以自动适配webp，但是如果我们要去支持4.0以下的系统的时候，就要去使用so库去支持。又可以玩以下交叉编译，得到so了。这下更加好的就是，谷歌已经提供好了jar，只要能够成功打包出so的话，就能够使用了。目前有三条交叉编译的路可以走，一种是利用as去进行编译，要写Android.mk文件。另外一种就是要去使用Linux平常的编译，但是需要将默认的虚拟机换成android ndk里面的android linux虚拟机。再者是使用工具链，我可没有试过。第二种是通用的方法，我得去写一个编译的sh脚本替换虚拟机。今晚去写。</p>
</li>
<li><p>webp的基本使用方法。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] LL;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle bundle)</span></span>&#123;</div><div class="line">  <span class="comment">//改变ImageView的创建方式</span></div><div class="line">  <span class="keyword">if</span>(Build.VERSION_SDK_INT &lt; Buile.VERSION_CODES.JHELLY_BEAN)&#123;</div><div class="line">    LayoutInflaterCompat.setFactory(LayoutInflater.from(<span class="keyword">this</span>),<span class="keyword">new</span> LayoutInflaterFactory()&#123;</div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreateView</span><span class="params">(View parent, String name, Context context, AttributeSet attrs)</span></span>&#123;</div><div class="line">        AppCompatDelegate.delegate = getDelegate();</div><div class="line">        View view = delegate.createView(parent, name, context, attrs);</div><div class="line">        <span class="keyword">if</span>(view <span class="keyword">instanceof</span> ImageView)&#123;</div><div class="line">          ImageView imageView = (ImageView)view;</div><div class="line">          <span class="comment">//取出用户声明的src属性</span></div><div class="line">          TypedArray a = context.obtainStyledAttrabutes(attrs, LL);</div><div class="line">          <span class="keyword">int</span> webpResId = a.getResourceId(<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">          <span class="keyword">if</span>(webpResId == <span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">return</span> view;</div><div class="line">          &#125;</div><div class="line">          <span class="comment">//打开文件流，得到byte原生数组</span></div><div class="line">          InputStream in = getResources().openRawResource(webpResId);</div><div class="line">          <span class="keyword">byte</span>[] date = streamToBytes(in);</div><div class="line">          <span class="comment">//使用so去加载库</span></div><div class="line">          <span class="keyword">final</span> Bitmap bitmap = WebPDecoder.getInstance().decodeWebP(data);</div><div class="line">          imageView.setImageBitmap(bitmap);</div><div class="line">          a.recycle();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">super</span>.onCreate(bundle);</div><div class="line">    setContentView(R.layout.activity_main);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>接着上一下事件分发机制的伪代码，好像真的是挺带感的。但是，如果父view没有拦截事件，到最后子view也没有消费掉那个事件，动作事件还是要被打回头，给父view去onTouchEvient();</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchEvent</span><span class="params">(MotionEvent event)</span></span>&#123;</div><div class="line">  <span class="keyword">boolean</span> consume = <span class="keyword">false</span>;</div><div class="line">  <span class="keyword">if</span>(onInterruptEvent(event))&#123;</div><div class="line">    consume = onTouchEvent(event);</div><div class="line">  &#125;<span class="keyword">else</span>&#123;</div><div class="line">    consume = child.dispatchEvent(event);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> consume;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>模板方法就是把具体的固定流程抽离出来，每个具体步骤有着不同的实现，组合起来成为不同的东西。之前全辅导写的那一套基础BaseActivity的东西，初始化方法那里，有一定的执行步骤了。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCar</span></span>&#123;</div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">startEngine</span><span class="params">()</span></span>&#123;</div><div class="line">    System.out.println(<span class="string">""</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">engageGear</span><span class="params">()</span></span>&#123;</div><div class="line">    System.out.println();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">stepOnTheGas</span><span class="params">()</span></span>&#123;</div><div class="line">    System.out.println();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">releaseClutch</span><span class="params">()</span></span>&#123;</div><div class="line">    System.out.println();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">//固定执行步骤，子类可以去实现不同的方法</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">drive</span><span class="params">()</span></span>&#123;</div><div class="line">    startEngine();</div><div class="line">    engageGear();</div><div class="line">    stepOnTheGas();</div><div class="line">    releaseClutch();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>发现自己的IDE好像关联不上源码了，点进去是一堆的空代码项，那可能就是当前的sdk版本没有默认提供源码，需要做的就是修改jdk.table.xml这个文件（在as配置目录之下），把当前版本的源码配置指向另外一个版本的就好。比如现在25的sdk貌似没有带源码下载，那么我们就可以让它指向24的代码，都一样的代码嘛。以后等到了sdk-25出了代码，再修改回去也不是不可。</li>
</ul>
<h3 id="11月22日-天气-雨"><a href="#11月22日-天气-雨" class="headerlink" title="11月22日 天气:雨"></a>11月22日 天气:雨</h3><p>今天回来的第一件事情就是要去弄一个软件上去手机市场，首选当然是360的啦。里面的坑就是，没有开发者账号，我问了一下是谁管这事的，没人管。然后正确的做法就是要以全通的名义，去开一个小号。开号的过程倒是没有什么难度，不过就是牺牲了我自己的身份证一次。弄出了apk以后，丢上去360还要进行加固，被解包以后，签名不在了。加固完成，我又要去学习一项新的技能，就是使用java命令行去对apk进行签名。摆脱了gui，就是靠自己了。经过了一番的周折，终于得到了下面的命令行。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore Key.store.jks -signedjar qky_sign.apk app.apk qky-app</div></pre></td></tr></table></figure></p>
<p>签名弄好了，就差一些文案了，这个谁管？没人管的话，我只好先写着，凑合去用。搞完了这些截图什么的啊，就可以进行发布了。现在在等通知，希望没有给账号，也能通过审核吧。</p>
<ul>
<li>新学习到的知识点就是有几种不需要权限去实现震动，不需要权限，不需要权限。方法一：设置longClickListener，返回个true就可以了，实现震动。performHapticFeedback(HapticFeedbackConstants.LONG_PRESS);该方法最终触发了震动反馈。可以在监听事件里面去手动调用这个方法，不过xml的文件配置会有一定的影响，但是可以忽略。用户关了震动，也是可以震动，但是我们最好不要去挑战用户的容忍度。</li>
</ul>
<ul>
<li>代理模式：这个模式的精髓就是自己干不了的事情，可以委托别人去做。持有代理对象，实现一样的接口，保证客户端使用的透明性。</li>
</ul>
<h1 id="11月23日-天气-阴雨"><a href="#11月23日-天气-阴雨" class="headerlink" title="11月23日 天气:阴雨"></a>11月23日 天气:阴雨</h1><p>今天遇到的一个bug收集，就是recyclerview去自定义itemdecoration的时候，getItemOffset()会导致布局改变，让你莫名其妙地发现上下会被绘制了两次。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhotoDivide</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ItemDecoration</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> mHorizontalSpace;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> mVerticalSpace;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhotoDivide</span><span class="params">(<span class="keyword">int</span> horizontalSpace, <span class="keyword">int</span> verticalSpace)</span> </span>&#123;</div><div class="line">		mHorizontalSpace = horizontalSpace;</div><div class="line">		mVerticalSpace = verticalSpace;</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getItemOffsets</span><span class="params">(Rect outRect, View view, RecyclerView parent, RecyclerView.State state)</span> </span>&#123;</div><div class="line">		GridLayoutManager manager = (GridLayoutManager) parent.getLayoutManager();</div><div class="line">		<span class="keyword">int</span> spanCount = manager.getSpanCount();</div><div class="line">		<span class="keyword">int</span> childPosition = ((RecyclerView.LayoutParams) view.getLayoutParams()).getViewLayoutPosition();</div><div class="line">		<span class="keyword">int</span> childCount = parent.getAdapter().getItemCount();</div><div class="line">		<span class="keyword">int</span> horizontalSpace = mHorizontalSpace;</div><div class="line">		<span class="keyword">int</span> verticalSpace = mVerticalSpace;</div><div class="line">		<span class="keyword">if</span> ((childPosition + <span class="number">1</span>) % spanCount == <span class="number">0</span>) &#123;</div><div class="line">			<span class="comment">// 最后一列，不需要绘制右边</span></div><div class="line">			horizontalSpace = <span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">int</span> spanLeft = childCount % spanCount;</div><div class="line">		<span class="keyword">if</span> (spanLeft == <span class="number">0</span>) &#123;</div><div class="line">			spanLeft = spanCount;</div><div class="line">		&#125;</div><div class="line">		childCount = childCount - spanLeft;</div><div class="line">		<span class="keyword">if</span> (childPosition &gt;= childCount) &#123;</div><div class="line">			<span class="comment">// 最后一行，则不需要绘制底部</span></div><div class="line">			verticalSpace = <span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">		outRect.set(<span class="number">0</span>, <span class="number">0</span>, horizontalSpace, verticalSpace);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>知识点学习：android 5.0以后，不允许隐式启动service。要去显式指定service。</li>
<li>拥有了重复的xml文件，都不知道android是怎么想的，同一个lib下面的不找，专门去找那些路径短的xml文件去加载。现在找到重复的xml文件，删除它就好了。</li>
</ul>
<h1 id="11月24日-天气-阴"><a href="#11月24日-天气-阴" class="headerlink" title="11月24日 天气:阴"></a>11月24日 天气:阴</h1><p>今天一早上都耗在自定义折线图那里去了。这个折线图其实也是没什么好说的，就是一通地去算那些坐标，然后连线，画。画直线，画坐标等等，都是可以的。我比较看重的一个有意思的技术点，也可能是我之前没有接触过吧。就是在折线的中间去绘制一个空心的圆。目前给出通用的处理方式就是要去画两个同心圆，第一个是空心的有色圆圈，第二个就是白色的圆，实心的。两个组合起来，就能够去画出空心圆了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">brokenPaint.setColor(brokenLineColor);</div><div class="line">canvas.drawCircle(x,y,dp2px(<span class="number">4</span>),brokenPaint);</div><div class="line">brokenPaint.setStyle(Paint.Style.FILL);</div><div class="line">brokenPaint.setColor(Color.WHITE);</div><div class="line">canvas.drawCircle(x,y,dp2px(<span class="number">2</span>),brokenPaint);</div></pre></td></tr></table></figure>
<p>另外一个，就是onTouchEvent那里，去进行触摸区域的判定，也就是得到当前的(x,y),判定这个点有没有落在要触摸的区域。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">validateTouch</span><span class="params">(<span class="keyword">float</span> x, <span class="keyword">float</span> y)</span></span>&#123;</div><div class="line">       <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; scorePoints.size() ; i ++)&#123;</div><div class="line">           <span class="keyword">float</span> scoreX = mWidth * <span class="number">0.1f</span> + (mWidth * <span class="number">0.9f</span> / scorePoints.size()) * i;</div><div class="line">           <span class="keyword">float</span> scoreY = mHeight * <span class="number">0.7f</span>;</div><div class="line">           <span class="keyword">if</span>(x &gt; scoreX - dp2px(<span class="number">30</span>) &amp;&amp; x &lt; scoreX + dp2px(<span class="number">30</span>) &amp;&amp; y &gt; scoreY - dp2px(<span class="number">30</span>) &amp;&amp; y&lt; scoreY + dp2px(<span class="number">30</span>))&#123;</div><div class="line">               selectedMonth = i+<span class="number">1</span>;</div><div class="line">               <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>下面来看看安卓的事件拦截，来一个通俗的外部拦截方法，重写父容器的onInterceptTouchEvent.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">inInterceptTouchEvent</span><span class="params">(MotionEvent event)</span></span>&#123;</div><div class="line">  <span class="keyword">boolean</span> intercepted = <span class="keyword">false</span>;</div><div class="line">  <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</div><div class="line">  <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</div><div class="line">  <span class="keyword">switch</span>(event.getAction())&#123;</div><div class="line">    <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">      intercepted = <span class="keyword">false</span>;<span class="comment">//要返回false，不然一旦父容器拦截了这个</span></div><div class="line">      <span class="keyword">if</span>(!mScroller.isFinished())&#123;</div><div class="line">        mScroller.abortAnimation();</div><div class="line">        intercepted = <span class="keyword">true</span>;</div><div class="line">      &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">    <span class="keyword">int</span> deltaX = x - mLastXIntercepted;</div><div class="line">    <span class="keyword">int</span> deltaY = y - mLaseYIntercepted;</div><div class="line">    <span class="comment">//判断是不是x方向的滑动大于y方向的滑动</span></div><div class="line">    <span class="keyword">if</span>(Math.abs(deltaX) &gt; Math.abs(deltaY))&#123;</div><div class="line">      intercepted = <span class="keyword">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      intercepted = <span class="keyword">false</span>;<span class="comment">//当竖直距离大的时候，父容器就不会去拦截事件，滑动事件就传递给了子元素</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">    intercepted = <span class="keyword">false</span>;<span class="comment">//这个事件本身也是没有什么意义，必须要返回false</span></div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  &#125;</div><div class="line">  mLastXIntercepted = x;</div><div class="line">  mLaseYIntercepted = y;</div><div class="line">  <span class="keyword">return</span> intercepted;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面去到子元素中间，使用内部拦截法，去进行事件消耗：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span></span>&#123;</div><div class="line">  <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</div><div class="line">  <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</div><div class="line">  <span class="keyword">switch</span>(event.getAction())&#123;</div><div class="line">    <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">      parent.requestDisallowInterceptTouchEvent(<span class="keyword">true</span>);<span class="comment">//父容器要禁止拦截事件了，都是那一句，一旦父容器拦截了这个事件，往后的事件都不能传递到子元素了</span></div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">    <span class="keyword">int</span> deltaX = x - mLastX;</div><div class="line">    <span class="keyword">int</span> deltaY = y- mLastY;</div><div class="line">    <span class="keyword">if</span>(父容器需要拦截事件)&#123;</div><div class="line">      parent.requestDisallowInterceptTouchEvent(<span class="keyword">false</span>);<span class="comment">//父容器才能给继续去拦截所需的时间</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  &#125;</div><div class="line">  mLastX = x;</div><div class="line">  mLastY = y;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(event);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>既然要配合子元素去使用内部拦截法，父容器的拦截事件需要写成下面这样子去了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">inInterceptTouchEvent</span><span class="params">(MotionEvent event)</span></span>&#123;</div><div class="line">  <span class="keyword">switch</span>(event.getAction())&#123;</div><div class="line">    <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="11月25日-天气-阴"><a href="#11月25日-天气-阴" class="headerlink" title="11月25日 天气:阴"></a>11月25日 天气:阴</h1><ul>
<li>使用ndk去进行交叉编译，得到so的时候，应该要去注意的是ndk不是向前兼容的，而是向后兼容的。使用高版本的ndk进行编译以后，后续的系统版本就能够使用，但是低版本的系统可能无法使用。所以，要根据项目可支持的最小的系统版本去选择ndk包进行编译。</li>
<li>今天去研究了一下自定义view中的构造方法中的第三个参数defStyle的意义。这个就是可以去加载xml文件中指定的style。</li>
</ul>
<p>先来看看xml文件里面干了什么。给了一个style，也给了一个text_normal_color属性，其实style里面也是有这个属性的，那么加载顺序，或者说优先级是怎么样的呢？<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;com.example.view.sesameview.SesameView</div><div class="line">        android:layout_width=<span class="string">"match_parent"</span></div><div class="line">        android:layout_height=<span class="string">"match_parent"</span></div><div class="line">        app:text_normal_color=<span class="string">"@color/colorPrimaryDark"</span></div><div class="line">        style=<span class="string">"@style/DefaultStyle"</span>/&gt;</div></pre></td></tr></table></figure></p>
<p>下面再去看看构造方法里面干了什么。这个是4个参数的构造方法，只有在api版本&gt;=21的时候可以使用.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">SesameView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr, <span class="keyword">int</span> defStyleRes)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr, defStyleRes);</div><div class="line">        mContext = context;</div><div class="line">        <span class="comment">//就是这里，可以通过4个途径</span></div><div class="line">        TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.SesameView,defStyleAttr,R.style.DefaultStyle);</div><div class="line">        maxScore = a.getInt(R.styleable.SesameView_max_score,<span class="number">800</span>);</div><div class="line">        minScore = a.getInt(R.styleable.SesameView_min_score,<span class="number">600</span>);</div><div class="line">        brokenLineColor = a.getColor(R.styleable.SesameView_broken_line_color,<span class="number">0</span>);</div><div class="line">        textNormalColor = a.getColor(R.styleable.SesameView_text_normal_color,<span class="number">0</span>);</div><div class="line">        brokenWidth = <span class="number">4</span>;</div><div class="line">        a.recycle();</div><div class="line">        init();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>顺便加上attr文件和tyle文件，看看里面都有些什么了啦.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">&lt;declare-styleable name="SesameView"&gt;</div><div class="line">        &lt;attr name="max_score" format="integer"/&gt;</div><div class="line">        &lt;attr name="min_score" format="integer"/&gt;</div><div class="line">        &lt;attr name="broken_line_color" format="color"/&gt;</div><div class="line">        &lt;attr name="text_normal_color" format="color"/&gt;</div><div class="line">    &lt;/declare-styleable&gt;</div><div class="line"></div><div class="line">    &lt;attr name="SesameViewColorStyle" format="reference"/&gt;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">&lt;style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar"&gt;</div><div class="line">       &lt;!-- Customize your theme here. --&gt;</div><div class="line">       &lt;item name="colorPrimary"&gt;@color/colorPrimary&lt;/item&gt;</div><div class="line">       &lt;item name="colorPrimaryDark"&gt;@color/colorPrimaryDark&lt;/item&gt;</div><div class="line">       &lt;item name="colorAccent"&gt;@color/colorAccent&lt;/item&gt;</div><div class="line">       &lt;item name="SesameViewColorStyle"&gt;@style/CustomizeStyleTheme&lt;/item&gt;</div><div class="line">   &lt;/style&gt;</div><div class="line"></div><div class="line">   &lt;style name="CustomizeStyleTheme"&gt;</div><div class="line">       &lt;item name="min_score"&gt;600&lt;/item&gt;</div><div class="line">       &lt;item name="broken_line_color"&gt;@color/first_color&lt;/item&gt;</div><div class="line">       &lt;item name="text_normal_color"&gt;@color/second_color&lt;/item&gt;</div><div class="line">   &lt;/style&gt;</div><div class="line"></div><div class="line">   &lt;style name="ThroughStyle"&gt;</div><div class="line">       &lt;item name="broken_line_color"&gt;@color/first_color&lt;/item&gt;</div><div class="line">       &lt;item name="text_normal_color"&gt;@color/second_color&lt;/item&gt;</div><div class="line">   &lt;/style&gt;</div><div class="line"></div><div class="line">   &lt;style name="DefaultStyle"&gt;</div><div class="line">       &lt;item name="max_score"&gt;800&lt;/item&gt;</div><div class="line">       &lt;item name="min_score"&gt;500&lt;/item&gt;</div><div class="line">       &lt;item name="broken_line_color"&gt;@color/colorAccent&lt;/item&gt;</div><div class="line">       &lt;item name="text_normal_color"&gt;@color/text_normal_color&lt;/item&gt;</div><div class="line">   &lt;/style&gt;</div></pre></td></tr></table></figure>
<p>我故意没有设置到任何属性的时候，就去调用了AppTheme里面指定的style；只是指定了style，就会去调用style里面的属性。同时指定了style和attr的属性的时候，就优先使用attr的属性；而defaultStyle这个呢，就在所有东西都不调用的时候出场。所以，我们现在可以得出这样的一个规律，就是xml&gt;style&gt;defStyleAttr&gt;defStyleRes、Theme中指定的值。现在剩下的问题，不，可能我已经解除迷惑了，就是defStyleRes的值是不会在xml里面定义的吧。</p>
<ul>
<li>编程知识点积累：2m和200k的同分辨率的图片，加载进入内存后，形成的对象是一样大的。都是每个像素占用的字节数的总和。这个，我好像之前是有打印过出来的哦。</li>
<li>如何在activity中获取到一个view的宽和高？在activity的生命周期方法中，是不能够正确获取到view的宽和高的，因为那时view还是没有准备好。正确的方式就是在onWindowFocusChanged()方法里面去获取到view的宽和高。不过要注意的就是，这个方法会被调用多次，在activity得到或者失去焦点的时候就会被调用。正确的解决思路就是要去等待view初始化以后，再去获取到它的宽和高。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onWindowFocusChanged</span><span class="params">(<span class="keyword">boolean</span> hasFocus)</span></span>&#123;</div><div class="line">  <span class="keyword">if</span>(hasFocus)&#123;</div><div class="line">    <span class="keyword">int</span> width = view.getMeasuredWidth();</div><div class="line">    <span class="keyword">int</span> height = view.getMeasuredHeight();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>setWillNotDraw(false),这个方法写在自定义view的onCreate()中，确保onDraw()方法会被执行。</li>
</ul>
<h2 id="11月28日-天气-晴"><a href="#11月28日-天气-晴" class="headerlink" title="11月28日 天气:晴"></a>11月28日 天气:晴</h2><ul>
<li>StringBuilder为什么会如此高效？就是因为StringBuilder始终都在使用一个字符串数组去进行操作。append不断地去把片段的String加到chars[]数组里面。下面是它的append方法，我在jdk8里面看到的，其他的jdk貌似不是这样的实现了哦。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> AbstractStringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (str == <span class="keyword">null</span>)</div><div class="line">           <span class="keyword">return</span> appendNull();</div><div class="line">       <span class="keyword">int</span> len = str.length();</div><div class="line">       ensureCapacityInternal(count + len);</div><div class="line">       str.getChars(<span class="number">0</span>, len, value, count);</div><div class="line">       count += len;<span class="comment">//字符串数组增长</span></div><div class="line">       <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>下面看看String类里面是怎么对这个进行实现的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">* @param      srcBegin   index of the first character in the string</div><div class="line">  *                        to copy.源数组的开始</div><div class="line">  * @param      srcEnd     index after the last character in the string</div><div class="line">  *                        to copy.源数组的结尾</div><div class="line">  * @param      dst        the destination array.目标数组</div><div class="line">  * @param      dstBegin   the start offset in the destination array.z目标数组的开始位置</div><div class="line">  * @exception IndexOutOfBoundsException If any of the following</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getChars</span><span class="params">(<span class="keyword">int</span> srcBegin, <span class="keyword">int</span> srcEnd, <span class="keyword">char</span> dst[], <span class="keyword">int</span> dstBegin)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (srcBegin &lt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(srcBegin);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (srcEnd &gt; value.length) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(srcEnd);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (srcBegin &gt; srcEnd) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(srcEnd - srcBegin);</div><div class="line">        &#125;</div><div class="line">        System.arraycopy(value, srcBegin, dst, dstBegin, srcEnd - srcBegin);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>到达最后一步的实现System就是要去使用native进行实现了。</p>
<ul>
<li>初步了解了去实现一个自定义的ViewPager类似的Layout的实现。重点要做的事情，就是要去测量总体view的宽高（要处理wrap的情况），然后去layout那里放置好子元素的位置。最重要的一点，就是要去解决滑动冲突。父控件可以左右滑动，子控件可以上下滑动，这样就存在着冲突。我们的做法就是，父控件去拦截左右滑动事件，不去拦截上下的滑动事件。使用的是外部拦截方法，代码如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">        <span class="keyword">boolean</span> intercepted = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">int</span> x = (<span class="keyword">int</span>)ev.getX();</div><div class="line">        <span class="keyword">int</span> y = (<span class="keyword">int</span>)ev.getY();</div><div class="line">        <span class="keyword">switch</span> (ev.getAction())&#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                intercepted = <span class="keyword">false</span>;</div><div class="line">                <span class="keyword">if</span>(!mScroller.isFinished())&#123;</div><div class="line">                    mScroller.abortAnimation();<span class="comment">//加入了滑动条，在快速滑动未停止的时候，触摸屏幕就要拦截事件</span></div><div class="line">                    intercepted = <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                <span class="keyword">int</span> deltaX = x - mLastXIntercept;</div><div class="line">                <span class="keyword">int</span> deltaY = y- mLastYIntercept;</div><div class="line">                <span class="keyword">if</span>(Math.abs(deltaX)&gt; Math.abs(deltaY))&#123;</div><div class="line">                    intercepted = <span class="keyword">true</span>;</div><div class="line">                &#125;<span class="keyword">else</span> &#123;</div><div class="line">                    intercepted = <span class="keyword">false</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                intercepted = <span class="keyword">false</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        mLastXIntercept = x;</div><div class="line">        mLastYIntercept = y;</div><div class="line">        mLastX = x;</div><div class="line">        mLastY = y;</div><div class="line">        <span class="keyword">return</span> intercepted;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>接着就是要去处理触摸事件了，继续看代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        mVelocityTracker.addMovement(event);</div><div class="line">        <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</div><div class="line">        <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</div><div class="line">        <span class="keyword">switch</span> (event.getAction())&#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                <span class="keyword">if</span>(!mScroller.isFinished())&#123;</div><div class="line">                    mScroller.abortAnimation();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                <span class="keyword">int</span> deltaX = x - mLastX;</div><div class="line">                scrollBy(-deltaX, <span class="number">0</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                <span class="keyword">int</span> scrollX = getScrollX();</div><div class="line">                mVelocityTracker.computeCurrentVelocity(<span class="number">1000</span>);</div><div class="line">                <span class="keyword">float</span> xVelocity = mVelocityTracker.getXVelocity();</div><div class="line">                <span class="keyword">if</span>(Math.abs(xVelocity) &gt;= <span class="number">50</span>)&#123;</div><div class="line">                    mChildIndex = xVelocity &gt; <span class="number">0</span> ? mChildIndex-<span class="number">1</span> : mChildIndex + <span class="number">1</span>;</div><div class="line">                &#125;<span class="keyword">else</span> &#123;</div><div class="line">                    mChildIndex = (scrollX + mChildSize / <span class="number">2</span>) /mChildWidth;</div><div class="line">                &#125;</div><div class="line">                mChildIndex = Math.max(<span class="number">0</span>, Math.min(mChildIndex, mChildSize-<span class="number">1</span>));</div><div class="line">                <span class="keyword">int</span> dx = mChildIndex * mChildWidth - scrollX;</div><div class="line">                smoothScrollBy(dx,<span class="number">0</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        mLastX = x;</div><div class="line">        mLastY = y;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="11月29日"><a href="#11月29日" class="headerlink" title="11月29日"></a>11月29日</h2><ul>
<li>java RTTI(Run Time Type Identification，通过运行时类型识别)，其实就是反射，这个概念原本是c++里面的概念，我以后阅读的时候，还是按照反射去理解就好了。</li>
<li>浏览器缓存，给okhttp设置缓存的时候，首先得有一个缓存文件夹，代码如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</div><div class="line">  File file = <span class="keyword">new</span> File(String Path);</div><div class="line">  <span class="keyword">int</span> cacheSize = <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">50</span>;<span class="comment">//我给你50M</span></div><div class="line">  Cache cache = <span class="keyword">new</span> Cache(file,cacheSize);</div><div class="line">  OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()</div><div class="line">  .addNetWorkInterceptor(<span class="keyword">new</span> CacheInterceptor())<span class="comment">//添加了下面的拦截器</span></div><div class="line">  .cache(cache).build();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其实控制缓存的消息往往就是服务端返回的信息中添加的如”Cache-Control:max-age=60”。这样就会有两种情况发生，一种是服务端能够返回这样的头部，另外一种就是不能返回这样的头部啦，后者通常见于服务端和前端不能很好地进行沟通。但是，OkHttp可以很好地去解决这个头部的问题，就是去使用拦截器。拦截器可以获取到Request和Response，就可以人为地去添加这种信息进去，移花接木。下面请看代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span></span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException</span>&#123;</div><div class="line">    Response originResponse = chain.proceed(chain.request());</div><div class="line">    <span class="keyword">return</span> originResponse.newBuilder().removeHeader(<span class="string">"pragma"</span>).header(<span class="string">"Cache-Control"</span>,<span class="string">"max-age=60"</span>).build();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是这样的情况是一刀切，我之前也有郁闷过，你加在了单例的client中，但是这个拦截器并不是全部请求都通用的。我能不能够不把拦截器设置在全局，而是哪个请求需要特定的拦截器，就给它设置特定的拦截器？但是okhttp给出了处理的建议，就是使用CacheControl，这个是针对请求的，只要在请求当中去设置缓存控制就好。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Request <span class="title">createRequest</span><span class="params">(...)</span></span>&#123;</div><div class="line">  <span class="comment">//cacheControl有如下的用法：noCache();noStore();onlyIfCached();noTransform();maxAge();maxStale();minFresh();</span></div><div class="line">  CacheControl cacheControl = <span class="keyword">new</span> CacheControl.Builder().maxAge(<span class="number">60</span>,TimeUnit.SECONDS).build();</div><div class="line">  Request request = <span class="keyword">new</span> Request.Builder().url(url).cacheControl(cacheControl).build();</div><div class="line">  <span class="keyword">return</span> request;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>如果一个逻辑业务逻辑过程太过复杂，需要去打印它的执行过程的时候，可以为它单独去设计一个方法，专门用于去打印（给了它一个特定的Tag，代码复用啦）。代码示例如下:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** 打印声网过程log */</span></div><div class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printLog</span><span class="params">(String content)</span></span>&#123;</div><div class="line">       DebugUtils.d(TeachingConstant.TAG_AGORA, content);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h2 id="11月30日-天气-晴"><a href="#11月30日-天气-晴" class="headerlink" title="11月30日 天气:晴"></a>11月30日 天气:晴</h2><ul>
<li>今天就是月尾了，一个月过去，写下这篇编程笔记。</li>
<li>写了自定义的一个芝麻信用分，时间就是用了一个早上。领悟到了好多之前并没有注意到的知识点，现在一一去列出来。首先就是扫盲了canvas.drawArc()，之前我一直去纳闷它的圆心在哪里，特别是去在Rect里面画弧。现在，我当然知道就是在中间啊，不就是圆的一部分么。另外的一点就是去画刻度之类的东西，我之前一直也是在郁闷要怎么去画那些刻度的，现在经过这次练习以后，基本就能够去扫盲了。就是把七点旋转到正上方，算好第一根，然后逐次去旋转。至于每一根的的粗细不同，再根据需要去画啦；单位转换的方式，目前就可以去使用TypedValue进行单位的转换,TypedValue.applyDimension(int unit,float value,DisplayMetrics d);系统统一给出了接口去进行转换。还有，这里学到最多的就是利用属性动画去进行背景颜色的渐变，之前有跟着去写过一下插值器的变换代码，但是却是实现得不够好，现在忽然发现，系统有提供现成的ArgbEvaluator可以让我去直接使用，动画工程控制是依旧使用ObjectAnimator，下面贴一下代码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCurrentNumAnim</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</div><div class="line">     <span class="keyword">float</span> duration = (<span class="keyword">float</span>) Math.abs(num-currentNum)/maxNum * <span class="number">1500</span> + <span class="number">500</span>;</div><div class="line">     ObjectAnimator animator = ObjectAnimator.ofInt(<span class="keyword">this</span>,<span class="string">"currentNum"</span>,num);</div><div class="line">     animator.setInterpolator(<span class="keyword">new</span> AccelerateDecelerateInterpolator());</div><div class="line">     animator.setDuration((<span class="keyword">long</span>)Math.min(duration,<span class="number">2000</span>));</div><div class="line">     animator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">         <span class="meta">@Override</span></div><div class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</div><div class="line">             <span class="keyword">int</span> value = (<span class="keyword">int</span>)animation.getAnimatedValue();</div><div class="line">             <span class="keyword">int</span> color = calculateColor(value);</div><div class="line">             setBackgroundColor(color);</div><div class="line">         &#125;</div><div class="line">     &#125;);</div><div class="line">     animator.start();</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculateColor</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</div><div class="line">     ArgbEvaluator evaluator = <span class="keyword">new</span> ArgbEvaluator();</div><div class="line">     <span class="keyword">float</span> fraction = <span class="number">0</span>;</div><div class="line">     <span class="keyword">int</span> color = <span class="number">0</span>;</div><div class="line">     <span class="comment">//1/2是分水岭啊</span></div><div class="line">     <span class="keyword">if</span>(value &lt;= maxNum/<span class="number">2</span>)&#123;</div><div class="line">         fraction = (<span class="keyword">float</span>)value/(maxNum/<span class="number">2</span>);</div><div class="line">         color = (<span class="keyword">int</span>) evaluator.evaluate(fraction,<span class="number">0xFFFF6347</span>,<span class="number">0xFFFF8C00</span>);</div><div class="line">     &#125;<span class="keyword">else</span> &#123;</div><div class="line">         fraction = ((<span class="keyword">float</span>)value-maxNum/<span class="number">2</span>)/(maxNum/<span class="number">2</span>);</div><div class="line">         color = (<span class="keyword">int</span>) evaluator.evaluate(fraction,<span class="number">0xFFFF8c00</span>, <span class="number">0xFF00CED1</span>);</div><div class="line">     &#125;</div><div class="line">     <span class="keyword">return</span> color;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>接下来就是去画圆弧的外圈背景了，其实就是我所不知道的一点效果，比如一条圆弧的颜色要怎么去实现渐变，怎么增减圆弧外面的效果等等。颜色渐变就是要使用Shader的子类SweepGradient，传入渐变的颜色数组就行了。还有就是弧的外边效果MaskFilter，可以外模糊的感觉啦。下面上代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawIndicator</span><span class="params">(Canvas canvas)</span></span>&#123;</div><div class="line">       paint_2.setStyle(Paint.Style.STROKE);</div><div class="line">       paint_2.setStrokeWidth(sweepOutWidth);</div><div class="line">       <span class="keyword">int</span> sweep ;</div><div class="line">       <span class="keyword">if</span>(currentNum &lt;= maxNum)&#123;</div><div class="line">           sweep = (<span class="keyword">int</span>)((<span class="keyword">float</span>)currentNum / (<span class="keyword">float</span>)maxNum * sweepAngle);</div><div class="line">       &#125;<span class="keyword">else</span> &#123;</div><div class="line">           sweep = sweepAngle;</div><div class="line">       &#125;</div><div class="line">       Shader shader = <span class="keyword">new</span> SweepGradient(<span class="number">0</span>, <span class="number">0</span>, indicatorColor, <span class="keyword">null</span>);</div><div class="line">       paint_2.setShader(shader);</div><div class="line">       <span class="keyword">int</span> w = dp2px(<span class="number">10</span>);<span class="comment">//增加的宽度</span></div><div class="line">       <span class="keyword">int</span> R = radius + w;<span class="comment">//半径</span></div><div class="line">       RectF rectF = <span class="keyword">new</span> RectF(-R, -R, R, R);</div><div class="line">       paint_2.setMaskFilter(<span class="keyword">new</span> BlurMaskFilter(dp2px(<span class="number">3</span>),BlurMaskFilter.Blur.SOLID));<span class="comment">//创建模糊阴影效果，EmbossMaskFilter创建浮雕阴影效果。</span></div><div class="line">       canvas.drawArc(rectF,startAngle,sweepAngle,<span class="keyword">false</span>,paint_2);</div><div class="line">       <span class="keyword">float</span> x = (<span class="keyword">float</span>)(R * Math.cos(Math.toRadians(sweep + startAngle)));<span class="comment">//通过三角函数去算</span></div><div class="line">       <span class="keyword">float</span> y = (<span class="keyword">float</span>)(R * Math.sin(Math.toRadians(sweep + startAngle)));</div><div class="line">       paint_3.setStyle(Paint.Style.FILL);</div><div class="line">       paint_3.setColor(Color.WHITE);</div><div class="line">       canvas.drawCircle(x,y,dp2px(<span class="number">3</span>),paint_3);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>最后需要再补充的一点就是Canvas也是有层次的，虽然不明白要怎么用它的层次，但是还是先把这句话记录下来先。我呢，其实不是很想用canvas.save()和canvas.restore(),在某些源码那里看到的，画每一个部分的时候都滥用了这两个玩意。我目前总结使用的规则就是，你要画某一个部件，画完以后canvas已经是凌乱的局面，不是没画之前的物理位置的时候，就需要在画之前将画布状态暂存，画完的时候再去恢复，ok？</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/work/">work</a><a href="/tags/coding/">coding</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	<div class="share-jiathis">
	  
<div class="jiathis_style_24x24">
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_googleplus"></a>
	<a class="jiathis_button_douban"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
    var jiathis_config={
    data_track_clickback:true,
    sm:"copy,renren,cqq",
    pic:"",
    summary:"",
     ralateuid:{"tsina":"1634073622"},hideMore:false}
    
  </script> 
<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=
2103362" charset="utf-8"></script>      

	 </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/12/29/Coding/12月工作笔记/" title="12月工作笔记">
  <strong>上一篇：</strong><br/>
  <span>
  12月工作笔记</span>
</a>
</div>


<div class="next">
<a href="/2016/10/12/Coding/2016-10工作笔记/2016-10-工作笔记/"  title="2016-10-工作笔记">
 <strong>下一篇：</strong><br/> 
 <span>2016-10-工作笔记
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/11/11/Coding/11月工作笔记/" data-title="11月工作笔记" data-url="http://yoursite.com/2016/11/11/Coding/11月工作笔记/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#11月2日-天气-阴"><span class="toc-number">1.</span> <span class="toc-text">11月2日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月3日-天气-阴"><span class="toc-number">2.</span> <span class="toc-text">11月3日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月4日-天气-晴"><span class="toc-number">3.</span> <span class="toc-text">11月4日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月7日-天气-晴"><span class="toc-number">4.</span> <span class="toc-text">11月7日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月8日-天气-阴"><span class="toc-number">5.</span> <span class="toc-text">11月8日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月9日-天气-阴"><span class="toc-number">6.</span> <span class="toc-text">11月9日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月10日-天气-阴雨"><span class="toc-number">7.</span> <span class="toc-text">11月10日 天气:阴雨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月11日-天气-冷"><span class="toc-number">8.</span> <span class="toc-text">11月11日 天气:冷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月14日-天气-晴"><span class="toc-number">9.</span> <span class="toc-text">11月14日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月15日-天气-晴"><span class="toc-number">10.</span> <span class="toc-text">11月15日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月16日-天气-晴"><span class="toc-number">11.</span> <span class="toc-text">11月16日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月17日-天气-晴"><span class="toc-number">12.</span> <span class="toc-text">11月17日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月18日-天气-阴"><span class="toc-number">13.</span> <span class="toc-text">11月18日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月21日-天气-阴"><span class="toc-number">14.</span> <span class="toc-text">11月21日 天气:阴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11月22日-天气-雨"><span class="toc-number">15.</span> <span class="toc-text">11月22日 天气:雨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11月23日-天气-阴雨"><span class="toc-number"></span> <span class="toc-text">11月23日 天气:阴雨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11月24日-天气-阴"><span class="toc-number"></span> <span class="toc-text">11月24日 天气:阴</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11月25日-天气-阴"><span class="toc-number"></span> <span class="toc-text">11月25日 天气:阴</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11月28日-天气-晴"><span class="toc-number"></span> <span class="toc-text">11月28日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11月29日"><span class="toc-number"></span> <span class="toc-text">11月29日</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11月30日-天气-晴"><span class="toc-number"></span> <span class="toc-text">11月30日 天气:晴</span></a>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="Eric1235" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/life/" title="life">life<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/work/" title="work">work<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/college/" title="college">college<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/coding/" title="coding">coding<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/feuture/" title="feuture">feuture<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/improve/" title="improve">improve<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/future/" title="future">future<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/study/" title="study">study<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/android/" title="android">android<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/me/" title="me">me<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/work-life/" title="-work -life">-work -life<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/fight/" title="fight">fight<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/sunshine/" title="sunshine">sunshine<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://weicong.win" target="_blank" title="Weicong Blog">Weicong Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1634073622&verifier=43ce7f75&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Be Fearless <br/>
			Be an Engineer</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1634073622" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/Eric1235" target="_blank" class="icon-github" title="github"></a>
		
		
		
		<a href="https://twitter.com/ericli1235" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/lixinkun" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		
		<a href="https://plus.google.com/Eric1235?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:Eric1235@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="Eric Li">Eric Li</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"ericli"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
