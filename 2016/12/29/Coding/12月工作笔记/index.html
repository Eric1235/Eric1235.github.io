
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  
    <title>12月工作笔记 | Eric&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Eric Li">
    

    
    <meta name="description" content="冬季 年末  2016的最后一个月，2016就快走完了，你有多少成就没有达成呢？">
<meta name="keywords" content="work,coding">
<meta property="og:type" content="article">
<meta property="og:title" content="12月工作笔记">
<meta property="og:url" content="http://yoursite.com/2016/12/29/Coding/12月工作笔记/index.html">
<meta property="og:site_name" content="Eric&#39;s Blog">
<meta property="og:description" content="冬季 年末  2016的最后一个月，2016就快走完了，你有多少成就没有达成呢？">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2016-12-30T10:04:08.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="12月工作笔记">
<meta name="twitter:description" content="冬季 年末  2016的最后一个月，2016就快走完了，你有多少成就没有达成呢？">
<meta name="twitter:creator" content="@ericli1235">
<link rel="publisher" href="Eric1235">

    
    <link rel="alternative" href="/atom.xml" title="Eric&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Eric&#39;s Blog" title="Eric&#39;s Blog"></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Eric&#39;s Blog">Eric&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索">
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</ul></nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope="" itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/12/29/Coding/12月工作笔记/" title="12月工作笔记" itemprop="url">12月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  </p><p class="article-time">
    <time datetime="2016-12-29T02:35:29.000Z" itemprop="datePublished"> 发表于 2016-12-29</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#12月1日-天气-晴"><span class="toc-number">1.</span> <span class="toc-text">12月1日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月5日-天气-晴"><span class="toc-number">2.</span> <span class="toc-text">12月5日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月6日-天气-晴"><span class="toc-number">3.</span> <span class="toc-text">12月6日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月7日-天气-晴"><span class="toc-number">4.</span> <span class="toc-text">12月7日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月8日-天气-晴"><span class="toc-number">5.</span> <span class="toc-text">12月8日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月9日-天气-晴"><span class="toc-number">6.</span> <span class="toc-text">12月9日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月11日-天气-晴"><span class="toc-number">7.</span> <span class="toc-text">12月11日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月13日-天气-晴"><span class="toc-number">8.</span> <span class="toc-text">12月13日 天气:晴</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#接着罗列一下android特有的数据结构"><span class="toc-number">8.0.1.</span> <span class="toc-text">接着罗列一下android特有的数据结构</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#12月14日-天气-晴"><span class="toc-number">9.</span> <span class="toc-text">12月14日 天气:晴</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#新编程知识点积累"><span class="toc-number">9.1.</span> <span class="toc-text">新编程知识点积累</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用多进程会造成的影响"><span class="toc-number">9.1.1.</span> <span class="toc-text">使用多进程会造成的影响:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12月15日-天气-晴"><span class="toc-number">9.2.</span> <span class="toc-text">12月15日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#新编程知识点积累-1"><span class="toc-number">9.3.</span> <span class="toc-text">新编程知识点积累</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月16日-天气-晴"><span class="toc-number">10.</span> <span class="toc-text">12月16日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月19日-天气-晴"><span class="toc-number">11.</span> <span class="toc-text">12月19日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月20日-天气-晴"><span class="toc-number">12.</span> <span class="toc-text">12月20日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月21日-天气-晴"><span class="toc-number">13.</span> <span class="toc-text">12月21日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月22日-天气-阴"><span class="toc-number">14.</span> <span class="toc-text">12月22日 天气:阴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月23日-天气-晴"><span class="toc-number">15.</span> <span class="toc-text">12月23日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月26日-天气-晴"><span class="toc-number">16.</span> <span class="toc-text">12月26日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月27日-天气-晴"><span class="toc-number">17.</span> <span class="toc-text">12月27日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月28日-天气-晴"><span class="toc-number">18.</span> <span class="toc-text">12月28日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月29日-天气-晴"><span class="toc-number">19.</span> <span class="toc-text">12月29日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月30日-天气-晴"><span class="toc-number">20.</span> <span class="toc-text">12月30日 天气:晴</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#字符流和字节流"><span class="toc-number">20.0.1.</span> <span class="toc-text">字符流和字节流</span></a></li></ol></li>
		
		</div>
		
		<p><code>冬季</code> <code>年末</code></p>
<blockquote>
<p>2016的最后一个月，2016就快走完了，你有多少成就没有达成呢？</p>
</blockquote>
<a id="more"></a>
<h2 id="12月1日-天气-晴"><a href="#12月1日-天气-晴" class="headerlink" title="12月1日 天气:晴"></a>12月1日 天气:晴</h2><ul>
<li>初步探索DataBinding，先明确它能解决的问题，目前可以解决两个问题：需要多次使用 findViewById，损害了应用性能且令人厌烦；更新UI数据需切换至UI线程，将数据分解映射到各个view比较麻烦。</li>
</ul>
<p>它的实现思路就是针对每个Activity的布局，在编译阶段，生成一个ViewDataBinding类的对象，该对象持有Activity要展示的数据和布局中各个view的引用。要展示的数据和它的布局已经紧紧绑定在一起了。</p>
<ul>
<li>知识积累，这次积累到的就是动画方面的知识了。我现在就是要有一个思想，xml能够配置的动画，在java代码里面也是可以实现的。目前多学习到的就是给ViewGroup的动画，比如我想让我相对布局里面的所有元素，或者listview的item有统一的一种动画，我应该怎么去动手呢？答案就是使用LayoutAnimation，这个动画就是作用在ViewGroup上面的。简单介绍一下使用。</li>
</ul>
<p>anim_layout.xml代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;layoutAnimation xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    android:delay=<span class="string">"0.5"</span></span><br><span class="line">    android:animationOrder=<span class="string">"normal"</span></span><br><span class="line">    android:animation=<span class="string">"@anim/anim_set"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>anim_set.xml代码，里面就是可以定义一连串的动画:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;set xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    android:shareInterpolator=<span class="string">"true"</span></span><br><span class="line">    android:duration=<span class="string">"3000"</span></span><br><span class="line">     android:interpolator=<span class="string">"@android:anim/accelerate_interpolator"</span></span><br><span class="line">    android:repeatMode=<span class="string">"restart"</span>&gt;</span><br><span class="line">    &lt;alpha</span><br><span class="line">        android:fromAlpha=<span class="string">"0"</span></span><br><span class="line">        android:toAlpha=<span class="string">"1"</span>/&gt;</span><br><span class="line">    &lt;scale</span><br><span class="line">        android:fromXScale=<span class="string">"0"</span></span><br><span class="line">        android:fromYScale=<span class="string">"0"</span></span><br><span class="line">        android:toXScale=<span class="string">"100"</span></span><br><span class="line">        android:toYScale=<span class="string">"100"</span>/&gt;</span><br><span class="line">    &lt;!--more x y 是起始坐标--&gt;</span><br><span class="line">    &lt;translate</span><br><span class="line">        android:fromXDelta=<span class="string">"0"</span></span><br><span class="line">        android:fromYDelta=<span class="string">"0"</span></span><br><span class="line">        android:toXDelta=<span class="string">"100"</span></span><br><span class="line">        android:toYDelta=<span class="string">"100"</span>/&gt;</span><br><span class="line">    &lt;!--x和y是旋转点的坐标--&gt;</span><br><span class="line">    &lt;rotate</span><br><span class="line">        android:fromDegrees=<span class="string">"0"</span></span><br><span class="line">        android:toDegrees=<span class="string">"270"</span></span><br><span class="line">        android:pivotX=<span class="string">"0"</span></span><br><span class="line">        android:pivotY=<span class="string">"0"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/set&gt;</span><br></pre></td></tr></table></figure>
<p>最后，就要将动画作用于listview上面，反正是ViewGroup都能够设置layoutAnimation：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">              android:orientation=<span class="string">"vertical"</span></span><br><span class="line">              android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">              android:layout_height=<span class="string">"match_parent"</span>&gt;</span><br><span class="line">    &lt;ListView</span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">        android:layoutAnimation=<span class="string">"@anim/anim_layout"</span></span><br><span class="line">        android:listSelector=<span class="string">"@color/color_bg"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<h2 id="12月5日-天气-晴"><a href="#12月5日-天气-晴" class="headerlink" title="12月5日 天气:晴"></a>12月5日 天气:晴</h2><p>今天学习到的知识就是自定义activity的动画转场Transition,其原理就是在转页面的时候，对不同页面的view去执行不同的动画，达到自定义的view转场。上代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造方法吧</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Animator <span class="title">createAnimator</span><span class="params">(ViewGroup sceneRoot, TransitionValues startValues, TransitionValues endValues)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(startValues == <span class="keyword">null</span> || endValues == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> View endView = endValues.view;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> startTop = (<span class="keyword">int</span>) startValues.values.get(TOP);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> startHeight = (<span class="keyword">int</span>) startValues.values.get(HEIGHT);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> endTop = (<span class="keyword">int</span>) endValues.values.get(TOP);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> endHeight = (<span class="keyword">int</span>) endValues.values.get(HEIGHT);</span><br><span class="line">        ViewCompat.setTranslationX(endView,startTop);</span><br><span class="line">        endView.getLayoutParams().height = startHeight;</span><br><span class="line">        endView.requestLayout();</span><br><span class="line">        ValueAnimator animator = ValueAnimator.ofInt(startTop, endTop);</span><br><span class="line">        <span class="keyword">if</span>(mPositionDuration &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            animator.setDuration(mPositionDuration);</span><br><span class="line">        &#125;</span><br><span class="line">        animator.setInterpolator(mPositionInterpolator);</span><br><span class="line">        animator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> current = (<span class="keyword">int</span>) animation.getAnimatedValue();</span><br><span class="line">                ViewCompat.setTranslationY(endView,current);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ValueAnimator sizeAnimator = ValueAnimator.ofInt(startHeight, endHeight);</span><br><span class="line">        <span class="keyword">if</span>(mSizeDuration &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            animator.setDuration(mSizeDuration);</span><br><span class="line">        &#125;</span><br><span class="line">        sizeAnimator.setInterpolator(mSizeInterpolator);</span><br><span class="line">        sizeAnimator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> current = (<span class="keyword">int</span>) animation.getAnimatedValue();</span><br><span class="line">                endView.getLayoutParams().height = current;</span><br><span class="line">                endView.requestLayout();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        AnimatorSet set = <span class="keyword">new</span> AnimatorSet();</span><br><span class="line">        set.play(sizeAnimator).after(animator);</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//收集动画开始的信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">captureStartValues</span><span class="params">(TransitionValues transitionValues)</span> </span>&#123;</span><br><span class="line">        View view = transitionValues.view;</span><br><span class="line">        Rect rect = <span class="keyword">new</span> Rect();</span><br><span class="line">        view.getHitRect(rect);</span><br><span class="line">        <span class="comment">//保存距离父布局上面的距离</span></span><br><span class="line">        transitionValues.values.put(TOP,rect.top);</span><br><span class="line">        transitionValues.values.put(HEIGHT,view.getHeight());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//收集动画结束时候的信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">captureEndValues</span><span class="params">(TransitionValues transitionValues)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//动画结束以后，view距离布局上面的距离应该是0</span></span><br><span class="line">        transitionValues.values.put(TOP,<span class="number">0</span>);</span><br><span class="line">        transitionValues.values.put(HEIGHT,transitionValues.view.getHeight());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>自定义好了转场动画，接着就要在两个Activity当中使用，不过这里面出现了一个view为空的错误，我只好先把它进行屏蔽：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(View view, String content)</span></span>&#123;</span><br><span class="line"><span class="comment">//        View statusBar = findViewById(android.R.id.statusBarBackground);</span></span><br><span class="line"><span class="comment">//        View navigationBar = findViewById(android.R.id.navigationBarBackground);//这个控件找不到，为null，所以导致最后的make有问题，必须屏蔽</span></span><br><span class="line">      List&lt;Pair&lt;View,String&gt;&gt; pairs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="comment">//        pairs.add(Pair.create(statusBar, Window.STATUS_BAR_BACKGROUND_TRANSITION_NAME));</span></span><br><span class="line"><span class="comment">//        pairs.add(Pair.create(navigationBar, Window.NAVIGATION_BAR_BACKGROUND_TRANSITION_NAME));</span></span><br><span class="line">      pairs.add(Pair.create(view,view.getTransitionName()));</span><br><span class="line">      Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>,MessageActivity.class);</span><br><span class="line">      intent.putExtra(<span class="string">"msg"</span>,content);</span><br><span class="line">      ActivityOptionsCompat compat = ActivityOptionsCompat.makeSceneTransitionAnimation(<span class="keyword">this</span>,pairs.toArray(<span class="keyword">new</span> Pair[pairs.size()]));</span><br><span class="line">      ActivityCompat.startActivity(<span class="keyword">this</span>,intent,compat.toBundle());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>再看一下后面一个Activity是如何发布：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeTransition</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        postponeEnterTransition();</span></span><br><span class="line">        <span class="keyword">final</span> View decorView = getWindow().getDecorView();</span><br><span class="line">        getWindow().getDecorView().getViewTreeObserver().addOnPreDrawListener(<span class="keyword">new</span> ViewTreeObserver.OnPreDrawListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPreDraw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                decorView.getViewTreeObserver().removeOnPreDrawListener(<span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        CusTransition transition = <span class="keyword">new</span> CusTransition();</span><br><span class="line">        transition.setPositionDuration(<span class="number">300</span>);</span><br><span class="line">        transition.setSizeDuration(<span class="number">300</span>);</span><br><span class="line">        transition.setPositionInterpolator(<span class="keyword">new</span> FastOutLinearInInterpolator());</span><br><span class="line">        transition.setSizeInterpolator(<span class="keyword">new</span> FastOutLinearInInterpolator());</span><br><span class="line">        transition.addTarget(<span class="string">"message"</span>);</span><br><span class="line">        getWindow().setSharedElementEnterTransition(transition);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>要再说多一句的就是xml文件那里，也要去对TransitionName进行设置。</p>
<ul>
<li>从定义上讲，Android（Java）平台的内存泄漏是指没有用的对象资源任与GC-Root保持可达路径，导致系统无法进行回收。</li>
</ul>
<h2 id="12月6日-天气-晴"><a href="#12月6日-天气-晴" class="headerlink" title="12月6日 天气:晴"></a>12月6日 天气:晴</h2><p><em>Lint的分析使用</em></p>
<ul>
<li>警告类，一直提示不要去硬编码/sdcard,要去使用Environment.getExternalStorageDirectory().getPath()代替。</li>
<li>FileProvider要再配置文件里面进行配置。0</li>
<li>所有官方的support包的版本应该一一对应，和buildtools一致。</li>
<li>不要硬编码text到xml中，要使用Strings进行引用.</li>
<li>不能在xml里面用错属性，比如说layout_below这个属性，在线性布局里面是不起作用的。</li>
<li>Do not place Android context classes in static fields; this is a memory leak。</li>
<li>分析布局，努力去减少布局层次</li>
<li>不要忽略方法的返回值，比如说mkdir，file.delete(),Stream.read()等的返回值。</li>
<li>最重要的是要去检测出有什么内存泄漏的问题，这才是要点。</li>
</ul>
<p>其他内存泄漏分析工具的使用：</p>
<p>第一个就是StrictMode的使用，放在基类比较好一点，或者，直接在Application那里</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(BuildConfig.DEBUG)&#123;</span><br><span class="line">    StrictMode.setThreadPolicy(<span class="keyword">new</span> StrictMode.ThreadPolicy.Builder()</span><br><span class="line">    .detectDiskReads()</span><br><span class="line">    .detectDiskWrites()</span><br><span class="line">    .detectNetwork()</span><br><span class="line">    .penaltyLog()</span><br><span class="line">    .build());</span><br><span class="line"></span><br><span class="line">    StrictMode.setVmPolicy(<span class="keyword">new</span> StrictMode.VmPolicy.Builder()</span><br><span class="line">    .detectLeakedSqlLiteObjects()</span><br><span class="line">    .detectLeakedClosableObjects()</span><br><span class="line">    .penaltyLog()</span><br><span class="line">    .penaltyDeath()</span><br><span class="line">    .build());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来就是要去分析一堆的log，看看那里有问题咯</p>
<p>下面一个工具就是Square公司的leakcanary,内存检测工具。我在as自带的gradle那里添加不了依赖，实在是很气人，又得上去github去看看了。引用方法还是没怎么变。我们的app后台挂掉了，内存泄漏这个测不了，明天再玩。</p>
<h2 id="12月7日-天气-晴"><a href="#12月7日-天气-晴" class="headerlink" title="12月7日 天气:晴"></a>12月7日 天气:晴</h2><ul>
<li>昨天摆乌龙了，不行，以后要是去优化代码的话。一定要改一点点，就去跑一下，看看行不行。不能改完了一大堆，第二天才去瞧一瞧行不行。今天早上打开程序，果然是不行。我怀疑是后台的问题，因为后台坏掉了。可是我今天去检查了一下可以登录，那么后台一个个是可以的。我问了一下后台的同事，后台搞好了。唯一验证的办法，就是去回滚一下代码，看看是不是自己改的东西，导致我的app挂掉了。这次一共回滚了三个版本，装上app，发现是可以运行的。那么就只剩下一个问题了，那就是我改错了。要怎么去补救？那可是我整整三个版本的提交，三个commit啊。不能让自己的努力白费的，git不会那么傻的，我去寻找一下解决办法。</li>
<li>下面进行的就是git的学习。我之前认识的就是git的整个版本回滚，但是我的东西是一个有意义的提交，是不能用reset_hard去解决的。那么，现在就是对单个文件去进行revert，然后凑成一个commit就行了。由于是第一次使用嘛，我revert的时候，分了好多个revert出来，况且，连名字也是没有改，只是和之前的一次提交一样，下次要做的话，就要自己去新命名一个revert的名字，然后就把所有的回滚的类都弄进去。</li>
<li>Monitors的内存检测工具dump使用初探。我第一次使用到这个工具，发现了好多东西的副本。就连MainActivity都有两个，这是怎么回事？我第一次发现这么有意思的事情。可能，是内存泄漏了吧。但是有一个高人告诉我，它应该有三个或者以上才是内存泄漏，我努力去尝试了一下，貌似不会出现3个或者以上的MainActivity。再接下来去进行排查，由于我们项目是基于webview的，自然要去观察有关webview的情况了啦。仔细去查看了webview文件下的代码，还真被我发现了一点问题。webview的两个client的数量明显比较多。我猜想是切换了一个界面就会多了一个。验证加过果然是每次切换一次界面就有一个。那么我就要去想到解决办法，尝试了一个早上，还是没有解决办法，能不能去释放这些client啦，webview真是霸道，找到了一个bug了。。。</li>
<li>使用StrictMode，要在Application那里去写代码。但是非常奇怪的就是，我跑了很久都没有发现有警告的log弹出，先不去管了。</li>
<li>adb shell dumpsys meminfo [包名]，这个命令去查看内存情况。使用这个命令查看到view是可以一直在增长的，等到gc的时候会被释放。但是app那里并没有进行释放，纳闷。</li>
</ul>
<p><em>另外的编程技巧</em></p>
<ul>
<li>如果一个单例的生命周期比activity要长，那么如果需要context的话，就是千万不能传入activity。</li>
</ul>
<h2 id="12月8日-天气-晴"><a href="#12月8日-天气-晴" class="headerlink" title="12月8日 天气:晴"></a>12月8日 天气:晴</h2><p>了解一下android项目的模块化开发的核心之路由的实现。自己实现自定义路由的话，就可以完全封装参数，实现跳转。如果我们把项目模块化了, 那两个组件间进行通讯或者跳转, 我们一般构建Intent的方式就不再使用了, 很简单, 因为在模块A中根本找不到模块B中的C类, 这就需要我们自定义路由规则, 绕一道弯去进行跳转, 说白了就是给你的类起一个别名, 我们用别名去引用。目前有着两种方法：</p>
<ul>
<li>完全自己实现路由，完全封装跳转参数。</li>
<li>利用隐式意图跳转。</li>
</ul>
<p>活久见，我在一篇文章里面发现，竟然可以在源码里面去打点。</p>
<ul>
<li>android对UI访问使用单线程模型来处理的原因。如果允许多线程操作UI，那么UI得到的结果是不可预期的。解决的方案其实是可以给UI加上锁，变成线程安全，但是会有两点不足。首先，UI的访问逻辑就会变得极其地复杂，但是最要命的就是牺牲了UI访问的效率。所以，Android规定，只有主线程可以操作UI。我们在子线程得到数据以后，可以通过Handler切换到主线程去操作UI。</li>
</ul>
<h2 id="12月9日-天气-晴"><a href="#12月9日-天气-晴" class="headerlink" title="12月9日 天气:晴"></a>12月9日 天气:晴</h2><p>卡农、雨的印记、菊次郎的夏天、雪之梦、悲怆、星空、天空之城、秋日私语、克罗地亚狂想曲、梦中的婚礼、夜的钢琴曲5、寂静之声、泪之曲、梦中的雪、风居住的街道、神秘园之歌</p>
<ul>
<li>一个null值引起的SharedPreference惨案。今天介绍的一篇推送文章里面说了。如果对sp的key值没有进行判空处理，存了进去，很有可能在被杀进程，重进后读取不到全部sp存储的数据。4.4的系统有事，5.1的系统没有对key为null做特别的处理，同样写进去了map中。</li>
<li>新知识点的学习，继续梳理了一下Asynctask，了解到了它的一个并行执行的方法。只要进行如下调用，这两个task就是并行执行的了。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> MyAsyncTask(<span class="string">"task#1"</span>).executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR,<span class="string">""</span>);</span><br><span class="line"><span class="keyword">new</span> MyAsyncTask(<span class="string">"task#2"</span>).executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR,<span class="string">""</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>记录一个很有意思的现象，就是用两台手机，去登陆同一个账号，不会把前者去踢下线。但是有一台手机退出以后，另一台手机就是莫名其妙地超时，然后不能使用这个软件。我现在得出的结论就是后台并没有做心跳包。不能实现与服务器的长连接，所以会导致目前我们的app可以在两个地方同时登陆。</li>
</ul>
<h2 id="12月11日-天气-晴"><a href="#12月11日-天气-晴" class="headerlink" title="12月11日 天气:晴"></a>12月11日 天气:晴</h2><p>今天知识点学习储备：</p>
<ul>
<li>了解到一个库，叫做SwissArmyKnife。它是可以在不用root的权限下面，去调试Android的ui。可以直接在android手机屏幕上面显示当前Activity中的所有控件（不管是否隐藏）的边界，内外边距的大小，每一个控件的大小，图片大小，字体颜色以及自定义信息。同事可以直接在屏幕上面去色，也可以直接测量大小，不管dp或者px。针对开发者还提供了布局树查看功能，可以查看控件的层次信息。至于用法什么的，要用到的时候就直接去github找。</li>
<li>智能无图的实现思路，就是要去监听网络状态，然后去根据是否连接上WiFi，来确定是否加载图片。分两个步骤，确定是否开启智能无图，然后再去判断网络的状态，是wifi就加载图片，不是的话，就显示预设图片。</li>
</ul>
<p>下面，我们来对网络状态进行一下分类，哪些是2g、3g或者4g。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getNetworkStatus</span><span class="params">()</span></span>&#123;</span><br><span class="line">     ConnectivityManager connectivityManager = getConnectivityManager();</span><br><span class="line">     NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo();<span class="comment">//6.0以后，获取网络的话，要使用getAllNetworks();</span></span><br><span class="line">     <span class="keyword">int</span> networkStatus = NetStatusManager.NETWORK_TYPE_DISCONNECT;</span><br><span class="line">     <span class="keyword">if</span> (networkInfo != <span class="keyword">null</span> &amp;&amp; networkInfo.isAvailable()) &#123;</span><br><span class="line">         <span class="keyword">if</span> (networkInfo.getType() == ConnectivityManager.TYPE_WIFI) &#123;</span><br><span class="line">             networkStatus = NetStatusManager.NETWORK_TYPE_WIFI;</span><br><span class="line">         &#125; <span class="keyword">else</span> <span class="keyword">if</span> (networkInfo.getType() == ConnectivityManager.TYPE_MOBILE) &#123;</span><br><span class="line">             <span class="keyword">int</span> networkType = networkInfo.getSubtype();</span><br><span class="line">             String _strSubTypeName = networkInfo.getSubtypeName();</span><br><span class="line">             <span class="keyword">switch</span> (networkType) &#123;</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_GPRS:</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_EDGE:</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_CDMA:</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_1xRTT:</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_IDEN: <span class="comment">//api&lt;8 : replace by 11</span></span><br><span class="line">                     networkStatus = NetStatusManager.NETWORK_TYPE_2G;</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_UMTS:</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_EVDO_0:</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_EVDO_A:</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_HSDPA:</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_HSUPA:</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_HSPA:</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_EVDO_B: <span class="comment">//api&lt;9 : replace by 14</span></span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_EHRPD:  <span class="comment">//api&lt;11 : replace by 12</span></span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_HSPAP:  <span class="comment">//api&lt;13 : replace by 15</span></span><br><span class="line">                     networkStatus = NetStatusManager.NETWORK_TYPE_3G;</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">                 <span class="keyword">case</span> TelephonyManager.NETWORK_TYPE_LTE:    <span class="comment">//api&lt;11 : replace by 13</span></span><br><span class="line">                     networkStatus = NetStatusManager.NETWORK_TYPE_4G;</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">                 <span class="keyword">default</span>:</span><br><span class="line">                     <span class="keyword">if</span> (_strSubTypeName.equalsIgnoreCase(<span class="string">"TD-SCDMA"</span>) || _strSubTypeName.equalsIgnoreCase(<span class="string">"WCDMA"</span>) || _strSubTypeName.equalsIgnoreCase(<span class="string">"CDMA2000"</span>)) &#123;</span><br><span class="line">                         networkStatus = NetStatusManager.NETWORK_TYPE_2G;</span><br><span class="line">                     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                         networkStatus = NetStatusManager.NETWORK_TYPE_UNKNOWN;</span><br><span class="line">                     &#125;</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> networkStatus;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>如何把异常信息输出到文件？这里就必须要去创建一个PrintWriter类了，因为在Throwable里面，有这样一个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printStackTrace</span><span class="params">(PrintWriter s)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>发生的写不进去内存卡的悲哀，其实就是路径不对。自己看，我不说话</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.io.FileNotFoundException: <span class="regexp">/storage/</span>emulated/<span class="number">0</span>CrashTest/log/cash2016<span class="number">-12</span><span class="number">-12</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">51.</span>trace: open failed: ENOENT (No such file or directory)</span><br></pre></td></tr></table></figure>
<p>在我排除了这个错误以后呢，发现还是有着其他问题卡住我，仍旧不能写入sd卡。我使用了好多种方法去进排除。其实我一早就发现权限列表那里多了一个权限的，我印象中记得我没有用过这个权限啊。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.MOUNT_FORMAT_FILESYSTEMS"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>后来查阅了资料，才了解到这是格式化内存卡的权限，我没事格式化干嘛。为了排除其他的问题，我去了主项目那里写文件，但是还是不行。后来隐约觉得是多了一点东西。然后去修改上述的权限，果然就能够去写入内存卡了。给自己的经验就是，不要去复制太多的代码，每一行都是自己了解得，才是最好的编程。</p>
<h2 id="12月13日-天气-晴"><a href="#12月13日-天气-晴" class="headerlink" title="12月13日 天气:晴"></a>12月13日 天气:晴</h2><p>编程技术学习之内存泄漏的敏感度训练：</p>
<ul>
<li>静态变量导致的内存泄漏，下面请看经典的例子</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Context sContext;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    sContext = <span class="keyword">this</span>; <span class="comment">//问题就出在这里。静态变量持有了Activity，导致其不能释放</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面我们来看一下产生anr的一个例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestANRActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState, PersistableBundle persistentState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState, persistentState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                testANR();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        SystemClock.sleep(<span class="number">10</span>);</span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//synchronized这种写法会导致两个方法去竞争同一个锁，就是Activity对象，然后造成ANR</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">testANR</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SystemClock.sleep(<span class="number">30</span> * <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="接着罗列一下android特有的数据结构"><a href="#接着罗列一下android特有的数据结构" class="headerlink" title="接着罗列一下android特有的数据结构"></a>接着罗列一下android特有的数据结构</h4><ul>
<li><p><em>SimpleArrayMap&lt;K,V&gt;与ArrayMap&lt;K,V&gt;</em><br>实质上ArrayMap继承自SimpleArrayMap,主要是为了实现像HashMap一样的api方法，让习惯使用HashMap的开发者感觉不到差异，本质上是SimpleArrayMap+Map的再封装。<br>一般来说使用这2个类主要来代替HashMap，因为他们比HashMap更加高效，对内存也进行了优化。</p>
</li>
<li><p><em>SparseArray<t>与SparseArrayCompat<t>和LongSparseArray<t></t></t></t></em><br>这3个类中，前2个基本上是同一类，只不过第二个类有removeAt方法，第三个是Long类型的。<br>这3个类也是用来代替HashMap,只不过他们的键(key)的类型是整型Integer或者Long类型，在实际开发中，如月份缩写的映射，或者进行文件缓存映射，viewHolder都特别适用</p>
</li>
<li><p><em>AtomicFile</em><br>AtomicFile首先不是用来代替File的，而是作为File的辅助类从在， AtomicFile的作用是实现事务性原子操作，即文件读写必须完整，适合多线程中的文件读写操作。<br>用来实现多线程中的文件读写的安全操作</p>
</li>
</ul>
<h2 id="12月14日-天气-晴"><a href="#12月14日-天气-晴" class="headerlink" title="12月14日 天气:晴"></a>12月14日 天气:晴</h2><h3 id="新编程知识点积累"><a href="#新编程知识点积累" class="headerlink" title="新编程知识点积累"></a>新编程知识点积累</h3><ul>
<li>原来啊，有些view里面，已经自带了onSaveInstanceState的效果的了，下面请看代码:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSaveInstanceState</span><span class="params">(Bundle outState, PersistableBundle outPersistentState)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onSaveInstanceState(outState, outPersistentState);</span><br><span class="line">       TextView textView = <span class="keyword">new</span> TextView(<span class="keyword">this</span>);</span><br><span class="line">       textView.onSaveInstanceState();<span class="comment">//这些view自带暂存功能了哟</span></span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>看了一下Intent的匹配规则，也算走出了一下误区了啦。主要是自己太懒，不想动手去验证。category的匹配，平时开发也没怎么用到，我就先忽略了咯。</p>
<h4 id="使用多进程会造成的影响"><a href="#使用多进程会造成的影响" class="headerlink" title="使用多进程会造成的影响:"></a>使用多进程会造成的影响:</h4><ul>
<li>静态成员和单例完全失效</li>
<li>线程同步机制完全失效</li>
<li>Sp的可靠性下降</li>
<li>Application会多次创建</li>
</ul>
<p>针对第四个问题，可以在App的create里面去检测进程的名字，如果不是那种非要创建App的进程，那么就直接pass掉App的重新创建。</p>
<p>关于两种序列化方式的比较与选择上面。Parcelable是android自带的，首选这一种序列化方式，别问为什么，高效，因为底层是c在实现。涉及到网络传输和存储设备（为何不使用数据库）序列化的话，Parcelable虽然也是可以的，但是就是比较复杂，建议还是使用Serialzable。</p>
<h3 id="12月15日-天气-晴"><a href="#12月15日-天气-晴" class="headerlink" title="12月15日 天气:晴"></a>12月15日 天气:晴</h3><h3 id="新编程知识点积累-1"><a href="#新编程知识点积累-1" class="headerlink" title="新编程知识点积累"></a>新编程知识点积累</h3><ul>
<li>抽取点阵的数据(二维数组)，组织成为一个path</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Path <span class="title">getPathFromStringArray</span><span class="params">(Context context, <span class="keyword">int</span> arrayId, <span class="keyword">float</span> zoomSize)</span></span>&#123;</span><br><span class="line">  Path path = <span class="keyword">new</span> Path();</span><br><span class="line">  String[] points = context.getResources().getStringArray(arrayId);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; points.length ; i++)&#123;</span><br><span class="line">    String[] x = points[i].split(<span class="string">" "</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; x.length ; j ++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(j == <span class="number">0</span>)&#123;</span><br><span class="line">        path.moveTo(Float.parseFloat(x[j]) * zoomSize, Float.parseFloat(x[j+<span class="number">1</span>]) * zoomSize);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        path.lineTo(Float.parseFloat(x[j]) * zoomSize, Float.parseFloat(x[j+<span class="number">1</span>]) * zoomSize);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> path;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>项目这里的话，貌似是有了一点小问题。ios那边反映h5和原生的通信要通过截取js的方法去进行原生通信。然后ios说不能截取alert，我不发表意见。</p>
<h2 id="12月16日-天气-晴"><a href="#12月16日-天气-晴" class="headerlink" title="12月16日 天气:晴"></a>12月16日 天气:晴</h2><p>今天搞了一下午的动画，算是对recyclerview的自定义入门了。但是工作远远没有完结，下面去贴代码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scrollToCenter</span><span class="params">(<span class="keyword">int</span> position)</span></span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> parentWidth = getWidth();<span class="comment">//屏幕宽度</span></span><br><span class="line">        <span class="keyword">int</span> firstVisiablePosition = ((LinearLayoutManager) getLayoutManager()).findFirstVisibleItemPosition();<span class="comment">//得到第一个可以看见的view的绝对id</span></span><br><span class="line">        <span class="keyword">int</span> count = getLayoutManager().getItemCount();</span><br><span class="line">        mTargetPos = Math.max(<span class="number">0</span>,Math.min(count-<span class="number">1</span>, position));</span><br><span class="line">        Log.d(<span class="string">"Eric"</span>, <span class="string">"realChild="</span> + (mTargetPos - firstVisiablePosition));<span class="comment">//获取到子view，当前屏幕当中的第几个</span></span><br><span class="line">        <span class="keyword">final</span> View targetChild = getChildAt(mTargetPos - firstVisiablePosition);<span class="comment">//误解了你这么多年，现在终于明白了是获取在屏幕中的位置</span></span><br><span class="line">        ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(targetChild,<span class="string">"Y"</span>,<span class="number">100f</span>).setDuration(<span class="number">100</span>);</span><br><span class="line">        objectAnimator.addListener(<span class="keyword">new</span> Animator.AnimatorListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> childLeftPx = targetChild.getLeft();</span><br><span class="line">                <span class="keyword">int</span> childRightPx = targetChild.getRight();</span><br><span class="line">                <span class="keyword">int</span> childWidth = targetChild.getWidth();</span><br><span class="line">                <span class="keyword">int</span> centerLeft = parentWidth / <span class="number">2</span> - childWidth / <span class="number">2</span>;<span class="comment">//扶正后的left</span></span><br><span class="line">                <span class="keyword">int</span> centerRight = parentWidth /<span class="number">2</span> + childWidth / <span class="number">2</span>;<span class="comment">//扶正后的right</span></span><br><span class="line">                <span class="keyword">if</span>(childLeftPx &gt; centerLeft)&#123;</span><br><span class="line">                    mLastX = childLeftPx;</span><br><span class="line">                    mScroller.startScroll(childLeftPx,<span class="number">0</span>,centerLeft-childLeftPx,<span class="number">0</span>,<span class="number">600</span>);</span><br><span class="line">                    postInvalidate();</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(childRightPx &lt; centerRight)&#123;</span><br><span class="line">                    mLastX = childRightPx;</span><br><span class="line">                    mScroller.startScroll(childRightPx,<span class="number">0</span>,centerRight - childRightPx,<span class="number">0</span>,<span class="number">600</span>);</span><br><span class="line">                    postInvalidate();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">        objectAnimator.start();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>事情还是没有完的，还有另外一个动画没有做出来，我下周再继续去写。</p>
<p>下面摘抄一段jdk里面的代码注释:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* &lt;p&gt;The sequence of characters following an optional</span><br><span class="line">    * sign and/<span class="function">or radix <span class="title">specifier</span> <span class="params">(<span class="string">"&#123;@code 0x&#125;"</span>, <span class="string">"&#123;@code 0X&#125;"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    * <span class="string">"&#123;@code #&#125;"</span>, or leading zero)</span> is parsed as by the </span>&#123;<span class="meta">@code</span></span><br><span class="line">    * Integer.parseInt&#125; <span class="function">method with the indicated <span class="title">radix</span> <span class="params">(<span class="number">10</span>, <span class="number">16</span>, or</span></span></span><br><span class="line"><span class="function"><span class="params">    * <span class="number">8</span>)</span>.  This sequence of characters must represent a positive</span></span><br><span class="line"><span class="function">    * value or a </span>&#123;<span class="meta">@link</span> NumberFormatException&#125; will be thrown.  The</span><br><span class="line">    * result is negated <span class="keyword">if</span> first character of the specified &#123;<span class="meta">@code</span></span><br><span class="line">    * String&#125; is the minus sign.  No whitespace characters are</span><br><span class="line">    * permitted in the &#123;<span class="meta">@code</span> String&#125;.</span><br></pre></td></tr></table></figure>
<p>也不差加上代码了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">decode</span><span class="params">(String nm)</span> <span class="keyword">throws</span> NumberFormatException </span>&#123;</span><br><span class="line">       <span class="keyword">int</span> radix = <span class="number">10</span>;</span><br><span class="line">       <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">boolean</span> negative = <span class="keyword">false</span>;</span><br><span class="line">       Integer result;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (nm.length() == <span class="number">0</span>)</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> NumberFormatException(<span class="string">"Zero length string"</span>);</span><br><span class="line">       <span class="keyword">char</span> firstChar = nm.charAt(<span class="number">0</span>);</span><br><span class="line">       <span class="comment">// Handle sign, if present</span></span><br><span class="line">       <span class="keyword">if</span> (firstChar == <span class="string">'-'</span>) &#123;</span><br><span class="line">           negative = <span class="keyword">true</span>;</span><br><span class="line">           index++;</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (firstChar == <span class="string">'+'</span>)</span><br><span class="line">           index++;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Handle radix specifier, if present</span></span><br><span class="line">       <span class="keyword">if</span> (nm.startsWith(<span class="string">"0x"</span>, index) || nm.startsWith(<span class="string">"0X"</span>, index)) &#123;</span><br><span class="line">           index += <span class="number">2</span>;</span><br><span class="line">           radix = <span class="number">16</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span> (nm.startsWith(<span class="string">"#"</span>, index)) &#123;</span><br><span class="line">           index ++;</span><br><span class="line">           radix = <span class="number">16</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span> (nm.startsWith(<span class="string">"0"</span>, index) &amp;&amp; nm.length() &gt; <span class="number">1</span> + index) &#123;</span><br><span class="line">           index ++;</span><br><span class="line">           radix = <span class="number">8</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (nm.startsWith(<span class="string">"-"</span>, index) || nm.startsWith(<span class="string">"+"</span>, index))</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> NumberFormatException(<span class="string">"Sign character in wrong position"</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           result = Integer.valueOf(nm.substring(index), radix);</span><br><span class="line">           result = negative ? Integer.valueOf(-result.intValue()) : result;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">           <span class="comment">// If number is Integer.MIN_VALUE, we'll end up here. The next line</span></span><br><span class="line">           <span class="comment">// handles this case, and causes any genuine format error to be</span></span><br><span class="line">           <span class="comment">// rethrown.</span></span><br><span class="line">           String constant = negative ? (<span class="string">"-"</span> + nm.substring(index))</span><br><span class="line">                                      : nm.substring(index);</span><br><span class="line">           result = Integer.valueOf(constant, radix);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="12月19日-天气-晴"><a href="#12月19日-天气-晴" class="headerlink" title="12月19日 天气:晴"></a>12月19日 天气:晴</h2><p>一早上去搞了一下SpannableString和它的兄弟SpannableStringBuilder，要说性能的话，那就肯定是后者的拼接能力会比较出众了啦。但是如果给某个文字片段去设置点击事件，再给整个textview设置点击事件，就会有两个坑出现。</p>
<ul>
<li>点击设置了点击事件的片段，会同时触发整个textview的点击事件</li>
<li>点击空白区域，textview会消耗整个点击事件，而不会传递到父view</li>
</ul>
<p>下面给一下用法，再给一下第二个问题的初步解决方案</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mode2</span><span class="params">(TextView textView)</span></span>&#123;</span><br><span class="line">        SpannableStringBuilder builder = <span class="keyword">new</span> SpannableStringBuilder(<span class="string">"今天"</span>);</span><br><span class="line">        builder.append(<span class="string">"天气好好!"</span>);</span><br><span class="line">        builder.append(<span class="string">"不如出去走走"</span>);</span><br><span class="line">        ForegroundColorSpan mForegroundColorSpan = <span class="keyword">new</span> ForegroundColorSpan(Color.BLUE);<span class="comment">//前景色</span></span><br><span class="line">        BackgroundColorSpan backgroundColorSpan = <span class="keyword">new</span> BackgroundColorSpan(Color.YELLOW);<span class="comment">// 背景色</span></span><br><span class="line">        AbsoluteSizeSpan absoluteSizeSpan = <span class="keyword">new</span> AbsoluteSizeSpan(<span class="number">20</span>);<span class="comment">//字体大小</span></span><br><span class="line">        StyleSpan styleSpan1 = <span class="keyword">new</span> StyleSpan(Typeface.BOLD);<span class="comment">//字体效果</span></span><br><span class="line">        StrikethroughSpan strikethroughSpan = <span class="keyword">new</span> StrikethroughSpan();<span class="comment">//删除线</span></span><br><span class="line">        UnderlineSpan underlineSpan = <span class="keyword">new</span> UnderlineSpan();<span class="comment">//下划线</span></span><br><span class="line"><span class="comment">//        ImageSpan imageSpan = new ImageSpan();//生成一个图片样式</span></span><br><span class="line">        <span class="comment">//现在的问题是，你在局部设置了点击事件，那么给整个Textview也设置了点击事件的话，怎么解决？</span></span><br><span class="line">        ClickableSpan clickableSpan = <span class="keyword">new</span> ClickableSpan() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View widget)</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"Eric"</span>, <span class="string">"click spannable string"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        builder.setSpan(styleSpan1, <span class="number">0</span>, <span class="number">5</span>, Spanned.SPAN_EXCLUSIVE_INCLUSIVE);</span><br><span class="line">        builder.setSpan(clickableSpan, <span class="number">0</span>, <span class="number">5</span>, Spanned.SPAN_EXCLUSIVE_INCLUSIVE);</span><br><span class="line">        builder.setSpan(mForegroundColorSpan, <span class="number">0</span> , <span class="number">5</span>, Spanned.SPAN_EXCLUSIVE_INCLUSIVE);</span><br><span class="line">        textView.setText(builder);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Sets the movement method (arrow key handler) to be used for</span></span><br><span class="line"><span class="comment">         * this TextView.  This can be null to disallow using the arrow keys</span></span><br><span class="line"><span class="comment">         * to move the cursor or scroll the view.</span></span><br><span class="line"><span class="comment">         * &lt;p&gt;</span></span><br><span class="line"><span class="comment">         * Be warned that if you want a TextView with a key listener or movement</span></span><br><span class="line"><span class="comment">         * method not to be focusable, or if you want a TextView without a</span></span><br><span class="line"><span class="comment">         * key listener or movement method to be focusable, you must call</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@link</span> #setFocusable&#125; again after calling this to get the focusability</span></span><br><span class="line"><span class="comment">         * back the way you want it.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        textView.setMovementMethod(ClickableMovementMethod.getInstance());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>要去修改的话，就可以去修改一下MovementMethod</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClickableMovementMethod</span> <span class="keyword">extends</span> <span class="title">BaseMovementMethod</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ClickableMovementMethod sInstance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ClickableMovementMethod <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            sInstance = <span class="keyword">new</span> ClickableMovementMethod();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sInstance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(TextView widget, Spannable buffer, MotionEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> action = event.getActionMasked();</span><br><span class="line">        <span class="keyword">if</span> (action == MotionEvent.ACTION_UP || action == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</span><br><span class="line">            <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</span><br><span class="line">            x -= widget.getTotalPaddingLeft();</span><br><span class="line">            y -= widget.getTotalPaddingTop();</span><br><span class="line">            x += widget.getScrollX();</span><br><span class="line">            y += widget.getScrollY();</span><br><span class="line">            Layout layout = widget.getLayout();</span><br><span class="line">            <span class="keyword">int</span> line = layout.getLineForVertical(y);</span><br><span class="line">            <span class="keyword">int</span> off = layout.getOffsetForHorizontal(line, x);</span><br><span class="line"></span><br><span class="line">            ClickableSpan[] link = buffer.getSpans(off, off, ClickableSpan.class);</span><br><span class="line">            <span class="keyword">if</span> (link.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (action == MotionEvent.ACTION_UP) &#123;</span><br><span class="line">                    link[<span class="number">0</span>].onClick(widget);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Selection.setSelection(buffer, buffer.getSpanStart(link[<span class="number">0</span>]),</span><br><span class="line">                            buffer.getSpanEnd(link[<span class="number">0</span>]));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Selection.removeSelection(buffer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;<span class="comment">//其实就是重写了这一句，然后在textview那里要手动去将焦点的那些方法都设置为false，这样就能够传递事件到父view了</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(TextView widget, Spannable text)</span> </span>&#123;</span><br><span class="line">        Selection.removeSelection(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对象序列化的时候，写serialVersionUID是有没有必要呢？是有必要的。指定以后，序列化和反序列化两者的serialVersionUID的值是一样的，就可以进行正常的反序列化。如果不手动指定这个值，反序列化时，当前的类有所改变，比如增加或者删除了某些成员变量，那系统就会去重新计算serialVersionUID，导致两个UID不一样，于是反序列化失败。所以，指定这个值，可以很大程度上避免反序列化过程的失败。</p>
<h2 id="12月20日-天气-晴"><a href="#12月20日-天气-晴" class="headerlink" title="12月20日 天气:晴"></a>12月20日 天气:晴</h2><p>编程新知识点积累：</p>
<ul>
<li>之前第一次动手去适配android的动态权限申请，发现有些地方用得不是很顺畅，其实就是使用了原生的Activity。原生的activity支持比较麻烦，我以后还是推荐使用AppcompatActivity.</li>
<li>sp在同一进程下面，是支持并发读写的。但是到跨进程以后，并发读写就变得不可靠了。因为系统对sp的读写会有一份缓存策略，内存中会有它的一份缓存。面对高并发读写的时候，sp会有很大的几率丢失数据，甚至，crash。跨进程文件通信的话，最好就是一个写，一个读，一定要处理好读写的问题。</li>
<li>理解进程间通信，同一个应用的不同组件，如果运行在不同的进程当中，那和他们分别属于两个应用没有本质区别。</li>
</ul>
<p>写AIDL的时候踩的坑，就是说实体类放到一起的时候，出问题了，找不到那个类。目前有一个解决办法，就是将src寻找java类的范围扩大。当报找不到类而你又写了类的时候，先放大区域咯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sourceSets&#123;</span><br><span class="line">      main&#123;</span><br><span class="line">          manifest.srcFile <span class="string">'src/main/AndroidManifest.xml'</span></span><br><span class="line">          java.srcDirs = [<span class="string">'src/main/java'</span>, <span class="string">'src/main/aidl'</span>]</span><br><span class="line">          resources.srcDirs = [<span class="string">'src/main/java'</span>, <span class="string">'src/main/aidl'</span>]</span><br><span class="line">          aidl.srcDirs = [<span class="string">'src/main/aidl'</span>]</span><br><span class="line">          res.srcDirs = [<span class="string">'src/main/res'</span>]</span><br><span class="line">          assets.srcDirs = [<span class="string">'src/main/assets'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>在AIDL返回的信息当中，我们不能直接去操作UI，要通过handle，将回来的信息，抛到主线程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> IOnNewBookArrivedListener mIOnNewBookArrivedListener = <span class="keyword">new</span> IOnNewBookArrivedListener.Stub()&#123;</span><br><span class="line">       <span class="comment">//不能直接操作ui</span></span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNewBookArraived</span><span class="params">(Book newBook)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">           <span class="comment">//post到主线程</span></span><br><span class="line">           mHandler.obtainMessage(MESSAGE_NEW_BOOK_ARRIVED, newBook).sendToTarget();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure>
<p>如果我们明明知道服务端某个远程方法是耗时的，就要避免在客户端ui线程中访问该远程方法。因为访问远程方法的时候，客户端线程会挂起，可能造成ANR。避免这种ANR，就是要把对耗时远程方法的调用，放到子线程中，然后将结果抛回到主线程。 同理，如果服务端调用客户端的远程方法是，该方法也不建议是耗时的方法，非要调用这个耗时方法的话，请确保不是在服务端的主线程中调用，否则，可能导致服务端没有响应。</p>
<p>我添加了服务的权限认证以后，有两种方式的认证，发现我连接不上那个服务。原来是我自己没有权限。。。下面我终于搞清楚了权限的定义，声明和使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--使用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"com.example.mybooklibrary.ACCESS_BOOK_SERVICE"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--定义--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:name</span>=<span class="string">"com.example.mybooklibrary.ACCESS_BOOK_SERVICE"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:protectionLevel</span>=<span class="string">"normal"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--声明--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">".BookManagerService"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:permission</span>=<span class="string">"com.example.mybooklibrary.ACCESS_BOOK_SERVICE"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:process</span>=<span class="string">":remote"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="12月21日-天气-晴"><a href="#12月21日-天气-晴" class="headerlink" title="12月21日 天气:晴"></a>12月21日 天气:晴</h2><p>今天突然发现了app上面的url加载有问题，就是页面被重定向，后退的时候退不到主页。我想这是后端的问题啦，让他们回来以后再看看。</p>
<p>Debuggable可调式风险：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">        debug &#123;</span><br><span class="line">            debuggable <span class="keyword">true</span></span><br><span class="line">            minifyEnabled <span class="keyword">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="keyword">false</span></span><br><span class="line">            debuggable <span class="keyword">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="12月22日-天气-阴"><a href="#12月22日-天气-阴" class="headerlink" title="12月22日 天气:阴"></a>12月22日 天气:阴</h2><p>今天把自己的hexo博客的域名给搞回去了，就是在source里面去添加CNAME文件，具体里面有什么呢？<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//网址的域名，不要http前缀</span></span><br><span class="line">lixinkun.win</span><br></pre></td></tr></table></figure></p>
<p>app的入口activity，不能设置属性export=false，不然的话，连系统也不能调起这个activity了。所以，对于那些绝对不能公开的应用界面就要设置为false。</p>
<p>写完了android开发艺术探索的时候，准备去运行一下demo，但是发现了ANR。出现ANR的原因一般都是主线程执行了耗时任务。我去排查一下，原来是连接服务的时候，在主线程执行了binder的耗时方法，导致主线程被挂起。正确的处理方式就是去新开一个线程处理。说到底，还是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">      setContentView(R.layout.acticitv_tcpclient);</span><br><span class="line">      btnSend = (Button) findViewById(R.id.btn_send);</span><br><span class="line">      btnSend.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">              <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                  <span class="meta">@Override</span></span><br><span class="line">                  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                      doSecurityWork();</span><br><span class="line">                      doComputeWork();</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;).start();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>现学现卖，想着无聊，就把我们项目的网络通信框架解耦了，使用什么方式呢？当然是工厂模式啦。抽象出一堆的接口，具体的网络框架，去实现这样的接口，然后代码端就使用一个工厂，取返回一个类就行了，其他层都使用这个东东。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">//以后要更换网络通信框架的话，就更改这里</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IRequestManager <span class="title">getRequestManager</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OkHttpRequestManager.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接口层，至于实现，那就只能是靠各位了</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IRequestManager</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">send</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> Map&lt;String, String&gt; getParames, <span class="keyword">final</span> Map&lt;String, String&gt; postParames, <span class="keyword">final</span> HttpCallback cb, <span class="keyword">final</span> <span class="keyword">long</span> ts)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sendFile</span><span class="params">(<span class="keyword">final</span> String url, <span class="keyword">final</span> String path, <span class="keyword">final</span> Map&lt;String, String&gt; getParames, <span class="keyword">final</span> HttpCallback cb, <span class="keyword">final</span> <span class="keyword">long</span> ts)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">final</span> HttpCallback cb, InputStream inputStream, <span class="keyword">long</span> offset)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cancel</span><span class="params">(<span class="keyword">long</span> ts)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="12月23日-天气-晴"><a href="#12月23日-天气-晴" class="headerlink" title="12月23日 天气:晴"></a>12月23日 天气:晴</h2><p>尝试着去看了别人实现的最美应用底部栏，学习到的东西就几点啦</p>
<ul>
<li>明白View自带的属性动画的使用新招,使用这个，就能做出那些view都弹出的效果，害我之前还在苦想。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> th = getHeight()/<span class="number">7</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">7</span> ; i ++)&#123;</span><br><span class="line">                    <span class="keyword">int</span> t = Math.abs(index - i);</span><br><span class="line">                    <span class="comment">//属性动画</span></span><br><span class="line">                    getChildAt(i).setTranslationY(t * th);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>recyclerview是自带着移动居中的，不，这个还要自己去算，是自带了滑动的scroll方式，并不用自己在内部使用Scroller.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 水平移动某个距离</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 屏幕中的实际位置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollItem</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> dx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> tw = getWidth() / <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; <span class="number">3</span>)&#123;</span><br><span class="line">            dx = -tw * (<span class="number">3</span> - index);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(index &gt; <span class="number">3</span>)&#123;</span><br><span class="line">            dx = tw * (index - <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//自带滑动了呀</span></span><br><span class="line">        smoothScrollBy(dx, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>还有一个最重要的问题，就是要去自己实现LayoutManager，不然LinearManager会和自己自定义的点击事件发生滑动冲突的，所以我们要去自定义一个。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLayoutChildren</span><span class="params">(RecyclerView.Recycler recycler, RecyclerView.State state)</span> </span>&#123;</span><br><span class="line">       detachAndScrapAttachedViews(recycler);</span><br><span class="line">       <span class="keyword">int</span> offsetX = mPadding;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; getItemCount() ; i ++)&#123;</span><br><span class="line">           View view = recycler.getViewForPosition(i);</span><br><span class="line">           measureChildWithMargins(view, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">           <span class="keyword">int</span> width = getDecoratedMeasuredWidth(view);</span><br><span class="line">           <span class="keyword">int</span> height = getDecoratedMeasuredHeight(view);</span><br><span class="line"></span><br><span class="line">           Rect frame = allItemFrams.get(i);</span><br><span class="line">           <span class="keyword">if</span>(frame == <span class="keyword">null</span>)&#123;</span><br><span class="line">               frame = <span class="keyword">new</span> Rect();</span><br><span class="line">           &#125;</span><br><span class="line">           frame.set(offsetX, -<span class="number">80</span>, offsetX + width, height);</span><br><span class="line">           allItemFrams.put(i, frame);</span><br><span class="line">           offsetX += (width + mPadding * <span class="number">2</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       mAllWidth = Math.max(getWidth() / <span class="number">7</span> * getItemCount(), getWidth());</span><br><span class="line">       recyclerAndFillItems(recycler, state);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">recyclerAndFillItems</span><span class="params">(RecyclerView.Recycler recycler, RecyclerView.State state)</span></span>&#123;</span><br><span class="line">           <span class="keyword">if</span>(state.isPreLayout())&#123;</span><br><span class="line">               <span class="keyword">return</span>;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           Rect displayFrame = <span class="keyword">new</span> Rect(mOffsetScroll, <span class="number">0</span>, getWidth() + mOffsetScroll, getHeight());</span><br><span class="line"></span><br><span class="line">           Rect childFrame = <span class="keyword">new</span> Rect();</span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; getChildCount() ; i ++)&#123;</span><br><span class="line">               View child = getChildAt(i);</span><br><span class="line">               childFrame.left = getDecoratedLeft(child);</span><br><span class="line">               childFrame.top = getDecoratedTop(child);</span><br><span class="line">               childFrame.right = getDecoratedRight(child);</span><br><span class="line">               childFrame.bottom = getDecoratedBottom(child);</span><br><span class="line">               <span class="keyword">if</span>(!Rect.intersects(displayFrame, childFrame))&#123;</span><br><span class="line">                   removeAndRecycleView(child, recycler);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           mFirstLayout = <span class="keyword">true</span>;</span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; getItemCount() ; i ++)&#123;</span><br><span class="line">               <span class="keyword">if</span>(Rect.intersects(displayFrame, allItemFrams.get(i)))&#123;</span><br><span class="line">                   <span class="keyword">if</span>(mFirstLayout)&#123;</span><br><span class="line">                       mFirstView = i;</span><br><span class="line">                       mFirstLayout = <span class="keyword">false</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">                   View scrap = recycler.getViewForPosition(i);</span><br><span class="line">                   measureChildWithMargins(scrap, <span class="number">0</span> , <span class="number">0</span>);</span><br><span class="line">                   <span class="keyword">int</span> height = getDecoratedMeasuredHeight(scrap);</span><br><span class="line">                   <span class="keyword">if</span>(i != mSelectIndex)&#123;</span><br><span class="line">                       scrap.setTranslationY(height / <span class="number">7</span> * <span class="number">6</span>);</span><br><span class="line">                   &#125;</span><br><span class="line">                   addView(scrap);</span><br><span class="line">                   Rect frame = allItemFrams.get(i);</span><br><span class="line">                   layoutDecorated(scrap,</span><br><span class="line">                           frame.left - mOffsetScroll,</span><br><span class="line">                           frame.top,</span><br><span class="line">                           frame.right - mOffsetScroll,</span><br><span class="line">                           frame.bottom);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<h2 id="12月26日-天气-晴"><a href="#12月26日-天气-晴" class="headerlink" title="12月26日 天气:晴"></a>12月26日 天气:晴</h2><p>今天早上弄了一下DiskLruCache，原来，下载下来的源码，是不能够直接拉进项目就使用了的，要去对源码进行一定的修改。我打开看了一下，那些都是对java io的修改，无奈自己对那边的api还是有点不熟悉，只能边看边去理解。把它们抽出来，也就成为了工具类的感觉</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取输入流的一行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> in</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">readAsciiLine</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> c = in.read();</span><br><span class="line">            <span class="keyword">if</span>(c == -<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> EOFException();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(c == <span class="string">'\n'</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            result.append((<span class="keyword">char</span>)c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> length = result.length();</span><br><span class="line">        <span class="keyword">if</span>(length &gt; <span class="number">0</span> &amp;&amp; result.charAt(length - <span class="number">1</span>) == <span class="string">'\r'</span>)&#123;</span><br><span class="line">            result.setLength(length - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递归删除所有的文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dir</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">deleteContents</span><span class="params">(File dir)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        File[] files = dir.listFiles();</span><br><span class="line">        <span class="keyword">if</span>(files == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"not a directory:"</span> + dir);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(File file : files)&#123;</span><br><span class="line">            <span class="keyword">if</span> (file.isDirectory())&#123;</span><br><span class="line">                deleteContents(file);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            deleteIfExists(file);</span></span><br><span class="line">            <span class="keyword">if</span>(!file.delete())&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"failed to delete file: "</span> + file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 输入流到</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> inputStreamReader</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">readFully</span><span class="params">(InputStreamReader inputStreamReader)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//            StringBuilder stringBuilder = new StringBuilder();</span></span><br><span class="line">                StringWriter writer = <span class="keyword">new</span> StringWriter();</span><br><span class="line">                <span class="keyword">char</span>[] buffer = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="keyword">int</span> count;</span><br><span class="line">                <span class="keyword">while</span> ((count = inputStreamReader.read(buffer)) != -<span class="number">1</span>)&#123;</span><br><span class="line">                    writer.write(buffer, <span class="number">0</span>, count);</span><br><span class="line">    <span class="comment">//                stringBuilder.append(buffer);</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> writer.toString();</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                MyUitl.close(inputStreamReader);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>线程不安全是源于多线程使用了共享变量造成,所以这里使用 ThreadLocal 来给每个线程单独创建副本变量</p>
<p>没事，继续去写一些linux的脚本好了哦。</p>
<h2 id="12月27日-天气-晴"><a href="#12月27日-天气-晴" class="headerlink" title="12月27日 天气:晴"></a>12月27日 天气:晴</h2><p>先来继续对try cache块做一个更加深刻的认识</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">ImageLoader</span><span class="params">(Context context)</span></span>&#123;</span><br><span class="line">        mContext = context.getApplicationContext();</span><br><span class="line">        <span class="keyword">int</span> maxMemory = (<span class="keyword">int</span>)(Runtime.getRuntime().maxMemory() / <span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">int</span> cacheSize = maxMemory / <span class="number">8</span>;</span><br><span class="line">        mMemoryCache = <span class="keyword">new</span> LruCache&lt;String, Bitmap&gt;(cacheSize)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">sizeOf</span><span class="params">(String key, Bitmap bitmap)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> bitmap.getRowBytes() * bitmap.getHeight() / <span class="number">1024</span>;<span class="comment">//一张图片的大小</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        File diskCacheDir = getDiskCacheDir(mContext, <span class="string">"bitmap"</span>);</span><br><span class="line">        <span class="keyword">if</span>(!diskCacheDir.exists())&#123;</span><br><span class="line">            diskCacheDir.mkdir();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(getUsableSpace(diskCacheDir) &gt; DISK_CACHE_SIZE)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mDiskLruCache = DiskLruCache.open(diskCacheDir, <span class="number">1</span>, <span class="number">1</span>, DISK_CACHE_SIZE);</span><br><span class="line">                <span class="comment">//如果打开硬盘缓存有异常的话，这个标志位是不能被设置的</span></span><br><span class="line">                mIsDiskLruCacheCreated = <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>对mvp模式的重新理解，就算我们把activity的逻辑业务抽离，但是全部抽到presenter那里的话，它也会显得臃肿。此时，我们是不是也要再对presenter进行逻辑业务继续分类呢。稍微清爽了一点，但是类就变多了哦</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserBiz</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">login</span><span class="params">(String username,String password,OnLoginListener loginListener)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserBiz</span> <span class="keyword">implements</span> <span class="title">IUserBiz</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(<span class="keyword">final</span> String username, <span class="keyword">final</span> String password, <span class="keyword">final</span> OnLoginListener loginListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"EricLi"</span>.equals(username) &amp;&amp; <span class="string">"123456"</span>.equals(password))&#123;</span><br><span class="line">                    User user = <span class="keyword">new</span> User();</span><br><span class="line">                    user.setUsername(username);</span><br><span class="line">                    user.setPassword(password);</span><br><span class="line">                    loginListener.loginSuccess(user);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    loginListener.loginFailed();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">UserLoginPresenter</span><span class="params">(IUserLoginView iUserLoginView)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userLoginView = iUserLoginView;</span><br><span class="line">        <span class="keyword">this</span>.userBiz = <span class="keyword">new</span> UserBiz();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">        userLoginView.showLoading();</span><br><span class="line">        String userName = userLoginView.getUserName();</span><br><span class="line">        String password = userLoginView.getPassword();</span><br><span class="line">        userBiz.login(userName, password, <span class="keyword">new</span> OnLoginListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loginSuccess</span><span class="params">(<span class="keyword">final</span> User user)</span> </span>&#123;</span><br><span class="line">                mHandler.post(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        userLoginView.hideLoading();</span><br><span class="line">                        userLoginView.gotoMainActivity(user);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loginFailed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                mHandler.post(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        userLoginView.hideLoading();</span><br><span class="line">                        userLoginView.showError();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="12月28日-天气-晴"><a href="#12月28日-天气-晴" class="headerlink" title="12月28日 天气:晴"></a>12月28日 天气:晴</h2><p>昨天的问题继续去跟，我也是不要太纠结于那个@SystemApi的注解了，昨天出现错误的原因不是因为那个注解，那个方法是可以被调用得到的，但是app拥有的权限不够，系统抛出异常了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个权限又是signature or system的，所以基本上是然并卵。。。</span></span><br><span class="line">Caused by: java.lang.SecurityException: WifiService: Neither user <span class="number">10136</span> nor current process has android.permission.READ_WIFI_CREDENTIAL.</span><br><span class="line"></span><br><span class="line"><span class="comment">//出现这个异常，是因为java反射调用方法时，该方法抛出的异常没有被捕获，到了最后就变成了这个异常</span></span><br><span class="line">exceptionjava.lang.reflect.InvocationTargetException</span><br></pre></td></tr></table></figure>
<p>as调试技巧，新学的就有：</p>
<ul>
<li>方法断点</li>
<li>日志断点</li>
<li>异常断点</li>
<li>临时断点：咱只使用一次</li>
<li>失效断点</li>
<li>观察变量，不是用Variables去看，而是移动鼠标，ALT加上鼠标左键</li>
<li>添加你想观察的变量到watcher窗口</li>
<li>计算出表达式</li>
</ul>
<p>学习一下gradle的语法，首先，自定义生成的apk名字啦</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">applicationVariants.all &#123; variant -&gt;</span><br><span class="line">        variant.outputs.each &#123; output -&gt;</span><br><span class="line">            output.outputFile = <span class="keyword">new</span> File(</span><br><span class="line">                    output.outputFile.parent + <span class="string">"/$&#123;variant.buildType.name&#125;"</span>,</span><br><span class="line">                    <span class="string">"view-$&#123;variant.buildType.name&#125;-V$&#123;variant.versionName&#125;.apk"</span>.toLowerCase())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>下面总结一下三种改变view位置的方式的不同点以及适用场合吧</p>
<ul>
<li>scrollTo/scrollBy:操作简单，适合对view内容的滑动；</li>
<li>动画：操作简单，主要适用于没有交互的view和实现复杂的动画效果；</li>
<li>改变布局参数：操作稍微复杂，适用于有交互的View。</li>
</ul>
<h2 id="12月29日-天气-晴"><a href="#12月29日-天气-晴" class="headerlink" title="12月29日 天气:晴"></a>12月29日 天气:晴</h2><p>下面说一下多进程的使用场景，假如要去做一个音乐播放器，可以有以下五种方案。</p>
<ul>
<li>使用Activity，直接播放音乐。（这个就没必要玩了，完全不合格）</li>
<li>启动后台service，播放音乐。</li>
<li>启动前台service，播放音乐。(优先级提高到2了，更不容易被系统或者其他应用杀死，这里插播一个知识，一般adj &lt; 5的话，是不容易被杀死的)</li>
<li>在新的进程中，启动后台service，播放音乐。（最智慧的方式）</li>
<li>在新的进程中，启动前台service，播放音乐。（喜欢是放肆，但爱是克制，为了android生态的稳定，不推荐使用这种）</li>
</ul>
<h2 id="12月30日-天气-晴"><a href="#12月30日-天气-晴" class="headerlink" title="12月30日 天气:晴"></a>12月30日 天气:晴</h2><p>整理一下java io流的知识。</p>
<h4 id="字符流和字节流"><a href="#字符流和字节流" class="headerlink" title="字符流和字节流"></a>字符流和字节流</h4><p>字符流的由来： 因为数据编码的不同，而有了对字符进行高效操作的流对象。本质其实就是基于字节流读取时，去查了指定的码表。 字节流和字符流的区别：</p>
<p>读写单位不同：字节流以字节（8bit）为单位，字符流以字符为单位，根据码表映射字符，一次可能读多个字节。<br>处理对象不同：字节流能处理所有类型的数据（如图片、avi等），而字符流只能处理字符类型的数据。<br>结论：只要是处理纯文本数据，就优先考虑使用字符流。 除此之外都使用字节流。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">*  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Returns the absolute form of this abstract pathname.  Equivalent to</span></span><br><span class="line"><span class="comment">    * &lt;code&gt;new&amp;nbsp;File(this.&#123;<span class="doctag">@link</span> #getAbsolutePath&#125;)&lt;/code&gt;.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>  The absolute abstract pathname denoting the same file or</span></span><br><span class="line"><span class="comment">    *          directory as this abstract pathname</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span>  SecurityException</span></span><br><span class="line"><span class="comment">    *          If a required system property value cannot be accessed.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@since</span> 1.2</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getAbsoluteFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           String absPath = getAbsolutePath();</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> File(absPath, fs.prefixLength(absPath));</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/work/">work</a><a href="/tags/coding/">coding</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	<div class="share-jiathis">
	  
<div class="jiathis_style_24x24">
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_googleplus"></a>
	<a class="jiathis_button_douban"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
    var jiathis_config={
    data_track_clickback:true,
    sm:"copy,renren,cqq",
    pic:"",
    summary:"",
     ralateuid:{"tsina":"1634073622"},hideMore:false}
    
  </script> 
<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=
2103362" charset="utf-8"></script>      

	 </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev">
 <a href="/2016/12/31/2016/2016年终总结-今年比较有趣和多事/" title="2016年终总结-今年比较有趣和多事">
  <strong>上一篇：</strong><br>
  <span>
  2016年终总结-今年比较有趣和多事</span>
</a>
</div>


<div class="next">
<a href="/2016/11/11/Coding/11月工作笔记/" title="11月工作笔记">
 <strong>下一篇：</strong><br> 
 <span>11月工作笔记
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/12/29/Coding/12月工作笔记/" data-title="12月工作笔记" data-url="http://yoursite.com/2016/12/29/Coding/12月工作笔记/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#12月1日-天气-晴"><span class="toc-number">1.</span> <span class="toc-text">12月1日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月5日-天气-晴"><span class="toc-number">2.</span> <span class="toc-text">12月5日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月6日-天气-晴"><span class="toc-number">3.</span> <span class="toc-text">12月6日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月7日-天气-晴"><span class="toc-number">4.</span> <span class="toc-text">12月7日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月8日-天气-晴"><span class="toc-number">5.</span> <span class="toc-text">12月8日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月9日-天气-晴"><span class="toc-number">6.</span> <span class="toc-text">12月9日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月11日-天气-晴"><span class="toc-number">7.</span> <span class="toc-text">12月11日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月13日-天气-晴"><span class="toc-number">8.</span> <span class="toc-text">12月13日 天气:晴</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#接着罗列一下android特有的数据结构"><span class="toc-number">8.0.1.</span> <span class="toc-text">接着罗列一下android特有的数据结构</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#12月14日-天气-晴"><span class="toc-number">9.</span> <span class="toc-text">12月14日 天气:晴</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#新编程知识点积累"><span class="toc-number">9.1.</span> <span class="toc-text">新编程知识点积累</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用多进程会造成的影响"><span class="toc-number">9.1.1.</span> <span class="toc-text">使用多进程会造成的影响:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12月15日-天气-晴"><span class="toc-number">9.2.</span> <span class="toc-text">12月15日 天气:晴</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#新编程知识点积累-1"><span class="toc-number">9.3.</span> <span class="toc-text">新编程知识点积累</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月16日-天气-晴"><span class="toc-number">10.</span> <span class="toc-text">12月16日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月19日-天气-晴"><span class="toc-number">11.</span> <span class="toc-text">12月19日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月20日-天气-晴"><span class="toc-number">12.</span> <span class="toc-text">12月20日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月21日-天气-晴"><span class="toc-number">13.</span> <span class="toc-text">12月21日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月22日-天气-阴"><span class="toc-number">14.</span> <span class="toc-text">12月22日 天气:阴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月23日-天气-晴"><span class="toc-number">15.</span> <span class="toc-text">12月23日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月26日-天气-晴"><span class="toc-number">16.</span> <span class="toc-text">12月26日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月27日-天气-晴"><span class="toc-number">17.</span> <span class="toc-text">12月27日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月28日-天气-晴"><span class="toc-number">18.</span> <span class="toc-text">12月28日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月29日-天气-晴"><span class="toc-number">19.</span> <span class="toc-text">12月29日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12月30日-天气-晴"><span class="toc-number">20.</span> <span class="toc-text">12月30日 天气:晴</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#字符流和字节流"><span class="toc-number">20.0.1.</span> <span class="toc-text">字符流和字节流</span></a></li></ol></li>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="Eric1235" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/life/" title="life">life<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/work/" title="work">work<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/coding/" title="coding">coding<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/college/" title="college">college<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/feuture/" title="feuture">feuture<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/study/" title="study">study<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/me/" title="me">me<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/sunshine/" title="sunshine">sunshine<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/android/" title="android">android<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/future/" title="future">future<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/work-life/" title="-work -life">-work -life<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/fight/" title="fight">fight<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/improve/" title="improve">improve<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://weicong.win" target="_blank" title="Weicong Blog">Weicong Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self" frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1634073622&verifier=43ce7f75&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer">
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Be Fearless <br>
			Be an Engineer</p>
	</section>
	 
	<div class="social-font">
		
		<a href="http://weibo.com/1634073622" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/Eric1235" target="_blank" class="icon-github" title="github"></a>
		
		
		
		<a href="https://twitter.com/ericli1235" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/lixinkun" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		
		<a href="https://plus.google.com/Eric1235?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:Eric1235@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="Eric Li">Eric Li</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"ericli"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
