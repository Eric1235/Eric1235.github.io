
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Eric&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Eric Li">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="Eric's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Eric's Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eric's Blog">
<meta name="twitter:creator" content="@ericli1235">
<link rel="publisher" href="Eric1235">

    
    <link rel="alternative" href="/atom.xml" title="Eric&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Eric&#39;s Blog" title="Eric&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Eric&#39;s Blog">Eric&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/01/10/2017/2017-12月工作笔记/" title="2017-12月工作笔记" itemprop="url">2017-12月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2018-01-10T02:41:06.000Z" itemprop="datePublished"> 发表于 2018-01-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <a id="more"></a>
<h2 id="12月1日-天气-晴"><a href="#12月1日-天气-晴" class="headerlink" title="12月1日 天气:晴"></a>12月1日 天气:晴</h2><ul>
<li>偶然发现了map中有一个putIfAbsent(K key, V value)方法，如果键是空的，就添加。jdk8新增</li>
</ul>
<h2 id="12月7日-天气-晴"><a href="#12月7日-天气-晴" class="headerlink" title="12月7日 天气:晴"></a>12月7日 天气:晴</h2><ul>
<li>如何同步服务器时间？</li>
<li>单纯使用前端的时间来作为基准时间是不够的吧，还需要服务器的时间进行校正</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">             * 计算客户端时间与服务器时间的误差</div><div class="line">             */</div><div class="line">            calTimeOffset: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> serverDate = <span class="keyword">new</span> <span class="built_in">Date</span>($.ajax(&#123;<span class="attr">async</span>: <span class="literal">false</span>&#125;).getResponseHeader(<span class="string">"Date"</span>));</div><div class="line">                <span class="keyword">this</span>.timeOffset = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - serverDate.getTime();</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">"服务器时间： "</span> + serverDate);</div><div class="line">            &#125;,</div><div class="line"></div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 同步服务器的时间</div><div class="line">             */</div><div class="line">            syncServerTime: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">this</span>.now = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - <span class="keyword">this</span>.timeOffset;</div><div class="line">            &#125;</div></pre></td></tr></table></figure>
<h2 id="12月8日-天气-晴"><a href="#12月8日-天气-晴" class="headerlink" title="12月8日 天气:晴"></a>12月8日 天气:晴</h2><ul>
<li>打开页面的时候，要进行数据统计，比如统计点击次数，分享轨迹等等。</li>
</ul>
<h2 id="12月9日-天气-晴"><a href="#12月9日-天气-晴" class="headerlink" title="12月9日 天气:晴"></a>12月9日 天气:晴</h2><ul>
<li>java序列化序列化就是把java Object转换成为byte[],反序列化就是将byte[]转成Java Object。以下介绍以下java序列化的第二种方式，Protostuff框架。支持如下格式protobuf，protostuff(本地)，graph，json，smile，xml，yaml，kvp</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//序列化</span></div><div class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">byte</span>[] serialize(T obj) &#123;</div><div class="line">    Class&lt;T&gt; cls = (Class&lt;T&gt;) obj.getClass();</div><div class="line">    <span class="comment">//使用LinkedBuffer，在大数据序列化的时候，可以进行缓冲</span></div><div class="line">    LinkedBuffer buffer = LinkedBuffer.allocate(LinkedBuffer.DEFAULT_BUFFER_SIZE);</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        Schema&lt;T&gt; schema = getSchema(cls);</div><div class="line">        <span class="comment">//得到byte[]</span></div><div class="line">        <span class="keyword">return</span> ProtostuffIOUtil.toByteArray(obj, schema, buffer);</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(e.getMessage(), e);</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        buffer.clear();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//反序列化</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">deserialize</span><span class="params">(<span class="keyword">byte</span>[] data, Class&lt;T&gt; cls)</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        T message = objenesis.newInstance(cls);</div><div class="line">        Schema&lt;T&gt; schema = getSchema(cls);</div><div class="line">        ProtostuffIOUtil.mergeFrom(data, message, schema);</div><div class="line">        <span class="keyword">return</span> message;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(e.getMessage(), e);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><a href="http://blog.csdn.net/yd201430320529/article/details/70544203" target="_blank" rel="external">秒杀</a></p>
</li>
<li><p>在html中，引入另外一个html</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"page1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">    &lt;div id=<span class="string">"page2"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">    &lt;script&gt;</div><div class="line">          $(<span class="string">"#page1"</span>).load(<span class="string">"page/Page_1.html"</span>);</div><div class="line">          $(<span class="string">"#page2"</span>).load(<span class="string">"page/Page_2.html"</span>);</div><div class="line">    <span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">&lt;<span class="regexp">/body&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//锁定表的某一行</div><div class="line"><span class="keyword">set</span> <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> <span class="keyword">read</span> uncommitted</div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span></div><div class="line"></div><div class="line"><span class="keyword">SELECT</span> <span class="string">`id`</span> <span class="keyword">FROM</span>  <span class="keyword">table</span> <span class="keyword">WHERE</span>　<span class="keyword">id</span> <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>)   <span class="keyword">LOCK</span> <span class="keyword">IN</span> <span class="keyword">SHARE</span> <span class="keyword">MODE</span></div><div class="line"></div><div class="line"><span class="keyword">SELECT</span> <span class="string">`id`</span> <span class="keyword">FROM</span> mk_user <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span></div></pre></td></tr></table></figure>
<ul>
<li>java虚拟机能够创建的线程数计算公式，得出的结论就是jvm的内存越多，能够创建的线程就越少</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(MaxProcessMemory - JVMMemory - ReservedOsMemory) / (ThreadStackSize) = Number Of Threads</div><div class="line">MaxProcessMemory 指的是一个进程的最大内存</div><div class="line">JVMMemory         JVM内存</div><div class="line">ReservedOsMemory  保留的操作系统内存</div><div class="line">ThreadStackSize      线程栈的大小</div></pre></td></tr></table></figure>
<p>1，    如果程序中有bug，导致创建大量不需要的线程或者线程没有及时回收，那么必须解决这个bug，修改参数是不能解决问题的。<br>2，    如果程序确实需要大量的线程，现有的设置不能达到要求，那么可以通过修改MaxProcessMemory，JVMMemory，ThreadStackSize这三个因素，来增加能创建的线程数：<br>a, MaxProcessMemory 使用64位操作系统<br>b, JVMMemory   减少JVMMemory的分配<br>c, ThreadStackSize  减小单个线程的栈大小</p>
<ul>
<li>maven snapshot仓库和release仓库是不一样的。我配置nexus以后，可以将快照版本打到快照那里去</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//正式库</div><div class="line">mvn deploy:deploy-file -Dversion=0.91 -DgroupId=com.yibaotong.ms  -DartifactId=pg-act-interface -Dpackaging=jar -Dfile=pg-act-interface/target/pg-act-interface.jar -Durl=http://192.168.1.125:8081/nexus/content/repositories/yibaotong -DrepositoryId=yibaotong</div><div class="line"></div><div class="line">//快照</div><div class="line">mvn deploy:deploy-file -Dversion=0.91-SNAPSHOT -DgroupId=com.yibaotong.ms  -DartifactId=pg-act-interface -Dpackaging=jar -Dfile=pg-act-interface/target/pg-act-interface.jar -Durl=http://192.168.1.125:8081/nexus/content/repositories/snapshots -DrepositoryId=snapshots</div></pre></td></tr></table></figure>
<p>使用快照机制后，只需要将未正式发布的构件设定为x.x-SNAPSHOT，然后发布在私服上，在发布的过程中maven会自动的将构件打上时间戳，比如x.x-2017-08-10.112710-12，表示的是2014年8月10日11点27分10秒发布的第12次构件快照，有了时间戳之后maven就很容易找到该构件最新的快照版本。</p>
<p>maven中的setting也要设置id<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">id</span>&gt;</span>snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">password</span>&gt;</span>zby2016<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">server</span>&gt;</span></div></pre></td></tr></table></figure></p>
<ul>
<li>先记住这个sql，以后修改营销活动列表的时候有用</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getInfoByStoreId"</span> <span class="attr">resultMap</span>=<span class="string">"actMarketingStore"</span>&gt;</span></div><div class="line">        SELECT t.* FROM act_marketing_store t LEFT JOIN act_marketing t1 ON t.act_marketing_id = t1.act_marketing_id</div><div class="line">        WHERE t.store_id = #&#123;storeId&#125;</div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"end == 1"</span>&gt;</span></div><div class="line">            AND t1.state IN (2,3) OR (t.state = -1 AND t1.state IN (0,1))</div><div class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"end == 0"</span>&gt;</span></div><div class="line">            AND t1.state IN (0,1) AND t.is_reject = 0</div><div class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"isCreator"</span>&gt;</span></div><div class="line">            AND t.is_belong_creator = 1</div><div class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="12月12日-天气-晴"><a href="#12月12日-天气-晴" class="headerlink" title="12月12日 天气:晴"></a>12月12日 天气:晴</h2><ul>
<li>解决方案1：<br>　　将存库从MySQL前移到Redis中，所有的写操作放到内存中，由于Redis中不存在锁故不会出现互相等待，并且由于Redis的写性能和读性能都远高于MySQL，这就解决了高并发下的性能问题。然后通过队列等异步手段，将变化的数据异步写入到DB中。<br>　　优点：解决性能问题<br>　　缺点：没有解决超卖问题，同时由于异步写入DB，存在某一时刻DB和Redis中数据不一致的风险。</li>
</ul>
<p>解决方案2：<br>　　引入队列，然后将所有写DB操作在单队列中排队，完全串行处理。当达到库存阀值的时候就不在消费队列，并关闭购买功能。这就解决了超卖问题。<br>　　优点：解决超卖问题，略微提升性能。<br>　　缺点：性能受限于队列处理机处理性能和DB的写入性能中最短的那个，另外多商品同时抢购的时候需要准备多条队列。</p>
<p>解决方案3：<br>　　将写操作前移到Memcached中，同时利用Memcached的轻量级的锁机制CAS来实现减库存操作。<br>　　优点：读写在内存中，操作性能快，引入轻量级锁之后可以保证同一时刻只有一个写入成功，解决减库存问题。<br>　　缺点：没有实测，基于CAS的特性不知道高并发下是否会出现大量更新失败？不过加锁之后肯定对并发性能会有影响。</p>
<p>解决方案4：<br>　　将提交操作变成两段式，先申请后确认。然后利用Redis的原子自增操作（相比较MySQL的自增来说没有空洞），同时利用Redis的事务特性来发号，保证拿到小于等于库存阀值的号的人都可以成功提交订单。然后数据异步更新到DB中。<br>　　优点：解决超卖问题，库存读写都在内存中，故同时解决性能问题。<br>　　缺点：由于异步写入DB，可能存在数据不一致。另可能存在少买，也就是如果拿到号的人不真正下订单，可能库存减为0，但是订单数并没有达到库存阀值。</p>
<ul>
<li><p>数据库行级锁</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">update</span> <span class="keyword">table</span> <span class="keyword">set</span> a=a<span class="number">-1</span> <span class="keyword">where</span> a&gt;=<span class="number">1</span> <span class="keyword">and</span> <span class="keyword">id</span> =x</div><div class="line">根据返回结果来看，如果为<span class="number">0</span>，表示卖完了。不为<span class="number">0</span>再继续下面的操作</div></pre></td></tr></table></figure>
</li>
<li><p>java注解序列化，如果你的字段是Date或者LocalDate,可以使用json的序列化注解，转换成为long等类型，给前端返回。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateSerializer</span> <span class="keyword">extends</span> <span class="title">JsonSerializer</span>&lt;<span class="title">Date</span>&gt; </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Date value, JsonGenerator gen, SerializerProvider serializers)</span> <span class="keyword">throws</span> IOException, JsonProcessingException </span>&#123;</div><div class="line">        gen.writeNumber(value.getTime() / <span class="number">1000</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>抑制编译器变长参数泛型参数警告</li>
</ul>
<p>@SafeVarargs注解只能用在参数长度可变的方法或构造方法上，且方法必须声明为static或final，否则会出现编译错误</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SafeVarargs</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">coalesce</span><span class="params">(T... t)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (T current : t) &#123;</div><div class="line">            <span class="keyword">if</span> (current != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">return</span> current;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;``</div></pre></td></tr></table></figure>
<ul>
<li>spring的验证注解可以重叠多个</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateMarketSeckillParams</span> <span class="keyword">extends</span> <span class="title">NewMarketActParam</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/** 秒杀开始时间 */</span></div><div class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"秒杀开始时间不能为空"</span>)</div><div class="line">    <span class="meta">@DateTimeFormat</span>(iso = DateTimeFormat.ISO.DATE_TIME)</div><div class="line">    <span class="keyword">private</span> LocalDateTime seckillStart;</div><div class="line"></div><div class="line">    <span class="comment">/** 秒杀结束时间 */</span></div><div class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"秒杀结束时间不能为空"</span>)</div><div class="line">    <span class="meta">@DateTimeFormat</span>(iso = DateTimeFormat.ISO.DATE_TIME)</div><div class="line">    <span class="keyword">private</span> LocalDateTime seckillEnd;</div><div class="line"></div><div class="line">    <span class="comment">/** 预期开始推广时间 */</span></div><div class="line">    <span class="meta">@DateTimeFormat</span>(iso = DateTimeFormat.ISO.DATE_TIME)</div><div class="line">    <span class="keyword">private</span> LocalDateTime expStartTime;</div><div class="line"></div><div class="line">    <span class="comment">/** 海报 URI */</span></div><div class="line">    <span class="keyword">private</span> String posterUri;</div><div class="line"></div><div class="line">    <span class="comment">/** 缩略图 URI */</span></div><div class="line">    <span class="keyword">private</span> String microImageUri;</div><div class="line"></div><div class="line">    <span class="comment">/** 参与秒杀活动的商品列表 */</span></div><div class="line">    <span class="meta">@Valid</span></div><div class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"未设置活动商品"</span>)</div><div class="line">    <span class="meta">@Size</span>(min = <span class="number">1</span>, message = <span class="string">"未设置活动商品"</span>)</div><div class="line">    <span class="keyword">private</span> List&lt;SeckillItemParams&gt; seckills;</div><div class="line"></div><div class="line">    <span class="comment">/** 操作人类型 */</span></div><div class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"操作人类型不能为空"</span>)</div><div class="line">    <span class="keyword">private</span> Integer operatorType;</div><div class="line">    <span class="comment">/** 操作人ID */</span></div><div class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"操作人id不能为空"</span>)</div><div class="line">    <span class="meta">@Min</span>(value = <span class="number">1</span>, message = <span class="string">"操作人ID错误，不能小于1"</span>)</div><div class="line">    <span class="keyword">private</span> Long operatorId;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>redis控制秒杀<a href="http://blog.csdn.net/u012116196/article/details/51782934" target="_blank" rel="external">秒杀</a></p>
</li>
<li><p>Jedis的发布和订阅的使用<a href="http://blog.csdn.net/lihao21/article/details/48370687" target="_blank" rel="external">Jedis的发布和订阅</a></p>
</li>
<li>Redis为我们提供了publish/subscribe(发布/订阅)功能。我们可以对某个channel(频道)进行subscribe(订阅)，当有人在这个channel上publish(发布)消息时，redis就会通知我们，这样我们可以收到别人发布的消息。<br>作为Java的redis客户端，Jedis提供了publish/subscribe的接口。本文讲述如何使用Jedis来实现redis的publish/subscribe。</li>
<li><p>由于Jedis的subscribe操作是阻塞的，因此，我们另起一个线程来进行subscribe操作。</p>
</li>
<li><p>一种线程池的配置</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** 单线程的线程池，用于执行推送最新竞投 */</span></div><div class="line"><span class="keyword">private</span> ExecutorService executorService = <span class="keyword">new</span> ThreadPoolBuilders.FixedThreadPoolBuilder()</div><div class="line">        <span class="comment">// 单线程</span></div><div class="line">        .setPoolSize(<span class="number">1</span>)</div><div class="line">        <span class="comment">// 队列大小</span></div><div class="line">        .setQueueSize(<span class="number">100</span>)</div><div class="line">        <span class="comment">// 队列满了后丢掉最老的任务</span></div><div class="line">        .setRejectHanlder(<span class="keyword">new</span> ThreadPoolExecutor.DiscardOldestPolicy())</div><div class="line">        .build();</div></pre></td></tr></table></figure>
<ul>
<li>有图片，有数据，只能用表单提交，不能使用json。要使用表单提交</li>
<li>mybatis如果出现主键冲突，可以使用ignore去忽略主键冲突，让mybatis直接返回0.</li>
</ul>
<h2 id="12月20日-天气-晴"><a href="#12月20日-天气-晴" class="headerlink" title="12月20日 天气:晴"></a>12月20日 天气:晴</h2><ul>
<li>终于遇到spring循环依赖了，使用这个东西去解决<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Autowired</span></div><div class="line">   <span class="meta">@Lazy</span></div><div class="line">   <span class="keyword">private</span> MarketingSeckillService marketingSeckillService;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="12月21日-天气-晴"><a href="#12月21日-天气-晴" class="headerlink" title="12月21日 天气:晴"></a>12月21日 天气:晴</h2><ul>
<li>如果给前端返回了一些数字，需要给出完整的结果集给前端。无关的信息，需要删除，不然移动端那里会有疑问。</li>
</ul>
<h2 id="12月24日-天气-晴"><a href="#12月24日-天气-晴" class="headerlink" title="12月24日 天气:晴"></a>12月24日 天气:晴</h2><ul>
<li>学会了一个md5盐值加密</li>
<li>联合活动自动进行推广或者开始的时候，需要把其关联的单品活动状态进行修改</li>
</ul>
<h2 id="12月25日-天气-晴"><a href="#12月25日-天气-晴" class="headerlink" title="12月25日 天气:晴"></a>12月25日 天气:晴</h2><ul>
<li>这里有个坑啊，mysql数据库的字段为dateTime的话，使用java的System.currentTimeMillis()的话，精度对不上，会报org.springframework.dao.DataIntegrityViolationException这个异常。</li>
<li>页面上为什么会有vue.js</li>
</ul>
<h2 id="12月27日-天气-晴"><a href="#12月27日-天气-晴" class="headerlink" title="12月27日 天气:晴"></a>12月27日 天气:晴</h2><ul>
<li>统一一下规范，返回给前台的时间为毫秒</li>
<li>确认参加可能有两次确认的机会，这里需要将已经确认的状态置为未确认</li>
<li>如果数据库联表查询的话，每个字段最好指定别名。不然，以后如果一个表增加了和联结的表相同的字段，就会报错。</li>
<li>关于图片的处理，纯展示的接口，就返回全路径，如果是这个数据需要被修改的，那么就返回相对路径。剩下的由前端补全。</li>
<li>这是接口处理的一个原则，我返回什么数据给前端，前端就返回什么数据来给我。</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/01/10/2017/2017-12月工作笔记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2018/01/10/2017/2017-12月工作笔记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/01/10/2018/2018-1月工作笔记/" title="2018-1月工作笔记" itemprop="url">2018-1月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2018-01-10T02:41:06.000Z" itemprop="datePublished"> 发表于 2018-01-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <a id="more"></a>
<h2 id="1月4日-天气-阴"><a href="#1月4日-天气-阴" class="headerlink" title="1月4日 天气:阴"></a>1月4日 天气:阴</h2><ul>
<li>无论是联合活动还是单品活动，都不能去做一个新的入口，只能是在现有的基础上面加。因为现有的接口已经做好统计，扣钱，跟踪等等。</li>
<li>发信息发错给人了，店铺加入活动的时候，要把预算冻结信息发送给自己。</li>
</ul>
<h2 id="1月5日-天气-阴"><a href="#1月5日-天气-阴" class="headerlink" title="1月5日 天气:阴"></a>1月5日 天气:阴</h2><ul>
<li>表单参数中，如果字段是基本类型long，请求中没有传递这个参数，那么就得到默认的0，如果是包装类型，就得到null了。</li>
</ul>
<h2 id="1月6日-天气-雨"><a href="#1月6日-天气-雨" class="headerlink" title="1月6日 天气:雨"></a>1月6日 天气:雨</h2><ul>
<li>java8的新特性使用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//对非预期的值，给出自己期望的值</span></div><div class="line">ActivitySingleDO actDO = activitySingleDOS.stream().</div><div class="line">                   filter(activitySingleDO -&gt; &#123;<span class="keyword">return</span> activitySingleDO.getItemId() == item.getItemId();&#125;).</div><div class="line">                   findFirst().orElse(<span class="keyword">null</span>);</div></pre></td></tr></table></figure>
<ul>
<li>list直接转成map，去除重复key</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这个做法，还去除了重复的键值。如果list中有重复的key，会报错的</span></div><div class="line">Map&lt;Long, SeckillItemParams&gt; itemSeckillMap = list.getSeckills().stream()</div><div class="line">                .collect(Collectors.toMap(SeckillItemParams::getItemId, o -&gt; o, (o, o2) -&gt; o));</div></pre></td></tr></table></figure>
<ul>
<li>服务器报了这个异常，<code>nested exception is java.lang.OutOfMemoryError: Java heap space</code>，我看看是怎么回事。有没有可能是这个代码配置的问题</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span>(name = <span class="string">"multipartResolver"</span>)</div><div class="line"> <span class="function"><span class="keyword">public</span> MultipartResolver <span class="title">multipartResolver</span><span class="params">()</span> </span>&#123;</div><div class="line">     CommonsMultipartResolver resolver = <span class="keyword">new</span></div><div class="line">             CommonsMultipartResolver();</div><div class="line">     resolver.setDefaultEncoding(<span class="string">"UTF-8"</span>);</div><div class="line">     <span class="comment">//resolveLazily属性启用是为了推迟文件解析，以在在UploadAction中捕获文件大小异常</span></div><div class="line">     resolver.setResolveLazily(<span class="keyword">true</span>);</div><div class="line">     <span class="comment">//在内存中的值</span></div><div class="line">     resolver.setMaxInMemorySize(<span class="number">40960</span>);</div><div class="line">     <span class="comment">//上传文件大小 100M 100*1024*1024</span></div><div class="line">     resolver.setMaxUploadSize(<span class="number">100</span>*<span class="number">1024</span>*<span class="number">1024</span>);</div><div class="line">     <span class="keyword">return</span> resolver;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h2 id="1月8日-天气-雨"><a href="#1月8日-天气-雨" class="headerlink" title="1月8日 天气:雨"></a>1月8日 天气:雨</h2><ul>
<li>做出一次修改的时候，要明确记得修改会影响到的地方。这不，图片的链接，之前返回的是全路径，后来的修改说要改成相对路径。改了商品的主页面，忘记改预览页面，导致出错，图片不能加载。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">   <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-if</span>=<span class="string">"model.act.fistPoster"</span> <span class="attr">class</span>=<span class="string">"second-kill-top"</span> <span class="attr">:src</span>=<span class="string">"model.act.fistPoster"</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--这个头部图，可能有可没有--&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-if</span>=<span class="string">"model.act.fistPoster"</span> <span class="attr">class</span>=<span class="string">"second-kill-top"</span> <span class="attr">:src</span>=<span class="string">"imageServer + model.act.fistPoster"</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>暴露出了对接口测试的不足，现在写的接口都是有点复杂，也是由很多方法组成的。我的错误就是没有单独对立面的小方法进行详细的测试。算商品总和不能超过9个的时候，就出问题了</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">    * 活动更新，由此引发了一连串的表更新</div><div class="line">    * 检查预算：预算不足，直接返回</div><div class="line">    * 解冻预算：解冻发起者的预算</div><div class="line">    * 删除商品：真实删除秒杀商品（不是item表）和商品关联的单品活动需要提前结束</div><div class="line">    * 新增商品：创建商品，创建单品活动</div><div class="line">    * 修改商品：修改商品信息，修改单品活动（单品活动里面没有预算的，不要修改）</div><div class="line">    * 修改总活动：主要是预算变更，时间变更</div><div class="line">    * 修改已经确认的店铺：主要是预算变更，店铺关联的活动也要进行修改</div><div class="line">    * 冻结预算：冻结修改者店铺预算，并且发送通知</div><div class="line">    *</div><div class="line">    * <span class="doctag">@param</span> market 活动</div><div class="line">    * <span class="doctag">@param</span> items 商品列表</div><div class="line">    * <span class="doctag">@param</span> deleteItems 删除的商品id</div><div class="line">    * <span class="doctag">@return</span> result</div><div class="line">    */</div><div class="line">   <span class="meta">@Transactional</span>(rollbackFor = Exception.class)</div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="keyword">public</span> Result&lt;?&gt; update(ActMarketing market, List&lt;ItemSeckill&gt; items, Long[] deleteItems) &#123;</div><div class="line">       Long actMarketId = market.getActMarketingId();</div><div class="line">       Long storeId = market.getStoreId();</div><div class="line">       <span class="comment">//过滤出不同的商品列表</span></div><div class="line">       List&lt;ItemSeckill&gt; addItems = items.stream().</div><div class="line">               filter(itemSeckill -&gt; &#123;<span class="keyword">return</span> itemSeckill.getId() == <span class="keyword">null</span>;&#125;).collect(Collectors.toList());</div><div class="line">       List&lt;ItemSeckill&gt; existItems = items.stream().</div><div class="line">               filter(itemSeckill -&gt; &#123;<span class="keyword">return</span> itemSeckill.getId() != <span class="keyword">null</span>;&#125;).collect(Collectors.toList());</div><div class="line">       Result result = <span class="keyword">new</span> Result();</div><div class="line">       <span class="comment">//目前店铺的商品数量</span></div><div class="line">       <span class="keyword">int</span> storeGoodsNum = existItems.size();</div><div class="line"></div><div class="line">       storeGoodsNum = storeGoodsNum + addItems.size() ;</div><div class="line">       BigDecimal blockMoney = market.getPerBlockMoney().get(<span class="number">0</span>).getBlockMoney();</div><div class="line">       <span class="comment">//查询发起者的店铺</span></div><div class="line">       Result&lt;ActMarketingStore&gt; marketingStoreResult = marketingActService.</div><div class="line">               getActMarketStoreByStoreAndActId(actMarketId, storeId);</div><div class="line">       <span class="keyword">if</span> (!marketingStoreResult.isSuccess()) &#123;</div><div class="line">           result.addError(ErrorCodes.STORE_NOT_EXIST);</div><div class="line">           <span class="keyword">return</span> result;</div><div class="line">       &#125;</div><div class="line">       ActMarketingStore creatorStore = marketingStoreResult.getObject();</div><div class="line">       <span class="comment">//算出有变化的预算，这个是增量，有可能负数</span></div><div class="line">       BigDecimal checkBudget = blockMoney.multiply(<span class="keyword">new</span> BigDecimal(storeGoodsNum)).subtract(creatorStore.getStoreBudget());</div><div class="line">       <span class="comment">//如果预算增加，则要检查账户余额是否足够</span></div><div class="line">       <span class="keyword">if</span> (checkBudget.compareTo(BigDecimal.ZERO) &gt;= <span class="number">0</span>) &#123;</div><div class="line">           <span class="comment">//检查店铺预算</span></div><div class="line">           Result&lt;Void&gt; enoughResult = singleActService.checkStoreMoney(storeId, checkBudget);</div><div class="line">           <span class="keyword">if</span> (!enoughResult.isSuccess()) &#123;</div><div class="line">               result.setErrors(enoughResult.getErrors());</div><div class="line">               <span class="keyword">return</span> result;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="comment">//获取全部加入活动的商品</span></div><div class="line">       Result&lt;List&lt;ActMarketingItem&gt;&gt; itemResult = marketingActService.getActMarketingItem(market.getActMarketingId());</div><div class="line">       <span class="keyword">if</span> (!itemResult.isSuccess() || itemResult.getObject() == <span class="keyword">null</span>) &#123;</div><div class="line">           result.setErrors(itemResult.getErrors());</div><div class="line">           <span class="keyword">return</span> result;</div><div class="line">       &#125;</div><div class="line">       <span class="comment">//现有的图块数量，就是总活动的商品数量，通过item表去做关联</span></div><div class="line">       <span class="keyword">int</span> currentGoodsNum = itemResult.getObject().size();</div><div class="line">       <span class="comment">//如果有商品被删除，则删除商品，再提前结束商品关联的单品活动</span></div><div class="line">       <span class="keyword">if</span> (deleteItems != <span class="keyword">null</span> &amp;&amp; deleteItems.length &gt; <span class="number">0</span>) &#123;</div><div class="line">           currentGoodsNum = currentGoodsNum - deleteItems.length;</div><div class="line">           <span class="keyword">if</span> ((currentGoodsNum + addItems.size()) &gt; <span class="number">9</span>) &#123;</div><div class="line">               result.addError(ErrorCodes.ACT_ITEMS_MORE_THAN_NINE);</div><div class="line">               <span class="keyword">return</span> result;</div><div class="line">           &#125;</div><div class="line">           marketingItemService.deleteItems(deleteItems);</div><div class="line">       &#125;</div><div class="line">       <span class="comment">//本店铺新增了商品，新建活动</span></div><div class="line">       <span class="keyword">if</span> (addItems.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">           currentGoodsNum = currentGoodsNum + addItems.size();</div><div class="line">           <span class="keyword">if</span> (currentGoodsNum  &gt; <span class="number">9</span>) &#123;</div><div class="line">               result.addError(ErrorCodes.ACT_ITEMS_MORE_THAN_NINE);</div><div class="line">               <span class="keyword">return</span> result;</div><div class="line">           &#125;</div><div class="line">           dealAddItems(market, addItems, storeId, market.getIdentityKey());</div><div class="line">       &#125;</div><div class="line">       <span class="comment">//修改发起者已经存在的商品，连同活动一起修改</span></div><div class="line">       <span class="keyword">if</span> (existItems.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">           marketingItemService.updateRemainItems(existItems, market, storeId);</div><div class="line">       &#125;</div><div class="line">       <span class="comment">//更新发起者店铺，创建者新预算 = 新单品预算 * 商品数</span></div><div class="line">       marketingStoreService.updateCreatorStore(creatorStore, market,</div><div class="line">               blockMoney.multiply(<span class="keyword">new</span> BigDecimal(storeGoodsNum)), storeGoodsNum);</div><div class="line"></div><div class="line">       <span class="comment">//更新联合秒杀活动，开始时间那些，在这个方法之前已经做好</span></div><div class="line">       marketingActService.updateActMarket(market, currentGoodsNum, blockMoney);</div><div class="line">       <span class="comment">//获取已经确认的店铺，可能没有店铺</span></div><div class="line">       Result&lt;List&lt;ActMarketingStore&gt;&gt; storeResult = marketingActService.getOtherMarketingStoreByJoin(actMarketId, storeId, <span class="keyword">true</span>);</div><div class="line">       <span class="keyword">if</span> (storeResult.isSuccess() &amp;&amp; storeResult.getObject().size() &gt; <span class="number">0</span>) &#123;</div><div class="line">           <span class="comment">//解冻预算，修改活动时间，设置状态为未参加，发送消息</span></div><div class="line">           List&lt;ActMarketingStore&gt; joinedStoreList = storeResult.getObject();</div><div class="line">           marketingStoreService.dealWithJoinStore(joinedStoreList, market);</div><div class="line">       &#125;</div><div class="line">       <span class="comment">//通知活动有修改，不包含自己和已经拒绝的店铺</span></div><div class="line">       marketingSecKillMsClient.noticeModify(actMarketId, storeId);</div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<ul>
<li>又是那种时间差的问题，活动被手动结束以后，用户还能不能去确认？如果用户停留在那个页面，此时正好创建者结束了这个活动，同时店铺又手贱点了确认，但是后台没有确认的时候，bug就出现了。后台，要对这种情况做一下限制。确认的时候，记得先去解冻预算，再冻结预算和发送相应的通知。</li>
<li>产品的设计真的是有问题。发起的一个活动，用户参与了以后，还能去拒绝。这样，等头脑一冷静下来，用户的流失率就高了。</li>
<li>取反：BigDecimal.negate().doubleValue()</li>
</ul>
<h2 id="1月9日-天气-阴雨，冷"><a href="#1月9日-天气-阴雨，冷" class="headerlink" title="1月9日 天气:阴雨，冷"></a>1月9日 天气:阴雨，冷</h2><ul>
<li>方法如果加了注解@Async以后，调试难度就变大了。特别是在单元测试的时候，方法立即就返回了，我根本debug不到。</li>
<li>出bug了，我传递js函数做参数的时候，用错了。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">             * 前端倒计时结束</div><div class="line">             * 暴露秒杀接口</div><div class="line">             * 修正计时，也可能让时间有误差，再次开始计时就好了</div><div class="line">             */</div><div class="line">            handleSecKill: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">                <span class="comment">//请求后台，判断前台时间和后台时间差别，如果前台时间有误差了，可以进行重新计时</span></div><div class="line">                axios.get(secKill.URL.checkStartUrl(<span class="keyword">this</span>.model.act.actSingleId)).then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</div><div class="line">                    <span class="built_in">console</span>.log(response.data);</div><div class="line">                    <span class="keyword">if</span> (response.data.success) &#123;</div><div class="line">                        self.exposer = response.data.result;</div><div class="line">                        <span class="keyword">if</span> (!self.exposer.exposed) &#123;</div><div class="line">                            <span class="comment">//进行计时</span></div><div class="line">                            <span class="keyword">var</span> remainTime = self.exposer.start - self.exposer.now;</div><div class="line">                            self.startTimeCountDown(remainTime, self.handleSecKill);</div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            self.countDownToEnd();</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</div><div class="line">                    <span class="built_in">console</span>.log(error);</div><div class="line">                &#125;);</div><div class="line">            &#125;,</div><div class="line"></div><div class="line">            <span class="comment">/**</span></div><div class="line">           * 开始倒计时</div><div class="line">           */</div><div class="line">          startTimeCountDown: <span class="function"><span class="keyword">function</span> (<span class="params">remainTime, callback</span>) </span>&#123;</div><div class="line">              <span class="keyword">this</span>.secondeTimerSH(remainTime, <span class="number">0</span>, callback);</div><div class="line">          &#125;,</div><div class="line">          <span class="comment">//错，把结果传进去</span></div><div class="line">          startTimeCountDown(remainTime, self.handleSecKill());</div><div class="line">          <span class="comment">//对，把函数传进去</span></div><div class="line">          startTimeCountDown(remainTime, self.handleSecKill);</div><div class="line"></div><div class="line">            <span class="comment">//问题就是self.handleSecKill与self.handleSecKill()的区别，后者是错的</span></div><div class="line">            mounted: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">            <span class="keyword">this</span>.$nextTick(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="comment">//如果活动正在进行中，则要初始化倒计时</span></div><div class="line">                <span class="keyword">var</span> remainTime = (self.exposer.start - self.exposer.now) / <span class="number">1000</span>;</div><div class="line">                <span class="keyword">if</span> (remainTime &gt; <span class="number">0</span>) &#123;</div><div class="line">                    self.startTimeCountDown(remainTime, self.handleSecKill());</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (self.exposer.exposed) &#123;</div><div class="line">                    self.countDownToEnd();</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;,</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">//spring boot移除tomcat依赖</div><div class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></div><div class="line">//添加另外一个web容器</div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="1月10日-天气-阴"><a href="#1月10日-天气-阴" class="headerlink" title="1月10日 天气:阴"></a>1月10日 天气:阴</h2><ul>
<li>spring boot的自动组件扫描会带来性能慢的问题，因为其会触发自动扫描，加载出很多不需要的bean。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EnableFeignClients</span>(basePackages = <span class="string">"com.yibaotong.pangu.api.server.ms"</span>)</div><div class="line"><span class="meta">@EnableDiscoveryClient</span></div><div class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;<span class="string">"com.yibaotong.pangu.api"</span>, <span class="string">"com.yibaotong.pangu.cache"</span>, <span class="string">"com.yibaotong.pangu.service"</span>,</div><div class="line">        <span class="string">"com.yibaotong.ms.goods"</span>, <span class="string">"com.yibaotong.commons.cache.component"</span>, <span class="string">"com.yibaotong.commons.service"</span>&#125;)</div><div class="line"><span class="meta">@SpringBootApplication</span>  <span class="comment">//自动扫描</span></div><div class="line"><span class="meta">@EnableAspectJAutoProxy</span>(proxyTargetClass = <span class="keyword">true</span>, exposeProxy = <span class="keyword">true</span>)</div><div class="line"><span class="meta">@EnableScheduling</span></div><div class="line"><span class="meta">@EnableAsync</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        SpringApplication.run(Application.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>下面，我们换一种启动方式，去除<code>@SpringBootApplication</code>,去除自动扫描。但是这样又会引发另外一个问题，即组件不能扫描</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableAutoConfiguration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">       SpringApplication.run(App.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">  <span class="meta">@Bean</span> <span class="comment">//需要加这个注解去配置</span></div><div class="line">  <span class="function"><span class="keyword">public</span> HelloController <span class="title">helloController</span><span class="params">()</span></span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">new</span> HelloController();</div><div class="line"></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<ul>
<li>这样配置了，还是会出问题，必要组件就不能加载了，必须在app那里，显式引入这些必要的组件。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"></div><div class="line"><span class="meta">@Import</span>(&#123;</div><div class="line">        DispatcherServletAutoConfiguration.class,</div><div class="line">        EmbeddedServletContainerAutoConfiguration.class,</div><div class="line">        ErrorMvcAutoConfiguration.class,</div><div class="line">        HttpEncodingAutoConfiguration.class,</div><div class="line">        HttpMessageConvertersAutoConfiguration.class,</div><div class="line">        JacksonAutoConfiguration.class,</div><div class="line">        JmxAutoConfiguration.class,</div><div class="line">        MultipartAutoConfiguration.class,</div><div class="line">        ServerPropertiesAutoConfiguration.class,</div><div class="line">        PropertyPlaceholderAutoConfiguration.class,</div><div class="line">        ThymeleafAutoConfiguration.class,</div><div class="line">        WebMvcAutoConfiguration.class,</div><div class="line">        WebSocketAutoConfiguration.class,</div><div class="line">&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>mybatis拾遗</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">insert</span></span></div><div class="line">  <span class="attr">id</span>=<span class="string">"insertAuthor"</span></div><div class="line">  <span class="attr">parameterType</span>=<span class="string">"domain.blog.Author"</span></div><div class="line">  <span class="attr">flushCache</span>=<span class="string">"true"</span></div><div class="line">  <span class="attr">statementType</span>=<span class="string">"PREPARED"</span></div><div class="line">  <span class="attr">keyProperty</span>=<span class="string">""</span></div><div class="line">  <span class="attr">keyColumn</span>=<span class="string">""</span></div><div class="line">  <span class="attr">useGeneratedKeys</span>=<span class="string">""</span></div><div class="line">  <span class="attr">timeout</span>=<span class="string">"20"</span>&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">update</span></span></div><div class="line">  <span class="attr">id</span>=<span class="string">"updateAuthor"</span></div><div class="line">  <span class="attr">parameterType</span>=<span class="string">"domain.blog.Author"</span></div><div class="line">  <span class="attr">flushCache</span>=<span class="string">"true"</span></div><div class="line">  <span class="attr">statementType</span>=<span class="string">"PREPARED"</span></div><div class="line">  <span class="attr">timeout</span>=<span class="string">"20"</span>&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">delete</span></span></div><div class="line">  <span class="attr">id</span>=<span class="string">"deleteAuthor"</span></div><div class="line">  <span class="attr">parameterType</span>=<span class="string">"domain.blog.Author"</span></div><div class="line">  <span class="attr">flushCache</span>=<span class="string">"true"</span></div><div class="line">  <span class="attr">statementType</span>=<span class="string">"PREPARED"</span></div><div class="line">  <span class="attr">timeout</span>=<span class="string">"20"</span>&gt;</div></pre></td></tr></table></figure>
<ul>
<li>终于找到添加好友的bug了，太过相信微服务提供的api了，它返回的结果并不是我想要的结果。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 店铺成为好友</div><div class="line"> * 先判断是否是好友，如果是的话就跳过</div><div class="line"> * 如果已有好友记录，但是不是好友状态，就重置为好友状态</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> storeId       店铺id</div><div class="line"> * <span class="doctag">@param</span> friendStoreId 好友店铺id</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dealTwoStoreFriends</span><span class="params">(Long storeId, Long friendStoreId)</span> </span>&#123;</div><div class="line">  <span class="comment">//这个方法不符合我的预期，返回的必须是正式好友，我需要的只是要返回一条记录，所以，添加过好友的店铺，就不走刷新分支，而是走新增分支，是新增不了的。</span></div><div class="line">    Result&lt;StoreFriend&gt; storeFriendResult = storeFriendMsClient.get(storeId, friendStoreId);</div><div class="line">    <span class="comment">//去微服务添加这个方法，就好了</span></div><div class="line">    Result&lt;StoreFriend&gt; storeFriendResult = storeFriendMsClient.getRecord(storeId, friendStoreId);</div><div class="line">    <span class="keyword">if</span> (storeFriendResult.isSuccess()) &#123;</div><div class="line">        <span class="keyword">if</span> (storeFriendResult.getObject().getFriendState() == ContactEnum.FriendState.ADDED) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">//添加过好友，但是可能解除过好友关系，需要更新好友状态</span></div><div class="line">            <span class="keyword">this</span>.storeFriendMsClient.updateFriendState(storeId, friendStoreId, ContactEnum.FriendState.ADDED);</div><div class="line">            <span class="keyword">this</span>.storeFriendMsClient.updateFriendState(friendStoreId, storeId, ContactEnum.FriendState.ADDED);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//不是好友关系</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">this</span>.storeFriendMsClient.beFriend(storeId, friendStoreId);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/life/">life</a><a href="/tags/feuture/">feuture</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2018/01/10/2018/2018-1月工作笔记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2018/01/10/2018/2018-1月工作笔记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/12/10/2017/2017-11月工作笔记/" title="2017-11月工作笔记" itemprop="url">2017-11月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2017-12-10T02:41:06.000Z" itemprop="datePublished"> 发表于 2017-12-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <a id="more"></a>
<h2 id="11月3日-天气-晴"><a href="#11月3日-天气-晴" class="headerlink" title="11月3日 天气:晴"></a>11月3日 天气:晴</h2><ul>
<li>早上回来发现我的统计程序被执行了两次。一开始怀疑是我的代码写得有问题。但是细想一下，可能是别人开了另外一个程序跑了一次。一般来说是不用解决的，但是为了防止这种情况的发生，我做的处理就是先在数据库那里加上唯一索引。然后统计的时候先判断数据库里面有没有今天的统计数据，如果有，就不再执行统计。前者是最后一道防线，后者的话。只能在部署同时跑的情况下可以进行互斥。</li>
<li>找一下解决手机端展示视频链接过大的问题。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="built_in">window</span>.onload = <span class="built_in">window</span>.onresize = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">resizeIframe();</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> resizeIframe=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"><span class="keyword">var</span> bodyw=<span class="built_in">document</span>.body.clientWidth;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> ilength=<span class="number">0</span>;ilength&lt;=<span class="built_in">document</span>.getElementsByTagName(<span class="string">"iframe"</span>).length;ilength++)&#123;</div><div class="line"><span class="built_in">document</span>.getElementsByTagName(<span class="string">"iframe"</span>)[ilength].height = bodyw*<span class="number">9</span>/<span class="number">16</span>;<span class="comment">//设定高度</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">width</span>=<span class="string">100%</span> <span class="attr">src</span>=<span class="string">"视频地址"</span> <span class="attr">frameborder</span>=<span class="string">0</span> <span class="attr">allowfullscreen</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="11月7日-天气-雨"><a href="#11月7日-天气-雨" class="headerlink" title="11月7日 天气:雨"></a>11月7日 天气:雨</h2><ul>
<li>发送的东西有重复数据。看了一下数据库，丫的，真是的。虚拟店长和店长是这样子的哦，userId可以相同哦。我去重可以了吧。搞这个就搞了我好久，还要清除数据库。</li>
<li>浮点数的计算会有问题，精度会丢失的，不能直接计算。如果有可能，将计算放在后台。前台只是负责展示。</li>
<li>h5项目中，加入api的url就不会被拦截。</li>
<li>微信授权登录以后，设置的nextPage为空。</li>
<li>去除后台的拦截页面，因为拦截了以后，授权后没有绑定user的话，还是会拦截，进入死循环。目前的做法就是去前端进行跳转，前端跳转到登录页面，本页面不被拦截。</li>
</ul>
<h2 id="11月8日-天气-晴"><a href="#11月8日-天气-晴" class="headerlink" title="11月8日 天气:晴"></a>11月8日 天气:晴</h2><ul>
<li>就算是微信授权以后，如果用户没有绑定手机，照样是会被拦截下来的。所以，要把这个这个创建我的活动页面不拦截，随便创建。</li>
<li>所以，微信打开的页面，最好不要进行拦截。</li>
<li>maven中有坑，我在主项目中引入了jar，但是在server那里，默认没有进行引用，死活jar包进不来，需要在server进行引用</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.yibaotong.ms<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pg-user-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="11月10日-天气-晴"><a href="#11月10日-天气-晴" class="headerlink" title="11月10日 天气:晴"></a>11月10日 天气:晴</h2><ul>
<li>String里面有一个忽略大小写的比较方法，这样就是我多写代码了，把大写小写的写上了</li>
<li>poi可以设置某个单元格是下拉的，具体代码如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HSSFSheet <span class="title">setHSSFValidation</span><span class="params">(HSSFSheet sheet,</span></span></div><div class="line">                                              String[] textlist, <span class="keyword">int</span> firstRow, <span class="keyword">int</span> endRow, <span class="keyword">int</span> firstCol,</div><div class="line">                                              <span class="keyword">int</span> endCol) &#123;</div><div class="line">        <span class="comment">// 加载下拉列表内容</span></div><div class="line">        DVConstraint constraint = DVConstraint.createExplicitListConstraint(textlist);</div><div class="line">        <span class="comment">// 设置数据有效性加载在哪个单元格上,四个参数分别是：起始行、终止行、起始列、终止列</span></div><div class="line">        CellRangeAddressList regions = <span class="keyword">new</span> CellRangeAddressList(firstRow,endRow, firstCol, endCol);</div><div class="line">        <span class="comment">// 数据有效性对象</span></div><div class="line">        HSSFDataValidation data_validation_list = <span class="keyword">new</span> HSSFDataValidation(regions, constraint);</div><div class="line">        sheet.addValidationData(data_validation_list);</div><div class="line">        <span class="keyword">return</span> sheet;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>接口超时了啦，这是怎么回事？我把接口都写成异步的，这样应该就没有问题了吧</li>
<li>把插入改成是批量插入。</li>
</ul>
<h2 id="11月13日-天气-雨"><a href="#11月13日-天气-雨" class="headerlink" title="11月13日 天气:雨"></a>11月13日 天气:雨</h2><ul>
<li>发现一个问题，微信授权登录的时候，需要关注了微信号，才能获取到用户的昵称信息。</li>
</ul>
<h2 id="11月15号-天气-阴"><a href="#11月15号-天气-阴" class="headerlink" title="11月15号 天气:阴"></a>11月15号 天气:阴</h2><ul>
<li>poi怎么把附加的信息写进去表格呢？把第一行空出来，然后写进去的东西用透明的颜色。然后合并单元格，再写点别的东西进去。</li>
<li>收集一份在用的mybatis的配置文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE configuration PUBLIC</span></div><div class="line">        "-//mybatis.org//DTD Config 3.0//EN"</div><div class="line">        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 是否开启自动驼峰命名规则（camel case）映射，即从经典数据库列名 A_COLUMN 到经典 Java 属性名 aColumn 的类似映射。默认 false --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 配置默认的执行器。SIMPLE 就是普通的执行器；REUSE 执行器会重用预处理语句（prepared statements）； BATCH 执行器将重用语句并执行批量更新。 --&gt;</span></div><div class="line">        <span class="comment">&lt;!--&lt;setting name="defaultExecutorType" value="BATCH" /&gt;--&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"StatisticDO"</span> <span class="attr">type</span>=<span class="string">"com.yibaotong.pangu.wpc.server.units.statistic.StatisticDO"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- Mybatis 版本低于 3.4.0，需手动注册类型处理器，支持 JSR310 日期时间 API --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"org.apache.ibatis.type.InstantTypeHandler"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"org.apache.ibatis.type.LocalDateTimeTypeHandler"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"org.apache.ibatis.type.LocalDateTypeHandler"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"org.apache.ibatis.type.LocalTimeTypeHandler"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"org.apache.ibatis.type.OffsetDateTimeTypeHandler"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"org.apache.ibatis.type.OffsetTimeTypeHandler"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"org.apache.ibatis.type.ZonedDateTimeTypeHandler"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- com.github.pagehelper为PageHelper类所在包名 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"com.github.pagehelper.PageHelper"</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 4.0.0以后版本可以不设置该参数 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span> <span class="attr">value</span>=<span class="string">"mysql"</span>/&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 该参数默认为false --&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 设置为true时，会将RowBounds第一个参数offset当成pageNum页码使用 --&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 和startPage中的pageNum效果一样--&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"offsetAsPageNum"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 该参数默认为false --&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 设置为true时，使用RowBounds分页会进行count查询 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"rowBoundsWithCount"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 设置为true时，如果pageSize=0或者RowBounds.limit = 0就会查询出全部的结果 --&gt;</span></div><div class="line">            <span class="comment">&lt;!-- （相当于没有执行分页查询，但是返回结果仍然是Page类型）--&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pageSizeZero"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>渠道版是没有款式图片的，上传的时候，就不用去进行上传了。原型那边需要进行更改，我也少做一部分工作。</li>
</ul>
<h2 id="11月16日-天气-晴"><a href="#11月16日-天气-晴" class="headerlink" title="11月16日 天气:晴"></a>11月16日 天气:晴</h2><ul>
<li>学习一个vue自定义指令的方法,这个是全局指令</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Vue.directive(<span class="string">'focus'</span>, &#123;</div><div class="line">  <span class="attr">inserted</span>: <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</div><div class="line">    el.focus();</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//使用示例</span></div><div class="line">&lt;input v-focus&gt;</div></pre></td></tr></table></figure>
<ul>
<li>当数据库不支持主键自增的时候，可以这样来处理。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertAuthor"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"int"</span> <span class="attr">order</span>=<span class="string">"BEFORE"</span>&gt;</span></div><div class="line">    select CAST(RANDOM()*1000000 as INTEGER) a from SYSIBM.SYSDUMMY1</div><div class="line">  <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></div><div class="line">  insert into Author</div><div class="line">    (id, username, password, email,bio, favourite_section)</div><div class="line">  values</div><div class="line">    (#&#123;id&#125;, #&#123;username&#125;, #&#123;password&#125;, #&#123;email&#125;, #&#123;bio&#125;, #&#123;favouriteSection,jdbcType=VARCHAR&#125;)</div><div class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>挖宝活动网页分享出去的时候有bug，为何会显示这个玩意。</li>
<li>必填属性没有配置的话，那么配置的也不要了，自己写死一个进去。</li>
</ul>
<h2 id="11月20日-天气-晴"><a href="#11月20日-天气-晴" class="headerlink" title="11月20日 天气:晴"></a>11月20日 天气:晴</h2><ul>
<li>学习一个js的post请求跳转页面</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$.extend(&#123;</div><div class="line">       <span class="attr">StandardPost</span>: <span class="function"><span class="keyword">function</span> (<span class="params">url, args</span>) </span>&#123;</div><div class="line">           <span class="keyword">var</span> form = $(<span class="string">"&lt;form method='post'&gt;&lt;/form&gt;"</span>),</div><div class="line">               input;</div><div class="line">           form.attr(&#123;<span class="string">"action"</span>: url&#125;);</div><div class="line">           $.each(args, <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</div><div class="line">               input = $(<span class="string">"&lt;input type='hidden'&gt;"</span>);</div><div class="line">               input.attr(&#123;<span class="string">"name"</span>: key&#125;);</div><div class="line">               input.val(value);</div><div class="line">               form.append(input);</div><div class="line">           &#125;);</div><div class="line">           $(<span class="built_in">document</span>.body).append(form);</div><div class="line">           form.submit();</div><div class="line">       &#125;</div><div class="line">   &#125;);</div></pre></td></tr></table></figure>
<ul>
<li>新问题的收集，就是代码为什么不是顺序执行？</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">signUp: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">if</span> (!isLogin) &#123;</div><div class="line">                   <span class="keyword">var</span> nextPage = basePath + <span class="string">'/activities/auctions/'</span> + single.actId + requestParams</div><div class="line">                   <span class="built_in">window</span>.location.href = basePath + <span class="string">"/to/login?updateNextPage=true&amp;NextPage="</span> + <span class="built_in">encodeURI</span>(nextPage);</div><div class="line">                   <span class="comment">//这里需要加</span></div><div class="line">                   <span class="keyword">return</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">var</span> url = basePath + <span class="string">'activities/auctions/'</span> + single.actId + <span class="string">'/apply'</span>;</div><div class="line">               axios.post(url).then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</div><div class="line">                   <span class="keyword">if</span> (response.data.success) &#123;</div><div class="line">                       <span class="keyword">var</span> param = response.data.result;</div><div class="line">                       <span class="keyword">var</span> item = &#123;</div><div class="line">                           <span class="string">"singleActType"</span>: param.singleActType,</div><div class="line">                           <span class="string">"singleActId"</span>: param.singleActId,</div><div class="line">                           <span class="string">"procureItems[0].itemId"</span>: param.procureItems[<span class="number">0</span>].itemId,</div><div class="line">                           <span class="string">"procureItems[0].styleName"</span>: param.procureItems[<span class="number">0</span>].styleName,</div><div class="line">                           <span class="string">"procureItems[0].buyNum"</span>: <span class="number">1</span></div><div class="line">                       &#125;</div><div class="line">                       <span class="keyword">var</span> signUpUrl = basePath + <span class="string">"confirm/act/apply"</span>;</div><div class="line">                       $.StandardPost(signUpUrl, item);</div><div class="line">                   &#125;</div><div class="line">               &#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</div><div class="line">                   <span class="built_in">console</span>.log(error);</div><div class="line">               &#125;)</div><div class="line">           &#125;,</div></pre></td></tr></table></figure>
<h2 id="11月21日-天气-晴"><a href="#11月21日-天气-晴" class="headerlink" title="11月21日 天气:晴"></a>11月21日 天气:晴</h2><ul>
<li>两者的区别<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">add: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.addPrice + auction.stepPrice &lt; <span class="number">10000</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.addPrice += auction.stepPrice;</div><div class="line">    &#125;</div><div class="line">&#125;,</div><div class="line"><span class="attr">add</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.addPrice &lt; <span class="number">10000</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.addPrice += auction.stepPrice;</div><div class="line">    &#125;</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="11月22日-天气-晴"><a href="#11月22日-天气-晴" class="headerlink" title="11月22日 天气:晴"></a>11月22日 天气:晴</h2><ul>
<li>下面来学一下标准的axios的get怎么传递数组,必须先转为字符串</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> url = basePath + <span class="string">'goods/check/duplicate'</span>;</div><div class="line">                   <span class="keyword">var</span> data = &#123;</div><div class="line">                       <span class="string">'goodsCodeList'</span>: <span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.goodsCodeList),</div><div class="line">                       <span class="string">'subCatId'</span>: <span class="number">1</span>,</div><div class="line">                   &#125;;</div><div class="line">                   <span class="built_in">console</span>.log(data);</div><div class="line">                   axios.get(url, &#123;<span class="attr">params</span>: data&#125;)</div><div class="line">                       .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</div><div class="line">                           <span class="built_in">console</span>.log(response);</div><div class="line">                           self.state = <span class="number">2</span>;</div><div class="line">                       &#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</div><div class="line">                       <span class="built_in">console</span>.log(error);</div><div class="line">                   &#125;);</div></pre></td></tr></table></figure>
<h2 id="11月25日-天气-阴"><a href="#11月25日-天气-阴" class="headerlink" title="11月25日 天气:阴"></a>11月25日 天气:阴</h2><ul>
<li>遇到的问题都是前端的问题，关于webuploader不能屏蔽按钮的交互，还有样式错乱的问题。我选择的就是在按钮那里，加多一个平行div，用这个div去屏蔽按钮。</li>
<li>验证的要领，如果没有数据了，就不要进入到下一步。</li>
</ul>
<h2 id="11月28日-天气-阴"><a href="#11月28日-天气-阴" class="headerlink" title="11月28日 天气:阴"></a>11月28日 天气:阴</h2><ul>
<li>上传excel，忽略商品的时候。如果列表都被忽略空了，如果还有其他选择可以不忽略，进行覆盖的时候，就不要真的把数据给清了。不然，就出bug。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">ignoreDuplicateGoods: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">                <span class="keyword">var</span> newGoodsList = [];</div><div class="line">                <span class="keyword">var</span> tempErrorList = [];</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.duplicateGoodsList.length === <span class="number">0</span>) &#123;</div><div class="line">                    self.state = <span class="number">3</span>;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="keyword">this</span>.goodsList.length ; i ++) &#123;</div><div class="line">                    <span class="keyword">var</span> goods = <span class="keyword">this</span>.goodsList[i];</div><div class="line">                    <span class="keyword">var</span> duplicate = <span class="literal">false</span>;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span> ; j &lt; <span class="keyword">this</span>.duplicateGoodsList.length ; j ++) &#123;</div><div class="line">                        <span class="keyword">var</span> existGoods = <span class="keyword">this</span>.duplicateGoodsList[j];</div><div class="line">                        <span class="keyword">if</span> (existGoods.goodsCode === goods.goodsCode) &#123;</div><div class="line">                            duplicate = <span class="literal">true</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span> (!duplicate) &#123;</div><div class="line">                        newGoodsList.push(goods);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="keyword">var</span> error = &#123;</div><div class="line">                            <span class="attr">errorList</span>: [<span class="string">"与现有库商品重复"</span>],</div><div class="line">                            <span class="attr">line</span>: goods.line,</div><div class="line">                            <span class="attr">goodsCode</span>: goods.goodsCode,</div><div class="line">                            <span class="attr">goodsTitle</span>: goods.goodsTitle,</div><div class="line">                        &#125;;</div><div class="line">                        tempErrorList.push(error);</div><div class="line">                        <span class="comment">//暂存被忽略的重复图片</span></div><div class="line">                        <span class="keyword">this</span>.ignoreGoodsList.push(goods);</div><div class="line">                    &#125;</div><div class="line">                    duplicate = <span class="literal">false</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (newGoodsList.length === <span class="number">0</span>) &#123;</div><div class="line">                    self.showAlertDialog(<span class="string">"表格中无合格商品，请修改货号后重新上传或选择覆盖库存商品"</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                  <span class="comment">//确定忽略不为空，才去真正忽略，忽略后进行下一步</span></div><div class="line">                    self.goodsList = newGoodsList;</div><div class="line">                    <span class="keyword">this</span>.errorList.push(tempErrorList);</div><div class="line">                    self.state = <span class="number">3</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;,</div></pre></td></tr></table></figure>
<ul>
<li>poi是可以对数据添加有效性约束的，创建excel的时候，我就限制了excel的下拉选择数据，输入数字的区间和输入的字符的长度约束。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">   * 设置某些列的值只能输入预制的数据,显示下拉框.</div><div class="line">   * <span class="doctag">@param</span> sheet 要设置的sheet.</div><div class="line">   * <span class="doctag">@param</span> textList 下拉框显示的内容</div><div class="line">   * <span class="doctag">@param</span> firstRow 开始行</div><div class="line">   * <span class="doctag">@param</span> endRow 结束行</div><div class="line">   * <span class="doctag">@param</span> firstCol   开始列</div><div class="line">   * <span class="doctag">@param</span> endCol  结束列</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setHSSFValidation</span><span class="params">(HSSFSheet sheet,</span></span></div><div class="line">                                            String[] textList, <span class="keyword">int</span> firstRow, <span class="keyword">int</span> endRow, <span class="keyword">int</span> firstCol,</div><div class="line">                                            <span class="keyword">int</span> endCol) &#123;</div><div class="line">      <span class="comment">// 加载下拉列表内容</span></div><div class="line">      DVConstraint constraint = DVConstraint.createExplicitListConstraint(textList);</div><div class="line">      <span class="comment">// 设置数据有效性加载在哪个单元格上,四个参数分别是：起始行、终止行、起始列、终止列</span></div><div class="line">      CellRangeAddressList regions = <span class="keyword">new</span> CellRangeAddressList(firstRow,endRow, firstCol, endCol);</div><div class="line">      <span class="comment">// 数据有效性对象</span></div><div class="line">      HSSFDataValidation dataValidationList = <span class="keyword">new</span> HSSFDataValidation(regions, constraint);</div><div class="line">      sheet.addValidationData(dataValidationList);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 设置某些列的值输入区间</div><div class="line">   * 暂时没有启用，等测试提了再说</div><div class="line">   * 但是我又启用了这个</div><div class="line">   * <span class="doctag">@param</span> sheet 表格</div><div class="line">   * <span class="doctag">@param</span> min 最小值</div><div class="line">   * <span class="doctag">@param</span> max 最大值</div><div class="line">   * <span class="doctag">@param</span> firstRow 开始行</div><div class="line">   * <span class="doctag">@param</span> endRow 结束行</div><div class="line">   * <span class="doctag">@param</span> firstCol 开始列</div><div class="line">   * <span class="doctag">@param</span> endCol 结束列</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setInputRange</span><span class="params">(HSSFSheet sheet, String min, String max, <span class="keyword">int</span> firstRow, <span class="keyword">int</span> endRow, <span class="keyword">int</span> firstCol,</span></span></div><div class="line">                             <span class="keyword">int</span> endCol) &#123;</div><div class="line">      DVConstraint constrain = DVConstraint.createNumericConstraint(</div><div class="line">              DataValidationConstraint.ValidationType.DECIMAL, DataValidationConstraint.OperatorType.BETWEEN, min, max);</div><div class="line">      CellRangeAddressList region = <span class="keyword">new</span> CellRangeAddressList(firstRow,endRow,firstCol,endCol);</div><div class="line">      HSSFDataValidation vali = <span class="keyword">new</span> HSSFDataValidation(region, constrain);</div><div class="line">      vali.createErrorBox(<span class="string">"输入值类型或大小有误"</span>, <span class="string">"数值型，请输入"</span> + min + <span class="string">"~"</span> + max + <span class="string">"之间的数值"</span>);</div><div class="line">      sheet.addValidationData(vali);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 设置某些单元格的输入长度</div><div class="line">   * <span class="doctag">@param</span> sheet 表格</div><div class="line">   * <span class="doctag">@param</span> min 最小长度</div><div class="line">   * <span class="doctag">@param</span> max 最大长度</div><div class="line">   * <span class="doctag">@param</span> firstRow 开始行</div><div class="line">   * <span class="doctag">@param</span> endRow 结束行</div><div class="line">   * <span class="doctag">@param</span> firstCol 开始列</div><div class="line">   * <span class="doctag">@param</span> endCol 结束列</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLengthValidate</span><span class="params">(HSSFSheet sheet, String min, String max, <span class="keyword">int</span> firstRow, <span class="keyword">int</span> endRow, <span class="keyword">int</span> firstCol,</span></span></div><div class="line">                                <span class="keyword">int</span> endCol) &#123;</div><div class="line">      DVConstraint constraint = DVConstraint.createNumericConstraint(</div><div class="line">              DVConstraint.ValidationType.TEXT_LENGTH,</div><div class="line">              DVConstraint.OperatorType.BETWEEN, min, max);</div><div class="line">      <span class="comment">// 设定在哪个单元格生效</span></div><div class="line">      CellRangeAddressList regions = <span class="keyword">new</span> CellRangeAddressList(firstRow,</div><div class="line">              endRow, firstCol, endCol);</div><div class="line">      <span class="comment">// 创建规则对象</span></div><div class="line">      HSSFDataValidation ret = <span class="keyword">new</span> HSSFDataValidation(regions, constraint);</div><div class="line">      ret.createErrorBox(<span class="string">"输入值的长度有误"</span>, <span class="string">"请输入"</span> + min + <span class="string">"~"</span> + max + <span class="string">"之间的长度"</span>);</div><div class="line">      sheet.addValidationData(ret);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<ul>
<li>产品那边要求重新上传文件的时候，需要记住自己选择的类目和直接上传文件。就是要把首页记住。我一开始使用的是v-if标签，这个并不行。因为类目的下拉框是动态生成的，我再次展示的时候，会丢失多级类目的选择。但是，我使用v-show标签去控制就可以了。这里是两者的区别，动态添加的元素保不住。</li>
<li>v-if 的初始化较快，但切换代价高；v-show 初始化慢，但切换成本低</li>
<li>v-if是动态的向DOM树内添加或者删除DOM元素；<br>v-show是通过设置DOM元素的display样式属性控制显隐；</li>
</ul>
<h2 id="11月29日-天气-晴"><a href="#11月29日-天气-晴" class="headerlink" title="11月29日 天气:晴"></a>11月29日 天气:晴</h2><ul>
<li>需要给页面做一些动态效果，鼠标悬浮的时候去加一点样式</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">effect: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">           $(<span class="string">'.pc-pg-Upload-list'</span>).mouseenter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">               $(<span class="keyword">this</span>).addClass(<span class="string">'pc-pg-Upload-list-active'</span>);</div><div class="line"></div><div class="line">           &#125;);</div><div class="line">           $(<span class="string">'.pc-pg-Upload-list'</span>).mouseleave(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">               $(<span class="keyword">this</span>).removeClass(<span class="string">'pc-pg-Upload-list-active'</span>);</div><div class="line"></div><div class="line">           &#125;)</div><div class="line">           $(<span class="string">'.pc-pg-Upload-list'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">               $(<span class="keyword">this</span>).addClass(<span class="string">'pc-pg-Upload-list-active'</span>);</div><div class="line">           &#125;)</div><div class="line">       &#125;,</div></pre></td></tr></table></figure>
<ul>
<li>slf4j的logger，是带占位符的，LOGGER.debug(“活动[{}]非进行中，不能竞投”, actId);</li>
<li><p>HTTP协议规范没有对URL长度进行限制。这个限制是特定的浏览器及服务器对它的限制<br>在IE8 下的URL地址总长度为：4076，超过该长度会自动忽略后面的内容；<br>在firefox 25下的URL地址总长度可以达到:7530，超过该长度会访问错误；<br>在chrome 29.0.1547.62 的最大总长度达到:7675，超过该长度会访问错误；</p>
</li>
<li><p>解决git的树冲突啊。</p>
</li>
</ul>
<h2 id="11月30日-天气-阴"><a href="#11月30日-天气-阴" class="headerlink" title="11月30日 天气:阴"></a>11月30日 天气:阴</h2><ul>
<li>Post请求</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">POST / HTTP/<span class="number">1.1</span></div><div class="line">Host: www.baidu.com</div><div class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows; U; Windows NT <span class="number">5.1</span>; en-US; rv:<span class="number">1.7</span><span class="number">.6</span>)</div><div class="line">Gecko/<span class="number">20050225</span> Firefox/<span class="number">1.0</span><span class="number">.1</span></div><div class="line">Content-Type: application/x-www-form-urlencoded</div><div class="line">Content-Length: <span class="number">40</span> <span class="comment">//表示请求消息正文的长度</span></div><div class="line">Connection: Keep-Alive <span class="comment">//持久连接，HTTP1.1默认持久连接</span></div><div class="line">name=Professional%<span class="number">20</span>Ajax&amp;publisher=Wiley <span class="comment">//请求主体</span></div></pre></td></tr></table></figure>
<ul>
<li>sessionid是一个会话的key，浏览器第一次访问服务器会在服务器端生成一个session，有一个sessionid和它对应。tomcat生成的sessionid叫做jsessionid。</li>
</ul>
<p>session在访问tomcat服务器HttpServletRequest的getSession(true)的时候创建，tomcat的ManagerBase类提供创建sessionid的方法：随机数+时间+jvmid；</p>
<p>存储在服务器的内存中，tomcat的StandardManager类将session存储在内存中，也可以持久化到file，数据库，memcache，redis等。客户端只保存sessionid到cookie中，而不会保存session，session销毁只能通过invalidate或超时，关掉浏览器并不会关闭session。</p>
<ul>
<li>spring配置数据源</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@MapperScan</span>(basePackages = <span class="string">"com.yibaotong.pangu.api.server.dao.pg.config"</span>,sqlSessionTemplateRef = <span class="string">"sqlSessionTemplatePgConfig"</span>)</div><div class="line"><span class="meta">@EnableTransactionManagement</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSource4PgConfig</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span>(name = <span class="string">"dataSourcePgConfig"</span>)</div><div class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.pangu-config"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">panguCoreDataSource</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span>(name = <span class="string">"sqlSessionFactoryPgConfig"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">sqlSessionFactory4Config</span><span class="params">(@Qualifier(<span class="string">"dataSourcePgConfig"</span>)</span> DataSource dataSource) <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        SqlSessionFactoryBean sqlSessionFactoryBean = <span class="keyword">new</span> SqlSessionFactoryBean();</div><div class="line">        sqlSessionFactoryBean.setDataSource(dataSource);</div><div class="line">        sqlSessionFactoryBean.setVfs(SpringBootVFS.class);</div><div class="line">        PathMatchingResourcePatternResolver resolver = <span class="keyword">new</span> PathMatchingResourcePatternResolver();</div><div class="line">        sqlSessionFactoryBean.setConfigLocation(resolver.getResource(<span class="string">"classpath:conf/mybatis-configuration.xml"</span>));</div><div class="line">        sqlSessionFactoryBean.setMapperLocations(resolver.getResources(<span class="string">"classpath:conf/sqlxml/pg_config/*.xml"</span>));</div><div class="line">        sqlSessionFactoryBean.setTypeAliasesPackage(<span class="string">"com.yibaotong.pangu.common.work.DO"</span>);</div><div class="line">        <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span>(name = <span class="string">"txManagerPgConfig"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> DataSourceTransactionManager <span class="title">dataSourceTransactionManager4Config</span><span class="params">(@Qualifier(<span class="string">"dataSourcePgConfig"</span>)</span> DataSource dataSource) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span>(name = <span class="string">"sqlSessionTemplatePgConfig"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> SqlSessionTemplate <span class="title">sqlSessionTemplate4Config</span><span class="params">(@Qualifier(<span class="string">"sqlSessionFactoryPgConfig"</span>)</span> SqlSessionFactory sqlSessionFactory) <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>对时间进行处理的时候，或许可以先看看Apache中的<code>DateUtils</code>有没有相应的方法，如果没有，才自己去写。</li>
<li>前端问题，前端渲染二维码不显示，这里就需要把<code>canvas</code>标签改成<code>div</code>标签就行了。</li>
<li>eventSource后台推送不能适应集群的情况，只能是部署了单个实例。</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/12/10/2017/2017-11月工作笔记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/12/10/2017/2017-11月工作笔记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/11/10/2017/2017-10月工作笔记/" title="2017-10月工作笔记" itemprop="url">2017-10月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2017-11-10T02:41:06.000Z" itemprop="datePublished"> 发表于 2017-11-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <a id="more"></a>
<h2 id="10月9日-天气-晴"><a href="#10月9日-天气-晴" class="headerlink" title="10月9日 天气:晴"></a>10月9日 天气:晴</h2><ul>
<li>不要把map作为参数，放在任何接口当中，除了DAO层。</li>
<li>传递枚举就是传递字符串。</li>
</ul>
<h2 id="10月10日-天气-晴"><a href="#10月10日-天气-晴" class="headerlink" title="10月10日 天气:晴"></a>10月10日 天气:晴</h2><ul>
<li>mybatis找不到resultType的类时，就给一个全路径的类名</li>
<li>数据库的优化<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getByBelongKey"</span> <span class="attr">resultType</span>=<span class="string">"com.yibaotong.ms.exam.dto.SimpleExamDTO"</span>&gt;</span></div><div class="line">    SELECT a.id AS examId, b.question_num AS questionNum, b.title AS paperTitle, b.type_name AS paperTypeName</div><div class="line">    FROM exam AS a JOIN (SELECT id, type_name, title, question_num FROM exam_paper) AS b ON a.exam_paper_id = b.id</div><div class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND | OR"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"belongType != null"</span>&gt;</span></div><div class="line">            AND a.belong_type = #&#123;belongType&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"belongKey != null"</span>&gt;</span></div><div class="line">            AND a.belong_key = #&#123;belongKey&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        AND a.is_sys = 0</div><div class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></div><div class="line">    ORDER BY a.id DESC</div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="10月13日-天气-晴"><a href="#10月13日-天气-晴" class="headerlink" title="10月13日 天气:晴"></a>10月13日 天气:晴</h2><ul>
<li>使用wangEditor的自带上传的时候，需要指定上传文件的名字，不然会报400的错误。</li>
<li>使用项目已有的上传图片服务时，发现上传成功后返回的url是带有时间戳的，这个就意味着我的md5验证是没有用了。因为oss服务器那里并没有提供模糊查询文件是否存在的功能</li>
</ul>
<h2 id="10月14日-天气-晴"><a href="#10月14日-天气-晴" class="headerlink" title="10月14日 天气:晴"></a>10月14日 天气:晴</h2><ul>
<li>sql怎么将一个表的数据更新到另外一个表？</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">UPDATE</span> exam <span class="keyword">AS</span> a</div><div class="line"><span class="keyword">JOIN</span> exam_paper <span class="keyword">AS</span> b <span class="keyword">ON</span> a.exam_paper_id = b.id</div><div class="line"><span class="keyword">SET</span> a.is_del = b.is_del</div></pre></td></tr></table></figure>
<h2 id="10月16日-天气-雨"><a href="#10月16日-天气-雨" class="headerlink" title="10月16日 天气:雨"></a>10月16日 天气:雨</h2><ul>
<li>事务那里添加了readOnly注解的话，多次查询同一条数据库语句，是可以缓存。所以，有些情况就不要联表，分多次查询的效率更高</li>
</ul>
<h2 id="10月18日-天气-晴"><a href="#10月18日-天气-晴" class="headerlink" title="10月18日 天气:晴"></a>10月18日 天气:晴</h2><ul>
<li>开始着手设计推广员分组以及它的统计功能，要修改的东西还是很多</li>
<li>设计得差不多了，这里学习到一个统计的sql语句</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"promoteAmountRank"</span> <span class="attr">resultMap</span>=<span class="string">"data"</span>&gt;</span></div><div class="line">     SELECT t.promoter AS promoterId ,SUM(t.money) AS money FROM</div><div class="line">     (SELECT promoter_id AS promoter, SUM(amount) AS money FROM act_detail_click WHERE</div><div class="line">     <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"promoterIds"</span> <span class="attr">item</span>=<span class="string">"promoterId"</span> <span class="attr">open</span>=<span class="string">"promoter_id IN ("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">         #&#123;promoterId&#125;</div><div class="line">     <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"start != null"</span>&gt;</span></div><div class="line">         AND gmt_created &gt;= #&#123;start&#125;</div><div class="line">     <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"end != null"</span>&gt;</span></div><div class="line">         AND #&#123;end&#125; &gt; gmt_created</div><div class="line">     <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">     GROUP BY promoter_id</div><div class="line">     UNION</div><div class="line">     SELECT promoter_id AS promoter, SUM(amount) AS money FROM act_detail_share WHERE</div><div class="line">     <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"promoterIds"</span> <span class="attr">item</span>=<span class="string">"promoterId"</span> <span class="attr">open</span>=<span class="string">"promoter_id IN ("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">         #&#123;promoterId&#125;</div><div class="line">     <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"start != null"</span>&gt;</span></div><div class="line">         AND gmt_created &gt;= #&#123;start&#125;</div><div class="line">     <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"end != null"</span>&gt;</span></div><div class="line">         AND #&#123;end&#125; &gt; gmt_created</div><div class="line">     <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">     GROUP BY promoter_id</div><div class="line">     UNION</div><div class="line">     SELECT promoter_id AS promoter, SUM(total_promoter_price) AS money FROM order_info WHERE</div><div class="line">     <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"promoterIds"</span> <span class="attr">item</span>=<span class="string">"promoterId"</span> <span class="attr">open</span>=<span class="string">"promoter_id IN ("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">         #&#123;promoterId&#125;</div><div class="line">     <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line">     AND share_state = 3</div><div class="line">     <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"start != null"</span>&gt;</span></div><div class="line">         AND completed_time &gt;= #&#123;start&#125;</div><div class="line">     <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"end != null"</span>&gt;</span></div><div class="line">         AND #&#123;end&#125; &gt; completed_time</div><div class="line">     <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">     GROUP BY promoter_id) AS t</div><div class="line">     GROUP BY t.promoter</div><div class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>修改了配置文件，要重启？不能随便动，之前搞了一个多小时，就是因为格式乱了</li>
<li>数据库新增列语句</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">alter</span> <span class="keyword">table</span> contacts_tag <span class="keyword">add</span> leader_key <span class="built_in">bigint</span>(<span class="number">5</span>) <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="literal">null</span></div></pre></td></tr></table></figure>
<ul>
<li>能写到配置文件的就不要写死在代码里面。</li>
</ul>
<h2 id="10月21日-天气-晴"><a href="#10月21日-天气-晴" class="headerlink" title="10月21日 天气:晴"></a>10月21日 天气:晴</h2><ul>
<li>如果BO到DO的时候，DO有些值是要有默认值的，需要在DO指定默认值。如果BO的值为null，不要覆盖DO的初始值。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ContactsTagDO <span class="title">contactsTagToDb</span><span class="params">(ContactsTag contactsTag)</span> </span>&#123;</div><div class="line">     ContactsTagDO contactsTagDO = <span class="keyword">new</span> ContactsTagDO();</div><div class="line">     contactsTagDO.setTagId(contactsTag.getTagId());</div><div class="line">     contactsTagDO.setIdentityType(contactsTag.getIdentityType().getTag());</div><div class="line">     contactsTagDO.setIdentityKey(contactsTag.getIdentityKey());</div><div class="line">     contactsTagDO.setTagType(contactsTag.getTagType().getTag());</div><div class="line">     <span class="keyword">if</span> (contactsTag.getLeaderKey() != <span class="keyword">null</span>) &#123;</div><div class="line">         contactsTagDO.setLeaderKey(contactsTag.getLeaderKey());</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (contactsTag.getLeaderType() != <span class="keyword">null</span>) &#123;</div><div class="line">         contactsTagDO.setLeaderType(contactsTag.getLeaderType().getTag());</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (StringUtils.isNotBlank(contactsTag.getName())) &#123;</div><div class="line">         contactsTagDO.setName(contactsTag.getName());</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (StringUtils.isNotBlank(contactsTag.getRemark())) &#123;</div><div class="line">         contactsTagDO.setRemark(contactsTag.getRemark());</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     contactsTagDO.setSort(contactsTag.getSort());</div><div class="line">     <span class="keyword">return</span> contactsTagDO;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h2 id="10月23日-天气-晴"><a href="#10月23日-天气-晴" class="headerlink" title="10月23日 天气:晴"></a>10月23日 天气:晴</h2><ul>
<li>之前说的要处理用户名的问题，就是去查询user表，这是没错的。如果realName字段为空的时候，就去使用userName。</li>
</ul>
<h2 id="10月24日-天气-晴"><a href="#10月24日-天气-晴" class="headerlink" title="10月24日 天气:晴"></a>10月24日 天气:晴</h2><ul>
<li>拉代码的时候，如果发现有问题，先去合并dev分支。</li>
</ul>
<h2 id="10月25日-天气-晴"><a href="#10月25日-天气-晴" class="headerlink" title="10月25日 天气:晴"></a>10月25日 天气:晴</h2><ul>
<li>发现了那个不稳定的排序，必须要增加新的排序规则去让其稳定下来</li>
<li>发现排名可能有问题，主要的问题还是出现在分页那里。要是进行第二次查询的话，rank会被重置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getPromoterGroupDataInList"</span> <span class="attr">resultType</span>=<span class="string">"com.yibaotong.pangu.common.work.BO.statistics.PromoterGroupRankData"</span>&gt;</span></div><div class="line">        SELECT resultSet.* FROM</div><div class="line">        (</div><div class="line">        SELECT rankResult.*,  @rank := @rank + 1 AS rank</div><div class="line">        FROM (SELECT SUM(obj.count_num) AS countNum, obj.tag_id, obj.tag_name, obj.leader_key, obj.leader_type</div><div class="line">        FROM (SELECT * FROM statistics_promoter_group_daily</div><div class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND | OR"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"statisticsType != null"</span>&gt;</span></div><div class="line">                AND statistics_type = #&#123;statisticsType&#125;</div><div class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"start != null"</span>&gt;</span></div><div class="line">                AND gmt_created &gt;= #&#123;start&#125;</div><div class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"end != null"</span>&gt;</span></div><div class="line">                AND #&#123;end&#125; &gt; gmt_created</div><div class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"tagIds != null"</span>&gt;</span></div><div class="line">                AND tag_id IN</div><div class="line">                <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"tagIds"</span> <span class="attr">item</span>=<span class="string">"tagId"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">                    #&#123;tagId&#125;</div><div class="line">                <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></div><div class="line">        ) AS obj</div><div class="line">        GROUP BY tag_id</div><div class="line">        HAVING countNum &gt; 0</div><div class="line">        ORDER BY countNum DESC, tag_id) AS rankResult, (SELECT @rank :=0) r</div><div class="line">        ) AS resultSet WHERE resultSet.tag_id = #&#123;tagId&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>再仔细去想一想，那些统计固化下来的数据，是不是应该只有创建时间就好了，不需要更新时间这个字段.</li>
<li>统计的时候，过完一天，才去进行统计，这样就能确保不会遗漏了数据。即使你到23:59:59去统计，也还有1秒的误差。</li>
<li>不能使用gmtCreated这字段去表示时间，如果要确定统计数据属于哪一天，请新开一个字段去进行保存。</li>
</ul>
<h2 id="10月26日-天气-晴"><a href="#10月26日-天气-晴" class="headerlink" title="10月26日 天气:晴"></a>10月26日 天气:晴</h2><ul>
<li>今早回来，每天统计推广员分组成绩的逻辑生效了。发现的问题就是时间对不上，数据库时间和项目时间对不上。</li>
<li>记录一个时间转换的类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getTime</span><span class="params">(String dateStr)</span> </span>&#123;</div><div class="line">       DateTimeFormatter sf = DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm"</span>);</div><div class="line">       LocalDateTime time = LocalDateTime.parse(dateStr, sf);</div><div class="line">       ZoneId zoneId = ZoneId.systemDefault();</div><div class="line">       ZonedDateTime zdt = time.atZone(zoneId);</div><div class="line">       Date date = Date.from(zdt.toInstant());</div><div class="line">       <span class="keyword">return</span> date.getTime();</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<ul>
<li>上线到正式环境，发现了有一些接口调不通。后来排查发现是配置文件没有进行一定的修改。</li>
<li>新学习的一条sql</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> world.city) – <span class="keyword">count</span>(*) <span class="keyword">from</span> world.city <span class="keyword">where</span> <span class="keyword">id</span> &lt;= <span class="number">5</span></div></pre></td></tr></table></figure>
<h2 id="10月27日-天气-晴"><a href="#10月27日-天气-晴" class="headerlink" title="10月27日 天气:晴"></a>10月27日 天气:晴</h2><ul>
<li>怪不得统计不到数据，原来统计的加法用错了。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> BigDecimal <span class="title">getMoney</span><span class="params">(List&lt;PromoterRankData&gt; promoterRankDataList)</span> </span>&#123;</div><div class="line">       BigDecimal result = <span class="keyword">new</span> BigDecimal(<span class="number">0</span>);</div><div class="line">       <span class="keyword">for</span> (PromoterRankData promoterRankData : promoterRankDataList) &#123;</div><div class="line">           result = result.add(promoterRankData.getMoney());</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<ul>
<li>数据精度没有问题，只是mysql的decimal的显示问题。实际上是存了够两位小数的精度，但是显示的时候把0给去掉了。我存了“4.30”， 数据库那里也是“4.30”的，但是显示是“4.3”，查出来估计是4.30.Navicat的bug？经过测试，查出来的也是1位小数，我好气。我使用设置精度的方式，将精度再设置回去。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (promoteDataResult.isSuccess()) &#123;</div><div class="line">            BigDecimal money = promoteDataResult.getObject().getMoney();</div><div class="line">            money.setScale(<span class="number">2</span>, RoundingMode.HALF_UP);</div><div class="line">            model.setPromoteAmount(money);</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<ul>
<li>spring事务中的rollBackFor指定了是哪个异常或者其子类的时候才去执行回滚。不指定的话，默认就是有RunTimeException的时候执行回滚。</li>
<li>对只读事务的一些理解：从这一点设置的时间点开始（时间点a）到这个事务结束的过程中，其他事务所提交的数据，该事务将看不见！（查询中不会出现别人在时间点a之后提交的数据）</li>
<li>应用场合：</li>
</ul>
<p>如果你一次执行单条查询语句，则没有必要启用事务支持，数据库默认支持SQL执行期间的读一致性；<br>如果你一次执行多条查询语句，例如统计查询，报表查询，在这种场景下，多条查询SQL必须保证整体的读一致性，否则，在前条SQL查询之后，后条SQL查询之前，数据被其他用户改变，则该次整体的统计查询将会出现读数据不一致的状态，此时，应该启用事务支持。<br>【注意是一次执行多次查询来统计某些信息，这时为了保证数据整体的一致性，要用只读事务】</p>
<h2 id="10月28日-天气-晴"><a href="#10月28日-天气-晴" class="headerlink" title="10月28日 天气:晴"></a>10月28日 天气:晴</h2><ul>
<li>最怕线上有bug的了，今天的就是上传文件后缀的判断，我判断了小写，忘记判断大写。</li>
<li>继续出bug，插入视频的文章链接打不开，这个就是框架的问题了咯，avalon的坑，有些属性竟然解析不了，没办法，只能用jq去进行渲染。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//腾讯视频的通用链接，avalon可以解析</div><div class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"640"</span> <span class="attr">height</span>=<span class="string">"498"</span> <span class="attr">src</span>=<span class="string">"https://v.qq.com/iframe/player.html?vid=b00249eiunm&amp;tiny=0&amp;auto=0"</span> <span class="attr">allowfullscreen</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div><div class="line">//优酷的视频链接，avalon不能解析。怎么办呢？使用jq，不使用avalon去进行渲染咯</div><div class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">height</span>=<span class="string">498</span> <span class="attr">width</span>=<span class="string">510</span> <span class="attr">src</span>=<span class="string">'http://player.youku.com/embed/XMzExMjk4NTM2NA=='</span> <span class="attr">frameborder</span>=<span class="string">0</span> '<span class="attr">allowfullscreen</span>'&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/11/10/2017/2017-10月工作笔记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/11/10/2017/2017-10月工作笔记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/10/10/2017/2017-9月工作笔记/" title="2017-9月工作笔记" itemprop="url">2017-9月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2017-10-10T02:41:06.000Z" itemprop="datePublished"> 发表于 2017-10-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <a id="more"></a>
<h2 id="9月2日-天气-阴"><a href="#9月2日-天气-阴" class="headerlink" title="9月2日 天气:阴"></a>9月2日 天气:阴</h2><ul>
<li>一开始的问题就是新项目部署，代码没有合并导致不能使用，排查了n久，过。</li>
<li>系统里面存在着普通用户，在店铺注册的时候，需要去对这类用户开放注册的权限</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h2 id="9月6日-天气-雨"><a href="#9月6日-天气-雨" class="headerlink" title="9月6日 天气:雨"></a>9月6日 天气:雨</h2><ul>
<li>踩坑了啊，我这边一直渲染不上去，原来是数据初始化出现了问题。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> vm = avalon.define(&#123;</div><div class="line">               <span class="attr">$id</span>: <span class="string">"answer"</span>,  <span class="comment">//vm</span></div><div class="line">               questionList: [],<span class="comment">//问题list</span></div><div class="line">               examName: <span class="string">"$&#123;examName&#125;"</span>, <span class="comment">//考试名称,这样就是把数据给初始化完毕了，后面挺难改动的</span></div><div class="line">               questionNum: <span class="string">''</span>, <span class="comment">//试题数目</span></div><div class="line">               examUserHistoryId: examUserHistoryId, <span class="comment">//考试记录id</span></div><div class="line">               userId: userId,</div><div class="line">               <span class="attr">examId</span>: examId,</div><div class="line">               <span class="attr">answerNum</span>: answerNum,<span class="comment">//已经作答的题目数量</span></div><div class="line">               answerSheet: [], <span class="comment">//自己的答案</span></div><div class="line">               curPage: <span class="string">'1'</span>,</div><div class="line">               <span class="attr">curQuestion</span>: <span class="number">0</span>,</div><div class="line">               <span class="attr">lastPosition</span>: <span class="number">0</span>,</div><div class="line">             &#125;)</div></pre></td></tr></table></figure>
<h2 id="9月7日-天气-雨"><a href="#9月7日-天气-雨" class="headerlink" title="9月7日 天气:雨"></a>9月7日 天气:雨</h2><ul>
<li>不要去搞神马外键，那个是级联的更新。所有的外键，应该自己在应用层弄表的关联</li>
<li>前端使用windom.open去打开新的窗口，渲染新的页面。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">createOrEditPaper: <span class="function"><span class="keyword">function</span> (<span class="params">examPaperId</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> redirectUtl = <span class="string">'exams/paper/design'</span>;</div><div class="line">                <span class="comment">//携带id跳转到试卷页面</span></div><div class="line">                <span class="built_in">window</span>.open(basePath + redirectUtl + <span class="string">"?examPaperId="</span> + <span class="number">1</span>);</div><div class="line">            &#125;,</div></pre></td></tr></table></figure>
<h2 id="9月8日-天气-阴"><a href="#9月8日-天气-阴" class="headerlink" title="9月8日 天气:阴"></a>9月8日 天气:阴</h2><ul>
<li>短信问题踩坑，不是根据id去匹配，要的是根据整个内容的匹配度达到60%以上，就行了。</li>
</ul>
<h2 id="9月11日-天气-阴"><a href="#9月11日-天气-阴" class="headerlink" title="9月11日 天气:阴"></a>9月11日 天气:阴</h2><ul>
<li>之前也是一直困扰我的问题，就是如何去控制元素的显示或者隐藏？使用了avalon以后，看到了这个ms-visiable标签，还支持表达式。瞬间就兴起了</li>
</ul>
<h2 id="9月12日-天气-晴"><a href="#9月12日-天气-晴" class="headerlink" title="9月12日 天气:晴"></a>9月12日 天气:晴</h2><ul>
<li>使用avalon编写一个过滤器。avalon默认会把用户的数据当做第一个参数来使用。</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//自己手动传递的，只有第二和第三个参数</div><div class="line">&lt;div&gt;&#123;&#123;@aaa | truncate(10, '...')&#125;&#125;&lt;/div&gt;</div><div class="line"></div><div class="line">avalon.filters.truncate = function (str, length, truncation) &#123;</div><div class="line">    //length，新字符串长度，truncation，新字符串的结尾的字段,返回新字符串</div><div class="line">    length = length || 30</div><div class="line">    truncation = typeof truncation === "string" ? truncation : "..."</div><div class="line">    return str.length &gt; length ?</div><div class="line">            str.slice(0, length - truncation.length) + truncation :</div><div class="line">            String(str)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>maven引入jar包的另外一种写法，把版本号抽离出来，方便管理。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">commons-lang3.version</span>&gt;</span>3.4<span class="tag">&lt;/<span class="name">commons-lang3.version</span>&gt;</span></div><div class="line">       ...</div><div class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 然后在依赖那里引用版本 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-lang3.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>springmav向spring boot转移。把web.xml中的所有bean，在java的@Configuration注解下面，一个一个写成bean。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//xml向java转化</span></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line">  * &lt;bean class="org.springframework.web.servlet.view.InternalResourceViewResolver" p:prefix="/jsp/" p:suffix=".jsp"/&gt;</div><div class="line">  *</div><div class="line">  * <span class="doctag">@return</span></div><div class="line">  */</div><div class="line"> <span class="meta">@Bean</span></div><div class="line"> <span class="function"><span class="keyword">public</span> ViewResolver <span class="title">viewResolver</span><span class="params">()</span> </span>&#123;</div><div class="line">     InternalResourceViewResolver resolver = <span class="keyword">new</span> InternalResourceViewResolver();</div><div class="line">     resolver.setPrefix(<span class="string">"/jsp/"</span>);</div><div class="line">     resolver.setSuffix(<span class="string">".jsp"</span>);</div><div class="line">     resolver.setExposeContextBeansAsAttributes(<span class="keyword">true</span>);</div><div class="line">     <span class="keyword">return</span> resolver;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">/**</span></div><div class="line">     * &lt;!--异常处理--&gt;</div><div class="line">     * &lt;bean id="exceptionHandler" class="cn.zhubaoyi.api.web.handler.SysExceptionHandler"/&gt;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="meta">@Bean</span>(name = <span class="string">"exceptionHandler"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> SysExceptionHandler <span class="title">exceptionHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SysExceptionHandler();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>带有微服务的spring boot启动类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EnableFeignClients</span>(basePackages = <span class="string">"com.yibaotong.pangu.pc.server.ms"</span>)</div><div class="line"><span class="meta">@EnableDiscoveryClient</span></div><div class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;<span class="string">"com.yibaotong.pangu.pc"</span>, <span class="string">"com.yibaotong.pangu.cache"</span>, <span class="string">"com.yibaotong.pangu.service"</span>,</div><div class="line">        <span class="string">"com.yibaotong.commons.cache.component"</span>, <span class="string">"com.yibaotong.commons.service"</span>&#125;)</div><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="meta">@EnableAspectJAutoProxy</span>(proxyTargetClass = <span class="keyword">true</span>,exposeProxy = <span class="keyword">true</span>)</div><div class="line"><span class="meta">@EnableScheduling</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder builder)</span> </span>&#123;</div><div class="line">        <span class="comment">// 注意这里要指向原先用main方法执行的Application启动类</span></div><div class="line">        <span class="keyword">return</span> builder.sources(Application.class);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        SpringApplication.run(Application.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="9月13日-天气-阴"><a href="#9月13日-天气-阴" class="headerlink" title="9月13日 天气:阴"></a>9月13日 天气:阴</h2><ul>
<li>困扰了多天的问题，短信发不出去就是因为模板没有同步到正式环境。以后遇到两个环境不同表现的时候，先要去检查各自的配置有什么不同</li>
</ul>
<h2 id="9月14日-天气-晴"><a href="#9月14日-天气-晴" class="headerlink" title="9月14日 天气:晴"></a>9月14日 天气:晴</h2><ul>
<li>紧急修复了类型多个新增的问题.每次新增都会新增类型，我在后台做了去重。</li>
<li>自己动手引入了微服务，增加了feign的这个jar包，启动的application就增加相应的注解。</li>
<li>@MapperScan 注解是mybatis的注解，设置扫描mybatis的mapper包路径。</li>
</ul>
<h2 id="9月15日-天气-晴"><a href="#9月15日-天气-晴" class="headerlink" title="9月15日 天气:晴"></a>9月15日 天气:晴</h2><ul>
<li>自己的事情还是自己做，丑就丑把，好过用户二次点击保存。我加上蒙版，屏蔽了所有交互。</li>
<li>页面扫码：接口给出一个uuid，移动端扫描得到这个uuid，然后填写信息提交到后台登录接口。后台先验证uuid，如果uuid通过，再去进行登录。登录成功以后，返回结果给移动端。那前端怎么办？前端就自己设置一个定时器，定时去轮询这个uuid有没有被登录成功。如果登录成功，后台重定向到登录成功后的页面。</li>
<li>页面二维码扫码登录，是页面每隔一定时间（3秒）去轮询一个接口。登录成功以后，进行跳转，其实就是reload，后台根据是否登录成功，进行重定向到页面。</li>
<li>页面的filePath，basePath这些，都是从session中拿到的。每次进行页面请求的时候，使用一个初始化过滤器，去session那里注入这两个attribute。</li>
<li>还有的就是登录过滤器，也需要判断某个页面是否要登录，这个主要就是去session去拿登录信息，如果session中没有，就拒绝通过。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//我只是关注，这里可以获得方法中的注解</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">requiredAuth</span><span class="params">(HandlerMethod handlerMethod)</span> </span>&#123;</div><div class="line">       Authorization methodAnnotation = handlerMethod.getMethodAnnotation(Authorization.class);</div><div class="line">       <span class="keyword">if</span> (methodAnnotation != <span class="keyword">null</span>) &#123;</div><div class="line">           <span class="keyword">return</span> methodAnnotation.required();</div><div class="line">       &#125;</div><div class="line">       Authorization classAnnotation = handlerMethod.getBeanType().getAnnotation(Authorization.class);</div><div class="line">       <span class="keyword">if</span> (classAnnotation != <span class="keyword">null</span>) &#123;</div><div class="line">           <span class="keyword">return</span> classAnnotation.required();</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<ul>
<li>给方法注入一些信息。从session中获得登录信息，然后通过注解，注入到方法的变量中。类似这种接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/paper/design"</span>, method = RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toDesignPage</span><span class="params">(@RequestParam(value = <span class="string">"examPaperId"</span>, required = <span class="keyword">false</span>, defaultValue = <span class="string">"0"</span>)</span> <span class="keyword">long</span> examPaperId, Model model,</span></div><div class="line">                                   @CurrentAuthentication AuthenticationInfo authenticationInfo)</div></pre></td></tr></table></figure>
<ul>
<li>现在说一下那个答题时长的问题，可以把试卷存储在session那里，进入答题页面的时候，session设置一个startTime的值，结束时间就是点击提交按钮的那个时间。点击结束按钮，就获取答题结束的时间戳。然后把这两个时间提交到后台。HttpSession目前是能够存储LocalDateTime的</li>
</ul>
<h2 id="9月16日-天气-晴"><a href="#9月16日-天气-晴" class="headerlink" title="9月16日 天气:晴"></a>9月16日 天气:晴</h2><ul>
<li>软删除的时候，请求方法可以使用patch。</li>
<li>搜索的优化，可以是每一秒就自动搜一下，这样频度就不会太高，服务器压力不会太大。搜索内容，去掉空格。</li>
<li>异步的方法要放到controller？发邮件，短信，推送消息这些，需要使用异步方法。</li>
<li>@RequestMapping那里，请求方法是可以给出多个的。比如get和patch共存。</li>
<li>微服务传递的数据类型，也是可以直接传递枚举过去的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//使用@RequesParam这个注解即可，不是使用@RequestBody</span></div><div class="line"><span class="function">Result&lt;OsOperatorAccount&gt; <span class="title">getByUserId</span><span class="params">(@RequestParam(value = <span class="string">"terminalType"</span>)</span> SysEnum.TerminalType terminalType,</span></div><div class="line">                                          @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"userId"</span>)</span> <span class="keyword">long</span> userId)</div></pre></td></tr></table></figure>
<ul>
<li>点击全部试卷的时候，清空搜索框内容</li>
</ul>
<h2 id="9月17日-天气-晴"><a href="#9月17日-天气-晴" class="headerlink" title="9月17日 天气:晴"></a>9月17日 天气:晴</h2><ul>
<li>自己无故，还是不要去改别人的代码。改了，还要进行测试。</li>
</ul>
<h2 id="9月18日-天气-晴"><a href="#9月18日-天气-晴" class="headerlink" title="9月18日 天气:晴"></a>9月18日 天气:晴</h2><ul>
<li>如果参数不加东西，那么就是body类型，但是post请求当中，只有一个body内容，多个参数不加@RequestParam注解的话，就会报错。</li>
<li>应对大量突发访问类的问题，可以有3种优化思路：写入内存而不是写入硬盘；异步处理而不是同步处理；分布式处理</li>
<li>跨界一下，写php代码，但是思路是一样的</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//基础数据的生成</span></div><div class="line">$num = <span class="number">10</span>;<span class="comment">//实际的库存</span></div><div class="line">$len = Redis::llen(<span class="string">'goods_store:1'</span>);<span class="comment">//检查库存</span></div><div class="line">$count = $num - $len;<span class="comment">//剩余可用库存</span></div><div class="line"><span class="keyword">for</span>($i = <span class="number">0</span> ; $i &lt; $count ; $i ++) &#123;</div><div class="line">  Redis::lpush(<span class="string">'goods_store:1'</span>, <span class="number">1</span>); <span class="comment">//初始化未抢购的库存</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>抢购的时间到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这个还是会出现问题，一个用户可能可以抢购多个，是否可以再加多一个排队队列</span></div><div class="line">$user_id = Session::get(<span class="string">'user_id'</span>);</div><div class="line">$queResult = Redis::lpush(<span class="string">'user_queue:1'</span>, $user_id);</div><div class="line"><span class="keyword">new</span> Thread(&#123;</div><div class="line">  $successResult = Redis::lpop(<span class="string">'$user_id'</span>);</div><div class="line">  <span class="keyword">if</span> ($successResult) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'你已经购买过了'</span>;</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line">$count = Redis::lpop(<span class="string">'goods_store:1'</span>);</div><div class="line"><span class="keyword">if</span> (!$count) &#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'已经抢光了哦'</span>;</div><div class="line">&#125;</div><div class="line">$result = Redis::lpush(<span class="string">'order:1'</span>, $user_id);</div><div class="line"><span class="comment">//下面处理抢购成功的流程，开启新的线程</span></div><div class="line">DB::table(<span class="string">'goods'</span>)-&gt;decrement(<span class="string">'num'</span>, <span class="number">1</span>);</div></pre></td></tr></table></figure>
<ul>
<li>下面学习一下Redis的锁</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisLock</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> lock = <span class="keyword">false</span>;</div><div class="line">  <span class="keyword">private</span> String key;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOCKED = <span class="string">"lock"</span>;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span> <span class="params">(<span class="keyword">long</span> timeout, <span class="keyword">long</span> expire)</span> </span>&#123;</div><div class="line">    <span class="keyword">long</span> time = System.nanoTime();</div><div class="line">    timeout * = MILL_NANO_TIME;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      <span class="keyword">while</span>(System.nanoTime() - nanoTime &lt; timeout) &#123;</div><div class="line">        <span class="keyword">if</span> (redisClient.setnx(key, LOCKED) == <span class="number">1</span>) &#123;</div><div class="line">          redisClient.expire(key, expire);</div><div class="line">          <span class="keyword">this</span>.lock = <span class="keyword">true</span>;</div><div class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.lock;</div><div class="line">        &#125;</div><div class="line">        System.out.println(<span class="string">"出现锁等待"</span>);</div><div class="line">        Thread.sleep(<span class="number">3</span>, RANDOM.nextInt(<span class="number">30</span>));</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">catch</span>(Exception e) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"locking error"</span>, e);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span>&#123;</div><div class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.lock) &#123;</div><div class="line">        redisClient.delKey(key);</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">catch</span>(Throwable e) &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>jq语法学习</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//将创建好的节点添加到body</span></div><div class="line">$(<span class="string">"&lt;div&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;/div&gt;"</span>).appendTo(<span class="string">'body'</span>);</div><div class="line"></div><div class="line">$(<span class="string">"&lt;div&gt;"</span>, &#123;</div><div class="line">  <span class="string">"class"</span>: <span class="string">"test"</span>,</div><div class="line">  <span class="attr">text</span>: <span class="string">"Click me!"</span>,</div><div class="line">  <span class="attr">click</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    $(<span class="keyword">this</span>).toggleClass(<span class="string">"test"</span>);</div><div class="line">  &#125;</div><div class="line">&#125;).appendTo(<span class="string">"body"</span>);</div><div class="line"></div><div class="line"><span class="comment">//文档渲染完毕之后</span></div><div class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//可以使用return false来跳出循环</span></div><div class="line">$(<span class="string">"img"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.src = <span class="string">"test"</span> + i + <span class="string">".jpg"</span>;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//结果</span></div><div class="line">&lt;img src=<span class="string">"test0.jpg"</span>/&gt;<span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"test1.jpg"</span>/&gt;</span></span></div><div class="line"></div><div class="line">$("div:contains('John')") //查找包含‘John’的div</div></pre></td></tr></table></figure>
<h2 id="9月21日-天气-晴"><a href="#9月21日-天气-晴" class="headerlink" title="9月21日 天气:晴"></a>9月21日 天气:晴</h2><ul>
<li>net::ERR_CONNECTION_RESET 问题排查，是后台限制了传输的大小，改小一点就好了。</li>
<li>上传图片那里，选择同步上传，不需要点击按钮进行上传了。</li>
</ul>
<h2 id="9月22日-天气-晴"><a href="#9月22日-天气-晴" class="headerlink" title="9月22日 天气:晴"></a>9月22日 天气:晴</h2><ul>
<li>LocalDateTime的日期格式化方式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LocalDateTime.now().format(DateTimeFormatter.ofPattern(<span class="string">"yyyyMMdd"</span>));</div></pre></td></tr></table></figure>
<ul>
<li>jq学习</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//为dom设置多个属性</span></div><div class="line">$(<span class="string">"img"</span>).attr(&#123; <span class="attr">src</span>: <span class="string">"test.jpg"</span>, <span class="attr">alt</span>: <span class="string">"Test Image"</span> &#125;);</div><div class="line"></div><div class="line"><span class="comment">//禁用页面上的所有复选框</span></div><div class="line">$(<span class="string">"input[type='checkbox']"</span>).prop(&#123;</div><div class="line">  <span class="attr">disabled</span>: <span class="literal">true</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</div><div class="line">$(<span class="string">"p"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  $(<span class="keyword">this</span>).toggleClass(<span class="string">"highlight"</span>, count++ %<span class="number">3</span> == <span class="number">0</span>);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<ul>
<li>安卓补充</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//webview获取js的函数返回值</span></div><div class="line">webview.evaluateJavascript(<span class="string">"javascript:getDeviceID()"</span>, <span class="keyword">new</span> ValueCallback&lt;String&gt;() &#123;</div><div class="line">                   <span class="meta">@Override</span></div><div class="line">                   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceiveValue</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">                       Log.d(<span class="string">"zzp"</span>, <span class="string">"--s--="</span> + s);</div><div class="line">                   &#125;</div><div class="line">               &#125;);</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">$("p").unwrap();</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span>Goodbye<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">$(".inner").wrapInner(function() &#123;</div><div class="line">  return '<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"' + $(this).text() + '"</span> /&gt;</span>';</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 对内层进行包裹 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"Hello"</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"Goodbye"</span>&gt;</span>Goodbye<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 对立面的内容进行清空 --&gt;</span></div><div class="line">$(".inner").empty();</div></pre></td></tr></table></figure>
<ul>
<li>bug的修复之重复创建问题，我能够新建试卷以后返回新的试卷id，偏偏忘记了也要返回问题的id列表，导致了问题多次被创建。解决办法就是返回问题id，然后前端对问题的id进行刷新。</li>
</ul>
<h2 id="9月23日-天气-晴"><a href="#9月23日-天气-晴" class="headerlink" title="9月23日 天气:晴"></a>9月23日 天气:晴</h2><ul>
<li>之前使用表达式去做试卷答案的展示，并不能解决多选问题的显示，所以，这里我选用了另外一种方式去实现这个功能，下面是代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">  * 获取答案展示的选项,从jsonObject转换成为jsonArray</div><div class="line">  * sourceOptionObject</div><div class="line">  * status说明： 0 空白 1 正确但未选 2 选择正确 3 选择错误</div><div class="line">  * 一层一层往上去叠加</div><div class="line">  */</div><div class="line">  getShowOptionList: <span class="function"><span class="keyword">function</span> (<span class="params">sourceOptionObject, myAnswer, answerSet</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> optionList = [];</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> sourceOptionObject) &#123;</div><div class="line">          <span class="keyword">var</span> option = &#123;&#125;;</div><div class="line">          option.optionKey = key;</div><div class="line">          option.optionValue = sourceOptionObject[key];</div><div class="line">          option.status = <span class="number">0</span>;<span class="comment">//默认给个0</span></div><div class="line">          <span class="comment">//处理正确答案</span></div><div class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; answerSet.length ; i ++) &#123;</div><div class="line">              <span class="keyword">if</span> (answerSet[i] == key) &#123;</div><div class="line">                  option.status = <span class="number">1</span>;<span class="comment">//把正确答案钉上去</span></div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">          <span class="comment">//处理我的答案</span></div><div class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span> ; j &lt; myAnswer.length ; j ++) &#123;</div><div class="line">              <span class="keyword">if</span> (key == myAnswer[j] &amp;&amp; option.status == <span class="number">1</span>) &#123;</div><div class="line">                  option.status = <span class="number">2</span>;<span class="comment">//正确</span></div><div class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key == myAnswer[j] &amp;&amp; option.status == <span class="number">0</span>) &#123;</div><div class="line">                  option.status = <span class="number">3</span>;<span class="comment">//错误</span></div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">          optionList.push(option);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> optionList;</div><div class="line">  &#125;,</div></pre></td></tr></table></figure>
<p>以后就只要使用如下的前端代码去展示即可，无需再做多一套</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-for</span>=<span class="string">"(option) in el.newOptionList"</span> <span class="attr">class</span>=<span class="string">"answer-option"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"flex-row"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">%--</span> 错误选项 <span class="attr">--</span>%&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-if</span>=<span class="string">"option.status == 3"</span> <span class="attr">class</span>=<span class="string">"answer-option-icon icon-answer-false"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">%--自选正确选项--%</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-if</span>=<span class="string">"option.status == 2"</span> <span class="attr">class</span>=<span class="string">"answer-option-icon icon-answer-true"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">%--未选正确答案--%</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-if</span>=<span class="string">"option.status == 1"</span> <span class="attr">class</span>=<span class="string">"answer-option-icon selected"</span>&gt;</span>&#123;&#123;option.optionKey&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">%--空白未选选项--%</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-if</span>=<span class="string">"option.status == 0"</span> <span class="attr">class</span>=<span class="string">"answer-option-icon"</span>&gt;</span>&#123;&#123;option.optionKey&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"flex-data"</span>&gt;</span>&#123;&#123;option.optionValue&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="9月27日-天气-晴"><a href="#9月27日-天气-晴" class="headerlink" title="9月27日 天气:晴"></a>9月27日 天气:晴</h2><ul>
<li>事务里面，调用的方法不能加异步？</li>
<li>这个是异步方法的返回值，不能是有返回值</li>
</ul>
<h2 id="9月28日-天气-晴"><a href="#9月28日-天气-晴" class="headerlink" title="9月28日 天气:晴"></a>9月28日 天气:晴</h2><ul>
<li>myBatis的查询参数，基本类型最好是使用封装类型。</li>
</ul>
<h2 id="9月30日-天气-晴"><a href="#9月30日-天气-晴" class="headerlink" title="9月30日 天气:晴"></a>9月30日 天气:晴</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> getUserInfo = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line">  $.ajax(&#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">"get"</span>,</div><div class="line">    <span class="attr">url</span>: <span class="string">"www.baidu.com"</span>,</div><div class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (data.success) &#123;</div><div class="line">        resolve(data.result);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        reject(data.errMsg);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> getDataList = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line">  $.ajax(&#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">"get"</span>,</div><div class="line">    <span class="attr">url</span>: <span class="string">"www.google.com"</span>,</div><div class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (data.success) &#123;</div><div class="line">        resolve(data.result);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        reject(data.errMsg);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">getUserInfo.then(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</div><div class="line"></div><div class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">errMsg</span>) </span>&#123;</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//等待两个接口都返回数据以后才执行</span></div><div class="line"><span class="built_in">Promise</span>.all([getUserInfo, getDataList]).then(<span class="function"><span class="keyword">function</span>(<span class="params">[json1, json2]</span>)</span>&#123;</div><div class="line"></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<ul>
<li>放弃wangEditor自带的图片上传功能，选择图片以后，将图片交给webUploader。但是，坑爹的官网并没有教你怎么接收文件，那些教程只是教你怎么使用picker去选择文件。做法就是查看源码，从picker入手，看啊看啊，发现了第1919行的猫腻</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">$( pick.id ).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> options, picker, deferred;</div><div class="line"></div><div class="line">                deferred = Base.Deferred();</div><div class="line"></div><div class="line">                options = $.extend(&#123;&#125;, pick, &#123;</div><div class="line">                    <span class="attr">accept</span>: $.isPlainObject( accept ) ? [ accept ] : accept,</div><div class="line">                    <span class="attr">swf</span>: opts.swf,</div><div class="line">                    <span class="attr">runtimeOrder</span>: opts.runtimeOrder,</div><div class="line">                    <span class="attr">id</span>: <span class="keyword">this</span></div><div class="line">                &#125;);</div><div class="line"></div><div class="line">                picker = <span class="keyword">new</span> FilePicker( options );</div><div class="line"></div><div class="line">                picker.once( <span class="string">'ready'</span>, deferred.resolve );</div><div class="line">                picker.on( <span class="string">'select'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> files </span>) </span>&#123;</div><div class="line">                    me.owner.request( <span class="string">'add-file'</span>, [ files ]);</div><div class="line">                &#125;);</div><div class="line">                picker.init();</div><div class="line"></div><div class="line">                me.pickers.push( picker );</div><div class="line"></div><div class="line">                promises.push( deferred.promise() );</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">            <span class="keyword">return</span> Base.when.apply( Base, promises );</div><div class="line">        &#125;,</div></pre></td></tr></table></figure>
<p>问题来了，owner是谁？我怎么在外部调用。断点了一下，发现owner就是uploader本身。然后总结出使用代码就是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">imgUploader.request(<span class="string">'add-file'</span>, files[<span class="number">0</span>]);</div></pre></td></tr></table></figure>
<p>添加文件成功了，现在还有一个问题，就是上传完成以后，我怎么将图片插入到编辑器？这个又要去看源码，这次看源码的难度就大了一点。寻找到源码以后，拷贝过来试试</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 根据链接插入图片</span></div><div class="line">insertLinkImg: <span class="function"><span class="keyword">function</span> <span class="title">insertLinkImg</span>(<span class="params">link</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> _this2 = <span class="keyword">this</span>;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!link) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> editor = <span class="keyword">this</span>.editor;</div><div class="line">    editor.cmd.do(<span class="string">'insertHTML'</span>, <span class="string">'&lt;img src="'</span> + link + <span class="string">'" style="max-width:100%;"/&gt;'</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 验证图片 url 是否有效，无效的话给出提示</span></div><div class="line">    <span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</div><div class="line">    img.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        img = <span class="literal">null</span>;</div><div class="line">    &#125;;</div><div class="line">    img.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        img = <span class="literal">null</span>;</div><div class="line">        <span class="comment">// 无法成功下载图片</span></div><div class="line">        _this2._alert(<span class="string">'插入图片错误'</span>, <span class="string">'wangEditor: \u63D2\u5165\u56FE\u7247\u51FA\u9519\uFF0C\u56FE\u7247\u94FE\u63A5\u662F "'</span> + link + <span class="string">'"\uFF0C\u4E0B\u8F7D\u8BE5\u94FE\u63A5\u5931\u8D25'</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;;</div><div class="line">    img.onabort = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        img = <span class="literal">null</span>;</div><div class="line">    &#125;;</div><div class="line">    img.src = link;</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>直接在页面上使用，就失败了，一筹莫展，但是我记住了cmd.do这个命令。某次断点的时候，发现editor对象里面有cmd，又总结出了使用方法，完成这个上传功能的修改。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">editor.cmd.do(<span class="string">'insertHTML'</span>, <span class="string">'&lt;img src="'</span> + link + <span class="string">'" style="max-width:100%;"/&gt;'</span>);</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/10/10/2017/2017-9月工作笔记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/10/10/2017/2017-9月工作笔记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/08/10/2017/2017-8月工作笔记/" title="2017-8月工作笔记" itemprop="url">2017-8月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2017-08-10T02:41:06.000Z" itemprop="datePublished"> 发表于 2017-08-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>一路前行<br>
        
        
        <p class="article-more-link">
          
            <a href="/2017/08/10/2017/2017-8月工作笔记/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/life/">life</a><a href="/tags/feuture/">feuture</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/08/10/2017/2017-8月工作笔记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/08/10/2017/2017-8月工作笔记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/04/10/2017/2017-3月工作笔记/" title="2017-3月工作笔记" itemprop="url">2017-3月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2017-04-10T02:41:06.000Z" itemprop="datePublished"> 发表于 2017-04-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <a id="more"></a>
<h2 id="3月1日-天气-晴"><a href="#3月1日-天气-晴" class="headerlink" title="3月1日 天气:晴"></a>3月1日 天气:晴</h2><p>想接手去继续搞一下web的项目，但是好像还是搞不定，明天继续加油。<br>今天的工作，主要就是要去删除界面的信息，但是我对html的界面不熟悉，做起来还是磕磕碰碰的。<br>js操作html，以及回调的时候处理逻辑，都要通通熟悉，才能做好界面的处理。<br>上代码，目前初步去做删除的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function">function <span class="title">image_close</span><span class="params">()</span> </span>&#123;</div><div class="line">    $(<span class="string">".img_colse"</span>).on(<span class="string">"click"</span>,function()&#123;</div><div class="line">        var object = $(<span class="keyword">this</span>);</div><div class="line">        layer.confirm(<span class="string">"是否要删除当前文件?"</span>,</div><div class="line">            function () &#123;</div><div class="line">                var parentId = object.parent().attr(<span class="string">"id"</span>);</div><div class="line">                var box = object.parents(<span class="string">".attachDiv"</span>);</div><div class="line">                <span class="comment">//处理身份证</span></div><div class="line">                <span class="keyword">if</span> (parentId == <span class="string">"idCardPict"</span>)&#123;</div><div class="line">                    vmAppRegisterIndex.formParam.idcardUrl = <span class="string">''</span>;</div><div class="line">                    <span class="comment">//清除attchDiv里面的代码</span></div><div class="line">                    box.html(<span class="string">""</span>);</div><div class="line">                    box.next().show();</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//处理附件</span></div><div class="line">                <span class="keyword">if</span> (parentId == <span class="string">"attrPict"</span>)&#123;</div><div class="line">                    var imageSrc = box.find(<span class="string">"img"</span>).attr(<span class="string">"src"</span>);</div><div class="line">                    vmAppRegisterIndex.attrUploadify.forEach(function (el, index) &#123;</div><div class="line">                        <span class="comment">//删除节点</span></div><div class="line">                        <span class="keyword">if</span>(imageSrc == el.url) &#123;</div><div class="line">                            vmAppRegisterIndex.attrUploadify.splice(index, <span class="number">1</span>);</div><div class="line">                            box.hide();</div><div class="line">                            box.next().show();</div><div class="line">                            <span class="keyword">return</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;);</div><div class="line">                &#125;</div><div class="line">                layer.closeAll();</div><div class="line">            &#125;</div><div class="line">        );</div><div class="line">    &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="3月2日-天气-晴"><a href="#3月2日-天气-晴" class="headerlink" title="3月2日 天气:晴"></a>3月2日 天气:晴</h2><p>到了今天，不止怎么的，状态貌似就好起来了。我的思路从隐藏节点到删除节点，好像得到了一点解决。<br>但是，解决了删除，上传又出问题了，我去。<br>上传的话，有一个属性写得有问题。不用这个属性，就是那个属性有问题。</p>
<h2 id="3月3日-天气-晴"><a href="#3月3日-天气-晴" class="headerlink" title="3月3日 天气:晴"></a>3月3日 天气:晴</h2><p>关于页面要隐藏控件，avalon是可以有if语句进行判断的，例如一个图片显示逻辑，在url为空的时候进行隐藏。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ms-<span class="keyword">if</span> = <span class="string">"判断条件"</span></div></pre></td></tr></table></figure>
<p>数据接收问题，页面要写上相应的字段去接收.</p>
<h2 id="3月6日-天气-阴"><a href="#3月6日-天气-阴" class="headerlink" title="3月6日 天气:阴"></a>3月6日 天气:阴</h2><p>修改项目的小bug,比如数据获取不对，ui修改有问题-删除加弹框。</p>
<h2 id="3月7日-天气-阴"><a href="#3月7日-天气-阴" class="headerlink" title="3月7日 天气:阴"></a>3月7日 天气:阴</h2><p>修改批量导入excel中，所有数据的约束更加严谨，不是允许的字段，一律不通过，并且提示相应的字段。<br>修改边栏，不让它具备点击功能了，只是变成指示器的功能。<br>确认的时候，添加必填字段，比如身份证必填，不然不能通过验证。</p>
<p>重点还是说回RN吧。学习到了一点Animted的用法，用于做出一个listview的item。点击就展开隐藏内容。里面的隐藏内容的话，我是用于去展示隐藏的天气信息，隐藏的内容，实际上就是ios那天气的底部信息差不多。<br>我好像在android工程目录下面，发现了好多本地模块。以后要开发针对android的特定功能的时候，先去查询非死不可有没有帮我们实现这玩意。</p>
<h2 id="3月8日-天气-阴"><a href="#3月8日-天气-阴" class="headerlink" title="3月8日 天气:阴"></a>3月8日 天气:阴</h2><ul>
<li>λ表达式主要用于替换以前广泛使用的内部匿名类，各种回调，比如事件响应器、传入Thread类的Runnable<br>说一下今天学习到的lambda表达式内容。之前有了解过匿名函数的使用，今天来看一个更新的用法，如何快速生成<code>interface</code>的实例；<br>首先，得有几个类：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Parent</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.age = age;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSome</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Boy</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Boy</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(name, age);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSome</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"I am a Boy"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Girl</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Girl</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(name, age);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSome</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"I am a girl"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来是普通的工厂类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Factory</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Parent</span>&gt; </span>&#123;</div><div class="line">    <span class="function">T <span class="title">create</span><span class="params">(String name, <span class="keyword">int</span> age)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后就是，比较两者的区别</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</div><div class="line">        Factory&lt;Boy&gt; factory = <span class="keyword">new</span> Factory&lt;Boy&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Boy <span class="title">create</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Boy(name, age);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">//只要一句，简洁性不言而喻</span></div><div class="line">        Factory&lt;Boy&gt; boyFactory = Boy::<span class="keyword">new</span>;</div><div class="line">        Boy boy1 = boyFactory.create(<span class="string">"Eric"</span>, <span class="number">18</span>);</div><div class="line">        boy1.doSome();</div><div class="line">        Factory&lt;Girl&gt; girlFactory = Girl::<span class="keyword">new</span>;</div><div class="line">        Girl girl1 = girlFactory.create(<span class="string">"Lisa"</span>, <span class="number">18</span>);</div><div class="line">        girl1.doSome();</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3月9日-天气-阴"><a href="#3月9日-天气-阴" class="headerlink" title="3月9日 天气:阴"></a>3月9日 天气:阴</h2><p>不想使用前端，那就使用rn去写es6语法试试。<br>接下来，又接到一点新任务了。那就是加载逻辑出了问题。这个问题，和我当时的rn也是一样。没有数据的时候，干嘛要让界面显示，先给一个圈圈啦。处理初次打开<br>先来问题重现，去设置chrome的开发工具，限定网速。看看网速慢，是否会有那种影响出现。处理得依旧不是很好。<br>下午叫勋爷来看了一下，可能是由于缓存原因，上了一下午的网再去弄，问题就不见了。勋爷说的对，缓存也是一个大坑。</p>
<p>这一段代码呢，就是avalon中，解决加载的时候，空白乱码的情况的。对body中加了controller的地方，直接先隐藏。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;style&gt;</div><div class="line">         .ms-controller, .ms-important, [ms-controller], [ms-important] &#123;</div><div class="line">             <span class="attr">visibility</span>: hidden;</div><div class="line">         &#125;</div><div class="line">         .cellTable&#123;</div><div class="line">             <span class="attr">width</span>: <span class="number">100</span>%;height:<span class="number">100</span>%;border-spacing:<span class="number">1</span>px;border: none</div><div class="line">         &#125;</div><div class="line">     &lt;<span class="regexp">/style&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="3月10日-天气-阴"><a href="#3月10日-天气-阴" class="headerlink" title="3月10日 天气:阴"></a>3月10日 天气:阴</h2><p>今天本来安排满满，准备去搞我的android的时间。都用来做前端了。感觉也还行，毕竟都是编程技术，能学一点是一点。<br>下班之前，做出了之前面试的那个方块进度条。</p>
<h2 id="3月13日-天气-阴"><a href="#3月13日-天气-阴" class="headerlink" title="3月13日 天气:阴"></a>3月13日 天气:阴</h2><p>今天去处理一番毕业登记系统，处理了那些ui现实逻辑，以求能够统一。<br>收到消息，可以去做android，还是移动集团的处理内容。</p>
<p>下面还是摘录一下我所看到的android的view中绘制的函数解释。</p>
<ul>
<li><code>invalidate</code>:请求重新绘制，但只会绘制调用者本身。<code>view</code>的<code>setSelection</code>,<code>setVisibility</code>,<code>setEnable</code>方法，会间接调用这个方法，导致view 的重绘。</li>
<li><code>requestLayout</code>方法：会导致调用measure()和layout（）过程，但是不会重新绘制任何视图包括调用者本身。例如<code>setVisiablity</code>，当View的可视状态发生改变，会间接调用<code>requestLayout</code>和<code>invalidate</code>方法。同时整棵View树大小发生了变化，会请求<code>measure</code>和<code>draw</code>过程。</li>
<li><code>requestFocus</code>:请求view树的draw过程，但只重绘<code>需要重绘</code>的视图。</li>
</ul>
<h2 id="3月14日-天气-晴"><a href="#3月14日-天气-晴" class="headerlink" title="3月14日 天气:晴"></a>3月14日 天气:晴</h2><p>处理了提的ui问题，还有上传时，重新上传，第一张被冲掉的尴尬地方。其实，就是改一下思路。选择文件的时候不能添加一个空对象进去，因为uploadify上传给的id不是唯一的，会变得，这样就不能拿这个来做唯一值。解决办法，就是，上传成功后，进行回调的时候，才去add对象进去数组，不就能够解决这个问题了。</p>
<p>新开了一个番茄土豆的项目，慢慢学习着吧。一开始先要去写两个自定控件。底部栏，加上中间的那个指示器。</p>
<p>下面归类一下Android的support注解功能，这里只是收集了几个我认为好玩的注解。</p>
<ul>
<li><code>@Keep</code>注解，避免被混淆</li>
<li><code>@CallSuper</code>注解，重写的时候，要调用超类方法</li>
<li><code>@RequestPermission</code>，为了防止在编译时，权限缺失，在要使用权限的地方，先打上，就能确保编译时候检查配置文件那里有没有声明</li>
<li><code>@Size</code>注解，对于类似数组、集合和字符串之类的参数，我们可以用size注解来表示这些参数的大小。</li>
<li><code>@UiThread</code>注解，还有<code>MainThread</code>，<code>WorkerThread</code>和<code>BinderThread</code>等，表明方法运行在不同的线程环境中</li>
</ul>
<h2 id="3月15日-天气-阴"><a href="#3月15日-天气-阴" class="headerlink" title="3月15日 天气:阴"></a>3月15日 天气:阴</h2><p>今天主要任务还是去搞了一下我那自定义的底部栏。就是，就是，让中间的item，在集体之外，对它进行操作。做到下午，算是基本做出来了。没有了图标，本来是想着去偷的，但是，加入新的知识，使用矢量图去做吧。</p>
<h2 id="3月16日-天气-阴"><a href="#3月16日-天气-阴" class="headerlink" title="3月16日 天气:阴"></a>3月16日 天气:阴</h2><p>看了java虚拟机，明白了一下之前写c调用java的时候，动态去注册java方法那时，使用的类似<code>([II)V</code>这种玩意，就是java的方法描述符。注册的东西，就是函数名称，和它的描述符。</p>
<p>遇到的第一坑，mysql设置了大小写敏感选项。java代码中是使用大写进行查询的，但是数据库中的表名却是小写，那就一直报表不存在的错误。既然找到了问题，那么就应该要有解决方案。我呢，没有权限，只能将这个问题先反馈上去，看看上头是不是会不用大小写了。</p>
<p>以下是我找到的办法。启动mysqlId的时候，多给下面这一串的参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//参数说明 0：名称对比大小写敏感，unix的默认设置，创建的是输入的值； 1：这样，大小写就不敏感了，无论大写，小写，mysql都统一转换成为小写；2：大小写敏感，但是创建的都是小写</span></div><div class="line">lower_case_table_names=<span class="number">1</span></div></pre></td></tr></table></figure>
<p>没办法，服务器那边不肯改了。我只有把数据库先导出来（导出的过程中，发现数据库贼大），然后再导入到我本地那里去。</p>
<p>别人发了dump文件过来，我运行命令行，然后就搞进去了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -uxxxx -pxxxxx db &lt; /Users/lixinkun/Downloads/zsyz_201612.dump</div></pre></td></tr></table></figure>
<p>看了一下新接手的项目，握草，java代码和html，js混编的。不，是serverlet生成html，这。。。。</p>
<h2 id="3月17日-天气-晴"><a href="#3月17日-天气-晴" class="headerlink" title="3月17日 天气:晴"></a>3月17日 天气:晴</h2><p>遇到的第一个坑，就是jq和prototype.js有冲突，大家都是使用美元符号<code>$</code>进行选择。初步解决的办法，就是给jq重命名别名。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> $j=jQuery.noConflict();<span class="comment">//重名jq，避免和prototype.js冲突</span></div></pre></td></tr></table></figure>
<p>接下来，后台封装json数据，返回到前台。至于怎么封装呢。<br>分析前端需要的数据，提取，封装，返回。使用集合，然后再转换成为json吧，就这么决定了</p>
<p>纠结json问题的时候，貌似突然就茅塞顿开了。我不用集合，就去使用json一直put。</p>
<p>接下来要爬的另外一个坑，就是先和我的接口进行对接了。</p>
<p>感觉还行吧，万事开头难，开头难。</p>
<h2 id="3月18日-天气-雨"><a href="#3月18日-天气-雨" class="headerlink" title="3月18日 天气:雨"></a>3月18日 天气:雨</h2><p>周末拾遗，继续学习。</p>
<ul>
<li>java使用<code>DatagramSocket</code>代表UDP协议的Socket，DatagramSocket本身只是码头，不维护状态，不能产生IO流，它唯一的作用就是发送和接收数据报。java用DatagramPacket来代表数据报，UDP的socket发送的就是这个数据报。</li>
</ul>
<p>为什么android的view那里会有一个<code>onTouchListener</code>呢？这玩意，就是为了方便在外部去处理view的点击事件。假如你的view是在MainActivity中被引用，你想要某某点击事件效果，设置listener，就不用再view的源码中去设置点击事件了。假如这个view在另外一处地方要用，但是需要的点击事件不同呢，哈哈。</p>
<h2 id="3月19日-天气-雨"><a href="#3月19日-天气-雨" class="headerlink" title="3月19日 天气:雨"></a>3月19日 天气:雨</h2><p>我一直在思考了之前的问题，就是一个如何去给一个view来设置无限循环动画？搜索了一下，原来就是在ObjectAnimator那里，给动画进行设置setRepeatMode(ValueAnimator.INFINITE)。下面个一个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator anim = ObjectAnimator.ofFloat(view,<span class="string">""</span>, -<span class="number">6.0f</span>, <span class="number">6.0f</span>, -<span class="number">6.0f</span>);</div><div class="line">anim.setDuration(<span class="number">1500</span>);</div><div class="line">anim.setRepeatCount(ValueAnimator.INFINITY);<span class="comment">//这个才起作用</span></div><div class="line">anim.setRepeatMode(ValueAnimator.INFINITY);<span class="comment">//这个貌似会不起作用哦</span></div><div class="line">anim.start();</div></pre></td></tr></table></figure>
<p>下面来了解一种节省内存的思想。日和避免过多地去生成对象呢？可以将相近，或者有联系的对象，杂糅成为一个对象。比如，在android的view中，MeasureSpec就是使用了这种思想。它把view的Mode和size集成在一起。mode在高2位，size在后面。然后一起组成32位的int值。下面贴一下它们的打包和解包过程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MODE_SHIFT = <span class="number">30</span>;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MODE_MASK = <span class="number">0x3</span> &lt;&lt; MODE_SHIFT;<span class="comment">//1100000000000000000000000000000000</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNSPECIFIED = <span class="number">0</span> &lt;&lt; MODE_SHIFT;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXACTLY = <span class="number">1</span> &lt;&lt; MODE_SHIFT;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> AMOST = <span class="number">2</span> &lt;&lt; MODE_SHIFT;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">makeMeasureSpec</span><span class="params">(<span class="keyword">int</span> size, <span class="keyword">int</span> mode)</span></span>&#123;</div><div class="line">  <span class="keyword">if</span> (sUseBrokenMakeMeasureSpec) &#123;</div><div class="line">    <span class="keyword">return</span> size + mode;<span class="comment">//如果是已经转换好，直接拼凑</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span> (size &amp; ~MODE_MASK) | (mode &amp; MODE_MASK);<span class="comment">//拼凑在一起</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMode</span><span class="params">(<span class="keyword">int</span> measureSpec)</span></span>&#123;</div><div class="line">  <span class="keyword">return</span> (measureSpec &amp; MODE_MASK);<span class="comment">//取高2位</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">(<span class="keyword">int</span> measureSpec)</span></span>&#123;</div><div class="line">  <span class="keyword">return</span> (measureSpec &amp; ~MODE_MASK);<span class="comment">//取低30位</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当一个子view申请的大小，大于父容器能给的最大大小的时候，那么经过测量，它能够获得的大小就是父容器能给的大小，而不是它理想得到的大小。</p>
<p>只要提供父容器的<code>MeasureSpec</code>和子元素的<code>LayoutParams</code>，就能快速确定出子元素的MeasureSpec了。</p>
<p>更正一个我之前在自定义view中走入的误区，就是让自定义view 支持padding属性的时候，不是在onMeasure那里减去padding的值，而是在draw的时候，减去padding的值。</p>
<p>接下来梳理一下微信支付的流程：</p>
<ul>
<li>用户浏览App，选择下单</li>
<li>服务器处理订单逻辑，开始正式发起支付流程</li>
<li>首先，后台服务器向微信服务器发起请求，获取一个token</li>
<li>后台拿到token，和其他参数进行加密，再次向微信服务器发起请求，获取一个预支付prepayid</li>
<li>后台服务器将该prepayid返回给app客户端</li>
<li>app调用手机上的微信控件，完成支付流程</li>
<li>app向后台发起一个回调请求，通知服务器交易完成</li>
<li>微信服务器处理完所有流程以后，向后台服务器发起一个post请求，正式通知服务器交易完毕</li>
</ul>
<p>回来看了一下项目的解构，我发现了一个问题，就是user_id和userId区别不大吗？那样真的能够取到参数？</p>
<h2 id="3月21日-天气-晴"><a href="#3月21日-天气-晴" class="headerlink" title="3月21日 天气:晴"></a>3月21日 天气:晴</h2><p>实力的方法可以调用本类的类方法。</p>
<ul>
<li>解决单选复选的问题，剩下的问题还有两个，就是判断选中的问题，以及后台参数获取问题。我该，怎么去找到那个参数选中呢</li>
</ul>
<p>java web继续踩坑。上午增加的几个特性就是判断框框选中数量方法进行更新；后台返回了正确的单选多选配置。</p>
<p>参数选中完成，参数值获取完成。改成前台去处理参数，再传到后台进行取值。</p>
<p>和后台对接成功，呈批件提交成功。</p>
<p>两个项目编码不同，也是有坑的。转到一个项目以后，必须切换为它的编码。</p>
<p>js如何判断一串字符全是空格，或者，现在降到如何判断字符串中有空格，就行了。</p>
<p>android拾遗：今天水了一下，在fragment里面创建菜单。创建的菜单，就是能够在activity里面显示</p>
<h2 id="3月22日-天气-阴"><a href="#3月22日-天气-阴" class="headerlink" title="3月22日 天气:阴"></a>3月22日 天气:阴</h2><p>今天做的比较有意义的工作，就是尝试去修改了uploadify.js的源码，将烦人的英文提示改成中文提示。我在源码那里改了，貌似不起作用，因为我们浏览器使用的就是压缩包。。。</p>
<p>java的每一个对象，都可以作为一个对象锁，那么，这个锁究竟是存在哪里呢？答案就是在java对象头中。</p>
<p>从java 1.6开始，为了减少获得锁和释放锁带来的性能损耗，引入了‘偏向锁’和‘轻量级锁’。现在一共有4种状态，依次是：无锁状态、偏向锁状态、轻量级锁状态、重量级锁状态。锁可以升级，但不能降级。</p>
<p>volatile变量是一种更轻量级的同步机制，因为在使用这些变量的时候，不会发生上下文切换和线程调度等操作。但是它有自身的局限：不能用于构建原子的复合操作，因此当一个变量依赖旧值时就不能使用volatile变量</p>
<h2 id="3月23日-天气-阴"><a href="#3月23日-天气-阴" class="headerlink" title="3月23日 天气:阴"></a>3月23日 天气:阴</h2><p>后台对数据库操作，要进行异常捕捉啊，不然返回了错误数据，谁整？<br>后台数据判断，紧跟到前端一样。批量导入要对数据进行比较严格的判断。</p>
<p>数据太长，怎么办？使用title属性，然后截取字符串。鼠标悬浮在上面的时候，就能够显示全文。</p>
<p>我本来想着是怎么去做那个recyclerview右滑删除的，还想着自定义。原来使用ItemTouchHelper进行处理。</p>
<p>在java中，<code>&gt;&gt;&gt;</code>叫做无符号右移。</p>
<p>为什么推荐使用静态工厂类去生成一个对象呢？好处之一就是语义明确。比如说表示一个点的时候，有极坐标的时候怎么办？不可能大家都是用构造器，因为正常的x，y会使用构造器。这事，静态工厂就可以起作用了，给出不同的接口。这样，上层的人用起来，就舒服很多了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Point <span class="title">valueOfPolar</span><span class="params">(k, k)</span></span>&#123;</div><div class="line">  <span class="comment">//进行逻辑转换</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3月27日-天气-阴"><a href="#3月27日-天气-阴" class="headerlink" title="3月27日 天气:阴"></a>3月27日 天气:阴</h2><p>先说主要项目中的工作：关于多选的时候的数据传递到后台。功能已经实现。只是在呈批件中需要这样去设置，那就简单了啊。前台拼凑起数据，和之前的格式一样吧，然后传递到后台进行对接，整个过程，除了找网页花费了一点时间，整体的调试接入也还是花了一点时间。在中午的吃饭之前解决问题。后台又给提了一个需求，说的就是要对那么多的数据进行一个搜索功能，有一个星期的时间，我打算明天才去动手，明天做完。<br>注意一下jq的使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>下午去做番茄土豆，番茄土豆啊。搞了一下午。拉了源代码进来，进行了一顿爆改，然后实现了右滑。思路就是先写好布局，然后滑动时候让布局显示出来。adapter中是使用了几种的滑动菜单效果，有滑动一部分的和滑动整个view的，具体的控制逻辑都在onChildDraw中。</p>
<p>布局文件，删除按钮早就在布局中了：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line">&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"</div><div class="line">             android:layout_width="match_parent"</div><div class="line">             android:layout_height="wrap_content"</div><div class="line">             android:background="#FF4444"&gt;</div><div class="line">    &lt;LinearLayout</div><div class="line">        android:id="@+id/view_list_repo_action_container"</div><div class="line">        android:layout_width="wrap_content"</div><div class="line">        android:layout_height="match_parent"</div><div class="line">        android:layout_gravity="left"</div><div class="line">        android:orientation="horizontal"&gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:id="@+id/view_list_repo_action_delete"</div><div class="line">            android:layout_width="80dp"</div><div class="line">            android:layout_height="match_parent"</div><div class="line">            android:gravity="center"</div><div class="line">            android:padding="12dp"</div><div class="line">            android:text="Delete"</div><div class="line">            android:textColor="@android:color/white"/&gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:id="@+id/view_list_repo_action_update"</div><div class="line">            android:layout_width="80dp"</div><div class="line">            android:layout_height="match_parent"</div><div class="line">            android:background="#8BC34A"</div><div class="line">            android:gravity="center"</div><div class="line">            android:padding="12dp"</div><div class="line">            android:text="Refresh"</div><div class="line">            android:textColor="@android:color/white"/&gt;</div><div class="line"></div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line">    &lt;include</div><div class="line">        android:id="@+id/view_list_main_content"</div><div class="line">        layout="@layout/item_task"/&gt;</div><div class="line">&lt;/FrameLayout&gt;</div></pre></td></tr></table></figure></p>
<p>下面是关键代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">  <span class="comment">//让布局只能在end下面进行滑动</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMovementFlags</span><span class="params">(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder)</span> </span>&#123;</div><div class="line">      <span class="keyword">int</span> dragFlag = ItemTouchHelper.UP | ItemTouchHelper.DOWN;</div><div class="line">      <span class="keyword">int</span> swipeFlags = ItemTouchHelper.END ;</div><div class="line">      <span class="keyword">return</span> makeMovementFlags(dragFlag, swipeFlags);</div><div class="line">  &#125;</div><div class="line"></div><div class="line"><span class="comment">//让隐藏的view显示出来</span></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChildDraw</span><span class="params">(Canvas c, RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder,</span></span></div><div class="line">          <span class="keyword">float</span> dX, <span class="keyword">float</span> dY, <span class="keyword">int</span> actionState, <span class="keyword">boolean</span> isCurrentlyActive) &#123;</div><div class="line">      PromotoAdapter.ItemBaseViewHolder holder = (PromotoAdapter.ItemBaseViewHolder) viewHolder;</div><div class="line">      <span class="keyword">if</span> (dY != <span class="number">0</span> &amp;&amp; dX == <span class="number">0</span>)&#123;</div><div class="line">          <span class="keyword">super</span>.onChildDraw(c, recyclerView, viewHolder, dX, dY, actionState, isCurrentlyActive);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span> (viewHolder <span class="keyword">instanceof</span> PromotoAdapter.ItemSwipeWithActionWidthNoSpringViewHolder)&#123;</div><div class="line">          <span class="keyword">if</span> (dX &gt; holder.mActionContainer.getWidth())&#123;</div><div class="line">              dX = holder.mActionContainer.getWidth();</div><div class="line">          &#125;</div><div class="line">          holder.mViewContent.setTranslationX(dX);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span> (viewHolder <span class="keyword">instanceof</span> PromotoAdapter.ItemBaseViewHolder)&#123;</div><div class="line">          holder.mViewContent.setTranslationX(dX);</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<h2 id="3月28日-天气-阴"><a href="#3月28日-天气-阴" class="headerlink" title="3月28日 天气:阴"></a>3月28日 天气:阴</h2><p>今早做好了搜索框，我选择在js中实现，就是为了代码的复用。然后去处理了加好变减号的指示器联动问题。一开始点击的时候是还行的，但是到了后来就是要去做一下联动，搜索的时候，也能直接变指示器。</p>
<p>pre sessionId = 75F98E47AA0F5BF49B2FAAA45EB5EFDF<br>aft sessionId = 75F98E47AA0F5BF49B2FAAA45EB5EFDF</p>
<p>终于要着手去处理浏览器兼容性的问题了。批量上传的时候，我们需要使用uploadify上传文件。使用火狐浏览器，报了302的错误。搜索一番，就是火狐会再次使用一个新的sessionid，不是旧的，这样就导致验证不成功了。做法就是先去获取到本来的sessionid，在上传的时候再度带过去。传递是传递过去了，但是还是不起作用。我在搜索的时候有看见，后台也是需要改一点东西的。但是我对项目的架构并不是十分地熟悉，就不知道在哪里被过滤了。后来找了同事，他说过滤器那里过滤掉了，不能进行重建。。。。</p>
<h2 id="3月29日-天气-阴"><a href="#3月29日-天气-阴" class="headerlink" title="3月29日 天气:阴"></a>3月29日 天气:阴</h2><p>今早回来，就被人追杀。说程序的兼容有问题，ie使用uploadify上传的时候，爆出406问题。找了一下原因，就是因为数据转回后，没有正确转换成为json，然后在springmvc-servlet中加入了如下代码：text/json</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;bean id="fastJsonHttpMessageConverter"</div><div class="line">       class="cn.thinkjoy.qky.graduate.common.QkyFastJsonHttpMessageConverter"&gt;</div><div class="line">     &lt;property name="supportedMediaTypes"&gt;</div><div class="line">         &lt;list&gt;</div><div class="line">             &lt;value&gt;application/json; charset=utf-8&lt;/value&gt;</div><div class="line">             &lt;value&gt;text/json; charset=utf-8&lt;/value&gt;</div><div class="line">         &lt;/list&gt;</div><div class="line">     &lt;/property&gt;</div><div class="line"> &lt;/bean&gt;</div></pre></td></tr></table></figure>
<p>谷歌浏览器使用avalon1.4，不能去获取到中文信息，有这个缺陷，目前只能期待更新版本解决。</p>
<p>bootstrap的代码还是不怎么会用，但是这有什么关系呢，我就是使用空白的div去填充，填充到自己满意为止</p>
<p>将avalon的版本升级到1.58，就能够获取到中文了。</p>
<h2 id="3月30日-天气-阴"><a href="#3月30日-天气-阴" class="headerlink" title="3月30日 天气:阴"></a>3月30日 天气:阴</h2><p>花了一早上去搭建win的环境，烦人。</p>
<p>下午做了两个小时的android，终于把弹窗部分的功能做出来了，还能去进行数据的增加和删除。</p>
<p>快下班时候，把项目部署到正式环境当中了。原来，他们是使用ftp进行文件替换，更新的。</p>
<p>接手几个小bug，原来是一直都有的bug，我也就接手，慢慢去进行改正</p>
<h2 id="3月31日-天气-雨"><a href="#3月31日-天气-雨" class="headerlink" title="3月31日 天气:雨"></a>3月31日 天气:雨</h2><p>昨天上的代码，兼容性有问题，回滚到上一个版本。做好兼容性测试以后再上。导入了新的项目，下午继续弄。先看一个大概。</p>
<p>记录一下js判断输入是否是email的代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">isEmail:<span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> em=<span class="regexp">/^([\w-_]+(?:\.[\w-_]+)*)@((?:[a-z0-9]+(?:-[a-zA-Z0-9]+)*)+\.[a-z]&#123;2,6&#125;)$/i</span>;</div><div class="line">        <span class="keyword">return</span> em.test(str)</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>线程拥有各自的计数器、堆栈和局部变量等属性，并且能够访问共享的内存变量。</li>
</ul>
<p>也算是一个深坑？数据库没有配好的话，那是简直连exception都不给我抛出。周平也是个深坑，我改好数据库以后，就能够进行操作了</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/04/10/2017/2017-3月工作笔记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/04/10/2017/2017-3月工作笔记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/03/15/2017/2017-2月工作笔记/" title="2017-2月工作笔记" itemprop="url">2017-2月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2017-03-15T02:12:49.000Z" itemprop="datePublished"> 发表于 2017-03-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><code>本命年</code> <code>新气象</code></p>
<blockquote>
<p>春节假期结束，开工大吉</p>
</blockquote>
        
        
        <p class="article-more-link">
          
            <a href="/2017/03/15/2017/2017-2月工作笔记/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/03/15/2017/2017-2月工作笔记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/03/15/2017/2017-2月工作笔记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/01/24/2017/2017-1月工作笔记/" title="2017-1月工作笔记" itemprop="url">2017-1月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2017-01-24T00:35:15.000Z" itemprop="datePublished"> 发表于 2017-01-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>2017来了</p>
</blockquote>
        
        
        <p class="article-more-link">
          
            <a href="/2017/01/24/2017/2017-1月工作笔记/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2017/01/24/2017/2017-1月工作笔记/#comments" class="ds-thread-count comments-count-link" data-thread-key="2017/01/24/2017/2017-1月工作笔记/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/12/31/2016/2016年终总结-今年比较有趣和多事/" title="2016年终总结-今年比较有趣和多事" itemprop="url">2016年终总结-今年比较有趣和多事</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2016-12-31T13:40:20.000Z" itemprop="datePublished"> 发表于 2016-12-31</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>2016年的确是我23年人生中，经历得最精彩的一年，可能，跟毕业和长大有关吧</p>
</blockquote>
<p><code>毕业</code> <code>Work</code> <code>长大</code></p>
        
        
        <p class="article-more-link">
          
            <a href="/2016/12/31/2016/2016年终总结-今年比较有趣和多事/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/life/">life</a><a href="/tags/future/">future</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/12/31/2016/2016年终总结-今年比较有趣和多事/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/12/31/2016/2016年终总结-今年比较有趣和多事/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="Eric1235" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/life/" title="life">life<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/work/" title="work">work<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/coding/" title="coding">coding<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/college/" title="college">college<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/feuture/" title="feuture">feuture<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/me/" title="me">me<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/improve/" title="improve">improve<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/future/" title="future">future<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/android/" title="android">android<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/study/" title="study">study<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/fight/" title="fight">fight<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/work-life/" title="-work -life">-work -life<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/sunshine/" title="sunshine">sunshine<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://weicong.win" target="_blank" title="Weicong Blog">Weicong Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1634073622&verifier=43ce7f75&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Be Fearless <br/>
			Be an Engineer</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1634073622" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/Eric1235" target="_blank" class="icon-github" title="github"></a>
		
		
		
		<a href="https://twitter.com/ericli1235" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/lixinkun" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		
		<a href="https://plus.google.com/Eric1235?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:Eric1235@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="Eric Li">Eric Li</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
