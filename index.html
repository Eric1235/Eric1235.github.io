
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Eric&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Eric Li">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="Eric's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Eric's Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eric's Blog">

    
    <link rel="alternative" href="/atom.xml" title="Eric&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Eric&#39;s Blog" title="Eric&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Eric&#39;s Blog">Eric&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/11/11/11月工作笔记/" title="11月工作笔记" itemprop="url">11月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  <p class="article-time">
    <time datetime="2016-11-11T08:28:12.000Z" itemprop="datePublished"> 发表于 2016-11-11</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>天气很好</p>
</blockquote>
<h3 id="11月2日-天气-阴"><a href="#11月2日-天气-阴" class="headerlink" title="11月2日 天气:阴"></a>11月2日 天气:阴</h3><ul>
<li>java知识补充，ConCurrentSkipListmap的学习。其优点有两个：key是有序的；支持更高的并发量。存取时间为log(N)，与线程数无关。线程数越多，越体现它的优势。</li>
<li>如果安装的时候报了这个错误： INSTALL_PARSE_FAILED_MANIFEST_MALFORMED 。 可以去检查一下配置清单文件有没有什么错误。比如包名路径那些，拒绝大写。Service中去掉android:process。</li>
<li>Android中的GUID的意义：通过唯一标识，可以对软件的使用情况进行上报。快速进行bug的定位，哪种机型不行，哪些机子经常出bug等。组成的有IMEI，androidid，mac，iccid，手机型号，品牌，操作系统等信息。</li>
</ul>
<h3 id="11月3日-天气-阴"><a href="#11月3日-天气-阴" class="headerlink" title="11月3日 天气:阴"></a>11月3日 天气:阴</h3><ul>
<li>知道了一个token过期的处理方式。页面一定要采取一种统一的报token过期的处理方式。我们目前能处理的就是js弹框。拦截js弹框，去处理token过期。当token过期的时候，弹得js符合我们的协议的话，我们就拦截，然后调用原始的方法，返回登录界面。目前的问题就是，有人的处理方式是不一样的，他们直接返回的静态的html页面告诉用户token过去，握草，我没法解决。</li>
<li><p>单一职责原则和开放封闭原则的实际小demo使用。一个类里面可能承载的功能是有点太多。比如要去写一个图片下载，ImageDownloader里面，第一版的时候是承载了下载，缓存的功能，违反了类的单一职责原则。正确的改法就是去抽离出一个缓存类。抽离出缓存的时候，问题又来了，缓存策略又被写死了，只能使用内存缓存。这样也不行，又得抽缓存策略出来。这时就得去依赖抽象了。暴露出接口，不同的策略去实现不同的东西。然后给个接口，去注入不同的缓存实现就好了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ImageCache</span> </span>&#123;</div><div class="line">    <span class="function">Bitmap <span class="title">get</span><span class="params">(String url)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(String url, Bitmap bitmap)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>里氏替换原则的应用，就是setIMageCache（）方法的使用，子类可以完全替换成为父类，所以可以随便切换缓存策略。使用反射的话，是不是就能够把配置写到xml文件里面？</p>
</li>
</ul>
<h3 id="11月4日-天气-晴"><a href="#11月4日-天气-晴" class="headerlink" title="11月4日 天气:晴"></a>11月4日 天气:晴</h3><ul>
<li>主要是没有见得多吧，终于要上6.0了。搞了一早上的拍照功能，一直爆的bug就是说图片得不到，写不进去。那就，乱改代码了啦。一顿乱改，还是没有解决问题。那么就开始怀疑其他的问题了，网上一搜，好多都说是权限，一看。果然app的访问内存卡功能被禁止掉了。既然找到问题，改起来就方便了。我们去动态申请权限就好了。既然坑都来了，连7.0的file传递也搞了吧。</li>
<li>java内存模型的主要目标是定义程序中各个变量的访问规则，即在虚拟机中将变量存储到内存和从内存中取出变量这样的底层细节。此处的变量（variable）与java编程中所说的变量略有区别，它包括了实例字段、静态字段和构成数组对象的元素，但是不包括局部变量与方法参数，因为后者是线程私有的，不会被共享，自然就不存在竞争问题。java内存模型规定了所有的变量都存储在主内存中。每条线程还有自己的工作内存，线程的工作内存中保存了被该线程使用到的变量的主内存副本拷贝，线程对变量的所有操作（读取、赋值等）都必须在工作内存中进行，而不能直接读写主内存中的变量。不同的线程之间也无法直接访问对方工作内存的变量，线程间变量的传递均需要通过主内存来完成。</li>
<li>FileProvider的作用，就是把以“file://”开头的文件，转换成为contentprovider 的uri。至于怎么注册，怎么使用的话，看自己的笔记。</li>
</ul>
<h3 id="11月7日-天气-晴"><a href="#11月7日-天气-晴" class="headerlink" title="11月7日 天气:晴"></a>11月7日 天气:晴</h3><ul>
<li>今天学习了建造者模式。它的精髓就是给出各个部件的组长接口，让用户直接调用接口去设置部件，再给出create（）就<br>能够组装出各具特色的产品。记得，要去检查参数了哦。看看用户输入的参数是不是全部可以使用，没有输入的参数，就只能给出默认实现。在初始化对象时，一次性set好，以后通过build的属性，就不允许再度更改。建造者模式的缺点就是会生成冗余的builder对象，消耗内存。</li>
<li>已安装了存在签名冲突的同名数据包这个冲突，有下面四种解释：打包签名的key不一样；新版的版本号比旧版的低；AndroidManifest文件不一样或者有冲突；导入的包名有冲突。</li>
<li>原型模式的核心就是对象的拷贝。使用原型模式，可以解决构建复杂对象的资源消耗问题，能够在某些场景提高对象创建的效率。还有一个重要的用途就是保护性拷贝，也许某个对象对外是只读的，为了防止该对象被修改，通常可以返回一个对象拷贝形式实现只读限制。用处：比如说登陆以后的用户信息，这个信息是由网上接口得来的，在app中只能是只读，不能被修改。</li>
</ul>
<h3 id="11月8日-天气-阴"><a href="#11月8日-天气-阴" class="headerlink" title="11月8日 天气:阴"></a>11月8日 天气:阴</h3><ul>
<li>昨天晚上就说好的，我今天要去写一个太极和八卦出来的。这次真的是自己动手写了，看看自己的自定义控件的能力还是不是真的熟练？八卦的外壳还是很容易写的，只要设定好了，让画布canvas先去旋转22.5°，然后就可以用一个for循环去画出骨架。然后就是用path一直去连线，然后画出外形。画好了边以后，要做的就是去话里面的太极图了。一开始我没有想好是怎么去画，就不断地去画圆和画弧，一层一层往上去堆叠，还真的是可以画出来的。后来想到了一种更加有用的方法，用path去不断地填充路径，到最后形成形状以后，去进行填充。步骤也是也是挺多的，但是就可以建设那么一点点过度绘制。</li>
<li>重新认识到了工厂模式，这里介绍的是使用反射去生成对象。用反射搭配工厂模式去生产复杂的对象，使代码就简洁了很多。只要传进去</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> &lt;T extends AudiCar&gt; <span class="function">T <span class="title">createAudiCar</span><span class="params">(Class&lt;T&gt; clazz)</span> </span>&#123;</div><div class="line">        AudiCar car = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span>&#123;</div><div class="line">            Class clz = Class.forName(clazz.getName());</div><div class="line">            car = (AudiCar) clz.newInstance();</div><div class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> (T)car;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>抽象工厂模式。刚刚的工厂模式只是一个工厂，可以生产出若干产品啦。现在再扩大一点，就是把工厂那一层也是抽象出来，变成好多个工厂，生产出更多的产品。看似是灵活了一点，但是会导致类文件会爆炸性增长。同时，起添加新的产品类的时候，就可能要修改抽象工厂，具体工厂也是要被修改的了。</li>
</ul>
<h3 id="11月9日-天气-阴"><a href="#11月9日-天气-阴" class="headerlink" title="11月9日 天气:阴"></a>11月9日 天气:阴</h3><ul>
<li>今天学习了安卓开发的mvp模式，里面最重要的精髓应该就是分层。复用代码的话，我还真是没有看出哪里进行了复用啊。高度抽象出一个view出来，数据的采集就是可以通过view传递到p。抽象出一个p，持有view，得到数据以后，就对数据进行处理。然后p把处理完的数据，再通过view抽象出来的接口回传回去activity，activity得到数据以后更新界面。所有的逻辑业务，理论上是可以交给p去做的，所以p抽象出来就是处理一堆的逻辑业务，然后得到处理后的数据。p持有view，p被activity或者fragment持有。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserLoginView</span> </span>&#123;</div><div class="line">    <span class="function">String <span class="title">getUserName</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">String <span class="title">getPassword</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clearUserName</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clearPassword</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">showLoading</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hideLoading</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">gotoMainActivity</span><span class="params">(User user)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">showError</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>编程经验的收集，如何去组织Toast被多次点击呢？要点就是将Toast的调用封装成为一个工具类，在调用的时候，判断Toast对象是否为空咯。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToastUtil</span></span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Toast toast;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showToast</span><span class="params">(Context context,String content)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(toast == <span class="keyword">null</span>)&#123;</div><div class="line">      toast = Toast.makeText(context,content,Toast.LENGTH_SHORT);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      toast.setText(content);</div><div class="line">    &#125;</div><div class="line">    toast.show();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Dialog：当提示信息是至关重要的，并且必须要由用户做出决定才能继续的时候，使用Dialog。<br>Toast：当提示信息只是告知用户某个事情发生了，用户不需要对这个事情做出响应的时候，使用Toast。<br>Snackbar：以上两者之外的任何其他场景，Snackbar可能会是你最好的选择。</p>
<ul>
<li>在Application的构造方法当中，是不能去调用Context的方法的，因为此时的Context还没有生成，直接报错。Application中在onCreate()方法里去初始化各种全局的变量数据是一种比较推荐的做法，但是如果你想把初始化的时间点提前到极致，也可以去重写attachBaseContext()方法。</li>
</ul>
<h3 id="11月10日-天气-阴雨"><a href="#11月10日-天气-阴雨" class="headerlink" title="11月10日 天气:阴雨"></a>11月10日 天气:阴雨</h3><ul>
<li>今天，就是学习着去做动画了。什么都别说，死磕PathMeasure就好了。这个工具类是有点好玩，可以获取path的片段，可以获取path上的某个点的坐标。利用这两个特性，再加上动画控制器，就能做出很多有意思的动画出来。比如说沿着path跑一圈，比如说慢慢画个圆圈出来。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startPathAnim</span><span class="params">(<span class="keyword">long</span> duration)</span> </span>&#123;</div><div class="line">        ValueAnimator valueAnimator = ValueAnimator.ofFloat(<span class="number">0</span>, mPathMeasure.getLength());</div><div class="line">        Log.i(TAG, <span class="string">"measure length = "</span> + mPathMeasure.getLength());</div><div class="line">        valueAnimator.setDuration(duration);</div><div class="line">        valueAnimator.setInterpolator(<span class="keyword">new</span> DecelerateInterpolator());</div><div class="line">        valueAnimator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</div><div class="line">                <span class="keyword">float</span> value = (Float) animation.getAnimatedValue();</div><div class="line">                Log.d(<span class="string">"Eric"</span>,<span class="string">"value="</span> + value);</div><div class="line">                <span class="comment">// 获取当前点坐标封装到mCurrentPosition</span></div><div class="line">                mPathMeasure.getPosTan(value, mCurrentPosition, <span class="keyword">null</span>);</div><div class="line">                postInvalidate();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        valueAnimator.start();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>这是另外一个去根据不同的状态绘制不同的路径。至于状态的切换嘛，那就是去使用handler进行切换了啦。在AnimatorListener的监听周期，动画结束的时候，使用handler发个消息，继续下一个动画。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawSearch</span><span class="params">(Canvas canvas)</span></span>&#123;</div><div class="line">        canvas.translate(mWidth/<span class="number">2</span>,mHeight/<span class="number">2</span>);</div><div class="line">        canvas.drawColor(Color.parseColor(<span class="string">"#0082D7"</span>));</div><div class="line">        <span class="keyword">switch</span> (mState)&#123;</div><div class="line">            <span class="keyword">case</span> NONE:</div><div class="line">                canvas.drawPath(mPathSearch,mPaint);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//放大镜逐渐消失</span></div><div class="line">            <span class="keyword">case</span> STARTING:</div><div class="line">                mPathMeasure.setPath(mPathSearch,<span class="keyword">false</span>);</div><div class="line">                Path dst = <span class="keyword">new</span> Path();</div><div class="line">                mPathMeasure.getSegment(mPathMeasure.getLength() * mAnimatorValue, mPathMeasure.getLength(),dst,<span class="keyword">true</span>);</div><div class="line">                canvas.drawPath(dst,mPaint);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//圆圈在转</span></div><div class="line">            <span class="keyword">case</span> SEARCHING:</div><div class="line">                mPathMeasure.setPath(mPathCircle,<span class="keyword">false</span>);</div><div class="line">                Path dst2 = <span class="keyword">new</span> Path();</div><div class="line">                <span class="keyword">float</span> stop = mPathMeasure.getLength() * mAnimatorValue;</div><div class="line">                <span class="keyword">float</span> start = (<span class="keyword">float</span>)(stop - ((<span class="number">0.5</span> - Math.abs(mAnimatorValue - <span class="number">0.5</span>))* (mPathMeasure.getLength() / <span class="number">3</span>)));</div><div class="line">                mPathMeasure.getSegment(start,stop,dst2,<span class="keyword">true</span>);<span class="comment">//开启硬件加速的时候可能会导致一些错误</span></div><div class="line">                canvas.drawPath(dst2,mPaint);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//放大镜回来</span></div><div class="line">            <span class="keyword">case</span> ENDING:</div><div class="line">                mPathMeasure.setPath(mPathSearch,<span class="keyword">false</span>);</div><div class="line">                Path dst3 = <span class="keyword">new</span> Path();</div><div class="line">                mPathMeasure.getSegment(mPathMeasure.getLength() * mAnimatorValue , mPathMeasure.getLength(), dst3, <span class="keyword">true</span>);</div><div class="line">                canvas.drawPath(dst3,mPaint);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>继续经验积累，要是弄不了view转的话，可以转一下思维，转画布咯。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">       mMeasure.getPosTan(mMeasure.getLength() * currentValue, pos, tan);</div><div class="line">       <span class="keyword">float</span> degrees = (<span class="keyword">float</span>) (Math.atan2(tan[<span class="number">1</span>], tan[<span class="number">0</span>]) * <span class="number">180.0</span> / Math.PI);</div><div class="line">       canvas.save();</div><div class="line">       canvas.translate(<span class="number">400</span>, <span class="number">400</span>);</div><div class="line">       canvas.drawPath(mPath, mPaint);</div><div class="line">       canvas.drawCircle(pos[<span class="number">0</span>], pos[<span class="number">1</span>], <span class="number">10</span>, mPaint);</div><div class="line">       canvas.rotate(degrees);</div><div class="line">       canvas.drawLine(<span class="number">0</span>, -<span class="number">200</span>, <span class="number">300</span>, -<span class="number">200</span>, mPaint);</div><div class="line">       canvas.restore();</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>控制器:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">ValueAnimator animator = ValueAnimator.ofFloat(<span class="number">0</span>, <span class="number">1</span>);</div><div class="line">       animator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator valueAnimator)</span> </span>&#123;</div><div class="line">               currentValue = (<span class="keyword">float</span>) valueAnimator.getAnimatedValue();</div><div class="line">               invalidate();</div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line">       animator.setDuration(<span class="number">3000</span>);</div><div class="line">       animator.setRepeatCount(ValueAnimator.INFINITE);</div><div class="line">       animator.start();</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h3 id="11月11日-天气-冷"><a href="#11月11日-天气-冷" class="headerlink" title="11月11日 天气:冷"></a>11月11日 天气:冷</h3><p>今天测试人员就丢了一个bug过来，说是那个头像照片上传不成功。我试了几次，就发现了有意思的问题。上传是可以上传成功的，但是返回的状态码就是timeout。问题就可能是出在自身的网络连接这方面了。我查看了一下代码，握草，之前的人也是太不负责任了，直接用默认的okhttp的timeout，网络差一点的地方哪里够用了？自己自定义一个，给多少好呢？30秒吧，和之前的下载一样，都是30秒。</p>
<ul>
<li>自定义Toast步骤。首先要有一个布局，构造方法的时候，把布局add到当前的activity中，怎么拿到当前activity的布局呢？一个ViewGroup，记得R是android.R。接着addView进去就好了，记住，view此时状态是隐藏的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">container = (ViewGroup)((Activity)context)<span class="comment">//Android activity的布局</span></div><div class="line">                .findViewById(android.R.id.content);</div></pre></td></tr></table></figure>
<p>然后，接着去写makeText方法，主要做的事情就是初始化加载进来的布局，设置好动画的时间。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EToast <span class="title">makeToast</span><span class="params">(Context context, String message, <span class="keyword">int</span> hideProxy)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(result == <span class="keyword">null</span>)&#123;</div><div class="line">            result = <span class="keyword">new</span> EToast(context);</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span>(!mContext.getClass().getName().equals(context.getClass().getName()))&#123;</div><div class="line">                result = <span class="keyword">new</span> EToast(context);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(hideProxy == LENGTH_LONG)&#123;</div><div class="line">            result.HIDE_DELAY = <span class="number">3000</span>;</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            result.HIDE_DELAY = <span class="number">1500</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        mTextView.setText(message);</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>也可以去重载那个传入int res的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EToast <span class="title">makeToast</span><span class="params">(Context context, <span class="keyword">int</span> res, <span class="keyword">int</span> hideProxy)</span></span>&#123;</div><div class="line">       String msg = <span class="string">""</span>;</div><div class="line">       msg = context.getResources().getString(res);</div><div class="line">       <span class="keyword">return</span> makeToast(context,msg,hideProxy);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>最后，就是到最重要的show方法了。定义两个动画，把布局展示出来，然后在相应的时间后，隐藏布局。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</div><div class="line">       <span class="keyword">if</span>(isShow)&#123;</div><div class="line">           <span class="keyword">return</span>;</div><div class="line">       &#125;</div><div class="line">       isShow = <span class="keyword">true</span>;</div><div class="line">       mFadeInAnimation = <span class="keyword">new</span> AlphaAnimation(<span class="number">0</span>,<span class="number">1</span>);</div><div class="line">       mFadeOutAnimation = <span class="keyword">new</span> AlphaAnimation(<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">       mFadeOutAnimation.setDuration(ANIMATION_DURATION);</div><div class="line">       mFadeOutAnimation.setAnimationListener(<span class="keyword">new</span> Animation.AnimationListener() &#123;</div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line">               isShow = <span class="keyword">true</span>;</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line">               mContainer.setVisibility(View.GONE);</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line"></div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line">       mContainer.setVisibility(View.VISIBLE);</div><div class="line">       mFadeInAnimation.setDuration(ANIMATION_DURATION);</div><div class="line">       mContainer.startAnimation(mFadeInAnimation);</div><div class="line">       mHandler.postDelayed(mHideRunnable,HIDE_DELAY);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>使用handler的原因，就是因为这里不是主线程嘛，不能操作界面。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/work-coding/">-work -coding</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/work-coding/" title="-work -coding">-work -coding<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Eric Li">Eric Li</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
