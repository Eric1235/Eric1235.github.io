
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  
    <title>2017-1月工作笔记 | Eric&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Eric Li">
    

    
    <meta name="description" content="2017来了">
<meta property="og:type" content="article">
<meta property="og:title" content="2017-1月工作笔记">
<meta property="og:url" content="http://yoursite.com/2017/01/24/2017/2017-1月工作笔记/index.html">
<meta property="og:site_name" content="Eric&#39;s Blog">
<meta property="og:description" content="2017来了">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-01-24T00:36:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2017-1月工作笔记">
<meta name="twitter:description" content="2017来了">
<meta name="twitter:creator" content="@ericli1235">
<link rel="publisher" href="Eric1235">

    
    <link rel="alternative" href="/atom.xml" title="Eric&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Eric&#39;s Blog" title="Eric&#39;s Blog"></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Eric&#39;s Blog">Eric&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索">
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</ul></nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope="" itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/01/24/2017/2017-1月工作笔记/" title="2017-1月工作笔记" itemprop="url">2017-1月工作笔记</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/Eric1235?rel=author" title="Eric Li" target="_blank" itemprop="author">Eric Li</a>
		
  </p><p class="article-time">
    <time datetime="2017-01-24T00:35:15.000Z" itemprop="datePublished"> 发表于 2017-01-24</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1月4日-天气-晴"><span class="toc-number">1.</span> <span class="toc-text">1月4日 天气:晴</span></a></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#1月5日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月5日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月6日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月6日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月9日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月9日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月10日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月10日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月11日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月11日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月12日-天气-阴天"><span class="toc-number"></span> <span class="toc-text">1月12日 天气:阴天</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月13日-天气-阴"><span class="toc-number"></span> <span class="toc-text">1月13日 天气:阴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月16日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月16日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月17日-天气-阴"><span class="toc-number"></span> <span class="toc-text">1月17日 天气:阴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月18日-天气-阴"><span class="toc-number"></span> <span class="toc-text">1月18日  天气:阴</span></a>
		
		</li></div>
		
		<blockquote>
<p>2017来了</p>
</blockquote>
<a id="more"></a>
<h3 id="1月4日-天气-晴"><a href="#1月4日-天气-晴" class="headerlink" title="1月4日 天气:晴"></a>1月4日 天气:晴</h3><p>打了几个小时的代码，好像是可以看到滑动滑块的效果，下面做一下总结。</p>
<ul>
<li>使用path去搞出滑块的形状。这个滑块，就好像是一张拼图的一块。半圆的大小，这个单位挺重要的</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 得到滑块的形状</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createCaptchaPath</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">int</span> gap = mCaptchaWidth / <span class="number">3</span>;<span class="comment">// 这个单位就定了整个滑块的单位基准</span></span><br><span class="line"></span><br><span class="line">       mCaptchaX = mRandom.nextInt(mWidth - mCaptchaWidth - gap);</span><br><span class="line">       mCaptchaY = mRandom.nextInt(mHeight - mCaptchaHeight - gap);</span><br><span class="line"></span><br><span class="line">       mCaptchaPath.reset();</span><br><span class="line">       mCaptchaPath.lineTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">       mCaptchaPath.moveTo(mCaptchaX, mCaptchaY);</span><br><span class="line">       mCaptchaPath.lineTo(mCaptchaX + gap, mCaptchaY);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//随机画出一个突出或者凹陷的圆，有想过使用addCircle的，但是会被分割成许多段，arcTo也不行，不能设置方向</span></span><br><span class="line">       drawPartCircle(<span class="keyword">new</span> PointF(mCaptchaX + gap, mCaptchaY), <span class="keyword">new</span> PointF(mCaptchaX + gap * <span class="number">2</span>, mCaptchaY), mCaptchaPath, mRandom.nextBoolean());</span><br><span class="line">       mCaptchaPath.lineTo(mCaptchaX + mCaptchaWidth, mCaptchaY);</span><br><span class="line">       mCaptchaPath.lineTo(mCaptchaX + mCaptchaWidth, mCaptchaY + gap);</span><br><span class="line">       drawPartCircle(<span class="keyword">new</span> PointF(mCaptchaX + mCaptchaWidth, mCaptchaY + gap), <span class="keyword">new</span> PointF(mCaptchaX + mCaptchaWidth ,</span><br><span class="line">               mCaptchaY + gap * <span class="number">2</span>), mCaptchaPath, mRandom.nextBoolean());</span><br><span class="line"></span><br><span class="line">       mCaptchaPath.lineTo(mCaptchaX + mCaptchaWidth, mCaptchaY + mCaptchaHeight);</span><br><span class="line">       mCaptchaPath.lineTo(mCaptchaX + mCaptchaWidth - gap , mCaptchaY + mCaptchaHeight);</span><br><span class="line"></span><br><span class="line">       drawPartCircle(<span class="keyword">new</span> PointF(mCaptchaX + mCaptchaWidth - gap, mCaptchaY + mCaptchaHeight), <span class="keyword">new</span> PointF(mCaptchaX + mCaptchaWidth - gap * <span class="number">2</span> ,</span><br><span class="line">               mCaptchaY + mCaptchaHeight), mCaptchaPath, mRandom.nextBoolean());</span><br><span class="line"></span><br><span class="line">       mCaptchaPath.lineTo(mCaptchaX, mCaptchaY + mCaptchaHeight);</span><br><span class="line">       mCaptchaPath.lineTo(mCaptchaX, mCaptchaY + mCaptchaHeight - gap);</span><br><span class="line"></span><br><span class="line">       drawPartCircle(<span class="keyword">new</span> PointF(mCaptchaX , mCaptchaY + mCaptchaHeight - gap), <span class="keyword">new</span> PointF(mCaptchaX,</span><br><span class="line">               mCaptchaY + mCaptchaHeight - gap * <span class="number">2</span>), mCaptchaPath, mRandom.nextBoolean());</span><br><span class="line"></span><br><span class="line">       mCaptchaPath.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用三阶贝塞尔曲线去拟合半圆。为什么不用addCircle和arcTo？都有各自不同的缺点，前者会分割path为多个，后者不能控制向前还是向后</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这样可以保证path不被分成这么多段，能够形成完整的一段。给出起点和终点，然后就能够画出半圆</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawPartCircle</span><span class="params">(PointF start, PointF end, Path path, <span class="keyword">boolean</span> outer)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> c = <span class="number">0.551915024494f</span>;<span class="comment">//计算贝塞尔曲线的常量</span></span><br><span class="line"></span><br><span class="line">    PointF middle = <span class="keyword">new</span> PointF((start.x + end.x) / <span class="number">2</span>, (start.y + end.y) / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> r1 = (<span class="keyword">float</span>) Math.sqrt(Math.pow((middle.x - start.x), <span class="number">2</span>) + Math.pow((middle.y - start.y), <span class="number">2</span>));<span class="comment">//半径</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> gap1 = r1 * c;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(start.x == end.x)&#123;</span><br><span class="line"><span class="comment">//            boolean topBottom = end.y - start.y &gt; 0 ? true : false;//有这两种写法</span></span><br><span class="line">        <span class="comment">//画竖直方向的</span></span><br><span class="line">        <span class="keyword">boolean</span> topToBottom = end.y - start.y &gt; <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">int</span> flag ;<span class="comment">//旋转系数</span></span><br><span class="line">        <span class="keyword">if</span>(topToBottom)&#123;</span><br><span class="line">            flag = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            flag = -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(outer)&#123;</span><br><span class="line">            <span class="comment">//凸</span></span><br><span class="line">            path.cubicTo(start.x + gap1 * flag, start.y,</span><br><span class="line">                    middle.x + r1 * flag, middle.y - gap1 * flag,</span><br><span class="line">                    middle.x + r1 * flag, middle.y);</span><br><span class="line"></span><br><span class="line">            path.cubicTo(middle.x + r1 * flag, middle.y + gap1 * flag,</span><br><span class="line">                    end.x + gap1 * flag,end.y,end.x,end.y);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//凹</span></span><br><span class="line">            path.cubicTo(start.x - gap1 * flag, start.y,</span><br><span class="line">                    middle.x - r1 * flag, middle.y - gap1 * flag,</span><br><span class="line">                    middle.x - r1 * flag, middle.y);</span><br><span class="line">            path.cubicTo(middle.x - r1 * flag, middle.y + gap1 * flag,</span><br><span class="line">                    end.x - gap1 * flag, end.y,</span><br><span class="line">                    end.x, end.y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">boolean</span> leftToRight = end.x - start.y &gt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> flag;</span><br><span class="line">        <span class="keyword">if</span>(leftToRight)&#123;</span><br><span class="line">            flag = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            flag = -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(outer)&#123;</span><br><span class="line">            <span class="comment">//凸</span></span><br><span class="line">            path.cubicTo(start.x, start.y - gap1 * flag,</span><br><span class="line">                    middle.x - gap1 * flag, middle.y - r1* flag,</span><br><span class="line">                    middle.x, middle.y - r1 * flag);</span><br><span class="line">            path.cubicTo(middle.x + gap1 * flag, middle.y - r1 * flag,</span><br><span class="line">                    end.x, end.y - gap1 * flag,</span><br><span class="line">                    end.x, end.y);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//凹</span></span><br><span class="line">            path.cubicTo(start.x, start.y + gap1 * flag,</span><br><span class="line">                    middle.x - gap1 * flag, middle.y + r1 * flag,</span><br><span class="line">                    middle.x, middle.y + r1 * flag);</span><br><span class="line">            path.cubicTo(middle.x + gap1 * flag, middle.y + r1 * flag,</span><br><span class="line">                    end.x, end.y + gap1 * flag, end.x, end.y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>弄好形状以后，需要把图给抠出来</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 先确定区域，再去画图</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mBitmap</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Bitmap <span class="title">getMaskBitmap</span><span class="params">(Bitmap mBitmap, Path path)</span></span>&#123;</span><br><span class="line">    Bitmap tmpBitmap = Bitmap.createBitmap(mWidth, mHeight, Bitmap.Config.ARGB_8888);</span><br><span class="line">    Canvas canvas = <span class="keyword">new</span> Canvas(tmpBitmap);<span class="comment">//这个bitmap做了底了</span></span><br><span class="line">    canvas.setDrawFilter(<span class="keyword">new</span> PaintFlagsDrawFilter(<span class="number">0</span>, Paint.ANTI_ALIAS_FLAG | Paint.FILTER_BITMAP_FLAG));</span><br><span class="line">    canvas.drawPath(path, mMaskPaint);</span><br><span class="line">    mMaskPaint.setXfermode(mPorterDuffXfermode);</span><br><span class="line"><span class="comment">//        canvas.clipPath(path);//先裁剪，再去画的话，这样会有锯齿</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 它们两者的宽高很大可能是不同的，这就是ImageView参数 scaleType 的作用。</span></span><br><span class="line"><span class="comment">     * 所以我们 取出 ImageView 的 Matrix 用于绘制 src 的 Bitmap。</span></span><br><span class="line"><span class="comment">     * 这样抠出来的Bitmap区域就和第1步遮盖住的区域是一样的了。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    canvas.drawBitmap(mBitmap, getImageMatrix(), mMaskPaint);</span><br><span class="line">    mMaskPaint.setXfermode(<span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">return</span> tmpBitmap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>插播一条信息，就是如何在子线程中调用jni方法。要是这样的话，会导致class和getenv找不到。我们可以讲其保存为全局变量哦。</p>
<ul>
<li>在JNI_OnLoad中，保存JavaVM<em>这是跨线程的，持久有效的，而JNIEnv</em>则是当前线程有效的。一旦启动线程，用AttachCurrentThread方法获得env。</li>
<li>通过JavaVM*和JNIEnv可以查找到jclass。</li>
<li>把jclass转成全局引用，使其跨线程。</li>
<li>然后就可以正常地调用你想调用的方法了。</li>
<li>用完后，别忘了delete掉创建的全局引用和调用DetachCurrentThread方法。</li>
</ul>
<p>下面引用自强哥<br>（一般有几种做法：1. 一条线程，JAVA用ThreadHandler或者thread + handler +looper等等啦，去一直持有一个env，当有需要用到JNI的时候，向这个线程发消息。当C++需要回调java时候，同样用这条线程  2. 向你这样把gVm保存，然后每个线程都用去拿env（当然你可以先缓存，判断tid是不是一样再重新attach去拿env）tid在哪里获取都行，但是推荐在c中获取）</p>
<h2 id="1月5日-天气-晴"><a href="#1月5日-天气-晴" class="headerlink" title="1月5日 天气:晴"></a>1月5日 天气:晴</h2><p>今天一大早，又走神了，我竟然是去研究c指针。由于看不懂内存破坏后会发生什么事情。我就按照609的推荐去看了c的一次函数调用。关于函数帧是怎么形成的，压栈的顺序，除了那些参数和变量，栈里面究竟还有些什么呢？通过阅读别人的博客，首先明白了栈里面有的是形参，自动变量，静态变量的位置；返回值是怎么返回的（特别是大于8位的返回值）；函数的返回地址等等。虽然也还不是很懂，但是就有了个基本印象了。</p>
<p>就和贝塞尔曲线杠上了，那个圆究竟是怎么来的嘛。三阶贝塞尔曲线是要有两个数据点，两个控制点的。一个圆，可以由4段贝塞尔曲线拟合而成。我算了一下，拼图的path生成的那几个点，我现在算是搞清了。两个数据点，外面的两个控制点。</p>
<h2 id="1月6日-天气-晴"><a href="#1月6日-天气-晴" class="headerlink" title="1月6日 天气:晴"></a>1月6日 天气:晴</h2><p>今天早上就把贝塞尔曲线的控制点变换给搞清楚了一下，能够从圆渐变到心形，还是有一点进步的。以后要涉及到高级动画的时候，再去巩固这方面的知识了。</p>
<p>下面说一下io流的部分，我看了这么久，本来是想今天能够收尾的，但是公司临时有事，只能利用晚上去扫一下。今天涉及的知识就是序列化啦。我之前记得的最重要的就是要去写 serialVersionUID 这个字段。自己亲自测试了一下，在没有修改写这个的时候，先把数据写入文件，然后修改类，再去读回来，serialVersionUID是不一样的，反序列化失败。</p>
<p>序列化的话，有另外一个接口是新学到的Externalizable，这个用法和android自带的parcelable差不多，下面给出用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 反序列化会去调用所有的构造方法，然后再去调用readExteral</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blip3</span> <span class="keyword">implements</span> <span class="title">Externalizable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">private</span> String s;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> String passwd;<span class="comment">//经过transient修饰的字段，就不会被序列化进去</span></span><br><span class="line">    <span class="comment">//构造方法一定要公有的，不然不行</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Blip3</span><span class="params">(<span class="keyword">int</span> i, String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.i = i;</span><br><span class="line">        <span class="keyword">this</span>.s = s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Blip3</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s + i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeExternal</span><span class="params">(ObjectOutput out)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        out.writeObject(s);</span><br><span class="line">        out.writeInt(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//恢复</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readExternal</span><span class="params">(ObjectInput in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        s = (String)in.readObject();</span><br><span class="line">        i = in.readInt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>序列化的时候，如果想要剔除某个字段，不序列化进去，记得使用transient关键字。</p>
<h2 id="1月9日-天气-晴"><a href="#1月9日-天气-晴" class="headerlink" title="1月9日 天气:晴"></a>1月9日 天气:晴</h2><p>首先要介绍一下课重入的方法。可重入的方法就是多线程安全的哦，比如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sqr</span><span class="params">(x)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>volatile关键字可以做到以下两件事情：</p>
<ul>
<li>阻止编译器为了提高速度将一个变量缓存到缓存器而不写回</li>
<li>阻止编译器调整操作volatile变量的指令顺序</li>
</ul>
<p>但是，仍然阻止不了cpu的乱序执行</p>
<p>每周至少4日，一小时新技术的阅读，无关android行不行？</p>
<p>发现了一个新的控件可以使用，就是android终于是自带了BottomNavigationView，有空去改写一下项目了哦。具体使用方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    TextView mTextView;</span><br><span class="line">    <span class="keyword">private</span> BottomNavigationView mNavigationView;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        mTextView = (TextView) findViewById(R.id.text);</span><br><span class="line">        <span class="comment">//加载一串的item进去就行了</span></span><br><span class="line">        mNavigationView = (BottomNavigationView) findViewById(R.id.navigation);</span><br><span class="line"></span><br><span class="line">        mNavigationView.setOnNavigationItemSelectedListener(</span><br><span class="line">                <span class="keyword">new</span> BottomNavigationView.OnNavigationItemSelectedListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onNavigationItemSelected</span><span class="params">(@NonNull MenuItem item)</span> </span>&#123;</span><br><span class="line">                        mTextView.setText(item.getTitle().toString().toUpperCase());</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>viewpager拥有预加载机制是确定了，但是它里面的源码告诉我们，你想设置mViewPager.setOffscreenPageLimit()为0，是行不通的。当然，你可以改写源码，再打包一个v4包，不过不建议这样去做.老老实实去研究viewpager的懒加载机制，在fragment那里弄。</p>
<p>下面介绍一下在通知栏直接回复消息的东东，虽然目前的app是可以自由使用，但是7.0以后是自带了，自带了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TargetApi</span>(<span class="number">23</span>)</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendNotification</span><span class="params">()</span></span>&#123;</span><br><span class="line">      RemoteInput input = <span class="keyword">new</span> RemoteInput.Builder(RESULT_KEY)</span><br><span class="line">              .setLabel(<span class="string">"回复消息"</span>)</span><br><span class="line">              .build();</span><br><span class="line">      Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>,SendMsgService.class);</span><br><span class="line">      PendingIntent pi = PendingIntent.getService(<span class="keyword">this</span>, <span class="number">1</span>, intent, PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line"></span><br><span class="line">      NotificationCompat.Action act = <span class="keyword">new</span> NotificationCompat.Action.Builder</span><br><span class="line">              (R.mipmap.ic_launcher,<span class="string">"null"</span>,pi).addRemoteInput(input).build();</span><br><span class="line"></span><br><span class="line">      NotificationCompat.Builder builder = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>)</span><br><span class="line">              .setSmallIcon(R.mipmap.ic_launcher)</span><br><span class="line">              .setContentTitle(<span class="string">"Msg"</span>)</span><br><span class="line">              .setContentText(<span class="string">"MSG Content"</span>)</span><br><span class="line">              .addAction(act)</span><br><span class="line">              .setCategory(Notification.CATEGORY_MESSAGE);</span><br><span class="line"></span><br><span class="line">      NotificationManager notificationManager = getSystemService(NotificationManager.class);</span><br><span class="line">      notificationManager.notify(NOTIFICATION_ID,builder.build());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>作一下检讨，就是如果有return语句了，switch那里还需要break吗？答案是不需要，因为程序运行根本不能到达那里。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//随机生成一个对象</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Shape <span class="title">randomFactory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> xVal = rand.nextInt(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">int</span> yVal = rand.nextInt(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">int</span> dim = rand.nextInt(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">switch</span> (counter++ % <span class="number">3</span>)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Circle(xVal, yVal, dim);</span><br><span class="line">                <span class="comment">// break;//不应该再加这一句啦，不能到达</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Square(xVal, yVal, dim);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Line(xVal, yVal, dim);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>import static 包名可以自动带入当前的命名空间。有些时候好用，但是还是不太推荐使用</p>
<h2 id="1月10日-天气-晴"><a href="#1月10日-天气-晴" class="headerlink" title="1月10日 天气:晴"></a>1月10日 天气:晴</h2><p>先去整理一下思路，原来我之前一直是记错了java的反射getField()and getDeclareField()的作用，前者是只能获取public，后者是能够获取所有字段，我承认我记反了</p>
<p>研究到java注解处理的一种方式，使用反射区处理注解。这样处理起来就是比较简便，但是性能非常不好。注解里面的字段包含基本数据类型和注解哦。下面给出一个注解处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableCreator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(args.length &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"arguments: annotated classes"</span>);</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(String className: args)&#123;</span><br><span class="line">            Class&lt;?&gt; cl = Class.forName(className);</span><br><span class="line">            DBTable dbTable = cl.getAnnotation(DBTable.class);</span><br><span class="line">            <span class="keyword">if</span>(dbTable == <span class="keyword">null</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">"NO DBTable annotations in class "</span> + className);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String tableName = dbTable.name();</span><br><span class="line">            <span class="keyword">if</span>(tableName.length() &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                tableName = cl.getName().toUpperCase();</span><br><span class="line">            &#125;</span><br><span class="line">            List&lt;String&gt; columnDefs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(Field field : cl.getDeclaredFields())&#123;</span><br><span class="line">                String columnName = <span class="keyword">null</span>;</span><br><span class="line">                Annotation[] anns = field.getDeclaredAnnotations();</span><br><span class="line">                <span class="keyword">if</span>(anns.length &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(anns[<span class="number">0</span>] <span class="keyword">instanceof</span> SQLInteger)&#123;</span><br><span class="line">                    SQLInteger sInt = (SQLInteger)anns[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">if</span>(sInt.name().length() &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                        columnName = field.getName().toUpperCase();</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        columnName = sInt.name();</span><br><span class="line">                    &#125;</span><br><span class="line">                    columnDefs.add(columnName + <span class="string">" INT"</span> + getConstraints(sInt.constraints()));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(anns[<span class="number">0</span>] <span class="keyword">instanceof</span> SQLString)&#123;</span><br><span class="line">                    SQLString sStr = (SQLString)anns[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">if</span>(sStr.name().length() &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                        columnName = field.getName().toUpperCase();</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        columnName = sStr.name();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    columnDefs.add(columnName +</span><br><span class="line">                            <span class="string">" VARCHAR("</span> + sStr.value() + <span class="string">")"</span> + getConstraints(sStr.constraints()));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                StringBuilder createCommand = <span class="keyword">new</span> StringBuilder(<span class="string">"CREATE TABLE "</span>+ tableName + <span class="string">"("</span>);</span><br><span class="line">                <span class="keyword">for</span>(String columnDef : columnDefs)&#123;</span><br><span class="line">                    createCommand.append(<span class="string">"\n    "</span> + columnDef + <span class="string">","</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                String tableCreate = createCommand.substring(<span class="number">0</span>, createCommand.length() - <span class="number">1</span>) + <span class="string">")"</span>;</span><br><span class="line">                System.out.println(<span class="string">"Table Creation SQL for "</span> + className + <span class="string">"is \n"</span> + tableCreate);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getConstraints</span><span class="params">(Constraints con)</span></span>&#123;</span><br><span class="line">        String constrains = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span>(!con.allowNull())&#123;</span><br><span class="line">            constrains += <span class="string">"NOT NULL"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(con.primaryKey())&#123;</span><br><span class="line">            constrains += <span class="string">"PRIMARY KEY"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(con.unique())&#123;</span><br><span class="line">            constrains += <span class="string">"UNIQUE"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> constrains;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>顽皮，想要去研究web项目，但是搞了一天，始终是没有跑起来。搞了一天，原因都是因为我一直舍不得去换jdk。还是8的好，我干嘛要用旧的。但是对付旧的项目，就必须去使用旧的jdk，那就换了。不用去切换系统的jdk，只要在项目那里指明了就好。</p>
<h2 id="1月11日-天气-晴"><a href="#1月11日-天气-晴" class="headerlink" title="1月11日 天气:晴"></a>1月11日 天气:晴</h2><p>今天继续去研究一下注解？昨天使用的是在运行期才处理的注解，似乎感觉有点太慢，太耗性能。那么，有没有一些比较好一点的注解处理呢？答案是有的，就是在编译期处理注解，然后生成新的java文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//继承AbstractProcessor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ProcessingEnvironment env)</span></span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annoations, RoundEnvironment env)</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//android端最好使用这两个方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getSupportedAnnotationTypes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">super</span>.getSupportedAnnotationTypes();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> SourceVersion <span class="title">getSupportedSourceVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">super</span>.getSupportedSourceVersion();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注解处理器是运行它自己的虚拟机JVM中。是的，你没有看错，javac启动一个完整Java虚拟机来运行注解处理器.</p>
<p>Android中，可以使用注解来代替枚举类型，具体是使用android annotation类库。</p>
<p>临近下班，就开始去接触并发编程了。</p>
<ul>
<li>明确的第一个概念，就是线程并不能进行跨线程传播，只能在本线程进行捕获，处理.</li>
</ul>
<h2 id="1月12日-天气-阴天"><a href="#1月12日-天气-阴天" class="headerlink" title="1月12日 天气:阴天"></a>1月12日 天气:阴天</h2><p>早上首先学习到并发相关的知识。第一个就是ThreadFactory这个东西。这个工厂类就是去处理线程池的线程。在线程加入到线程池的时候，再进行统一的封装。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaemonThreadFactory</span> <span class="keyword">implements</span> <span class="title">ThreadFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        t.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来了解到的就是后台线程。先上后台线程的介绍：</p>
<ol>
<li>后台线程会随着主程序的结束而结束，但是前台线程则不会；或者说，只要有一个前台线程未退出，进程就不会终止。（下面的例子会充分说明这一点）;</li>
<li>默认情况下，程序员创建的线程是用户线程；用setDaemon(true)可以设置线程为后台线程；而用isDaemon( )则可以判断一个线程是前台线程还是后台线程；</li>
<li>jvm的垃圾回收器其实就是一个后台线程；</li>
<li>setDaemon函数必须在start函数之前设定，否则会抛出IllegalThreadStateException异常;</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//关于后台线程，如果是后台线程，是不会走finally语句的</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ADaemon</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Daemon"</span>);</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Finally"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> ADaemon());</span><br><span class="line">        t.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>承认我学的东西都很碎片了啊，这不，继续跑来了okhttp,自定义拦截器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> Interceptor netInterceptor = <span class="keyword">new</span> Interceptor() &#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">         Request request = chain.request();</span><br><span class="line">         Response response = chain.proceed(request);</span><br><span class="line">       <span class="comment">/*String cacheControl = request.header("Cache-Control");</span></span><br><span class="line"><span class="comment">         if (TextUtils.isEmpty(cacheControl)) &#123;</span></span><br><span class="line"><span class="comment">             cacheControl = "public, max-age=60";</span></span><br><span class="line"><span class="comment">         &#125;*/</span></span><br><span class="line">         <span class="keyword">int</span> maxAge = <span class="number">60</span>;</span><br><span class="line">         <span class="keyword">return</span> response.newBuilder()</span><br><span class="line">                 .removeHeader(<span class="string">"Pragma"</span>)<span class="comment">// 清除头信息，因为服务器如果不支持，会返回一些干扰信息，不清除下面无法生效</span></span><br><span class="line">                 .removeHeader(<span class="string">"Cache-Control"</span>)</span><br><span class="line">                 .header(<span class="string">"Cache-Control"</span>, <span class="string">"public, max-age="</span> + maxAge)</span><br><span class="line">                 .build();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> File cacheFile = <span class="keyword">new</span> File(BaseApp.getInstance().getCacheDir(), <span class="string">"caheData"</span>);</span><br><span class="line">       <span class="comment">//设置缓存大小</span></span><br><span class="line">       Cache cache = <span class="keyword">new</span> Cache(cacheFile, DEFAULT_DIR_CACHE);<span class="comment">//google建议放到这里</span></span><br><span class="line">       OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">               .retryOnConnectionFailure(<span class="keyword">true</span>)<span class="comment">//连接失败后是否重新连接</span></span><br><span class="line">               .connectTimeout(<span class="number">15</span>, TimeUnit.SECONDS)<span class="comment">//超时时间15S</span></span><br><span class="line">               .addNetworkInterceptor(cacheInterceptor)<span class="comment">//这里大家一定要注意了是addNetworkOnterceptor别搞错了啊。</span></span><br><span class="line">               .cache(cache)</span><br><span class="line">               .build();</span><br></pre></td></tr></table></figure>
<h2 id="1月13日-天气-阴"><a href="#1月13日-天气-阴" class="headerlink" title="1月13日 天气:阴"></a>1月13日 天气:阴</h2><p>继续了一下踩坑之旅，自己好不容易去研究了多viewtype的adapter的解耦，在最临急的一刻，竟然把recyclerview的显示步骤漏掉了layoutmanager，导致显示不出来，检讨一下？<br>下面说一下如何去解耦，这个比较重要。普通去实现多个type，就是使用if else等等去判断。但是，那是不提倡的编码风格。必须去解耦。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultiTypeAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">BaseViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BaseViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//使用工厂模式，根据type去生产出viewHolder</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(BaseViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//根据工厂生产出来的viewholder，调用统一接口去绑定view</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//整个list的长度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//根据position，返回相应的type（最好包含item的resID咯）</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一共要进行抽象的地方有三个，TypeFactory，BeanType，ViewHolder。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseViewHolder</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SparseArray&lt;View&gt; views;</span><br><span class="line">    <span class="keyword">private</span> View mItemView;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(itemView);</span><br><span class="line">        <span class="keyword">this</span>.mItemView = itemView;</span><br><span class="line">        views = <span class="keyword">new</span> SparseArray&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> resID)</span></span>&#123;</span><br><span class="line">        View view = views.get(resID);</span><br><span class="line">        <span class="keyword">if</span>(view == <span class="keyword">null</span>)&#123;</span><br><span class="line">            view = mItemView.findViewById(resID);</span><br><span class="line">            views.put(resID, view);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这个主要就是去实现数据绑定，具体bean从泛型那里来</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setupView</span><span class="params">(T model, <span class="keyword">int</span> position, MultiTypeAdapter adapter)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TypeFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">type</span><span class="params">(One one)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">type</span><span class="params">(Two two)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">type</span><span class="params">(Normal normal)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">BaseViewHolder <span class="title">createViewHolder</span><span class="params">(<span class="keyword">int</span> type, View itemView)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Visiable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">type</span><span class="params">(TypeFactory factory)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面介绍一下如何捕获线程中产生的异常，就是线程中的异常跑出去run方法了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CaptureUncaughtException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionThread2</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Thread t = Thread.currentThread();</span><br><span class="line">            System.out.println(<span class="string">"run() by "</span> + t);</span><br><span class="line">            System.out.println(<span class="string">"eh = "</span> + t.getUncaughtExceptionHandler());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过这货来捕获异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyUncaughtExceptionHandler</span> <span class="keyword">implements</span> <span class="title">Thread</span>.<span class="title">UncaughtExceptionHandler</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uncaughtException</span><span class="params">(Thread t, Throwable e)</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"caught "</span> + e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerThreadFactory</span> <span class="keyword">implements</span> <span class="title">ThreadFactory</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span> + <span class="string">" creating new Thread"</span>);</span><br><span class="line">            Thread t = <span class="keyword">new</span> Thread(r);</span><br><span class="line">            System.out.println(<span class="string">"created "</span> + t);</span><br><span class="line">            t.setUncaughtExceptionHandler(<span class="keyword">new</span> MyUncaughtExceptionHandler());<span class="comment">//设置处理机制</span></span><br><span class="line">            System.out.println(<span class="string">"eh = "</span> + t.getUncaughtExceptionHandler());</span><br><span class="line">            <span class="keyword">return</span> t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        ExecutorService exec = Executors.newCachedThreadPool(<span class="keyword">new</span> HandlerThreadFactory());</span><br><span class="line">        exec.execute(<span class="keyword">new</span> ExceptionThread2());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1月16日-天气-晴"><a href="#1月16日-天气-晴" class="headerlink" title="1月16日 天气:晴"></a>1月16日 天气:晴</h2><p>首先说一下今天遇到的一个小坑，就是自定义style的时候，出现了一点小问题，导致，崩溃。要给activity去设置一个透明的背景，就去自定义一个style，用到activity的时候，有如下报错信息。原因就是缺少了父类<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">“You need to use a Theme.<span class="function">AppCompat <span class="title">theme</span> <span class="params">(or descendant)</span> with the design library”</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&lt;style name</span>=<span class="string">"Transparent"</span>&gt;</span><br><span class="line"><span class="comment">// &lt;style name="Transparent" parent="Theme.AppCompat"&gt;//要指定父类</span></span><br><span class="line">    &lt;item name="android:windowBackground"&gt;@color/transparent&lt;/item&gt;</span><br><span class="line">    &lt;item name="android:windowIsTranslucent"&gt;true&lt;/item&gt;</span><br><span class="line">    &lt;item name="android:windowAnimationStyle"&gt;@android:style/Animation.Translucent&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></p>
<p>对于下面的这个属性<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如何判断一次滑动时有效的？为了增强用户体验，是应该要去判断一下本次滑动是否有效的</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@Override</span><br><span class="line">   public boolean onInterceptTouchEvent(MotionEvent ev) &#123;</span><br><span class="line">       switch (ev.getAction())&#123;</span><br><span class="line">           case MotionEvent.ACTION_DOWN:</span><br><span class="line">               //思考一下为什么要在这里写？</span><br><span class="line">               iDownY = ev.getY();</span><br><span class="line">               break;</span><br><span class="line">           case MotionEvent.ACTION_MOVE:</span><br><span class="line">               int moveY = (int)ev.getY();</span><br><span class="line">               //判断是有效滑动的时候，就进行拦截</span><br><span class="line">               if(Math.abs(moveY - iDownY) &gt; mTouchSlop)&#123;</span><br><span class="line">                   return true;</span><br><span class="line">               &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       return super.onInterceptTouchEvent(ev);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>继续bug的出现以及解决。问题是这样子的，我呢，设置了activity的背景为透明。直接这样继承的话，是不行的，字体会默认没用颜色</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;style name=<span class="string">"Transparent"</span> parent=<span class="string">"Theme.AppCompat"</span>&gt;<span class="comment">//这个父类是不能用的，咱们要用它的子类去写</span></span><br><span class="line">&lt;style name=<span class="string">"Transparent"</span> parent=<span class="string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><br><span class="line">       &lt;item name="android:windowBackground"&gt;@color/transparent&lt;/item&gt;</span><br><span class="line">       &lt;item name="android:windowIsTranslucent"&gt;true&lt;/item&gt;</span><br><span class="line">   &lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h2 id="1月17日-天气-阴"><a href="#1月17日-天气-阴" class="headerlink" title="1月17日 天气:阴"></a>1月17日 天气:阴</h2><p>不如，我们来研究一下String的常量池和栈吧，看看对象都是存放在什么位置。intern就是负责去找一下new到的字符串，如果常量池里面有，就直接取得引用，如果没有，就先放进去，再返回引用。</p>
<ul>
<li>直接使用双引号声明出来的String对象会直接存储在常量池中。</li>
<li>如果不是用双引号声明的String对象，可以使用String提供的intern方法。intern 方法会从字符串常量池中查询当前字符串是否存在，若不存在就会将当前字符串放入常量池中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 使用intern就是为了节省空间</span><br><span class="line"> * new创建的字符串不进入字符串池</span><br><span class="line"> * perm区只有4m，如果大量使用intern(),会造成oom的</span><br><span class="line"> */</span><br><span class="line">public class Intern &#123;</span><br><span class="line">    static final int MAX = 1000 * 10000;</span><br><span class="line">    static final String[] arr = new String[MAX];</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args)throws Exception&#123;</span><br><span class="line"></span><br><span class="line">        String s6 = &quot;a&quot;;//直接在常量池</span><br><span class="line">        String s7 = &quot;b&quot;;</span><br><span class="line">        String s8 = &quot;ab&quot;;</span><br><span class="line">        String s9 = new String(&quot;ab&quot;);//在堆栈</span><br><span class="line">        String s10 = new String(&quot;a&quot;) + new String(&quot;b&quot;);</span><br><span class="line">        String s11 = &quot;a&quot; + &quot;b&quot;;</span><br><span class="line"></span><br><span class="line">        System.out.println(s8 == s9);</span><br><span class="line">        System.out.println(s8 == s9.intern());</span><br><span class="line">        System.out.println(s8 == s11);</span><br><span class="line">        System.out.println(s9 == s10);</span><br><span class="line">        System.out.println(s9.intern() == s10.intern());</span><br><span class="line">        System.out.println(s9.intern() == s11);</span><br><span class="line"></span><br><span class="line">        testIntern(args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void testIntern(String[] args) throws Exception&#123;</span><br><span class="line">        Integer[] DB_DATA = new Integer[10];</span><br><span class="line">        Random random = new Random(10 * 10000);</span><br><span class="line">        for (int i = 0 ; i &lt; DB_DATA.length ; i ++)&#123;</span><br><span class="line">            DB_DATA[i] = random.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        long t = System.currentTimeMillis();</span><br><span class="line">        for (int i = 0 ; i &lt; MAX ; i ++)&#123;</span><br><span class="line">//            arr[i] = new String(String.valueOf(DB_DATA[i % DB_DATA.length]));</span><br><span class="line">            arr[i] = new String(String.valueOf(DB_DATA[i % DB_DATA.length])).intern();//减少对象的生成</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println((System.currentTimeMillis() - t) + &quot;ms&quot;);</span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="1月18日-天气-阴"><a href="#1月18日-天气-阴" class="headerlink" title="1月18日  天气:阴"></a>1月18日  天气:阴</h2><p>debug的时候，你明明已经定位到了问题，也修改了代码，多次发现程序还是原来的样子的时候，记得去clean一下。</p>
<p>自定义控件控制view的旋转什么的，就可以去使用matrix去做。</p>
<p>volatile关键字可以确保应用中的可见性。只要对volatile域产生了写操作，那么所有的读操作都能够看到这个修改。即使是使用了本地缓存，情况也一样。volatile域会立即被写入到主存当中，而读取操作就发生在主存。</p>
<p>某些特殊的情况，记得要去使用原子类去操作，这样，一切的同步操作就可以得到根除，在多线程的时候不会有事。要记住的就是，原子类在普通的编程当中不使用到，但是在调优的时候，它就会大显身手了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicityTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"><span class="comment">//    private static volatile int i = 0;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AtomicInteger i = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//这个虽然是原子性操作，但是缺少同步，也是不稳定状态读取到的数值</span></span><br><span class="line"><span class="comment">//        return i;</span></span><br><span class="line">        <span class="keyword">return</span> i.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">evenIncrement</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        i ++;</span></span><br><span class="line"><span class="comment">//        i ++;</span></span><br><span class="line">        i.addAndGet(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            evenIncrement();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Timer().schedule(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.err.println(<span class="string">"Aborting"</span>);</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">        ExecutorService exec = Executors.newCachedThreadPool();</span><br><span class="line">        AtomicityTest atomicityTest = <span class="keyword">new</span> AtomicityTest();</span><br><span class="line">        exec.execute(atomicityTest);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> val = atomicityTest.getValue();</span><br><span class="line">            <span class="keyword">if</span>(val % <span class="number">2</span> != <span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(val);</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同步控制块。有些时候，我们只是希望去阻止多线程访问方法内部的部分代码，而不是阻止访问整个方法。那部分锁定的区域就是临界区。使用临界区，可以使多个任务访问对象的时间性能得到显著提高。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(synObject)&#123;</span><br><span class="line">  <span class="comment">//This code can be accessed</span></span><br><span class="line">  <span class="comment">//but only one task at a time</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果对某个类的某个操作不是线程安全的，有一种解决办法就是去增加一个中间层，使用中间层进行操作封装，变成同步的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x, y;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.x = x;</span><br><span class="line">        <span class="keyword">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incrementX</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//线程不安全啊</span></span><br><span class="line">        x++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incrementY</span><span class="params">()</span></span>&#123;</span><br><span class="line">        y++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PairValuesNotEqualException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PairValuesNotEqualException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(<span class="string">"Pair values not equal: "</span> + Pair.<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkState</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x != y)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> PairValuesNotEqualException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Pair.x = "</span> + x + <span class="string">" Pair.y"</span> + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个就是模板方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PairManager</span> </span>&#123;</span><br><span class="line">    AtomicInteger checkCounter = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">protected</span> Pair pair = <span class="keyword">new</span> Pair();</span><br><span class="line">    <span class="keyword">private</span> List&lt;Pair&gt; storage = Collections.synchronizedList(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> Pair <span class="title">getPair</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Pair(pair.getX(), pair.getY());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">store</span><span class="params">(Pair p)</span></span>&#123;</span><br><span class="line">        storage.add(p);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">50</span>);</span><br><span class="line">            <span class="keyword">if</span>(storage.size() &gt; <span class="number">50</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">"full"</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; storage.size() ; i ++)&#123;</span><br><span class="line">                    System.out.println(storage.get(i));</span><br><span class="line">                &#125;</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里就可以使用多种方式去进行同步了，使用关键字（方法或者块），lock等</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PairManager1</span> <span class="keyword">extends</span> <span class="title">PairManager</span> </span>&#123;</span><br><span class="line">    <span class="comment">//继承的时候，是可以去添加关键字的，不属于特征签名的组成部分</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        pair.incrementX();</span><br><span class="line">        pair.incrementY();</span><br><span class="line">        store(getPair());<span class="comment">//要使用新对象这种方式去存</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExplicitPairManager1</span> <span class="keyword">extends</span> <span class="title">PairManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            pair.incrementX();</span><br><span class="line">            pair.incrementY();</span><br><span class="line">            store(getPair());</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用同步的时候，要给不同的临界区不同的锁，不然另外的方法得不到执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//锁了整个对象</span></span><br><span class="line">    <span class="keyword">synchronized</span>(Test.class)&#123;</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(Test.class)&#123;</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>##1月19日 天气:阴<br>今天几乎一整天都花在自定义控件里面去了，对于风车那个，我实在是花了好多心血去优化，首先就是要把风车图案整合到一个view里面，因为之前的那个分离，是不能导致居中的，麻烦的就是要去算一堆的坐标，算到它居中。<br>其次，背景也要自己去画好了，不过这样去随便画的话，就会导致堆叠，虽然只是几个规则形状，但是绘制次数就多起来了。所以，我把轮廓用path勾勒出来。</p>
<p>stroke的时候，strokewidth是算进去半径或者其他路径里面的，反正就是算进去。</p>
<p>##1月20日 天气:阴<br>今天早上先学习到了Java并发方面的内容，如何去中断一个在阻塞中的线程呢？有三种阻塞的情况摆在这里，正常sleep，等待io，等待synchronized释放锁。前者是可以直接被中断的，但是后面两个是不能被中断。</p>
<p>Android 已经自带了音视频编码以及混合的api了，只不过要到（4.3）以上的系统才能使用。音频可以使用MediaCodec进行处理，得到aac音频文件；视频也使用这个玩意；等到两者进行进行混合的时候，记住去使用MediaMuxer混合，然后得到mp4文件.</p>
<p>path填充有四种规则，具体的话就没怎么用到，先记录下来也是可以的：EVEN_ODD奇偶规则;INVERSE_EVEN_ODD反奇偶规则;WINDING非零环绕数规则;INVERSE_WINDING反非零环绕数规则;具体怎么用？就是path里面有其他图形，那些图形缠绕在一起的时候，填充哪个部分。其实，只要是涉及到层叠的时候，android是有提供很多种显示模式要给我们。</p>
<p>之前说过多少次，不要在自定义view里面去new对象出来，不然的话，一瞬间就会有很多的对象出现的。其实，是可以重复利用之前的对象的，但是就是对象里面可能有东西，需要清空一下，典型的就是有<code>matrix</code>的使用，多个对象我就去使用了</p>
<p>##1月22日 天气:晴<br>今天来插播一下java运行慢的原因：过度使用堆操作。但是这是面向对象语言的必然特征。</p>
<p>线程调用sleep和yield的时候，并没有释放锁，其他任务就不能获得这个锁，就不能引起其他的改变；线程调用wait的时候，会去释放掉当前的锁，其他任务获得锁以后，会引起改变，而这个改变，则正是使被挂起的任务重新唤醒所感兴趣的变化。有两种形式的wiat:</p>
<ul>
<li>使用指定的时间参数，这个和sleep的休眠一样，但是在wait期间，锁是释放的；可以通过notify、notifyall，或者指令时间到，从中恢复</li>
<li>不使用任何参数，这样线程会一直等待下去，直到接收notify、notifyAll信息，重新唤醒</li>
</ul>
<p>当你使用ExecutorService的shutdownNow的时候，它会调用所有由它控制的线程的interrupt()方法。</p>
<blockquote>
<p>新年到了，暂时先完结</p>
</blockquote>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	<div class="share-jiathis">
	  
<div class="jiathis_style_24x24">
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_googleplus"></a>
	<a class="jiathis_button_douban"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
    var jiathis_config={
    data_track_clickback:true,
    sm:"copy,renren,cqq",
    pic:"",
    summary:"",
     ralateuid:{"tsina":"1634073622"},hideMore:false}
    
  </script> 
<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=
2103362" charset="utf-8"></script>      

	 </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev">
 <a href="/2017/03/15/2017/2017-2月工作笔记/" title="2017-2月工作笔记">
  <strong>上一篇：</strong><br>
  <span>
  2017-2月工作笔记</span>
</a>
</div>


<div class="next">
<a href="/2016/12/31/2016/2016年终总结-今年比较有趣和多事/" title="2016年终总结-今年比较有趣和多事">
 <strong>下一篇：</strong><br> 
 <span>2016年终总结-今年比较有趣和多事
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2017/01/24/2017/2017-1月工作笔记/" data-title="2017-1月工作笔记" data-url="http://yoursite.com/2017/01/24/2017/2017-1月工作笔记/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1月4日-天气-晴"><span class="toc-number">1.</span> <span class="toc-text">1月4日 天气:晴</span></a></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#1月5日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月5日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月6日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月6日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月9日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月9日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月10日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月10日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月11日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月11日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月12日-天气-阴天"><span class="toc-number"></span> <span class="toc-text">1月12日 天气:阴天</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月13日-天气-阴"><span class="toc-number"></span> <span class="toc-text">1月13日 天气:阴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月16日-天气-晴"><span class="toc-number"></span> <span class="toc-text">1月16日 天气:晴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月17日-天气-阴"><span class="toc-number"></span> <span class="toc-text">1月17日 天气:阴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1月18日-天气-阴"><span class="toc-number"></span> <span class="toc-text">1月18日  天气:阴</span></a>
 
  </li></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="Eric1235" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script>
</div>
  </div>



  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/life/" title="life">life<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/work/" title="work">work<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/coding/" title="coding">coding<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/college/" title="college">college<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/feuture/" title="feuture">feuture<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/study/" title="study">study<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/future/" title="future">future<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/me/" title="me">me<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/android/" title="android">android<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/sunshine/" title="sunshine">sunshine<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/work-life/" title="-work -life">-work -life<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/fight/" title="fight">fight<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/improve/" title="improve">improve<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://weicong.win" target="_blank" title="Weicong Blog">Weicong Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self" frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1634073622&verifier=43ce7f75&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer">
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Be Fearless <br>
			Be an Engineer</p>
	</section>
	 
	<div class="social-font">
		
		<a href="http://weibo.com/1634073622" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/Eric1235" target="_blank" class="icon-github" title="github"></a>
		
		
		
		<a href="https://twitter.com/ericli1235" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/lixinkun" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		
		<a href="https://plus.google.com/Eric1235?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:Eric1235@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="Eric Li">Eric Li</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"ericli"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
